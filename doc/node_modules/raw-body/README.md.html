<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/raw-body/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#raw-body">raw-body</a>
      </div>

      <div class="heading h2">
        <a href="#api">API</a>
      </div>

      <div class="heading h3">
        <a href="#getrawbody-stream-options-callback">getRawBody(stream, [options], [callback])</a>
      </div>

      <div class="heading h2">
        <a href="#examples">Examples</a>
      </div>

      <div class="heading h3">
        <a href="#simple-express-example">Simple Express example</a>
      </div>

      <div class="heading h3">
        <a href="#simple-koa-example">Simple Koa example</a>
      </div>

      <div class="heading h3">
        <a href="#using-as-a-promise">Using as a promise</a>
      </div>

      <div class="heading h2">
        <a href="#license">License</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="raw-body">
  <h1>
    <a href="#raw-body" name="raw-body" class="pilcrow"></a>
raw-body
  </h1>
</div>
<p><a href="https://npmjs.org/package/raw-body"><img src="https://img.shields.io/npm/v/raw-body.svg" alt="NPM Version"></a>
<a href="https://npmjs.org/package/raw-body"><img src="https://img.shields.io/npm/dm/raw-body.svg" alt="NPM Downloads"></a>
<a href="https://nodejs.org/en/download/"><img src="https://img.shields.io/node/v/raw-body.svg" alt="Node.js Version"></a>
<a href="https://travis-ci.org/stream-utils/raw-body"><img src="https://img.shields.io/travis/stream-utils/raw-body/master.svg" alt="Build status"></a>
<a href="https://coveralls.io/r/stream-utils/raw-body?branch=master"><img src="https://img.shields.io/coveralls/stream-utils/raw-body/master.svg" alt="Test coverage"></a></p>
<p>Gets the entire buffer of a stream either as a <code>Buffer</code> or a string.
Validates the stream's length against an expected length and maximum limit.
Ideal for parsing request bodies.</p>
<div class="pilwrap" id="api">
  <h2>
    <a href="#api" name="api" class="pilcrow"></a>
API
  </h2>
</div>
<!-- eslint-disable no-unused-vars -->
<pre><code class="js"><span class="hljs-keyword">var</span> getRawBody = <span class="hljs-built_in">require</span>(<span class="hljs-string">'raw-body'</span>)
</code></pre>
<div class="pilwrap" id="getrawbody-stream-options-callback">
  <h3>
    <a href="#getrawbody-stream-options-callback" name="getrawbody-stream-options-callback" class="pilcrow"></a>
getRawBody(stream, [options], [callback])
  </h3>
</div>
<p><strong>Returns a promise if no callback specified and global <code>Promise</code> exists.</strong></p>
<p>Options:</p>
<ul>
<li><code>length</code> - The length of the stream.
If the contents of the stream do not add up to this length,
an <code>400</code> error code is returned.</li>
<li><code>limit</code> - The byte limit of the body.
This is the number of bytes or any string format supported by
<a href="https://www.npmjs.com/package/bytes">bytes</a>,
for example <code>1000</code>, <code>'500kb'</code> or <code>'3mb'</code>.
If the body ends up being larger than this limit,
a <code>413</code> error code is returned.</li>
<li><code>encoding</code> - The encoding to use to decode the body into a string.
By default, a <code>Buffer</code> instance will be returned when no encoding is specified.
Most likely, you want <code>utf-8</code>, so setting <code>encoding</code> to <code>true</code> will decode as <code>utf-8</code>.
You can use any type of encoding supported by <a href="https://www.npmjs.org/package/iconv-lite#readme">iconv-lite</a>.</li>
</ul>
<p>You can also pass a string in place of options to just specify the encoding.</p>
<p><code>callback(err, res)</code>:</p>
<ul>
<li>
<p><code>err</code> - the following attributes will be defined if applicable:</p>
<ul>
<li><code>limit</code> - the limit in bytes</li>
<li><code>length</code> and <code>expected</code> - the expected length of the stream</li>
<li><code>received</code> - the received bytes</li>
<li><code>encoding</code> - the invalid encoding</li>
<li><code>status</code> and <code>statusCode</code> - the corresponding status code for the error</li>
<li><code>type</code> - either <code>entity.too.large</code>, <code>request.aborted</code>, <code>request.size.invalid</code>, <code>stream.encoding.set</code>, or <code>encoding.unsupported</code></li>
</ul>
</li>
<li>
<p><code>res</code> - the result, either as a <code>String</code> if an encoding was set or a <code>Buffer</code> otherwise.</p>
</li>
</ul>
<p>If an error occurs, the stream will be paused, everything unpiped,
and you are responsible for correctly disposing the stream.
For HTTP requests, no handling is required if you send a response.
For streams that use file descriptors, you should <code>stream.destroy()</code> or <code>stream.close()</code> to prevent leaks.</p>
<div class="pilwrap" id="examples">
  <h2>
    <a href="#examples" name="examples" class="pilcrow"></a>
Examples
  </h2>
</div>
<div class="pilwrap" id="simple-express-example">
  <h3>
    <a href="#simple-express-example" name="simple-express-example" class="pilcrow"></a>
Simple Express example
  </h3>
</div>
<pre><code class="js"><span class="hljs-keyword">var</span> contentType = <span class="hljs-built_in">require</span>(<span class="hljs-string">'content-type'</span>)
<span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>)
<span class="hljs-keyword">var</span> getRawBody = <span class="hljs-built_in">require</span>(<span class="hljs-string">'raw-body'</span>)

<span class="hljs-keyword">var</span> app = express()

app.use(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res, next</span>) </span>{
  getRawBody(req, {
    <span class="hljs-attr">length</span>: req.headers[<span class="hljs-string">'content-length'</span>],
    <span class="hljs-attr">limit</span>: <span class="hljs-string">'1mb'</span>,
    <span class="hljs-attr">encoding</span>: contentType.parse(req).parameters.charset
  }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, string</span>) </span>{
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> next(err)
    req.text = string
    next()
  })
})

<span class="hljs-comment">// now access req.text</span>
</code></pre>
<div class="pilwrap" id="simple-koa-example">
  <h3>
    <a href="#simple-koa-example" name="simple-koa-example" class="pilcrow"></a>
Simple Koa example
  </h3>
</div>
<pre><code class="js"><span class="hljs-keyword">var</span> contentType = <span class="hljs-built_in">require</span>(<span class="hljs-string">'content-type'</span>)
<span class="hljs-keyword">var</span> getRawBody = <span class="hljs-built_in">require</span>(<span class="hljs-string">'raw-body'</span>)
<span class="hljs-keyword">var</span> koa = <span class="hljs-built_in">require</span>(<span class="hljs-string">'koa'</span>)

<span class="hljs-keyword">var</span> app = koa()

app.use(<span class="hljs-function"><span class="hljs-keyword">function</span> * (<span class="hljs-params">next</span>) </span>{
  <span class="hljs-keyword">this</span>.text = <span class="hljs-keyword">yield</span> getRawBody(<span class="hljs-keyword">this</span>.req, {
    <span class="hljs-attr">length</span>: <span class="hljs-keyword">this</span>.req.headers[<span class="hljs-string">'content-length'</span>],
    <span class="hljs-attr">limit</span>: <span class="hljs-string">'1mb'</span>,
    <span class="hljs-attr">encoding</span>: contentType.parse(<span class="hljs-keyword">this</span>.req).parameters.charset
  })
  <span class="hljs-keyword">yield</span> next
})

<span class="hljs-comment">// now access this.text</span>
</code></pre>
<div class="pilwrap" id="using-as-a-promise">
  <h3>
    <a href="#using-as-a-promise" name="using-as-a-promise" class="pilcrow"></a>
Using as a promise
  </h3>
</div>
<p>To use this library as a promise, simply omit the <code>callback</code> and a promise is
returned, provided that a global <code>Promise</code> is defined.</p>
<pre><code class="js"><span class="hljs-keyword">var</span> getRawBody = <span class="hljs-built_in">require</span>(<span class="hljs-string">'raw-body'</span>)
<span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>)

<span class="hljs-keyword">var</span> server = http.createServer(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">req, res</span>) </span>{
  getRawBody(req)
  .then(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf</span>) </span>{
    res.statusCode = <span class="hljs-number">200</span>
    res.end(buf.length + <span class="hljs-string">' bytes submitted'</span>)
  })
  .catch(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
    res.statusCode = <span class="hljs-number">500</span>
    res.end(err.message)
  })
})

server.listen(<span class="hljs-number">3000</span>)
</code></pre>
<div class="pilwrap" id="license">
  <h2>
    <a href="#license" name="license" class="pilcrow"></a>
License
  </h2>
</div>
<p><a href="LICENSE.html">MIT</a></p>
</div>
  </div>
</body>
</html>
