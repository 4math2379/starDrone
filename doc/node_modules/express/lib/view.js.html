<!DOCTYPE html>
<html>
<head>
  <title>view.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/express/lib/view.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>view.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>!
express
Copyright(c) 2009-2013 TJ Holowaychuk
Copyright(c) 2013 Roman Shtylman
Copyright(c) 2014-2015 Douglas Christopher Wilson
MIT Licensed</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">
'use strict'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module dependencies.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'express:view'</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module variables.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> dirname = path.dirname;
<span class="hljs-keyword">var</span> basename = path.basename;
<span class="hljs-keyword">var</span> extname = path.extname;
<span class="hljs-keyword">var</span> join = path.join;
<span class="hljs-keyword">var</span> resolve = path.resolve;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module exports.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-built_in">module</span>.exports = View;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Initialize a new <code>View</code> with the given <code>name</code>.</p>
</div>
<div class="body">
<p>Options:</p>
<ul>
<li><code>defaultEngine</code> the default template engine name</li>
<li><code>engines</code> template engine require() cache</li>
<li><code>root</code> root path for view lookup</li>
</ul>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">name</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">object</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">View</span>(<span class="hljs-params">name, options</span>) </span>{
  <span class="hljs-keyword">var</span> opts = options || {};

  <span class="hljs-keyword">this</span>.defaultEngine = opts.defaultEngine;
  <span class="hljs-keyword">this</span>.ext = extname(name);
  <span class="hljs-keyword">this</span>.name = name;
  <span class="hljs-keyword">this</span>.root = opts.root;

  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.ext &amp;&amp; !<span class="hljs-keyword">this</span>.defaultEngine) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'No default engine was specified and no extension was provided.'</span>);
  }

  <span class="hljs-keyword">var</span> fileName = name;

  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.ext) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>get extension from default engine name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.ext = <span class="hljs-keyword">this</span>.defaultEngine[<span class="hljs-number">0</span>] !== <span class="hljs-string">'.'</span>
      ? <span class="hljs-string">'.'</span> + <span class="hljs-keyword">this</span>.defaultEngine
      : <span class="hljs-keyword">this</span>.defaultEngine;

    fileName += <span class="hljs-keyword">this</span>.ext;
  }

  <span class="hljs-keyword">if</span> (!opts.engines[<span class="hljs-keyword">this</span>.ext]) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>load engine</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    opts.engines[<span class="hljs-keyword">this</span>.ext] = <span class="hljs-built_in">require</span>(<span class="hljs-keyword">this</span>.ext.substr(<span class="hljs-number">1</span>)).__express;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>store loaded engine</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>.engine = opts.engines[<span class="hljs-keyword">this</span>.ext];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>lookup path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>.path = <span class="hljs-keyword">this</span>.lookup(fileName);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
<p>Lookup view by the given <code>name</code></p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">name</span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
View.prototype.lookup = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">lookup</span>(<span class="hljs-params">name</span>) </span>{
  <span class="hljs-keyword">var</span> path;
  <span class="hljs-keyword">var</span> roots = [].concat(<span class="hljs-keyword">this</span>.root);

  debug(<span class="hljs-string">'lookup "%s"'</span>, name);

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; roots.length &amp;&amp; !path; i++) {
    <span class="hljs-keyword">var</span> root = roots[i];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>resolve the path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> loc = resolve(root, name);
    <span class="hljs-keyword">var</span> dir = dirname(loc);
    <span class="hljs-keyword">var</span> file = basename(loc);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>resolve the file</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    path = <span class="hljs-keyword">this</span>.resolve(dir, file);
  }

  <span class="hljs-keyword">return</span> path;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p>Render with the given options.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">object</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">function</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
View.prototype.render = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params">options, callback</span>) </span>{
  debug(<span class="hljs-string">'render "%s"'</span>, <span class="hljs-keyword">this</span>.path);
  <span class="hljs-keyword">this</span>.engine(<span class="hljs-keyword">this</span>.path, options, callback);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<div class="dox">
<div class="summary">
<p>Resolve the file within the given directory.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">dir</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">file</span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
View.prototype.resolve = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolve</span>(<span class="hljs-params">dir, file</span>) </span>{
  <span class="hljs-keyword">var</span> ext = <span class="hljs-keyword">this</span>.ext;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p><path>.<ext></p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> path = join(dir, file);
  <span class="hljs-keyword">var</span> stat = tryStat(path);

  <span class="hljs-keyword">if</span> (stat &amp;&amp; stat.isFile()) {
    <span class="hljs-keyword">return</span> path;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p><path>/index.<ext></p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  path = join(dir, basename(file, ext), <span class="hljs-string">'index'</span> + ext);
  stat = tryStat(path);

  <span class="hljs-keyword">if</span> (stat &amp;&amp; stat.isFile()) {
    <span class="hljs-keyword">return</span> path;
  }
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<div class="dox">
<div class="summary">
<p>Return a stat, maybe.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">fs.Stats</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tryStat</span>(<span class="hljs-params">path</span>) </span>{
  debug(<span class="hljs-string">'stat "%s"'</span>, path);

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> fs.statSync(path);
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
  }
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
