<!DOCTYPE html>
<html>
<head>
  <title>layer.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node_modules/express/lib/router/layer.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>layer.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>!
express
Copyright(c) 2009-2013 TJ Holowaychuk
Copyright(c) 2013 Roman Shtylman
Copyright(c) 2014-2015 Douglas Christopher Wilson
MIT Licensed</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">
'use strict'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module dependencies.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> pathRegexp = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path-to-regexp'</span>);
<span class="hljs-keyword">var</span> debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'express:router:layer'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module variables.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> hasOwnProperty = <span class="hljs-built_in">Object</span>.prototype.hasOwnProperty;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module exports.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-built_in">module</span>.exports = Layer;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Layer</span>(<span class="hljs-params">path, options, fn</span>) </span>{
  <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> Layer)) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Layer(path, options, fn);
  }

  debug(<span class="hljs-string">'new %s'</span>, path);
  <span class="hljs-keyword">var</span> opts = options || {};

  <span class="hljs-keyword">this</span>.handle = fn;
  <span class="hljs-keyword">this</span>.name = fn.name || <span class="hljs-string">'&lt;anonymous&gt;'</span>;
  <span class="hljs-keyword">this</span>.params = <span class="hljs-literal">undefined</span>;
  <span class="hljs-keyword">this</span>.path = <span class="hljs-literal">undefined</span>;
  <span class="hljs-keyword">this</span>.regexp = pathRegexp(path, <span class="hljs-keyword">this</span>.keys = [], opts);

  <span class="hljs-keyword">if</span> (path === <span class="hljs-string">'/'</span> &amp;&amp; opts.end === <span class="hljs-literal">false</span>) {
    <span class="hljs-keyword">this</span>.regexp.fast_slash = <span class="hljs-literal">true</span>;
  }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Handle the error for the layer.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">error</span>
<span class="dox_type">Error</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">req</span>
<span class="dox_type">Request</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">res</span>
<span class="dox_type">Response</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">next</span>
<span class="dox_type">function</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
Layer.prototype.handle_error = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle_error</span>(<span class="hljs-params">error, req, res, next</span>) </span>{
  <span class="hljs-keyword">var</span> fn = <span class="hljs-keyword">this</span>.handle;

  <span class="hljs-keyword">if</span> (fn.length !== <span class="hljs-number">4</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>not a standard error handler</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> next(error);
  }

  <span class="hljs-keyword">try</span> {
    fn(error, req, res, next);
  } <span class="hljs-keyword">catch</span> (err) {
    next(err);
  }
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Handle the request for the layer.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">req</span>
<span class="dox_type">Request</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">res</span>
<span class="dox_type">Response</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">next</span>
<span class="dox_type">function</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
Layer.prototype.handle_request = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handle</span>(<span class="hljs-params">req, res, next</span>) </span>{
  <span class="hljs-keyword">var</span> fn = <span class="hljs-keyword">this</span>.handle;

  <span class="hljs-keyword">if</span> (fn.length &gt; <span class="hljs-number">3</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>not a standard request handler</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">return</span> next();
  }

  <span class="hljs-keyword">try</span> {
    fn(req, res, next);
  } <span class="hljs-keyword">catch</span> (err) {
    next(err);
  }
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>Check if this route matches <code>path</code>, if so
populate <code>.params</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Boolean</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
Layer.prototype.match = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">match</span>(<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">if</span> (path == <span class="hljs-literal">null</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>no path, nothing matches</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.params = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>.path = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.regexp.fast_slash) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>fast path non-ending match for / (everything matches)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.params = {};
    <span class="hljs-keyword">this</span>.path = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">this</span>.regexp.exec(path);

  <span class="hljs-keyword">if</span> (!m) {
    <span class="hljs-keyword">this</span>.params = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>.path = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>store values</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>.params = {};
  <span class="hljs-keyword">this</span>.path = m[<span class="hljs-number">0</span>];

  <span class="hljs-keyword">var</span> keys = <span class="hljs-keyword">this</span>.keys;
  <span class="hljs-keyword">var</span> params = <span class="hljs-keyword">this</span>.params;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; m.length; i++) {
    <span class="hljs-keyword">var</span> key = keys[i - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">var</span> prop = key.name;
    <span class="hljs-keyword">var</span> val = decode_param(m[i]);

    <span class="hljs-keyword">if</span> (val !== <span class="hljs-literal">undefined</span> || !(hasOwnProperty.call(params, prop))) {
      params[prop] = val;
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p>Decode param value.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">val</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode_param</span>(<span class="hljs-params">val</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val !== <span class="hljs-string">'string'</span> || val.length === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> val;
  }

  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">decodeURIComponent</span>(val);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">if</span> (err <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">URIError</span>) {
      err.message = <span class="hljs-string">'Failed to decode param \''</span> + val + <span class="hljs-string">'\''</span>;
      err.status = err.statusCode = <span class="hljs-number">400</span>;
    }

    <span class="hljs-keyword">throw</span> err;
  }
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
