<!DOCTYPE html>
<html>
<head>
  <title>response.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/express/lib/response.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>response.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>!
express
Copyright(c) 2009-2013 TJ Holowaychuk
Copyright(c) 2014-2015 Douglas Christopher Wilson
MIT Licensed</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">
'use strict'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module dependencies.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> contentDisposition = <span class="hljs-built_in">require</span>(<span class="hljs-string">'content-disposition'</span>);
<span class="hljs-keyword">var</span> deprecate = <span class="hljs-built_in">require</span>(<span class="hljs-string">'depd'</span>)(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">var</span> encodeUrl = <span class="hljs-built_in">require</span>(<span class="hljs-string">'encodeurl'</span>);
<span class="hljs-keyword">var</span> escapeHtml = <span class="hljs-built_in">require</span>(<span class="hljs-string">'escape-html'</span>);
<span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">var</span> isAbsolute = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>).isAbsolute;
<span class="hljs-keyword">var</span> onFinished = <span class="hljs-built_in">require</span>(<span class="hljs-string">'on-finished'</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">var</span> merge = <span class="hljs-built_in">require</span>(<span class="hljs-string">'utils-merge'</span>);
<span class="hljs-keyword">var</span> sign = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cookie-signature'</span>).sign;
<span class="hljs-keyword">var</span> normalizeType = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>).normalizeType;
<span class="hljs-keyword">var</span> normalizeTypes = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>).normalizeTypes;
<span class="hljs-keyword">var</span> setCharset = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>).setCharset;
<span class="hljs-keyword">var</span> statusCodes = http.STATUS_CODES;
<span class="hljs-keyword">var</span> cookie = <span class="hljs-built_in">require</span>(<span class="hljs-string">'cookie'</span>);
<span class="hljs-keyword">var</span> send = <span class="hljs-built_in">require</span>(<span class="hljs-string">'send'</span>);
<span class="hljs-keyword">var</span> extname = path.extname;
<span class="hljs-keyword">var</span> mime = send.mime;
<span class="hljs-keyword">var</span> resolve = path.resolve;
<span class="hljs-keyword">var</span> vary = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vary'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Response prototype.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> res = <span class="hljs-built_in">module</span>.exports = {
  <span class="hljs-attr">__proto__</span>: http.ServerResponse.prototype
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module variables.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> charsetRegExp = <span class="hljs-regexp">/;\s*charset\s*=/</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set status <code>code</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">code</span>
<span class="dox_type">Number</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">ServerResponse</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.status = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">status</span>(<span class="hljs-params">code</span>) </span>{
  <span class="hljs-keyword">this</span>.statusCode = code;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set Link header field with the given <code>links</code>.</p>
</div>
<div class="body">
<p>Examples:</p>
<p>res.links({
next: 'http://api.example.com/users?page=2',
last: 'http://api.example.com/users?page=5'
});</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">links</span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">ServerResponse</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.links = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">links</span>)</span>{
  <span class="hljs-keyword">var</span> link = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'Link'</span>) || <span class="hljs-string">''</span>;
  <span class="hljs-keyword">if</span> (link) link += <span class="hljs-string">', '</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Link'</span>, link + <span class="hljs-built_in">Object</span>.keys(links).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">rel</span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;'</span> + links[rel] + <span class="hljs-string">'&gt;; rel="'</span> + rel + <span class="hljs-string">'"'</span>;
  }).join(<span class="hljs-string">', '</span>));
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Send a response.</p>
</div>
<div class="body">
<p>Examples:</p>
<pre><code>res.send(new Buffer('wahoo'));
res.send({ some: 'json' });
res.send('&lt;p&gt;some html&lt;/p&gt;');</code></pre>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">body</span>
<span class="dox_type">string</span>
<span class="dox_type">number</span>
<span class="dox_type">boolean</span>
<span class="dox_type">object</span>
<span class="dox_type">Buffer</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.send = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">send</span>(<span class="hljs-params">body</span>) </span>{
  <span class="hljs-keyword">var</span> chunk = body;
  <span class="hljs-keyword">var</span> encoding;
  <span class="hljs-keyword">var</span> len;
  <span class="hljs-keyword">var</span> req = <span class="hljs-keyword">this</span>.req;
  <span class="hljs-keyword">var</span> type;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>settings</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> app = <span class="hljs-keyword">this</span>.app;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>allow status / body</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>res.send(body, status) backwards compat</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] !== <span class="hljs-string">'number'</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>] === <span class="hljs-string">'number'</span>) {
      deprecate(<span class="hljs-string">'res.send(body, status): Use res.status(status).send(body) instead'</span>);
      <span class="hljs-keyword">this</span>.statusCode = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
    } <span class="hljs-keyword">else</span> {
      deprecate(<span class="hljs-string">'res.send(status, body): Use res.status(status).send(body) instead'</span>);
      <span class="hljs-keyword">this</span>.statusCode = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
      chunk = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>disambiguate res.send(status) and res.send(status, num)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> chunk === <span class="hljs-string">'number'</span> &amp;&amp; <span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>res.send(status) will set status message as text string</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'Content-Type'</span>)) {
      <span class="hljs-keyword">this</span>.type(<span class="hljs-string">'txt'</span>);
    }

    deprecate(<span class="hljs-string">'res.send(status): Use res.sendStatus(status) instead'</span>);
    <span class="hljs-keyword">this</span>.statusCode = chunk;
    chunk = statusCodes[chunk];
  }

  <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">typeof</span> chunk) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>string defaulting to html</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">case</span> <span class="hljs-string">'string'</span>:
      <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'Content-Type'</span>)) {
        <span class="hljs-keyword">this</span>.type(<span class="hljs-string">'html'</span>);
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">'boolean'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'number'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'object'</span>:
      <span class="hljs-keyword">if</span> (chunk === <span class="hljs-literal">null</span>) {
        chunk = <span class="hljs-string">''</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Buffer.isBuffer(chunk)) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'Content-Type'</span>)) {
          <span class="hljs-keyword">this</span>.type(<span class="hljs-string">'bin'</span>);
        }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.json(chunk);
      }
      <span class="hljs-keyword">break</span>;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>write strings in utf-8</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> chunk === <span class="hljs-string">'string'</span>) {
    encoding = <span class="hljs-string">'utf8'</span>;
    type = <span class="hljs-keyword">this</span>.get(<span class="hljs-string">'Content-Type'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>reflect this in content-type</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> type === <span class="hljs-string">'string'</span>) {
      <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Content-Type'</span>, setCharset(type, <span class="hljs-string">'utf-8'</span>));
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>populate Content-Length</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (chunk !== <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">if</span> (!Buffer.isBuffer(chunk)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>convert chunk to Buffer; saves later double conversions</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      chunk = <span class="hljs-keyword">new</span> Buffer(chunk, encoding);
      encoding = <span class="hljs-literal">undefined</span>;
    }

    len = chunk.length;
    <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Content-Length'</span>, len);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>populate ETag</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> etag;
  <span class="hljs-keyword">var</span> generateETag = len !== <span class="hljs-literal">undefined</span> &amp;&amp; app.get(<span class="hljs-string">'etag fn'</span>);
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> generateETag === <span class="hljs-string">'function'</span> &amp;&amp; !<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'ETag'</span>)) {
    <span class="hljs-keyword">if</span> ((etag = generateETag(chunk, encoding))) {
      <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'ETag'</span>, etag);
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>freshness</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (req.fresh) <span class="hljs-keyword">this</span>.statusCode = <span class="hljs-number">304</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>strip irrelevant headers</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-number">204</span> === <span class="hljs-keyword">this</span>.statusCode || <span class="hljs-number">304</span> === <span class="hljs-keyword">this</span>.statusCode) {
    <span class="hljs-keyword">this</span>.removeHeader(<span class="hljs-string">'Content-Type'</span>);
    <span class="hljs-keyword">this</span>.removeHeader(<span class="hljs-string">'Content-Length'</span>);
    <span class="hljs-keyword">this</span>.removeHeader(<span class="hljs-string">'Transfer-Encoding'</span>);
    chunk = <span class="hljs-string">''</span>;
  }

  <span class="hljs-keyword">if</span> (req.method === <span class="hljs-string">'HEAD'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>skip body for HEAD</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.end();
  } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>respond</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.end(chunk, encoding);
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<div class="dox">
<div class="summary">
<p>Send JSON response.</p>
</div>
<div class="body">
<p>Examples:</p>
<pre><code>res.json(null);
res.json({ user: 'tj' });</code></pre>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">obj</span>
<span class="dox_type">string</span>
<span class="dox_type">number</span>
<span class="dox_type">boolean</span>
<span class="dox_type">object</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.json = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">json</span>(<span class="hljs-params">obj</span>) </span>{
  <span class="hljs-keyword">var</span> val = obj;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>allow status / body</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>res.json(body, status) backwards compat</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>] === <span class="hljs-string">'number'</span>) {
      deprecate(<span class="hljs-string">'res.json(obj, status): Use res.status(status).json(obj) instead'</span>);
      <span class="hljs-keyword">this</span>.statusCode = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
    } <span class="hljs-keyword">else</span> {
      deprecate(<span class="hljs-string">'res.json(status, obj): Use res.status(status).json(obj) instead'</span>);
      <span class="hljs-keyword">this</span>.statusCode = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
      val = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>settings</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> app = <span class="hljs-keyword">this</span>.app;
  <span class="hljs-keyword">var</span> replacer = app.get(<span class="hljs-string">'json replacer'</span>);
  <span class="hljs-keyword">var</span> spaces = app.get(<span class="hljs-string">'json spaces'</span>);
  <span class="hljs-keyword">var</span> body = stringify(val, replacer, spaces);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>content-type</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'Content-Type'</span>)) {
    <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/json'</span>);
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.send(body);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<div class="dox">
<div class="summary">
<p>Send JSON response with JSONP callback support.</p>
</div>
<div class="body">
<p>Examples:</p>
<pre><code>res.jsonp(null);
res.jsonp({ user: 'tj' });</code></pre>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">obj</span>
<span class="dox_type">string</span>
<span class="dox_type">number</span>
<span class="dox_type">boolean</span>
<span class="dox_type">object</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.jsonp = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jsonp</span>(<span class="hljs-params">obj</span>) </span>{
  <span class="hljs-keyword">var</span> val = obj;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>allow status / body</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>res.json(body, status) backwards compat</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>] === <span class="hljs-string">'number'</span>) {
      deprecate(<span class="hljs-string">'res.jsonp(obj, status): Use res.status(status).json(obj) instead'</span>);
      <span class="hljs-keyword">this</span>.statusCode = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
    } <span class="hljs-keyword">else</span> {
      deprecate(<span class="hljs-string">'res.jsonp(status, obj): Use res.status(status).jsonp(obj) instead'</span>);
      <span class="hljs-keyword">this</span>.statusCode = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
      val = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>settings</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> app = <span class="hljs-keyword">this</span>.app;
  <span class="hljs-keyword">var</span> replacer = app.get(<span class="hljs-string">'json replacer'</span>);
  <span class="hljs-keyword">var</span> spaces = app.get(<span class="hljs-string">'json spaces'</span>);
  <span class="hljs-keyword">var</span> body = stringify(val, replacer, spaces);
  <span class="hljs-keyword">var</span> callback = <span class="hljs-keyword">this</span>.req.query[app.get(<span class="hljs-string">'jsonp callback name'</span>)];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>content-type</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.get(<span class="hljs-string">'Content-Type'</span>)) {
    <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'X-Content-Type-Options'</span>, <span class="hljs-string">'nosniff'</span>);
    <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/json'</span>);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>fixup callback</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(callback)) {
    callback = callback[<span class="hljs-number">0</span>];
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>jsonp</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">'string'</span> &amp;&amp; callback.length !== <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">this</span>.charset = <span class="hljs-string">'utf-8'</span>;
    <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'X-Content-Type-Options'</span>, <span class="hljs-string">'nosniff'</span>);
    <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/javascript'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>restrict callback charset</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    callback = callback.replace(<span class="hljs-regexp">/[^\[\]\w$.]/g</span>, <span class="hljs-string">''</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>replace chars not allowed in JavaScript that are in JSON</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    body = body
      .replace(<span class="hljs-regexp">/\u2028/g</span>, <span class="hljs-string">'\\u2028'</span>)
      .replace(<span class="hljs-regexp">/\u2029/g</span>, <span class="hljs-string">'\\u2029'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>the /**/ is a specific security mitigation for &quot;Rosetta Flash JSONP abuse&quot;
the typeof check is just to reduce client error noise</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    body = <span class="hljs-string">'/**/ typeof '</span> + callback + <span class="hljs-string">' === \'function\' &amp;&amp; '</span> + callback + <span class="hljs-string">'('</span> + body + <span class="hljs-string">');'</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.send(body);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<div class="dox">
<div class="summary">
<p>Send given HTTP status code.</p>
</div>
<div class="body">
<p>Sets the response status to <code>statusCode</code> and the body of the
response to the standard description from node's http.STATUS_CODES
or the statusCode number if no description.</p>
<p>Examples:</p>
<pre><code>res.sendStatus(200);</code></pre>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">statusCode</span>
<span class="dox_type">number</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.sendStatus = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendStatus</span>(<span class="hljs-params">statusCode</span>) </span>{
  <span class="hljs-keyword">var</span> body = statusCodes[statusCode] || <span class="hljs-built_in">String</span>(statusCode);

  <span class="hljs-keyword">this</span>.statusCode = statusCode;
  <span class="hljs-keyword">this</span>.type(<span class="hljs-string">'txt'</span>);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.send(body);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<div class="dox">
<div class="summary">
<p>Transfer the file at the given <code>path</code>.</p>
</div>
<div class="body">
<p>Automatically sets the <em>Content-Type</em> response header field.
The callback <code>callback(err)</code> is invoked when the transfer is complete
or when an error occurs. Be sure to check <code>res.sentHeader</code>
if you wish to attempt responding, as the header and some data
may have already been transferred.</p>
<p>Options:</p>
<ul>
<li><code>maxAge</code>   defaulting to 0 (can be string converted by <code>ms</code>)</li>
<li><code>root</code>     root directory for relative filenames</li>
<li><code>headers</code>  object of headers to serve with file</li>
<li><code>dotfiles</code> serve dotfiles, defaulting to false; can be <code>&quot;allow&quot;</code> to send them</li>
</ul>
<p>Other options are passed along to <code>send</code>.</p>
<p>Examples:</p>
<p>The following example illustrates how <code>res.sendFile()</code> may
be used as an alternative for the <code>static()</code> middleware for
dynamic situations. The code backing <code>res.sendFile()</code> is actually
the same code, so HTTP cache support etc is identical.</p>
<pre><code>app.get('/user/:uid/photos/:file', function(req, res){
  var uid = req.params.uid
    , file = req.params.file;
<p>req.user.mayViewFilesFrom(uid, function(yes){
if (yes) {
res.sendFile('/uploads/' + uid + '/' + file);
} else {
res.send(403, 'Sorry! you cant see that.');
}
});
});</code></pre></p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.sendFile = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendFile</span>(<span class="hljs-params">path, options, callback</span>) </span>{
  <span class="hljs-keyword">var</span> done = callback;
  <span class="hljs-keyword">var</span> req = <span class="hljs-keyword">this</span>.req;
  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">var</span> next = req.next;
  <span class="hljs-keyword">var</span> opts = options || {};

  <span class="hljs-keyword">if</span> (!path) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'path argument is required to res.sendFile'</span>);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>support function as second arg</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options === <span class="hljs-string">'function'</span>) {
    done = options;
    opts = {};
  }

  <span class="hljs-keyword">if</span> (!opts.root &amp;&amp; !isAbsolute(path)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'path must be absolute or specify root to res.sendFile'</span>);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>create file stream</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> pathname = <span class="hljs-built_in">encodeURI</span>(path);
  <span class="hljs-keyword">var</span> file = send(req, pathname, opts);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>transfer</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  sendfile(res, file, opts, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">return</span> done(err);
    <span class="hljs-keyword">if</span> (err &amp;&amp; err.code === <span class="hljs-string">'EISDIR'</span>) <span class="hljs-keyword">return</span> next();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>next() all but write errors</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (err &amp;&amp; err.code !== <span class="hljs-string">'ECONNABORTED'</span> &amp;&amp; err.syscall !== <span class="hljs-string">'write'</span>) {
      next(err);
    }
  });
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<div class="dox">
<div class="summary">
<p>Transfer the file at the given <code>path</code>.</p>
</div>
<div class="body">
<p>Automatically sets the <em>Content-Type</em> response header field.
The callback <code>callback(err)</code> is invoked when the transfer is complete
or when an error occurs. Be sure to check <code>res.sentHeader</code>
if you wish to attempt responding, as the header and some data
may have already been transferred.</p>
<p>Options:</p>
<ul>
<li><code>maxAge</code>   defaulting to 0 (can be string converted by <code>ms</code>)</li>
<li><code>root</code>     root directory for relative filenames</li>
<li><code>headers</code>  object of headers to serve with file</li>
<li><code>dotfiles</code> serve dotfiles, defaulting to false; can be <code>&quot;allow&quot;</code> to send them</li>
</ul>
<p>Other options are passed along to <code>send</code>.</p>
<p>Examples:</p>
<p>The following example illustrates how <code>res.sendfile()</code> may
be used as an alternative for the <code>static()</code> middleware for
dynamic situations. The code backing <code>res.sendfile()</code> is actually
the same code, so HTTP cache support etc is identical.</p>
<pre><code>app.get('/user/:uid/photos/:file', function(req, res){
  var uid = req.params.uid
    , file = req.params.file;
<p>req.user.mayViewFilesFrom(uid, function(yes){
if (yes) {
res.sendfile('/uploads/' + uid + '/' + file);
} else {
res.send(403, 'Sorry! you cant see that.');
}
});
});</code></pre></p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.sendfile = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">path, options, callback</span>) </span>{
  <span class="hljs-keyword">var</span> done = callback;
  <span class="hljs-keyword">var</span> req = <span class="hljs-keyword">this</span>.req;
  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">this</span>;
  <span class="hljs-keyword">var</span> next = req.next;
  <span class="hljs-keyword">var</span> opts = options || {};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<p>support function as second arg</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options === <span class="hljs-string">'function'</span>) {
    done = options;
    opts = {};
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>create file stream</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> file = send(req, path, opts);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>transfer</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  sendfile(res, file, opts, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">return</span> done(err);
    <span class="hljs-keyword">if</span> (err &amp;&amp; err.code === <span class="hljs-string">'EISDIR'</span>) <span class="hljs-keyword">return</span> next();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<p>next() all but write errors</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (err &amp;&amp; err.code !== <span class="hljs-string">'ECONNABORT'</span> &amp;&amp; err.syscall !== <span class="hljs-string">'write'</span>) {
      next(err);
    }
  });
};

res.sendfile = deprecate.function(res.sendfile,
  <span class="hljs-string">'res.sendfile: Use res.sendFile instead'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<div class="dox">
<div class="summary">
<p>Transfer the file at the given <code>path</code> as an attachment.</p>
</div>
<div class="body">
<p>Optionally providing an alternate attachment <code>filename</code>,
and optional callback <code>callback(err)</code>. The callback is invoked
when the data transfer is complete, or when an error has
ocurred. Be sure to check <code>res.headersSent</code> if you plan to respond.</p>
<p>This method uses <code>res.sendfile()</code>.</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.download = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">download</span>(<span class="hljs-params">path, filename, callback</span>) </span>{
  <span class="hljs-keyword">var</span> done = callback;
  <span class="hljs-keyword">var</span> name = filename;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<p>support function as second arg</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> filename === <span class="hljs-string">'function'</span>) {
    done = filename;
    name = <span class="hljs-literal">null</span>;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<p>set Content-Disposition when file is sent</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> headers = {
    <span class="hljs-string">'Content-Disposition'</span>: contentDisposition(name || path)
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52"></a>
</div>
<p>Resolve the full path for sendFile</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> fullPath = resolve(path);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.sendFile(fullPath, { <span class="hljs-attr">headers</span>: headers }, done);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set <em>Content-Type</em> response header with <code>type</code> through <code>mime.lookup()</code>
when it does not contain &quot;/&quot;, or set the Content-Type to <code>type</code> otherwise.</p>
</div>
<div class="body">
<p>Examples:</p>
<pre><code>res.type('.html');
res.type('html');
res.type('json');
res.type('application/json');
res.type('png');</code></pre>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">type</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">ServerResponse</span>
<span>for chaining
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.contentType =
res.type = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contentType</span>(<span class="hljs-params">type</span>) </span>{
  <span class="hljs-keyword">var</span> ct = type.indexOf(<span class="hljs-string">'/'</span>) === <span class="hljs-number">-1</span>
    ? mime.lookup(type)
    : type;

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Content-Type'</span>, ct);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54"></a>
</div>
<div class="dox">
<div class="summary">
<p>Respond to the Acceptable formats using an <code>obj</code>
of mime-type callbacks.</p>
</div>
<div class="body">
<p>This method uses <code>req.accepted</code>, an array of
acceptable types ordered by their quality values.
When &quot;Accept&quot; is not present the <em>first</em> callback
is invoked, otherwise the first match is used. When
no match is performed the server responds with
406 &quot;Not Acceptable&quot;.</p>
<p>Content-Type is set for you, however if you choose
you may alter this within the callback using <code>res.type()</code>
or <code>res.set('Content-Type', ...)</code>.</p>
<p>res.format({
'text/plain': function(){
res.send('hey');
},</p>
<pre><code> 'text/html': function(){
   res.send('&lt;p&gt;hey&lt;/p&gt;');
 },
<p>'appliation/json': function(){
res.send({ message: 'hey' });
}
</code></pre></p>
<p>});</p>
<p>In addition to canonicalized MIME types you may
also use extnames mapped to these types:</p>
<p>res.format({
text: function(){
res.send('hey');
},</p>
<pre><code> html: function(){
   res.send('&lt;p&gt;hey&lt;/p&gt;');
 },
<p>json: function(){
res.send({ message: 'hey' });
}
</code></pre></p>
<p>});</p>
<p>By default Express passes an <code>Error</code>
with a <code>.status</code> of 406 to <code>next(err)</code>
if a match is not made. If you provide
a <code>.default</code> callback it will be invoked
instead.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">obj</span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">ServerResponse</span>
<span>for chaining
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.format = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>)</span>{
  <span class="hljs-keyword">var</span> req = <span class="hljs-keyword">this</span>.req;
  <span class="hljs-keyword">var</span> next = req.next;

  <span class="hljs-keyword">var</span> fn = obj.default;
  <span class="hljs-keyword">if</span> (fn) <span class="hljs-keyword">delete</span> obj.default;
  <span class="hljs-keyword">var</span> keys = <span class="hljs-built_in">Object</span>.keys(obj);

  <span class="hljs-keyword">var</span> key = keys.length &gt; <span class="hljs-number">0</span>
    ? req.accepts(keys)
    : <span class="hljs-literal">false</span>;

  <span class="hljs-keyword">this</span>.vary(<span class="hljs-string">"Accept"</span>);

  <span class="hljs-keyword">if</span> (key) {
    <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Content-Type'</span>, normalizeType(key).value);
    obj[key](req, <span class="hljs-keyword">this</span>, next);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (fn) {
    fn();
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Not Acceptable'</span>);
    err.status = err.statusCode = <span class="hljs-number">406</span>;
    err.types = normalizeTypes(keys).map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">o</span>)</span>{ <span class="hljs-keyword">return</span> o.value });
    next(err);
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set <em>Content-Disposition</em> header to <em>attachment</em> with optional <code>filename</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">filename</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">ServerResponse</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.attachment = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">attachment</span>(<span class="hljs-params">filename</span>) </span>{
  <span class="hljs-keyword">if</span> (filename) {
    <span class="hljs-keyword">this</span>.type(extname(filename));
  }

  <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Content-Disposition'</span>, contentDisposition(filename));

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56"></a>
</div>
<div class="dox">
<div class="summary">
<p>Append additional header <code>field</code> with value <code>val</code>.</p>
</div>
<div class="body">
<p>Example:</p>
<p>res.append('Link', ['<a href="http://localhost/">http://localhost/</a>', '<a href="http://localhost:3000/">http://localhost:3000/</a>']);
res.append('Set-Cookie', 'foo=bar; Path=/; HttpOnly');
res.append('Warning', '199 Miscellaneous warning');</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">field</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">val</span>
<span class="dox_type">String</span>
<span class="dox_type">Array</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">ServerResponse</span>
<span>for chaining
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.append = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">append</span>(<span class="hljs-params">field, val</span>) </span>{
  <span class="hljs-keyword">var</span> prev = <span class="hljs-keyword">this</span>.get(field);
  <span class="hljs-keyword">var</span> value = val;

  <span class="hljs-keyword">if</span> (prev) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57"></a>
</div>
<p>concat the new and prev vals</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    value = <span class="hljs-built_in">Array</span>.isArray(prev) ? prev.concat(val)
      : <span class="hljs-built_in">Array</span>.isArray(val) ? [prev].concat(val)
      : [prev, val];
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.set(field, value);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set header <code>field</code> to <code>val</code>, or pass
an object of header fields.</p>
</div>
<div class="body">
<p>Examples:</p>
<p>res.set('Foo', ['bar', 'baz']);
res.set('Accept', 'application/json');
res.set({ Accept: 'text/plain', 'X-API-Key': 'tobi' });</p>
<p>Aliased as <code>res.header()</code>.</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">field</span>
<span class="dox_type">String</span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">val</span>
<span class="dox_type">String</span>
<span class="dox_type">Array</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">ServerResponse</span>
<span>for chaining
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.set =
res.header = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">header</span>(<span class="hljs-params">field, val</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">var</span> value = <span class="hljs-built_in">Array</span>.isArray(val)
      ? val.map(<span class="hljs-built_in">String</span>)
      : <span class="hljs-built_in">String</span>(val);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59"></a>
</div>
<p>add charset to content-type</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (field.toLowerCase() === <span class="hljs-string">'content-type'</span> &amp;&amp; !charsetRegExp.test(value)) {
      <span class="hljs-keyword">var</span> charset = mime.charsets.lookup(value.split(<span class="hljs-string">';'</span>)[<span class="hljs-number">0</span>]);
      <span class="hljs-keyword">if</span> (charset) value += <span class="hljs-string">'; charset='</span> + charset.toLowerCase();
    }

    <span class="hljs-keyword">this</span>.setHeader(field, value);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> field) {
      <span class="hljs-keyword">this</span>.set(key, field[key]);
    }
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60"></a>
</div>
<div class="dox">
<div class="summary">
<p>Get value for header <code>field</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">field</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">String</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.get = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">field</span>)</span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.getHeader(field);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61"></a>
</div>
<div class="dox">
<div class="summary">
<p>Clear cookie <code>name</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">name</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[options]</span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">ServerResponse</span>
<span>for chaining
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.clearCookie = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearCookie</span>(<span class="hljs-params">name, options</span>) </span>{
  <span class="hljs-keyword">var</span> opts = merge({ <span class="hljs-attr">expires</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">1</span>), <span class="hljs-attr">path</span>: <span class="hljs-string">'/'</span> }, options);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.cookie(name, <span class="hljs-string">''</span>, opts);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set cookie <code>name</code> to <code>value</code>, with the given <code>options</code>.</p>
</div>
<div class="body">
<p>Options:</p>
<ul>
<li><code>maxAge</code>   max-age in milliseconds, converted to <code>expires</code></li>
<li><code>signed</code>   sign the cookie</li>
<li><code>path</code>     defaults to &quot;/&quot;</li>
</ul>
<p>Examples:</p>
<p>// &quot;Remember Me&quot; for 15 minutes
res.cookie('rememberme', '1', { expires: new Date(Date.now() + 900000), httpOnly: true });</p>
<p>// save as above
res.cookie('rememberme', '1', { maxAge: 900000, httpOnly: true })</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">name</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">value</span>
<span class="dox_type">String</span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">Options</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">ServerResponse</span>
<span>for chaining
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.cookie = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, value, options</span>) </span>{
  <span class="hljs-keyword">var</span> opts = merge({}, options);
  <span class="hljs-keyword">var</span> secret = <span class="hljs-keyword">this</span>.req.secret;
  <span class="hljs-keyword">var</span> signed = opts.signed;

  <span class="hljs-keyword">if</span> (signed &amp;&amp; !secret) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'cookieParser("secret") required for signed cookies'</span>);
  }

  <span class="hljs-keyword">var</span> val = <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span>
    ? <span class="hljs-string">'j:'</span> + <span class="hljs-built_in">JSON</span>.stringify(value)
    : <span class="hljs-built_in">String</span>(value);

  <span class="hljs-keyword">if</span> (signed) {
    val = <span class="hljs-string">'s:'</span> + sign(val, secret);
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-string">'maxAge'</span> <span class="hljs-keyword">in</span> opts) {
    opts.expires = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-built_in">Date</span>.now() + opts.maxAge);
    opts.maxAge /= <span class="hljs-number">1000</span>;
  }

  <span class="hljs-keyword">if</span> (opts.path == <span class="hljs-literal">null</span>) {
    opts.path = <span class="hljs-string">'/'</span>;
  }

  <span class="hljs-keyword">this</span>.append(<span class="hljs-string">'Set-Cookie'</span>, cookie.serialize(name, <span class="hljs-built_in">String</span>(val), opts));

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set the location header to <code>url</code>.</p>
</div>
<div class="body">
<p>The given <code>url</code> can also be &quot;back&quot;, which redirects
to the <em>Referrer</em> or <em>Referer</em> headers or &quot;/&quot;.</p>
<p>Examples:</p>
<p>res.location('/foo/bar').;
res.location('http://example.com');
res.location('../login');</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">url</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">ServerResponse</span>
<span>for chaining
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.location = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">location</span>(<span class="hljs-params">url</span>) </span>{
  <span class="hljs-keyword">var</span> loc = url;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64"></a>
</div>
<p>&quot;back&quot; is an alias for the referrer</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (url === <span class="hljs-string">'back'</span>) {
    loc = <span class="hljs-keyword">this</span>.req.get(<span class="hljs-string">'Referrer'</span>) || <span class="hljs-string">'/'</span>;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65"></a>
</div>
<p>set location</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Location'</span>, encodeUrl(loc));
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66"></a>
</div>
<div class="dox">
<div class="summary">
<p>Redirect to the given <code>url</code> with optional response <code>status</code>
defaulting to 302.</p>
</div>
<div class="body">
<p>The resulting <code>url</code> is determined by <code>res.location()</code>, so
it will play nicely with mounted apps, relative paths,
<code>&quot;back&quot;</code> etc.</p>
<p>Examples:</p>
<p>res.redirect('/foo/bar');
res.redirect('http://example.com');
res.redirect(301, 'http://example.com');
res.redirect('../login'); // /blog/post/1 -&gt; /blog/login</p>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.redirect = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">redirect</span>(<span class="hljs-params">url</span>) </span>{
  <span class="hljs-keyword">var</span> address = url;
  <span class="hljs-keyword">var</span> body;
  <span class="hljs-keyword">var</span> status = <span class="hljs-number">302</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67"></a>
</div>
<p>allow status / url</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">2</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] === <span class="hljs-string">'number'</span>) {
      status = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
      address = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
    } <span class="hljs-keyword">else</span> {
      deprecate(<span class="hljs-string">'res.redirect(url, status): Use res.redirect(status, url) instead'</span>);
      status = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68"></a>
</div>
<p>Set location header</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  address = <span class="hljs-keyword">this</span>.location(address).get(<span class="hljs-string">'Location'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69"></a>
</div>
<p>Support text/{plain,html} by default</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>.format({
    <span class="hljs-attr">text</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      body = statusCodes[status] + <span class="hljs-string">'. Redirecting to '</span> + address;
    },

    <span class="hljs-attr">html</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      <span class="hljs-keyword">var</span> u = escapeHtml(address);
      body = <span class="hljs-string">'&lt;p&gt;'</span> + statusCodes[status] + <span class="hljs-string">'. Redirecting to &lt;a href="'</span> + u + <span class="hljs-string">'"&gt;'</span> + u + <span class="hljs-string">'&lt;/a&gt;&lt;/p&gt;'</span>;
    },

    <span class="hljs-attr">default</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
      body = <span class="hljs-string">''</span>;
    }
  });

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70"></a>
</div>
<p>Respond</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>.statusCode = status;
  <span class="hljs-keyword">this</span>.set(<span class="hljs-string">'Content-Length'</span>, Buffer.byteLength(body));

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.req.method === <span class="hljs-string">'HEAD'</span>) {
    <span class="hljs-keyword">this</span>.end();
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">this</span>.end(body);
  }
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71"></a>
</div>
<div class="dox">
<div class="summary">
<p>Add <code>field</code> to Vary. If already present in the Vary set, then
this call is simply ignored.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">field</span>
<span class="dox_type">Array</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">ServerResponse</span>
<span>for chaining
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.vary = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">field</span>)</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-72" id="section-72"></a>
</div>
<p>checks for back-compat</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!field || (<span class="hljs-built_in">Array</span>.isArray(field) &amp;&amp; !field.length)) {
    deprecate(<span class="hljs-string">'res.vary(): Provide a field name'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  }

  vary(<span class="hljs-keyword">this</span>, field);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73"></a>
</div>
<div class="dox">
<div class="summary">
<p>Render <code>view</code> with the given <code>options</code> and optional callback <code>fn</code>.
When a callback function is given a response will <em>not</em> be made
automatically, otherwise a response of <em>200</em> and <em>text/html</em> is given.</p>
</div>
<div class="body">
<p>Options:</p>
<ul>
<li><code>cache</code>     boolean hinting to the engine it should cache</li>
<li><code>filename</code>  filename of the view being rendered</li>
</ul>
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
res.render = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params">view, options, callback</span>) </span>{
  <span class="hljs-keyword">var</span> app = <span class="hljs-keyword">this</span>.req.app;
  <span class="hljs-keyword">var</span> done = callback;
  <span class="hljs-keyword">var</span> opts = options || {};
  <span class="hljs-keyword">var</span> req = <span class="hljs-keyword">this</span>.req;
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74"></a>
</div>
<p>support callback function as second arg</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options === <span class="hljs-string">'function'</span>) {
    done = options;
    opts = {};
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75"></a>
</div>
<p>merge res.locals</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  opts._locals = self.locals;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76"></a>
</div>
<p>default callback to respond</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  done = done || <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, str</span>) </span>{
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> req.next(err);
    self.send(str);
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77"></a>
</div>
<p>render</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  app.render(view, opts, done);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78"></a>
</div>
<p>pipe the send file stream</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendfile</span>(<span class="hljs-params">res, file, options, callback</span>) </span>{
  <span class="hljs-keyword">var</span> done = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">var</span> streaming;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79"></a>
</div>
<p>request aborted</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onaborted</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">return</span>;
    done = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Request aborted'</span>);
    err.code = <span class="hljs-string">'ECONNABORTED'</span>;
    callback(err);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80"></a>
</div>
<p>directory</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ondirectory</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">return</span>;
    done = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'EISDIR, read'</span>);
    err.code = <span class="hljs-string">'EISDIR'</span>;
    callback(err);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81"></a>
</div>
<p>errors</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onerror</span>(<span class="hljs-params">err</span>) </span>{
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">return</span>;
    done = <span class="hljs-literal">true</span>;
    callback(err);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82"></a>
</div>
<p>ended</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onend</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">return</span>;
    done = <span class="hljs-literal">true</span>;
    callback();
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83"></a>
</div>
<p>file</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onfile</span>(<span class="hljs-params"></span>) </span>{
    streaming = <span class="hljs-literal">false</span>;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84"></a>
</div>
<p>finished</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onfinish</span>(<span class="hljs-params">err</span>) </span>{
    <span class="hljs-keyword">if</span> (err &amp;&amp; err.code === <span class="hljs-string">'ECONNRESET'</span>) <span class="hljs-keyword">return</span> onaborted();
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> onerror(err);
    <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">return</span>;

    setImmediate(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">if</span> (streaming !== <span class="hljs-literal">false</span> &amp;&amp; !done) {
        onaborted();
        <span class="hljs-keyword">return</span>;
      }

      <span class="hljs-keyword">if</span> (done) <span class="hljs-keyword">return</span>;
      done = <span class="hljs-literal">true</span>;
      callback();
    });
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85"></a>
</div>
<p>streaming</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onstream</span>(<span class="hljs-params"></span>) </span>{
    streaming = <span class="hljs-literal">true</span>;
  }

  file.on(<span class="hljs-string">'directory'</span>, ondirectory);
  file.on(<span class="hljs-string">'end'</span>, onend);
  file.on(<span class="hljs-string">'error'</span>, onerror);
  file.on(<span class="hljs-string">'file'</span>, onfile);
  file.on(<span class="hljs-string">'stream'</span>, onstream);
  onFinished(res, onfinish);

  <span class="hljs-keyword">if</span> (options.headers) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86"></a>
</div>
<p>set headers on successful transfer</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    file.on(<span class="hljs-string">'headers'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">headers</span>(<span class="hljs-params">res</span>) </span>{
      <span class="hljs-keyword">var</span> obj = options.headers;
      <span class="hljs-keyword">var</span> keys = <span class="hljs-built_in">Object</span>.keys(obj);

      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; keys.length; i++) {
        <span class="hljs-keyword">var</span> k = keys[i];
        res.setHeader(k, obj[k]);
      }
    });
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87"></a>
</div>
<p>pipe</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  file.pipe(res);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88"></a>
</div>
<div class="dox">
<div class="summary">
<p>Stringify JSON, like JSON.stringify, but v8 optimized.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stringify</span>(<span class="hljs-params">value, replacer, spaces</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89"></a>
</div>
<p>v8 checks arguments.length for optimizing simple call
https://bugs.chromium.org/p/v8/issues/detail?id=4730</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">return</span> replacer || spaces
    ? <span class="hljs-built_in">JSON</span>.stringify(value, replacer, spaces)
    : <span class="hljs-built_in">JSON</span>.stringify(value);
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
