<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/function-bind/test/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>);

<span class="hljs-keyword">var</span> functionBind = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../implementation'</span>);
<span class="hljs-keyword">var</span> getCurrentContext = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>; };

test(<span class="hljs-string">'functionBind is a function'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
    t.equal(<span class="hljs-keyword">typeof</span> functionBind, <span class="hljs-string">'function'</span>);
    t.end();
});

test(<span class="hljs-string">'non-functions'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
    <span class="hljs-keyword">var</span> nonFunctions = [<span class="hljs-literal">true</span>, <span class="hljs-literal">false</span>, [], {}, <span class="hljs-number">42</span>, <span class="hljs-string">'foo'</span>, <span class="hljs-literal">NaN</span>, /a/g];
    t.plan(nonFunctions.length);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; nonFunctions.length; ++i) {
        <span class="hljs-keyword">try</span> { functionBind.call(nonFunctions[i]); } <span class="hljs-keyword">catch</span> (ex) {
            t.ok(ex <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">TypeError</span>, <span class="hljs-string">'throws when given '</span> + <span class="hljs-built_in">String</span>(nonFunctions[i]));
        }
    }
    t.end();
});

test(<span class="hljs-string">'without a context'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
    t.test(<span class="hljs-string">'binds properly'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> args, context;
        <span class="hljs-keyword">var</span> namespace = {
            <span class="hljs-attr">func</span>: functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
                context = <span class="hljs-keyword">this</span>;
            })
        };
        namespace.func(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
        st.deepEqual(args, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);
        st.equal(context, getCurrentContext.call());
        st.end();
    });

    t.test(<span class="hljs-string">'binds properly, and still supplies bound arguments'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> args, context;
        <span class="hljs-keyword">var</span> namespace = {
            <span class="hljs-attr">func</span>: functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
                context = <span class="hljs-keyword">this</span>;
            }, <span class="hljs-literal">undefined</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
        };
        namespace.func(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>);
        st.deepEqual(args, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]);
        st.equal(context, getCurrentContext.call());
        st.end();
    });

    t.test(<span class="hljs-string">'returns properly'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> args;
        <span class="hljs-keyword">var</span> namespace = {
            <span class="hljs-attr">func</span>: functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            }, <span class="hljs-literal">null</span>)
        };
        <span class="hljs-keyword">var</span> context = namespace.func(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
        st.equal(context, getCurrentContext.call(), <span class="hljs-string">'returned context is namespaced context'</span>);
        st.deepEqual(args, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-string">'passed arguments are correct'</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'returns properly with bound arguments'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> args;
        <span class="hljs-keyword">var</span> namespace = {
            <span class="hljs-attr">func</span>: functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            }, <span class="hljs-literal">null</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
        };
        <span class="hljs-keyword">var</span> context = namespace.func(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>);
        st.equal(context, getCurrentContext.call(), <span class="hljs-string">'returned context is namespaced context'</span>);
        st.deepEqual(args, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>], <span class="hljs-string">'passed arguments are correct'</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'called as a constructor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> thunkify = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> value; };
        };
        st.test(<span class="hljs-string">'returns object value'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">sst</span>) </span>{
            <span class="hljs-keyword">var</span> expectedReturnValue = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];
            <span class="hljs-keyword">var</span> Constructor = functionBind.call(thunkify(expectedReturnValue), <span class="hljs-literal">null</span>);
            <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> Constructor();
            sst.equal(result, expectedReturnValue);
            sst.end();
        });

        st.test(<span class="hljs-string">'does not return primitive value'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">sst</span>) </span>{
            <span class="hljs-keyword">var</span> Constructor = functionBind.call(thunkify(<span class="hljs-number">42</span>), <span class="hljs-literal">null</span>);
            <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> Constructor();
            sst.notEqual(result, <span class="hljs-number">42</span>);
            sst.end();
        });

        st.test(<span class="hljs-string">'object from bound constructor is instance of original and bound constructor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">sst</span>) </span>{
            <span class="hljs-keyword">var</span> A = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">x</span>) </span>{
                <span class="hljs-keyword">this</span>.name = x || <span class="hljs-string">'A'</span>;
            };
            <span class="hljs-keyword">var</span> B = functionBind.call(A, <span class="hljs-literal">null</span>, <span class="hljs-string">'B'</span>);

            <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> B();
            sst.ok(result <span class="hljs-keyword">instanceof</span> B, <span class="hljs-string">'result is instance of bound constructor'</span>);
            sst.ok(result <span class="hljs-keyword">instanceof</span> A, <span class="hljs-string">'result is instance of original constructor'</span>);
            sst.end();
        });

        st.end();
    });

    t.end();
});

test(<span class="hljs-string">'with a context'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
    t.test(<span class="hljs-string">'with no bound arguments'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> args, context;
        <span class="hljs-keyword">var</span> boundContext = {};
        <span class="hljs-keyword">var</span> namespace = {
            <span class="hljs-attr">func</span>: functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
                context = <span class="hljs-keyword">this</span>;
            }, boundContext)
        };
        namespace.func(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
        st.equal(context, boundContext, <span class="hljs-string">'binds a context properly'</span>);
        st.deepEqual(args, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-string">'supplies passed arguments'</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'with bound arguments'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> args, context;
        <span class="hljs-keyword">var</span> boundContext = {};
        <span class="hljs-keyword">var</span> namespace = {
            <span class="hljs-attr">func</span>: functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
                context = <span class="hljs-keyword">this</span>;
            }, boundContext, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
        };
        namespace.func(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>);
        st.equal(context, boundContext, <span class="hljs-string">'binds a context properly'</span>);
        st.deepEqual(args, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>], <span class="hljs-string">'supplies bound and passed arguments'</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'returns properly'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> boundContext = {};
        <span class="hljs-keyword">var</span> args;
        <span class="hljs-keyword">var</span> namespace = {
            <span class="hljs-attr">func</span>: functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            }, boundContext)
        };
        <span class="hljs-keyword">var</span> context = namespace.func(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);
        st.equal(context, boundContext, <span class="hljs-string">'returned context is bound context'</span>);
        st.notEqual(context, getCurrentContext.call(), <span class="hljs-string">'returned context is not lexical context'</span>);
        st.deepEqual(args, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-string">'passed arguments are correct'</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'returns properly with bound arguments'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> boundContext = {};
        <span class="hljs-keyword">var</span> args;
        <span class="hljs-keyword">var</span> namespace = {
            <span class="hljs-attr">func</span>: functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            }, boundContext, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)
        };
        <span class="hljs-keyword">var</span> context = namespace.func(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>);
        st.equal(context, boundContext, <span class="hljs-string">'returned context is bound context'</span>);
        st.notEqual(context, getCurrentContext.call(), <span class="hljs-string">'returned context is not lexical context'</span>);
        st.deepEqual(args, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>], <span class="hljs-string">'passed arguments are correct'</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'passes the correct arguments when called as a constructor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> expected = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Correct'</span> };
        <span class="hljs-keyword">var</span> namespace = {
            <span class="hljs-attr">Func</span>: functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{
                <span class="hljs-keyword">return</span> arg;
            }, { <span class="hljs-attr">name</span>: <span class="hljs-string">'Incorrect'</span> })
        };
        <span class="hljs-keyword">var</span> returned = <span class="hljs-keyword">new</span> namespace.Func(expected);
        st.equal(returned, expected, <span class="hljs-string">'returns the right arg when called as a constructor'</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'has the new instance\'s context when called as a constructor'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> actualContext;
        <span class="hljs-keyword">var</span> expectedContext = { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> };
        <span class="hljs-keyword">var</span> namespace = {
            <span class="hljs-attr">Func</span>: functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                actualContext = <span class="hljs-keyword">this</span>;
            }, expectedContext)
        };
        <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">new</span> namespace.Func();
        st.equal(result <span class="hljs-keyword">instanceof</span> namespace.Func, <span class="hljs-literal">true</span>);
        st.notEqual(actualContext, expectedContext);
        st.end();
    });

    t.end();
});

test(<span class="hljs-string">'bound function length'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
    t.test(<span class="hljs-string">'sets a correct length without thisArg'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> subject = functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b, c</span>) </span>{ <span class="hljs-keyword">return</span> a + b + c; });
        st.equal(subject.length, <span class="hljs-number">3</span>);
        st.equal(subject(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>), <span class="hljs-number">6</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'sets a correct length with thisArg'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> subject = functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b, c</span>) </span>{ <span class="hljs-keyword">return</span> a + b + c; }, {});
        st.equal(subject.length, <span class="hljs-number">3</span>);
        st.equal(subject(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>), <span class="hljs-number">6</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'sets a correct length without thisArg and first argument'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> subject = functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b, c</span>) </span>{ <span class="hljs-keyword">return</span> a + b + c; }, <span class="hljs-literal">undefined</span>, <span class="hljs-number">1</span>);
        st.equal(subject.length, <span class="hljs-number">2</span>);
        st.equal(subject(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), <span class="hljs-number">6</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'sets a correct length with thisArg and first argument'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> subject = functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b, c</span>) </span>{ <span class="hljs-keyword">return</span> a + b + c; }, {}, <span class="hljs-number">1</span>);
        st.equal(subject.length, <span class="hljs-number">2</span>);
        st.equal(subject(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>), <span class="hljs-number">6</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'sets a correct length without thisArg and too many arguments'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> subject = functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b, c</span>) </span>{ <span class="hljs-keyword">return</span> a + b + c; }, <span class="hljs-literal">undefined</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>);
        st.equal(subject.length, <span class="hljs-number">0</span>);
        st.equal(subject(), <span class="hljs-number">6</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'sets a correct length with thisArg and too many arguments'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> subject = functionBind.call(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b, c</span>) </span>{ <span class="hljs-keyword">return</span> a + b + c; }, {}, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>);
        st.equal(subject.length, <span class="hljs-number">0</span>);
        st.equal(subject(), <span class="hljs-number">6</span>);
        st.end();
    });
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
