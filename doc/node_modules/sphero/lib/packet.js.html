<!DOCTYPE html>
<html>
<head>
  <title>packet.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/sphero/lib/packet.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>packet.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;

<span class="hljs-keyword">var</span> inherits = <span class="hljs-built_in">require</span>(<span class="hljs-string">"util"</span>).inherits,
    EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">"events"</span>).EventEmitter;

<span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./utils"</span>),
    RES_PARSER = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./parsers/response.js"</span>),
    ASYNC_PARSER = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./parsers/async.js"</span>);

<span class="hljs-keyword">var</span> MIN_BUFFER_SIZE = <span class="hljs-number">6</span>,
    FIELDS = {
      <span class="hljs-attr">size</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">sop1</span>: {
        <span class="hljs-attr">pos</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">hex</span>: <span class="hljs-number">0xFF</span>
      },
      <span class="hljs-attr">sop2</span>: {
        <span class="hljs-attr">pos</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">sync</span>: <span class="hljs-number">0xFF</span>,
        <span class="hljs-attr">async</span>: <span class="hljs-number">0xFE</span>,
      },
      <span class="hljs-attr">mrspHex</span>: <span class="hljs-number">0x00</span>,
      <span class="hljs-attr">seqHex</span>: <span class="hljs-number">0x00</span>,
      <span class="hljs-attr">mrspIdCode</span>: <span class="hljs-number">2</span>,
      <span class="hljs-attr">seqMsb</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">dlenLsb</span>: <span class="hljs-number">4</span>,
      <span class="hljs-attr">checksum</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">didHex</span>: <span class="hljs-number">0x00</span>,
      <span class="hljs-attr">cidHex</span>: <span class="hljs-number">0x01</span>
    };

<span class="hljs-keyword">var</span> Packet = <span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.partialBuffer = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">0</span>);
  <span class="hljs-keyword">this</span>.partialCounter = <span class="hljs-number">0</span>;
};

inherits(Packet, EventEmitter);

Packet.prototype.create = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opts</span>) </span>{
  opts = opts || {};

  <span class="hljs-keyword">var</span> sop1 = (opts.sop1 === <span class="hljs-literal">undefined</span>) ? FIELDS.sop1.hex : opts.sop1,
      sop2 = (opts.sop2 === <span class="hljs-literal">undefined</span>) ? FIELDS.sop2.sync : opts.sop2,
      did = (opts.did === <span class="hljs-literal">undefined</span>) ? FIELDS.didHex : opts.did,
      cid = (opts.cid === <span class="hljs-literal">undefined</span>) ? FIELDS.cidHex : opts.cid,
      seq = (opts.seq === <span class="hljs-literal">undefined</span>) ? FIELDS.seqHex : opts.seq,
      data = (!opts.data) ? [] : opts.data,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Add 1 to dlen, since it also counts the checksum byte</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      dlen = data.length + <span class="hljs-number">1</span>,
      checksum = <span class="hljs-number">0x00</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Create array with packet bytes</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> packet = [
    sop1, sop2, did, cid, seq, dlen
  ].concat(data);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Get checksum for final byte in packet</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  checksum = utils.checksum(packet.slice(<span class="hljs-number">2</span>));

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Add checksum to packet</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  packet.push(checksum);

  <span class="hljs-keyword">return</span> packet;
};

Packet.prototype.parse = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.partialBuffer.length &gt; <span class="hljs-number">0</span>) {
    buffer = Buffer.concat(
      [<span class="hljs-keyword">this</span>.partialBuffer, buffer],
      buffer.length + <span class="hljs-keyword">this</span>.partialBuffer.length
    );

    <span class="hljs-keyword">this</span>.partialBuffer = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">0</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">this</span>.partialBuffer = <span class="hljs-keyword">new</span> Buffer(buffer);
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._checkSOPs(buffer)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Check the packet is at least 6 bytes long</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._checkMinSize(buffer)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Check the buffer length matches the
DLEN value specified in the buffer</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._checkExpectedSize(buffer) &gt; <span class="hljs-number">-1</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>If the packet looks good parse it</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._parse(buffer);
      }
    }

    <span class="hljs-keyword">this</span>.partialBuffer = <span class="hljs-keyword">new</span> Buffer(buffer);
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};

Packet.prototype._parse = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer</span>) </span>{
  <span class="hljs-keyword">var</span> packet = {};
  packet.sop1 = buffer[FIELDS.sop1.pos];
  packet.sop2 = buffer[FIELDS.sop2.pos];

  <span class="hljs-keyword">var</span> bByte2 = buffer[FIELDS.mrspIdCode],
      bByte3 = buffer[FIELDS.seqMsb],
      bByte4 = buffer[FIELDS.dlenLsb];

  <span class="hljs-keyword">if</span> (FIELDS.sop2.sync === buffer[FIELDS.sop2.pos]) {
    packet.mrsp = bByte2;
    packet.seq = bByte3;
    packet.dlen = bByte4;
  } <span class="hljs-keyword">else</span> {
    packet.idCode = bByte2;
    packet.dlenMsb = bByte3;
    packet.dlenLsb = bByte4;
  }

  packet.dlen = <span class="hljs-keyword">this</span>._extractDlen(buffer);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Create new Buffer for data that is dlen -1 (minus checksum) in size</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  packet.data = <span class="hljs-keyword">new</span> Buffer(packet.dlen - <span class="hljs-number">1</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Copy data from buffer into packet.data</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  buffer.copy(packet.data, <span class="hljs-number">0</span>, FIELDS.size, FIELDS.size + packet.dlen - <span class="hljs-number">1</span>);
  packet.checksum = buffer[FIELDS.size + packet.dlen - <span class="hljs-number">1</span>];

  <span class="hljs-keyword">this</span>._dealWithExtraBytes(buffer);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._verifyChecksum(buffer, packet);
};

Packet.prototype._dealWithExtraBytes = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>If the packet was parsed successfully, and the buffer and
expected size of the buffer are the same,clean up the
partialBuffer, otherwise assign extrabytes to partialBuffer</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> expectedSize = <span class="hljs-keyword">this</span>._checkExpectedSize(buffer);
  <span class="hljs-keyword">if</span> (buffer.length &gt; expectedSize) {
    <span class="hljs-keyword">this</span>.partialBuffer = <span class="hljs-keyword">new</span> Buffer(buffer.length - expectedSize);
    buffer.copy(<span class="hljs-keyword">this</span>.partialBuffer, <span class="hljs-number">0</span>, expectedSize);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">this</span>.partialBuffer = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">0</span>);
  }
};

Packet.prototype._verifyChecksum = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer, packet</span>) </span>{
  <span class="hljs-keyword">var</span> bSlice = buffer.slice(
        FIELDS.mrspIdCode,
        FIELDS.checksum + packet.dlen - <span class="hljs-number">1</span>
      ),
      checksum = utils.checksum(bSlice);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>If we got an incorrect checksum we cleanup the packet,
partialBuffer, return null and emit an error event</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (checksum !== packet.checksum) {
    packet = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.partialBuffer = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">"error"</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Incorrect checksum, packet discarded!"</span>));
  }

  <span class="hljs-keyword">return</span> packet;
};

Packet.prototype.parseAsyncData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">payload, ds</span>) </span>{
  <span class="hljs-keyword">var</span> parser = ASYNC_PARSER[payload.idCode];

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._parseData(parser, payload, ds);
};

Packet.prototype.parseResponseData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cmd, payload</span>) </span>{
  <span class="hljs-keyword">if</span> (!cmd || cmd.did === <span class="hljs-literal">undefined</span> || cmd.cid === <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">return</span> payload;
  }

  <span class="hljs-keyword">var</span> parserId = cmd.did.toString(<span class="hljs-number">16</span>) + <span class="hljs-string">":"</span> + cmd.cid.toString(<span class="hljs-number">16</span>),
      parser = RES_PARSER[parserId];

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._parseData(parser, payload);
};

Packet.prototype._parseData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parser, payload, ds</span>) </span>{
  <span class="hljs-keyword">var</span> data = payload.data,
      pData, fields, field;


  <span class="hljs-keyword">if</span> (parser &amp;&amp; (data.length &gt; <span class="hljs-number">0</span>)) {

    ds = <span class="hljs-keyword">this</span>._checkDSMasks(ds, parser);

    <span class="hljs-keyword">if</span> (ds === <span class="hljs-number">-1</span>) {
      <span class="hljs-keyword">return</span> payload;
    }

    fields = parser.fields;

    pData = {
      <span class="hljs-attr">desc</span>: parser.desc,
      <span class="hljs-attr">idCode</span>: parser.idCode,
      <span class="hljs-attr">event</span>: parser.event,
      <span class="hljs-attr">did</span>: parser.did,
      <span class="hljs-attr">cid</span>: parser.cid,
      <span class="hljs-attr">packet</span>: payload
    };


    <span class="hljs-keyword">var</span> dsIndex = <span class="hljs-number">0</span>,
        dsFlag = <span class="hljs-number">0</span>,
        i = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">while</span> (i &lt; fields.length) {
      field = fields[i];

      dsFlag = <span class="hljs-keyword">this</span>._checkDSBit(ds, field);

      <span class="hljs-keyword">if</span> (dsFlag === <span class="hljs-number">1</span>) {
        field.from = dsIndex;
        field.to = dsIndex = dsIndex + <span class="hljs-number">2</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dsFlag === <span class="hljs-number">0</span>) {
        i = <span class="hljs-keyword">this</span>._incParserIndex(i, fields, data, dsFlag, dsIndex);
        <span class="hljs-keyword">continue</span>;
      }

      pData[field.name] = <span class="hljs-keyword">this</span>._parseField(field, data, pData);

      i = <span class="hljs-keyword">this</span>._incParserIndex(i, fields, data, dsFlag, dsIndex);
    }
  } <span class="hljs-keyword">else</span> {
    pData = payload;
  }

  <span class="hljs-keyword">return</span> pData;
};

Packet.prototype._checkDSMasks = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ds, parser</span>) </span>{
  <span class="hljs-keyword">if</span> (parser.idCode === <span class="hljs-number">0x03</span>) {
    <span class="hljs-keyword">if</span> (!(ds &amp;&amp; ds.mask1 != <span class="hljs-literal">null</span> &amp;&amp; ds.mask2 != <span class="hljs-literal">null</span>)) {
      <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-keyword">return</span> ds;
};

Packet.prototype._incParserIndex = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i, fields, data, dsFlag, dsIndex</span>) </span>{
  i++;

  <span class="hljs-keyword">if</span> ((dsFlag &gt;= <span class="hljs-number">0</span>) &amp;&amp; (i === fields.length) &amp;&amp; (dsIndex &lt; data.length)) {
    i = <span class="hljs-number">0</span>;
  }

  <span class="hljs-keyword">return</span> i;
};

Packet.prototype._checkDSBit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ds, field</span>) </span>{
  <span class="hljs-keyword">if</span> (!ds) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.abs(ds[field.maskField] &amp; field.bitmask) &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
};

Packet.prototype._parseField = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">field, data, pData</span>) </span>{
  <span class="hljs-keyword">var</span> pField;

  data = data.slice(field.from, field.to);
  pField = utils.bufferToInt(data);

  <span class="hljs-keyword">switch</span> (field.type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">"number"</span>:
      <span class="hljs-keyword">if</span> (field.format === <span class="hljs-string">"hex"</span>) {
        pField = <span class="hljs-string">"0x"</span> + pField.toString(<span class="hljs-number">16</span>).toUpperCase();
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"string"</span>:
      pField = data.toString(field.format).replace(<span class="hljs-regexp">/\0/g</span>, <span class="hljs-string">"0"</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"raw"</span>:
      pField = <span class="hljs-keyword">new</span> Buffer(data);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"predefined"</span>:
      <span class="hljs-keyword">if</span> (field.mask != <span class="hljs-literal">null</span>) {
        pField &amp;= field.mask;
      }
      pField = field.values[pField];
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">"bitmask"</span>:
      pField = <span class="hljs-keyword">this</span>._parseBitmaskField(pField, field, pData);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">"error"</span>, <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Data could not be parsed!"</span>));
      pField = <span class="hljs-string">"Data could not be parsed!"</span>;
      <span class="hljs-keyword">break</span>;
  }

  <span class="hljs-keyword">return</span> pField;
};

Packet.prototype._parseBitmaskField = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val, field, pData</span>) </span>{
  <span class="hljs-keyword">var</span> pField = {};

  <span class="hljs-keyword">if</span> (val &gt; field.range.top) {
    val = utils.twosToInt(val, <span class="hljs-number">2</span>);
  }

  <span class="hljs-keyword">if</span> (pData[field.name]) {
    pField = pData[field.name];
    pField.value.push(val);
  } <span class="hljs-keyword">else</span> {
    pField = {
      <span class="hljs-attr">sensor</span>: field.sensor,
      <span class="hljs-attr">range</span>: field.range,
      <span class="hljs-attr">units</span>: field.units,
      <span class="hljs-attr">value</span>: [val]
    };
  }

  <span class="hljs-keyword">return</span> pField;
};

Packet.prototype._checkSOPs = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer</span>) </span>{
  <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._checkSOP1(buffer)) ? <span class="hljs-keyword">this</span>._checkSOP2(buffer) : <span class="hljs-literal">false</span>;
};

Packet.prototype._checkSOP1 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer</span>) </span>{
  <span class="hljs-keyword">return</span> (buffer[FIELDS.sop1.pos] === FIELDS.sop1.hex);
};

Packet.prototype._checkSOP2 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer</span>) </span>{
  <span class="hljs-keyword">var</span> sop2 = buffer[FIELDS.sop2.pos];

  <span class="hljs-keyword">if</span> (sop2 === FIELDS.sop2.sync) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"sync"</span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sop2 === FIELDS.sop2.async) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">"async"</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

Packet.prototype._checkExpectedSize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>Size = buffer fields size (SOP1, SOP2, MSRP, SEQ and DLEN) + DLEN value</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> expectedSize = FIELDS.size + <span class="hljs-keyword">this</span>._extractDlen(buffer),
      bufferSize = buffer.length;

  <span class="hljs-keyword">return</span> (bufferSize &lt; expectedSize) ? <span class="hljs-number">-1</span> : expectedSize;
};

Packet.prototype._checkMinSize = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer</span>) </span>{
  <span class="hljs-keyword">return</span> (buffer.length &gt;= MIN_BUFFER_SIZE);
};

Packet.prototype._extractDlen = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">buffer</span>) </span>{
  <span class="hljs-keyword">if</span> (buffer[FIELDS.sop2.pos] === FIELDS.sop2.sync) {
    <span class="hljs-keyword">return</span> buffer[FIELDS.dlenLsb];
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>We shift the dlen MSB 8 bits and then do a binary OR
between the two values to obtain the dlen value</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">return</span> (buffer[FIELDS.seqMsb] &lt;&lt; <span class="hljs-number">8</span>) | buffer[FIELDS.dlenLsb];
};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
