<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/send/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>!
send
Copyright(c) 2012 TJ Holowaychuk
Copyright(c) 2014-2016 Douglas Christopher Wilson
MIT Licensed</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">
'use strict'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module dependencies.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> createError = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http-errors'</span>)
<span class="hljs-keyword">var</span> debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">'debug'</span>)(<span class="hljs-string">'send'</span>)
<span class="hljs-keyword">var</span> deprecate = <span class="hljs-built_in">require</span>(<span class="hljs-string">'depd'</span>)(<span class="hljs-string">'send'</span>)
<span class="hljs-keyword">var</span> destroy = <span class="hljs-built_in">require</span>(<span class="hljs-string">'destroy'</span>)
<span class="hljs-keyword">var</span> encodeUrl = <span class="hljs-built_in">require</span>(<span class="hljs-string">'encodeurl'</span>)
<span class="hljs-keyword">var</span> escapeHtml = <span class="hljs-built_in">require</span>(<span class="hljs-string">'escape-html'</span>)
<span class="hljs-keyword">var</span> etag = <span class="hljs-built_in">require</span>(<span class="hljs-string">'etag'</span>)
<span class="hljs-keyword">var</span> EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'events'</span>).EventEmitter
<span class="hljs-keyword">var</span> fresh = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fresh'</span>)
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">var</span> mime = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mime'</span>)
<span class="hljs-keyword">var</span> ms = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ms'</span>)
<span class="hljs-keyword">var</span> onFinished = <span class="hljs-built_in">require</span>(<span class="hljs-string">'on-finished'</span>)
<span class="hljs-keyword">var</span> parseRange = <span class="hljs-built_in">require</span>(<span class="hljs-string">'range-parser'</span>)
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">var</span> statuses = <span class="hljs-built_in">require</span>(<span class="hljs-string">'statuses'</span>)
<span class="hljs-keyword">var</span> Stream = <span class="hljs-built_in">require</span>(<span class="hljs-string">'stream'</span>)
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Path function references.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> extname = path.extname
<span class="hljs-keyword">var</span> join = path.join
<span class="hljs-keyword">var</span> normalize = path.normalize
<span class="hljs-keyword">var</span> resolve = path.resolve
<span class="hljs-keyword">var</span> sep = path.sep

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Regular expression for identifying a bytes Range header.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> BYTES_RANGE_REGEXP = <span class="hljs-regexp">/^ *bytes=/</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Maximum value allowed for the max age.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> MAX_MAXAGE = <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">24</span> * <span class="hljs-number">365</span> * <span class="hljs-number">1000</span> <span class="hljs-comment">// 1 year</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>Regular expression to match a path with a directory up component.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> UP_PATH_REGEXP = <span class="hljs-regexp">/(?:^|[\\\/])\.\.(?:[\\\/]|$)/</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module exports.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-built_in">module</span>.exports = send
<span class="hljs-built_in">module</span>.exports.mime = mime

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<p>Shim EventEmitter.listenerCount for node.js &lt; 0.10</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-comment">/* istanbul ignore next */</span>
<span class="hljs-keyword">var</span> listenerCount = EventEmitter.listenerCount ||
  <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">emitter, type</span>) </span>{ <span class="hljs-keyword">return</span> emitter.listeners(type).length }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>Return a <code>SendStream</code> for <code>req</code> and <code>path</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">req</span>
<span class="dox_type">object</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[options]</span>
<span class="dox_type">object</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">SendStream</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">send</span> (<span class="hljs-params">req, path, options</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SendStream(req, path, options)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
<p>Initialize a <code>SendStream</code> with the given <code>path</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">req</span>
<span class="dox_type">Request</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[options]</span>
<span class="dox_type">object</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SendStream</span> (<span class="hljs-params">req, path, options</span>) </span>{
  Stream.call(<span class="hljs-keyword">this</span>)

  <span class="hljs-keyword">var</span> opts = options || {}

  <span class="hljs-keyword">this</span>.options = opts
  <span class="hljs-keyword">this</span>.path = path
  <span class="hljs-keyword">this</span>.req = req

  <span class="hljs-keyword">this</span>._acceptRanges = opts.acceptRanges !== <span class="hljs-literal">undefined</span>
    ? <span class="hljs-built_in">Boolean</span>(opts.acceptRanges)
    : <span class="hljs-literal">true</span>

  <span class="hljs-keyword">this</span>._cacheControl = opts.cacheControl !== <span class="hljs-literal">undefined</span>
    ? <span class="hljs-built_in">Boolean</span>(opts.cacheControl)
    : <span class="hljs-literal">true</span>

  <span class="hljs-keyword">this</span>._etag = opts.etag !== <span class="hljs-literal">undefined</span>
    ? <span class="hljs-built_in">Boolean</span>(opts.etag)
    : <span class="hljs-literal">true</span>

  <span class="hljs-keyword">this</span>._dotfiles = opts.dotfiles !== <span class="hljs-literal">undefined</span>
    ? opts.dotfiles
    : <span class="hljs-string">'ignore'</span>

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._dotfiles !== <span class="hljs-string">'ignore'</span> &amp;&amp; <span class="hljs-keyword">this</span>._dotfiles !== <span class="hljs-string">'allow'</span> &amp;&amp; <span class="hljs-keyword">this</span>._dotfiles !== <span class="hljs-string">'deny'</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'dotfiles option must be "allow", "deny", or "ignore"'</span>)
  }

  <span class="hljs-keyword">this</span>._hidden = <span class="hljs-built_in">Boolean</span>(opts.hidden)

  <span class="hljs-keyword">if</span> (opts.hidden !== <span class="hljs-literal">undefined</span>) {
    deprecate(<span class="hljs-string">'hidden: use dotfiles: \''</span> + (<span class="hljs-keyword">this</span>._hidden ? <span class="hljs-string">'allow'</span> : <span class="hljs-string">'ignore'</span>) + <span class="hljs-string">'\' instead'</span>)
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>legacy support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (opts.dotfiles === <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">this</span>._dotfiles = <span class="hljs-literal">undefined</span>
  }

  <span class="hljs-keyword">this</span>._extensions = opts.extensions !== <span class="hljs-literal">undefined</span>
    ? normalizeList(opts.extensions, <span class="hljs-string">'extensions option'</span>)
    : []

  <span class="hljs-keyword">this</span>._index = opts.index !== <span class="hljs-literal">undefined</span>
    ? normalizeList(opts.index, <span class="hljs-string">'index option'</span>)
    : [<span class="hljs-string">'index.html'</span>]

  <span class="hljs-keyword">this</span>._lastModified = opts.lastModified !== <span class="hljs-literal">undefined</span>
    ? <span class="hljs-built_in">Boolean</span>(opts.lastModified)
    : <span class="hljs-literal">true</span>

  <span class="hljs-keyword">this</span>._maxage = opts.maxAge || opts.maxage
  <span class="hljs-keyword">this</span>._maxage = <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">this</span>._maxage === <span class="hljs-string">'string'</span>
    ? ms(<span class="hljs-keyword">this</span>._maxage)
    : <span class="hljs-built_in">Number</span>(<span class="hljs-keyword">this</span>._maxage)
  <span class="hljs-keyword">this</span>._maxage = !<span class="hljs-built_in">isNaN</span>(<span class="hljs-keyword">this</span>._maxage)
    ? <span class="hljs-built_in">Math</span>.min(<span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>._maxage), MAX_MAXAGE)
    : <span class="hljs-number">0</span>

  <span class="hljs-keyword">this</span>._root = opts.root
    ? resolve(opts.root)
    : <span class="hljs-literal">null</span>

  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._root &amp;&amp; opts.from) {
    <span class="hljs-keyword">this</span>.from(opts.from)
  }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<div class="dox">
<div class="summary">
<p>Inherits from <code>Stream</code>.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
util.inherits(SendStream, Stream)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p>Enable or disable etag generation.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">val</span>
<span class="dox_type">Boolean</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">SendStream</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">public</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.etag = deprecate.function(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">etag</span> (<span class="hljs-params">val</span>) </span>{
  <span class="hljs-keyword">this</span>._etag = <span class="hljs-built_in">Boolean</span>(val)
  debug(<span class="hljs-string">'etag %s'</span>, <span class="hljs-keyword">this</span>._etag)
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}, <span class="hljs-string">'send.etag: pass etag as option'</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<div class="dox">
<div class="summary">
<p>Enable or disable &quot;hidden&quot; (dot) files.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">Boolean</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">SendStream</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">public</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.hidden = deprecate.function(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hidden</span> (<span class="hljs-params">val</span>) </span>{
  <span class="hljs-keyword">this</span>._hidden = <span class="hljs-built_in">Boolean</span>(val)
  <span class="hljs-keyword">this</span>._dotfiles = <span class="hljs-literal">undefined</span>
  debug(<span class="hljs-string">'hidden %s'</span>, <span class="hljs-keyword">this</span>._hidden)
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}, <span class="hljs-string">'send.hidden: use dotfiles option'</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set index <code>paths</code>, set to a falsy
value to disable index support.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">paths</span>
<span class="dox_type">String</span>
<span class="dox_type">Boolean</span>
<span class="dox_type">Array</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">SendStream</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">public</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.index = deprecate.function(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span> (<span class="hljs-params">paths</span>) </span>{
  <span class="hljs-keyword">var</span> index = !paths ? [] : normalizeList(paths, <span class="hljs-string">'paths argument'</span>)
  debug(<span class="hljs-string">'index %o'</span>, paths)
  <span class="hljs-keyword">this</span>._index = index
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}, <span class="hljs-string">'send.index: pass index as option'</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set root <code>path</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">SendStream</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">public</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.root = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">root</span> (<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">this</span>._root = resolve(<span class="hljs-built_in">String</span>(path))
  debug(<span class="hljs-string">'root %s'</span>, <span class="hljs-keyword">this</span>._root)
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}

SendStream.prototype.from = deprecate.function(SendStream.prototype.root,
  <span class="hljs-string">'send.from: pass root as option'</span>)

SendStream.prototype.root = deprecate.function(SendStream.prototype.root,
  <span class="hljs-string">'send.root: pass root as option'</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set max-age to <code>maxAge</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">maxAge</span>
<span class="dox_type">Number</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">SendStream</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">public</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.maxage = deprecate.function(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">maxage</span> (<span class="hljs-params">maxAge</span>) </span>{
  <span class="hljs-keyword">this</span>._maxage = <span class="hljs-keyword">typeof</span> maxAge === <span class="hljs-string">'string'</span>
    ? ms(maxAge)
    : <span class="hljs-built_in">Number</span>(maxAge)
  <span class="hljs-keyword">this</span>._maxage = !<span class="hljs-built_in">isNaN</span>(<span class="hljs-keyword">this</span>._maxage)
    ? <span class="hljs-built_in">Math</span>.min(<span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>._maxage), MAX_MAXAGE)
    : <span class="hljs-number">0</span>
  debug(<span class="hljs-string">'max-age %d'</span>, <span class="hljs-keyword">this</span>._maxage)
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>
}, <span class="hljs-string">'send.maxage: pass maxAge as option'</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<div class="dox">
<div class="summary">
<p>Emit error with <code>status</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">status</span>
<span class="dox_type">number</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[error]</span>
<span class="dox_type">Error</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.error = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">error</span> (<span class="hljs-params">status, error</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>emit if listeners instead of responding</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (listenerCount(<span class="hljs-keyword">this</span>, <span class="hljs-string">'error'</span>) !== <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'error'</span>, createError(error, status, {
      <span class="hljs-attr">expose</span>: <span class="hljs-literal">false</span>
    }))
  }

  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">this</span>.res
  <span class="hljs-keyword">var</span> msg = statuses[status]

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>clear existing headers</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  clearHeaders(res)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>add error headers</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (error &amp;&amp; error.headers) {
    setHeaders(res, error.headers)
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>send basic response</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  res.statusCode = status
  res.setHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/plain; charset=UTF-8'</span>)
  res.setHeader(<span class="hljs-string">'Content-Length'</span>, Buffer.byteLength(msg))
  res.setHeader(<span class="hljs-string">'X-Content-Type-Options'</span>, <span class="hljs-string">'nosniff'</span>)
  res.end(msg)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<div class="dox">
<div class="summary">
<p>Check if the pathname ends with &quot;/&quot;.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Boolean</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.hasTrailingSlash = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hasTrailingSlash</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.path[<span class="hljs-keyword">this</span>.path.length - <span class="hljs-number">1</span>] === <span class="hljs-string">'/'</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<div class="dox">
<div class="summary">
<p>Check if this is a conditional GET request.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Boolean</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.isConditionalGET = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isConditionalGET</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.req.headers[<span class="hljs-string">'if-none-match'</span>] ||
    <span class="hljs-keyword">this</span>.req.headers[<span class="hljs-string">'if-modified-since'</span>]
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<div class="dox">
<div class="summary">
<p>Strip content-* header fields.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.removeContentHeaderFields = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeContentHeaderFields</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">this</span>.res
  <span class="hljs-keyword">var</span> headers = <span class="hljs-built_in">Object</span>.keys(res._headers || {})

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; headers.length; i++) {
    <span class="hljs-keyword">var</span> header = headers[i]
    <span class="hljs-keyword">if</span> (header.substr(<span class="hljs-number">0</span>, <span class="hljs-number">8</span>) === <span class="hljs-string">'content-'</span> &amp;&amp; header !== <span class="hljs-string">'content-location'</span>) {
      res.removeHeader(header)
    }
  }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<div class="dox">
<div class="summary">
<p>Respond with 304 not modified.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.notModified = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">notModified</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">this</span>.res
  debug(<span class="hljs-string">'not modified'</span>)
  <span class="hljs-keyword">this</span>.removeContentHeaderFields()
  res.statusCode = <span class="hljs-number">304</span>
  res.end()
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<div class="dox">
<div class="summary">
<p>Raise error that headers already sent.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.headersAlreadySent = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">headersAlreadySent</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Can\'t set headers after they are sent.'</span>)
  debug(<span class="hljs-string">'headers already sent'</span>)
  <span class="hljs-keyword">this</span>.error(<span class="hljs-number">500</span>, err)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<div class="dox">
<div class="summary">
<p>Check if the request is cacheable, aka
responded with 2xx or 304 (see RFC 2616 section 14.2{5,6}).</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Boolean</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.isCachable = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isCachable</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> statusCode = <span class="hljs-keyword">this</span>.res.statusCode
  <span class="hljs-keyword">return</span> (statusCode &gt;= <span class="hljs-number">200</span> &amp;&amp; statusCode &lt; <span class="hljs-number">300</span>) ||
    statusCode === <span class="hljs-number">304</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<div class="dox">
<div class="summary">
<p>Handle stat() error.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">error</span>
<span class="dox_type">Error</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.onStatError = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onStatError</span> (<span class="hljs-params">error</span>) </span>{
  <span class="hljs-keyword">switch</span> (error.code) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">'ENAMETOOLONG'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'ENOENT'</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">'ENOTDIR'</span>:
      <span class="hljs-keyword">this</span>.error(<span class="hljs-number">404</span>, error)
      <span class="hljs-keyword">break</span>
    <span class="hljs-keyword">default</span>:
      <span class="hljs-keyword">this</span>.error(<span class="hljs-number">500</span>, error)
      <span class="hljs-keyword">break</span>
  }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<div class="dox">
<div class="summary">
<p>Check if the cache is fresh.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Boolean</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.isFresh = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isFresh</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> fresh(<span class="hljs-keyword">this</span>.req.headers, <span class="hljs-keyword">this</span>.res._headers)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<div class="dox">
<div class="summary">
<p>Check if the range is fresh.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Boolean</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.isRangeFresh = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isRangeFresh</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> ifRange = <span class="hljs-keyword">this</span>.req.headers[<span class="hljs-string">'if-range'</span>]

  <span class="hljs-keyword">if</span> (!ifRange) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }

  <span class="hljs-keyword">return</span> ~ifRange.indexOf(<span class="hljs-string">'"'</span>)
    ? ~ifRange.indexOf(<span class="hljs-keyword">this</span>.res._headers[<span class="hljs-string">'etag'</span>])
    : <span class="hljs-built_in">Date</span>.parse(<span class="hljs-keyword">this</span>.res._headers[<span class="hljs-string">'last-modified'</span>]) &lt;= <span class="hljs-built_in">Date</span>.parse(ifRange)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<div class="dox">
<div class="summary">
<p>Redirect to path.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.redirect = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">redirect</span> (<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">if</span> (listenerCount(<span class="hljs-keyword">this</span>, <span class="hljs-string">'directory'</span>) !== <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'directory'</span>)
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.hasTrailingSlash()) {
    <span class="hljs-keyword">this</span>.error(<span class="hljs-number">403</span>)
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">var</span> loc = encodeUrl(collapseLeadingSlashes(path + <span class="hljs-string">'/'</span>))
  <span class="hljs-keyword">var</span> msg = <span class="hljs-string">'Redirecting to &lt;a href="'</span> + escapeHtml(loc) + <span class="hljs-string">'"&gt;'</span> + escapeHtml(loc) + <span class="hljs-string">'&lt;/a&gt;\n'</span>
  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">this</span>.res

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>redirect</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  res.statusCode = <span class="hljs-number">301</span>
  res.setHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/html; charset=UTF-8'</span>)
  res.setHeader(<span class="hljs-string">'Content-Length'</span>, Buffer.byteLength(msg))
  res.setHeader(<span class="hljs-string">'X-Content-Type-Options'</span>, <span class="hljs-string">'nosniff'</span>)
  res.setHeader(<span class="hljs-string">'Location'</span>, loc)
  res.end(msg)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<div class="dox">
<div class="summary">
<p>Pipe to `res.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">res</span>
<span class="dox_type">Stream</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Stream</span>
<span>res
</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">public</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.pipe = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pipe</span> (<span class="hljs-params">res</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>root path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> root = <span class="hljs-keyword">this</span>._root

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>references</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>.res = res

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>decode the path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> path = decode(<span class="hljs-keyword">this</span>.path)
  <span class="hljs-keyword">if</span> (path === <span class="hljs-number">-1</span>) {
    <span class="hljs-keyword">this</span>.error(<span class="hljs-number">400</span>)
    <span class="hljs-keyword">return</span> res
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>null byte(s)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (~path.indexOf(<span class="hljs-string">'\0'</span>)) {
    <span class="hljs-keyword">this</span>.error(<span class="hljs-number">400</span>)
    <span class="hljs-keyword">return</span> res
  }

  <span class="hljs-keyword">var</span> parts
  <span class="hljs-keyword">if</span> (root !== <span class="hljs-literal">null</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>malicious path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (UP_PATH_REGEXP.test(normalize(<span class="hljs-string">'.'</span> + sep + path))) {
      debug(<span class="hljs-string">'malicious path "%s"'</span>, path)
      <span class="hljs-keyword">this</span>.error(<span class="hljs-number">403</span>)
      <span class="hljs-keyword">return</span> res
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>join / normalize from optional root dir</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    path = normalize(join(root, path))
    root = normalize(root + sep)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>explode path parts</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    parts = path.substr(root.length).split(sep)
  } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>&quot;..&quot; is malicious without &quot;root&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (UP_PATH_REGEXP.test(path)) {
      debug(<span class="hljs-string">'malicious path "%s"'</span>, path)
      <span class="hljs-keyword">this</span>.error(<span class="hljs-number">403</span>)
      <span class="hljs-keyword">return</span> res
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>explode path parts</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    parts = normalize(path).split(sep)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>resolve the path</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    path = resolve(path)
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<p>dotfile handling</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (containsDotFile(parts)) {
    <span class="hljs-keyword">var</span> access = <span class="hljs-keyword">this</span>._dotfiles

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>legacy support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (access === <span class="hljs-literal">undefined</span>) {
      access = parts[parts.length - <span class="hljs-number">1</span>][<span class="hljs-number">0</span>] === <span class="hljs-string">'.'</span>
        ? (<span class="hljs-keyword">this</span>._hidden ? <span class="hljs-string">'allow'</span> : <span class="hljs-string">'ignore'</span>)
        : <span class="hljs-string">'allow'</span>
    }

    debug(<span class="hljs-string">'%s dotfile "%s"'</span>, access, path)
    <span class="hljs-keyword">switch</span> (access) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">'allow'</span>:
        <span class="hljs-keyword">break</span>
      <span class="hljs-keyword">case</span> <span class="hljs-string">'deny'</span>:
        <span class="hljs-keyword">this</span>.error(<span class="hljs-number">403</span>)
        <span class="hljs-keyword">return</span> res
      <span class="hljs-keyword">case</span> <span class="hljs-string">'ignore'</span>:
      <span class="hljs-keyword">default</span>:
        <span class="hljs-keyword">this</span>.error(<span class="hljs-number">404</span>)
        <span class="hljs-keyword">return</span> res
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>index file support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._index.length &amp;&amp; <span class="hljs-keyword">this</span>.path[<span class="hljs-keyword">this</span>.path.length - <span class="hljs-number">1</span>] === <span class="hljs-string">'/'</span>) {
    <span class="hljs-keyword">this</span>.sendIndex(path)
    <span class="hljs-keyword">return</span> res
  }

  <span class="hljs-keyword">this</span>.sendFile(path)
  <span class="hljs-keyword">return</span> res
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<div class="dox">
<div class="summary">
<p>Transfer <code>path</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">public</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.send = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">send</span> (<span class="hljs-params">path, stat</span>) </span>{
  <span class="hljs-keyword">var</span> len = stat.size
  <span class="hljs-keyword">var</span> options = <span class="hljs-keyword">this</span>.options
  <span class="hljs-keyword">var</span> opts = {}
  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">this</span>.res
  <span class="hljs-keyword">var</span> req = <span class="hljs-keyword">this</span>.req
  <span class="hljs-keyword">var</span> ranges = req.headers.range
  <span class="hljs-keyword">var</span> offset = options.start || <span class="hljs-number">0</span>

  <span class="hljs-keyword">if</span> (res._header) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<p>impossible to send now</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.headersAlreadySent()
    <span class="hljs-keyword">return</span>
  }

  debug(<span class="hljs-string">'pipe "%s"'</span>, path)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<p>set header fields</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>.setHeader(path, stat)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<p>set content-type</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>.type(path)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52"></a>
</div>
<p>conditional GET support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isConditionalGET() &amp;&amp; <span class="hljs-keyword">this</span>.isCachable() &amp;&amp; <span class="hljs-keyword">this</span>.isFresh()) {
    <span class="hljs-keyword">this</span>.notModified()
    <span class="hljs-keyword">return</span>
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<p>adjust len to start/end options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  len = <span class="hljs-built_in">Math</span>.max(<span class="hljs-number">0</span>, len - offset)
  <span class="hljs-keyword">if</span> (options.end !== <span class="hljs-literal">undefined</span>) {
    <span class="hljs-keyword">var</span> bytes = options.end - offset + <span class="hljs-number">1</span>
    <span class="hljs-keyword">if</span> (len &gt; bytes) len = bytes
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54"></a>
</div>
<p>Range support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._acceptRanges &amp;&amp; BYTES_RANGE_REGEXP.test(ranges)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55"></a>
</div>
<p>parse</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    ranges = parseRange(len, ranges, {
      <span class="hljs-attr">combine</span>: <span class="hljs-literal">true</span>
    })

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56"></a>
</div>
<p>If-Range support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isRangeFresh()) {
      debug(<span class="hljs-string">'range stale'</span>)
      ranges = <span class="hljs-number">-2</span>
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57"></a>
</div>
<p>unsatisfiable</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (ranges === <span class="hljs-number">-1</span>) {
      debug(<span class="hljs-string">'range unsatisfiable'</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58"></a>
</div>
<p>Content-Range</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      res.setHeader(<span class="hljs-string">'Content-Range'</span>, contentRange(<span class="hljs-string">'bytes'</span>, len))

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59"></a>
</div>
<p>416 Requested Range Not Satisfiable</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.error(<span class="hljs-number">416</span>, {
        <span class="hljs-attr">headers</span>: {<span class="hljs-string">'Content-Range'</span>: res.getHeader(<span class="hljs-string">'Content-Range'</span>)}
      })
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60"></a>
</div>
<p>valid (syntactically invalid/multiple ranges are treated as a regular response)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (ranges !== <span class="hljs-number">-2</span> &amp;&amp; ranges.length === <span class="hljs-number">1</span>) {
      debug(<span class="hljs-string">'range %j'</span>, ranges)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61"></a>
</div>
<p>Content-Range</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      res.statusCode = <span class="hljs-number">206</span>
      res.setHeader(<span class="hljs-string">'Content-Range'</span>, contentRange(<span class="hljs-string">'bytes'</span>, len, ranges[<span class="hljs-number">0</span>]))

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62"></a>
</div>
<p>adjust for requested range</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      offset += ranges[<span class="hljs-number">0</span>].start
      len = ranges[<span class="hljs-number">0</span>].end - ranges[<span class="hljs-number">0</span>].start + <span class="hljs-number">1</span>
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63"></a>
</div>
<p>clone options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> options) {
    opts[prop] = options[prop]
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64"></a>
</div>
<p>set read options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  opts.start = offset
  opts.end = <span class="hljs-built_in">Math</span>.max(offset, offset + len - <span class="hljs-number">1</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65"></a>
</div>
<p>content-length</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  res.setHeader(<span class="hljs-string">'Content-Length'</span>, len)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66"></a>
</div>
<p>HEAD support</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (req.method === <span class="hljs-string">'HEAD'</span>) {
    res.end()
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">this</span>.stream(path, opts)
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67"></a>
</div>
<div class="dox">
<div class="summary">
<p>Transfer file for <code>path</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">SendStream.prototype.sendFile = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendFile</span> (<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>

  debug(<span class="hljs-string">'stat "%s"'</span>, path)
  fs.stat(path, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onstat</span> (<span class="hljs-params">err, stat</span>) </span>{
    <span class="hljs-keyword">if</span> (err &amp;&amp; err.code === <span class="hljs-string">'ENOENT'</span> &amp;&amp; !extname(path) &amp;&amp; path[path.length - <span class="hljs-number">1</span>] !== sep) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68"></a>
</div>
<p>not found, check extensions</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">return</span> next(err)
    }
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> self.onStatError(err)
    <span class="hljs-keyword">if</span> (stat.isDirectory()) <span class="hljs-keyword">return</span> self.redirect(self.path)
    self.emit(<span class="hljs-string">'file'</span>, path, stat)
    self.send(path, stat)
  })

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">next</span> (<span class="hljs-params">err</span>) </span>{
    <span class="hljs-keyword">if</span> (self._extensions.length &lt;= i) {
      <span class="hljs-keyword">return</span> err
        ? self.onStatError(err)
        : self.error(<span class="hljs-number">404</span>)
    }

    <span class="hljs-keyword">var</span> p = path + <span class="hljs-string">'.'</span> + self._extensions[i++]

    debug(<span class="hljs-string">'stat "%s"'</span>, p)
    fs.stat(p, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, stat</span>) </span>{
      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> next(err)
      <span class="hljs-keyword">if</span> (stat.isDirectory()) <span class="hljs-keyword">return</span> next()
      self.emit(<span class="hljs-string">'file'</span>, p, stat)
      self.send(p, stat)
    })
  }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69"></a>
</div>
<div class="dox">
<div class="summary">
<p>Transfer index for <code>path</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">SendStream.prototype.sendIndex = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendIndex</span> (<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">var</span> i = <span class="hljs-number">-1</span>
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">next</span> (<span class="hljs-params">err</span>) </span>{
    <span class="hljs-keyword">if</span> (++i &gt;= self._index.length) {
      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> self.onStatError(err)
      <span class="hljs-keyword">return</span> self.error(<span class="hljs-number">404</span>)
    }

    <span class="hljs-keyword">var</span> p = join(path, self._index[i])

    debug(<span class="hljs-string">'stat "%s"'</span>, p)
    fs.stat(p, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, stat</span>) </span>{
      <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> next(err)
      <span class="hljs-keyword">if</span> (stat.isDirectory()) <span class="hljs-keyword">return</span> next()
      self.emit(<span class="hljs-string">'file'</span>, p, stat)
      self.send(p, stat)
    })
  }

  next()
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70"></a>
</div>
<div class="dox">
<div class="summary">
<p>Stream <code>path</code> to the response.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.stream = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stream</span> (<span class="hljs-params">path, options</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71"></a>
</div>
<p>TODO: this is all lame, refactor meeee</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> finished = <span class="hljs-literal">false</span>
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>
  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">this</span>.res

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-72" id="section-72"></a>
</div>
<p>pipe</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> stream = fs.createReadStream(path, options)
  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'stream'</span>, stream)
  stream.pipe(res)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73"></a>
</div>
<p>response finished, done with the fd</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  onFinished(res, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onfinished</span> (<span class="hljs-params"></span>) </span>{
    finished = <span class="hljs-literal">true</span>
    destroy(stream)
  })

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74"></a>
</div>
<p>error handling code-smell</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  stream.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onerror</span> (<span class="hljs-params">err</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75"></a>
</div>
<p>request already finished</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (finished) <span class="hljs-keyword">return</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76"></a>
</div>
<p>clean up stream</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    finished = <span class="hljs-literal">true</span>
    destroy(stream)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77"></a>
</div>
<p>error</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    self.onStatError(err)
  })

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78"></a>
</div>
<p>end</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  stream.on(<span class="hljs-string">'end'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onend</span> (<span class="hljs-params"></span>) </span>{
    self.emit(<span class="hljs-string">'end'</span>)
  })
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set content-type based on <code>path</code>
if it hasn't been explicitly set.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.type = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">type</span> (<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">this</span>.res

  <span class="hljs-keyword">if</span> (res.getHeader(<span class="hljs-string">'Content-Type'</span>)) <span class="hljs-keyword">return</span>

  <span class="hljs-keyword">var</span> type = mime.lookup(path)

  <span class="hljs-keyword">if</span> (!type) {
    debug(<span class="hljs-string">'no content-type'</span>)
    <span class="hljs-keyword">return</span>
  }

  <span class="hljs-keyword">var</span> charset = mime.charsets.lookup(type)

  debug(<span class="hljs-string">'content-type %s'</span>, type)
  res.setHeader(<span class="hljs-string">'Content-Type'</span>, type + (charset ? <span class="hljs-string">'; charset='</span> + charset : <span class="hljs-string">''</span>))
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set response header fields, most
fields may be pre-defined.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">stat</span>
<span class="dox_type">Object</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
SendStream.prototype.setHeader = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setHeader</span> (<span class="hljs-params">path, stat</span>) </span>{
  <span class="hljs-keyword">var</span> res = <span class="hljs-keyword">this</span>.res

  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'headers'</span>, res, path, stat)

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._acceptRanges &amp;&amp; !res.getHeader(<span class="hljs-string">'Accept-Ranges'</span>)) {
    debug(<span class="hljs-string">'accept ranges'</span>)
    res.setHeader(<span class="hljs-string">'Accept-Ranges'</span>, <span class="hljs-string">'bytes'</span>)
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._cacheControl &amp;&amp; !res.getHeader(<span class="hljs-string">'Cache-Control'</span>)) {
    <span class="hljs-keyword">var</span> cacheControl = <span class="hljs-string">'public, max-age='</span> + <span class="hljs-built_in">Math</span>.floor(<span class="hljs-keyword">this</span>._maxage / <span class="hljs-number">1000</span>)
    debug(<span class="hljs-string">'cache-control %s'</span>, cacheControl)
    res.setHeader(<span class="hljs-string">'Cache-Control'</span>, cacheControl)
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._lastModified &amp;&amp; !res.getHeader(<span class="hljs-string">'Last-Modified'</span>)) {
    <span class="hljs-keyword">var</span> modified = stat.mtime.toUTCString()
    debug(<span class="hljs-string">'modified %s'</span>, modified)
    res.setHeader(<span class="hljs-string">'Last-Modified'</span>, modified)
  }

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._etag &amp;&amp; !res.getHeader(<span class="hljs-string">'ETag'</span>)) {
    <span class="hljs-keyword">var</span> val = etag(stat)
    debug(<span class="hljs-string">'etag %s'</span>, val)
    res.setHeader(<span class="hljs-string">'ETag'</span>, val)
  }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81"></a>
</div>
<div class="dox">
<div class="summary">
<p>Clear all headers from a response.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">res</span>
<span class="dox_type">object</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clearHeaders</span> (<span class="hljs-params">res</span>) </span>{
  res._headers = {}
  res._headerNames = {}
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82"></a>
</div>
<div class="dox">
<div class="summary">
<p>Collapse all leading slashes into a single slash</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">str</span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">collapseLeadingSlashes</span> (<span class="hljs-params">str</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; str.length; i++) {
    <span class="hljs-keyword">if</span> (str[i] !== <span class="hljs-string">'/'</span>) {
      <span class="hljs-keyword">break</span>
    }
  }

  <span class="hljs-keyword">return</span> i &gt; <span class="hljs-number">1</span>
    ? <span class="hljs-string">'/'</span> + str.substr(i)
    : str
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83"></a>
</div>
<div class="dox">
<div class="summary">
<p>Determine if path parts contain a dotfile.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">containsDotFile</span> (<span class="hljs-params">parts</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; parts.length; i++) {
    <span class="hljs-keyword">if</span> (parts[i][<span class="hljs-number">0</span>] === <span class="hljs-string">'.'</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84"></a>
</div>
<div class="dox">
<div class="summary">
<p>Create a Content-Range header.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">type</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">size</span>
<span class="dox_type">number</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[range]</span>
<span class="dox_type">array</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">contentRange</span> (<span class="hljs-params">type, size, range</span>) </span>{
  <span class="hljs-keyword">return</span> type + <span class="hljs-string">' '</span> + (range ? range.start + <span class="hljs-string">'-'</span> + range.end : <span class="hljs-string">'*'</span>) + <span class="hljs-string">'/'</span> + size
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85"></a>
</div>
<div class="dox">
<div class="summary">
<p>decodeURIComponent.</p>
</div>
<div class="body">
<p>Allows V8 to only deoptimize this fn instead of all
of send().</p>
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">path</span>
<span class="dox_type">String</span>
</div>
<div class="dox_tag_title">API</div>
<div class="dox_tag_detail">
<span class="dox_type">private</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span> (<span class="hljs-params">path</span>) </span>{
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">decodeURIComponent</span>(path)
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>
  }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86"></a>
</div>
<div class="dox">
<div class="summary">
<p>Normalize the index option into an array.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">val</span>
<span class="dox_type">boolean</span>
<span class="dox_type">string</span>
<span class="dox_type">array</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">name</span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalizeList</span> (<span class="hljs-params">val, name</span>) </span>{
  <span class="hljs-keyword">var</span> list = [].concat(val || [])

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list.length; i++) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> list[i] !== <span class="hljs-string">'string'</span>) {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(name + <span class="hljs-string">' must be array of strings or false'</span>)
    }
  }

  <span class="hljs-keyword">return</span> list
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set an object of headers on a response.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">res</span>
<span class="dox_type">object</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">headers</span>
<span class="dox_type">object</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setHeaders</span> (<span class="hljs-params">res, headers</span>) </span>{
  <span class="hljs-keyword">var</span> keys = <span class="hljs-built_in">Object</span>.keys(headers)

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; keys.length; i++) {
    <span class="hljs-keyword">var</span> key = keys[i]
    res.setHeader(key, headers[key])
  }
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
