<!DOCTYPE html>
<html>
<head>
  <title>1to2.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/nan/tools/1to2.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>1to2.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">#!/usr/bin/env node</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<hr>
<p>NAN - Native Abstractions for Node.js</p>
</div>
<div class="body">
<p>Copyright (c) 2016 NAN contributors</p>
<p>MIT License <a href="https://github.com/nodejs/nan/blob/master/LICENSE.md">https://github.com/nodejs/nan/blob/master/LICENSE.md</a></p>
<hr>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> commander = <span class="hljs-built_in">require</span>(<span class="hljs-string">'commander'</span>),
    fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>),
    glob = <span class="hljs-built_in">require</span>(<span class="hljs-string">'glob'</span>),
    groups = [],
    total = <span class="hljs-number">0</span>,
    warning1 = <span class="hljs-string">'/* ERROR: Rewrite using Buffer */\n'</span>,
    warning2 = <span class="hljs-string">'\\/\\* ERROR\\: Rewrite using Buffer \\*\\/\\n'</span>,
    length,
    i;

fs.readFile(__dirname + <span class="hljs-string">'/package.json'</span>, <span class="hljs-string">'utf8'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>{
  <span class="hljs-keyword">if</span> (err) {
    <span class="hljs-keyword">throw</span> err;
  }

  commander
      .version(<span class="hljs-built_in">JSON</span>.parse(data).version)
      .usage(<span class="hljs-string">'[options] &lt;file ...&gt;'</span>)
      .parse(process.argv);

  <span class="hljs-keyword">if</span> (!process.argv.slice(<span class="hljs-number">2</span>).length) {
    commander.outputHelp();
  }
});

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>construct strings representing regular expressions
each expression contains a unique group allowing for identification of the match
the index of this key group, relative to the regular expression in question,
is indicated by the first array member</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-comment">/* simple substistutions, key group is the entire match, 0 */</span>
groups.push([<span class="hljs-number">0</span>, [
  <span class="hljs-string">'_NAN_'</span>,
  <span class="hljs-string">'NODE_SET_METHOD'</span>,
  <span class="hljs-string">'NODE_SET_PROTOTYPE_METHOD'</span>,
  <span class="hljs-string">'NanAsciiString'</span>,
  <span class="hljs-string">'NanEscapeScope'</span>,
  <span class="hljs-string">'NanReturnValue'</span>,
  <span class="hljs-string">'NanUcs2String'</span>].join(<span class="hljs-string">'|'</span>)]);

<span class="hljs-comment">/* substitutions of parameterless macros, key group is 1 */</span>
groups.push([<span class="hljs-number">1</span>, [<span class="hljs-string">'('</span>, [
  <span class="hljs-string">'NanEscapableScope'</span>,
  <span class="hljs-string">'NanReturnNull'</span>,
  <span class="hljs-string">'NanReturnUndefined'</span>,
  <span class="hljs-string">'NanScope'</span>].join(<span class="hljs-string">'|'</span>), <span class="hljs-string">')\\(\\)'</span>].join(<span class="hljs-string">''</span>)]);

<span class="hljs-comment">/* replace TryCatch with NanTryCatch once, gobbling possible namespace, key group 2 */</span>
groups.push([<span class="hljs-number">2</span>, <span class="hljs-string">'(?:(?:v8\\:\\:)?|(Nan)?)(TryCatch)'</span>]);

<span class="hljs-comment">/* NanNew("string") will likely not fail a ToLocalChecked(), key group 1 */</span> 
groups.push([<span class="hljs-number">1</span>, [<span class="hljs-string">'(NanNew)'</span>, <span class="hljs-string">'(\\("[^\\"]*"[^\\)]*\\))(?!\\.ToLocalChecked\\(\\))'</span>].join(<span class="hljs-string">''</span>)]);

<span class="hljs-comment">/* Removed v8 APIs, warn that the code needs rewriting using node::Buffer, key group 2 */</span>
groups.push([<span class="hljs-number">2</span>, [<span class="hljs-string">'('</span>, warning2, <span class="hljs-string">')?'</span>, <span class="hljs-string">'^.*?('</span>, [
      <span class="hljs-string">'GetIndexedPropertiesExternalArrayDataLength'</span>,
      <span class="hljs-string">'GetIndexedPropertiesExternalArrayData'</span>,
      <span class="hljs-string">'GetIndexedPropertiesExternalArrayDataType'</span>,
      <span class="hljs-string">'GetIndexedPropertiesPixelData'</span>,
      <span class="hljs-string">'GetIndexedPropertiesPixelDataLength'</span>,
      <span class="hljs-string">'HasIndexedPropertiesInExternalArrayData'</span>,
      <span class="hljs-string">'HasIndexedPropertiesInPixelData'</span>,
      <span class="hljs-string">'SetIndexedPropertiesToExternalArrayData'</span>,
      <span class="hljs-string">'SetIndexedPropertiesToPixelData'</span>].join(<span class="hljs-string">'|'</span>), <span class="hljs-string">')'</span>].join(<span class="hljs-string">''</span>)]);

<span class="hljs-comment">/* No need for NanScope in V8-exposed methods, key group 2 */</span>
groups.push([<span class="hljs-number">2</span>, [<span class="hljs-string">'(('</span>, [
      <span class="hljs-string">'NAN_METHOD'</span>,
      <span class="hljs-string">'NAN_GETTER'</span>,
      <span class="hljs-string">'NAN_SETTER'</span>,
      <span class="hljs-string">'NAN_PROPERTY_GETTER'</span>,
      <span class="hljs-string">'NAN_PROPERTY_SETTER'</span>,
      <span class="hljs-string">'NAN_PROPERTY_ENUMERATOR'</span>,
      <span class="hljs-string">'NAN_PROPERTY_DELETER'</span>,
      <span class="hljs-string">'NAN_PROPERTY_QUERY'</span>,
      <span class="hljs-string">'NAN_INDEX_GETTER'</span>,
      <span class="hljs-string">'NAN_INDEX_SETTER'</span>,
      <span class="hljs-string">'NAN_INDEX_ENUMERATOR'</span>,
      <span class="hljs-string">'NAN_INDEX_DELETER'</span>,
      <span class="hljs-string">'NAN_INDEX_QUERY'</span>].join(<span class="hljs-string">'|'</span>), <span class="hljs-string">')\\([^\\)]*\\)\\s*\\{)\\s*NanScope\\(\\)\\s*;'</span>].join(<span class="hljs-string">''</span>)]);

<span class="hljs-comment">/* v8::Value::ToXXXXXXX returns v8::MaybeLocal&lt;T&gt;, key group 3 */</span>
groups.push([<span class="hljs-number">3</span>, [<span class="hljs-string">'([\\s\\(\\)])([^\\s\\(\\)]+)-&gt;('</span>, [
      <span class="hljs-string">'Boolean'</span>,
      <span class="hljs-string">'Number'</span>,
      <span class="hljs-string">'String'</span>,
      <span class="hljs-string">'Object'</span>,
      <span class="hljs-string">'Integer'</span>,
      <span class="hljs-string">'Uint32'</span>,
      <span class="hljs-string">'Int32'</span>].join(<span class="hljs-string">'|'</span>), <span class="hljs-string">')\\('</span>].join(<span class="hljs-string">''</span>)]);

<span class="hljs-comment">/* v8::Value::XXXXXXXValue returns v8::Maybe&lt;T&gt;, key group 3 */</span>
groups.push([<span class="hljs-number">3</span>, [<span class="hljs-string">'([\\s\\(\\)])([^\\s\\(\\)]+)-&gt;((?:'</span>, [
      <span class="hljs-string">'Boolean'</span>,
      <span class="hljs-string">'Number'</span>,
      <span class="hljs-string">'Integer'</span>,
      <span class="hljs-string">'Uint32'</span>,
      <span class="hljs-string">'Int32'</span>].join(<span class="hljs-string">'|'</span>), <span class="hljs-string">')Value)\\('</span>].join(<span class="hljs-string">''</span>)]);

<span class="hljs-comment">/* NAN_WEAK_CALLBACK macro was removed, write out callback definition, key group 1 */</span>
groups.push([<span class="hljs-number">1</span>, <span class="hljs-string">'(NAN_WEAK_CALLBACK)\\(([^\\s\\)]+)\\)'</span>]);

<span class="hljs-comment">/* node::ObjectWrap and v8::Persistent have been replaced with Nan implementations, key group 1 */</span>
groups.push([<span class="hljs-number">1</span>, [<span class="hljs-string">'('</span>, [
  <span class="hljs-string">'NanDisposePersistent'</span>,
  <span class="hljs-string">'NanObjectWrapHandle'</span>].join(<span class="hljs-string">'|'</span>), <span class="hljs-string">')\\s*\\(\\s*([^\\s\\)]+)'</span>].join(<span class="hljs-string">''</span>)]);

<span class="hljs-comment">/* Since NanPersistent there is no need for NanMakeWeakPersistent, key group 1 */</span>
groups.push([<span class="hljs-number">1</span>, <span class="hljs-string">'(NanMakeWeakPersistent)\\s*\\(\\s*([^\\s,]+)\\s*,\\s*'</span>]);

<span class="hljs-comment">/* Many methods of v8::Object and others now return v8::MaybeLocal&lt;T&gt;, key group 3 */</span>
groups.push([<span class="hljs-number">3</span>, [<span class="hljs-string">'([\\s])([^\\s]+)-&gt;('</span>, [
  <span class="hljs-string">'GetEndColumn'</span>,
  <span class="hljs-string">'GetFunction'</span>,
  <span class="hljs-string">'GetLineNumber'</span>,
  <span class="hljs-string">'NewInstance'</span>,
  <span class="hljs-string">'GetPropertyNames'</span>,
  <span class="hljs-string">'GetOwnPropertyNames'</span>,
  <span class="hljs-string">'GetSourceLine'</span>,
  <span class="hljs-string">'GetStartColumn'</span>,
  <span class="hljs-string">'ObjectProtoToString'</span>,
  <span class="hljs-string">'ToArrayIndex'</span>,
  <span class="hljs-string">'ToDetailString'</span>,
  <span class="hljs-string">'CallAsConstructor'</span>,
  <span class="hljs-string">'CallAsFunction'</span>,
  <span class="hljs-string">'CloneElementAt'</span>,
  <span class="hljs-string">'Delete'</span>,
  <span class="hljs-string">'ForceSet'</span>,
  <span class="hljs-string">'Get'</span>,
  <span class="hljs-string">'GetPropertyAttributes'</span>,
  <span class="hljs-string">'GetRealNamedProperty'</span>,
  <span class="hljs-string">'GetRealNamedPropertyInPrototypeChain'</span>,
  <span class="hljs-string">'Has'</span>,
  <span class="hljs-string">'HasOwnProperty'</span>,
  <span class="hljs-string">'HasRealIndexedProperty'</span>,
  <span class="hljs-string">'HasRealNamedCallbackProperty'</span>,
  <span class="hljs-string">'HasRealNamedProperty'</span>,
  <span class="hljs-string">'Set'</span>,
  <span class="hljs-string">'SetAccessor'</span>,
  <span class="hljs-string">'SetIndexedPropertyHandler'</span>,
  <span class="hljs-string">'SetNamedPropertyHandler'</span>,
  <span class="hljs-string">'SetPrototype'</span>].join(<span class="hljs-string">'|'</span>), <span class="hljs-string">')\\('</span>].join(<span class="hljs-string">''</span>)]);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>You should get an error if any of these fail anyways,
or handle the error better, it is indicated either way, key group 2</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">groups.push([<span class="hljs-number">2</span>, [<span class="hljs-string">'NanNew(&lt;(?:v8\\:\\:)?('</span>, [<span class="hljs-string">'Date'</span>, <span class="hljs-string">'String'</span>, <span class="hljs-string">'RegExp'</span>].join(<span class="hljs-string">'|'</span>), <span class="hljs-string">')&gt;)(\\([^\\)]*\\))(?!\\.ToLocalChecked\\(\\))'</span>].join(<span class="hljs-string">''</span>)]);

<span class="hljs-comment">/* v8::Value::Equals now returns a v8::Maybe, key group 3 */</span>
groups.push([<span class="hljs-number">3</span>, <span class="hljs-string">'([\\s\\(\\)])([^\\s\\(\\)]+)-&gt;(Equals)\\(([^\\s\\)]+)'</span>]);

<span class="hljs-comment">/* NanPersistent makes this unnecessary, key group 1 */</span>
groups.push([<span class="hljs-number">1</span>, <span class="hljs-string">'(NanAssignPersistent)(?:&lt;v8\\:\\:[^&gt;]+&gt;)?\\(([^,]+),\\s*'</span>]);

<span class="hljs-comment">/* args has been renamed to info, key group 2 */</span>
groups.push([<span class="hljs-number">2</span>, <span class="hljs-string">'(\\W)(args)(\\W)'</span>])

<span class="hljs-comment">/* node::ObjectWrap was replaced with NanObjectWrap, key group 2 */</span>
groups.push([<span class="hljs-number">2</span>, <span class="hljs-string">'(\\W)(?:node\\:\\:)?(ObjectWrap)(\\W)'</span>]);

<span class="hljs-comment">/* v8::Persistent was replaced with NanPersistent, key group 2 */</span>
groups.push([<span class="hljs-number">2</span>, <span class="hljs-string">'(\\W)(?:v8\\:\\:)?(Persistent)(\\W)'</span>]);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>counts the number of capturing groups in a well-formed regular expression,
ignoring non-capturing groups and escaped parentheses</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">groupcount</span>(<span class="hljs-params">s</span>) </span>{
  <span class="hljs-keyword">var</span> positive = s.match(<span class="hljs-regexp">/\((?!\?)/g</span>),
      negative = s.match(<span class="hljs-regexp">/\\\(/g</span>);
  <span class="hljs-keyword">return</span> (positive ? positive.length : <span class="hljs-number">0</span>) - (negative ? negative.length : <span class="hljs-number">0</span>);
}

<span class="hljs-comment">/* compute the absolute position of each key group in the joined master RegExp */</span>
<span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>, length = groups.length; i &lt; length; i++) {
	total += groupcount(groups[i - <span class="hljs-number">1</span>][<span class="hljs-number">1</span>]);
	groups[i][<span class="hljs-number">0</span>] += total;
}

<span class="hljs-comment">/* create the master RegExp, whis is the union of all the groups' expressions */</span>
master = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(groups.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a</span>) </span>{ <span class="hljs-keyword">return</span> a[<span class="hljs-number">1</span>]; }).join(<span class="hljs-string">'|'</span>), <span class="hljs-string">'gm'</span>);

<span class="hljs-comment">/* replacement function for String.replace, receives 21 arguments */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">replace</span>(<span class="hljs-params"></span>) </span>{
	<span class="hljs-comment">/* simple expressions */</span>
      <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'_NAN_'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'NAN_'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NODE_SET_METHOD'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'NanSetMethod'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NODE_SET_PROTOTYPE_METHOD'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'NanSetPrototypeMethod'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NanAsciiString'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'NanUtf8String'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NanEscapeScope'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'scope.Escape'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NanReturnNull'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'info.GetReturnValue().SetNull'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NanReturnValue'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'info.GetReturnValue().Set'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NanUcs2String'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'v8::String::Value'</span>;
        <span class="hljs-keyword">default</span>:
      }

      <span class="hljs-comment">/* macros without arguments */</span>
      <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NanEscapableScope'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'NanEscapableScope scope'</span>
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NanReturnUndefined'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'return'</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NanScope'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-string">'NanScope scope'</span>;
        <span class="hljs-keyword">default</span>:
      }

      <span class="hljs-comment">/* TryCatch, emulate negative backref */</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]] === <span class="hljs-string">'TryCatch'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>] ? <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] : <span class="hljs-string">'NanTryCatch'</span>;
      }

      <span class="hljs-comment">/* NanNew("foo") --&gt; NanNew("foo").ToLocalChecked() */</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">3</span>][<span class="hljs-number">0</span>]] === <span class="hljs-string">'NanNew'</span>) {
        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>], <span class="hljs-string">'.ToLocalChecked()'</span>].join(<span class="hljs-string">''</span>);
      }

      <span class="hljs-comment">/* insert warning for removed functions as comment on new line above */</span>
      <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">4</span>][<span class="hljs-number">0</span>]]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetIndexedPropertiesExternalArrayData'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetIndexedPropertiesExternalArrayDataLength'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetIndexedPropertiesExternalArrayDataType'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetIndexedPropertiesPixelData'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetIndexedPropertiesPixelDataLength'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'HasIndexedPropertiesInExternalArrayData'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'HasIndexedPropertiesInPixelData'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'SetIndexedPropertiesToExternalArrayData'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'SetIndexedPropertiesToPixelData'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">4</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>] ? <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] : [warning1, <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>]].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">default</span>:
      }

     <span class="hljs-comment">/* remove unnecessary NanScope() */</span>
      <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">5</span>][<span class="hljs-number">0</span>]]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_GETTER'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_METHOD'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_SETTER'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_INDEX_DELETER'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_INDEX_ENUMERATOR'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_INDEX_GETTER'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_INDEX_QUERY'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_INDEX_SETTER'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_PROPERTY_DELETER'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_PROPERTY_ENUMERATOR'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_PROPERTY_GETTER'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_PROPERTY_QUERY'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NAN_PROPERTY_SETTER'</span>:
          <span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">5</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>];
        <span class="hljs-keyword">default</span>:
      }

      <span class="hljs-comment">/* Value converstion */</span>
      <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">6</span>][<span class="hljs-number">0</span>]]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Boolean'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Int32'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Integer'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Number'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Object'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'String'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Uint32'</span>:
          <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">6</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">2</span>], <span class="hljs-string">'NanTo&lt;v8::'</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">6</span>][<span class="hljs-number">0</span>]], <span class="hljs-string">'&gt;('</span>,  <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">6</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>]].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">default</span>:
      }

      <span class="hljs-comment">/* other value conversion */</span>
      <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">7</span>][<span class="hljs-number">0</span>]]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'BooleanValue'</span>:
          <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">7</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">2</span>], <span class="hljs-string">'NanTo&lt;bool&gt;('</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">7</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>]].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Int32Value'</span>:
          <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">7</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">2</span>], <span class="hljs-string">'NanTo&lt;int32_t&gt;('</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">7</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>]].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'IntegerValue'</span>:
          <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">7</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">2</span>], <span class="hljs-string">'NanTo&lt;int64_t&gt;('</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">7</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>]].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Uint32Value'</span>:
          <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">7</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">2</span>], <span class="hljs-string">'NanTo&lt;uint32_t&gt;('</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">7</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>]].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">default</span>:
      }

      <span class="hljs-comment">/* NAN_WEAK_CALLBACK */</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">8</span>][<span class="hljs-number">0</span>]] === <span class="hljs-string">'NAN_WEAK_CALLBACK'</span>) {
        <span class="hljs-keyword">return</span> [<span class="hljs-string">'template&lt;typename T&gt;\nvoid '</span>,
          <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">8</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>], <span class="hljs-string">'(const NanWeakCallbackInfo&lt;T&gt; &amp;data)'</span>].join(<span class="hljs-string">''</span>);
      }

      <span class="hljs-comment">/* use methods on NAN classes instead */</span>
      <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">9</span>][<span class="hljs-number">0</span>]]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NanDisposePersistent'</span>:
          <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">9</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>], <span class="hljs-string">'.Reset('</span>].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NanObjectWrapHandle'</span>:
          <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">9</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>], <span class="hljs-string">'-&gt;handle('</span>].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">default</span>:
      }

      <span class="hljs-comment">/* use method on NanPersistent instead */</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">10</span>][<span class="hljs-number">0</span>]] === <span class="hljs-string">'NanMakeWeakPersistent'</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">10</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>] + <span class="hljs-string">'.SetWeak('</span>;
      }

      <span class="hljs-comment">/* These return Maybes, the upper ones take no arguments */</span>
      <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">11</span>][<span class="hljs-number">0</span>]]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetEndColumn'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetFunction'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetLineNumber'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetOwnPropertyNames'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetPropertyNames'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetSourceLine'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetStartColumn'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'NewInstance'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'ObjectProtoToString'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'ToArrayIndex'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'ToDetailString'</span>:
          <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">11</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">2</span>], <span class="hljs-string">'Nan'</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">11</span>][<span class="hljs-number">0</span>]], <span class="hljs-string">'('</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">11</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>]].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">case</span> <span class="hljs-string">'CallAsConstructor'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'CallAsFunction'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'CloneElementAt'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Delete'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'ForceSet'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Get'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetPropertyAttributes'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetRealNamedProperty'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'GetRealNamedPropertyInPrototypeChain'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Has'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'HasOwnProperty'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'HasRealIndexedProperty'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'HasRealNamedCallbackProperty'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'HasRealNamedProperty'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Set'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'SetAccessor'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'SetIndexedPropertyHandler'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'SetNamedPropertyHandler'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'SetPrototype'</span>:
          <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">11</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">2</span>], <span class="hljs-string">'Nan'</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">11</span>][<span class="hljs-number">0</span>]], <span class="hljs-string">'('</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">11</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>], <span class="hljs-string">', '</span>].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">default</span>:
      }

      <span class="hljs-comment">/* Automatic ToLocalChecked(), take it or leave it */</span>
      <span class="hljs-keyword">switch</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">12</span>][<span class="hljs-number">0</span>]]) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">'Date'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'String'</span>:
        <span class="hljs-keyword">case</span> <span class="hljs-string">'RegExp'</span>:
          <span class="hljs-keyword">return</span> [<span class="hljs-string">'NanNew'</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">12</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>], <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">12</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>], <span class="hljs-string">'.ToLocalChecked()'</span>].join(<span class="hljs-string">''</span>);
        <span class="hljs-keyword">default</span>:
      }

      <span class="hljs-comment">/* NanEquals is now required for uniformity */</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">13</span>][<span class="hljs-number">0</span>]] === <span class="hljs-string">'Equals'</span>) {
        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">13</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>], <span class="hljs-string">'NanEquals('</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">13</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>], <span class="hljs-string">', '</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">13</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>]].join(<span class="hljs-string">''</span>);
      }

      <span class="hljs-comment">/* use method on replacement class instead */</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">14</span>][<span class="hljs-number">0</span>]] === <span class="hljs-string">'NanAssignPersistent'</span>) {
        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">14</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>], <span class="hljs-string">'.Reset('</span>].join(<span class="hljs-string">''</span>);
      }

      <span class="hljs-comment">/* args --&gt; info */</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">15</span>][<span class="hljs-number">0</span>]] === <span class="hljs-string">'args'</span>) {
        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">15</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>], <span class="hljs-string">'info'</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">15</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>]].join(<span class="hljs-string">''</span>);
      }

      <span class="hljs-comment">/* ObjectWrap --&gt; NanObjectWrap */</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">16</span>][<span class="hljs-number">0</span>]] === <span class="hljs-string">'ObjectWrap'</span>) {
        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">16</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>], <span class="hljs-string">'NanObjectWrap'</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">16</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>]].join(<span class="hljs-string">''</span>);
      }

      <span class="hljs-comment">/* Persistent --&gt; NanPersistent */</span>
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">17</span>][<span class="hljs-number">0</span>]] === <span class="hljs-string">'Persistent'</span>) {
        <span class="hljs-keyword">return</span> [<span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">17</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span>], <span class="hljs-string">'NanPersistent'</span>, <span class="hljs-built_in">arguments</span>[groups[<span class="hljs-number">17</span>][<span class="hljs-number">0</span>] + <span class="hljs-number">1</span>]].join(<span class="hljs-string">''</span>);
      }

      <span class="hljs-comment">/* This should not happen. A switch is probably missing a case if it does. */</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-string">'Unhandled match: '</span> + <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>];
}

<span class="hljs-comment">/* reads a file, runs replacement and writes it back */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">processFile</span>(<span class="hljs-params">file</span>) </span>{
  fs.readFile(file, {<span class="hljs-attr">encoding</span>: <span class="hljs-string">'utf8'</span>}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">throw</span> err;
    }

    <span class="hljs-comment">/* run replacement twice, might need more runs */</span>
    fs.writeFile(file, data.replace(master, replace).replace(master, replace), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
      <span class="hljs-keyword">if</span> (err) {
        <span class="hljs-keyword">throw</span> err;
      }
    });
  });
}

<span class="hljs-comment">/* process file names from command line and process the identified files */</span>
<span class="hljs-keyword">for</span> (i = <span class="hljs-number">2</span>, length = process.argv.length; i &lt; length; i++) {
  glob(process.argv[i], <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, matches</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">throw</span> err;
    }
    matches.forEach(processFile);
  });
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
