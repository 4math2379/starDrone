<!DOCTYPE html>
<html>
<head>
  <title>promise.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node_modules/bluebird/js/release/promise.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>promise.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">var</span> makeSelfResolutionError = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"circular promise resolution chain\u000a\u000a    See http://goo.gl/MqrFmX\u000a"</span>);
};
<span class="hljs-keyword">var</span> reflectHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>.PromiseInspection(<span class="hljs-keyword">this</span>._target());
};
<span class="hljs-keyword">var</span> apiRejection = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(msg));
};
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Proxyable</span>(<span class="hljs-params"></span>) </span>{}
<span class="hljs-keyword">var</span> UNDEFINED_BINDING = {};
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./util"</span>);

<span class="hljs-keyword">var</span> getDomain;
<span class="hljs-keyword">if</span> (util.isNode) {
    getDomain = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> ret = process.domain;
        <span class="hljs-keyword">if</span> (ret === <span class="hljs-literal">undefined</span>) ret = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">return</span> ret;
    };
} <span class="hljs-keyword">else</span> {
    getDomain = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    };
}
util.notEnumerableProp(<span class="hljs-built_in">Promise</span>, <span class="hljs-string">"_getDomain"</span>, getDomain);

<span class="hljs-keyword">var</span> es5 = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./es5"</span>);
<span class="hljs-keyword">var</span> Async = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./async"</span>);
<span class="hljs-keyword">var</span> <span class="hljs-keyword">async</span> = <span class="hljs-keyword">new</span> Async();
es5.defineProperty(<span class="hljs-built_in">Promise</span>, <span class="hljs-string">"_async"</span>, {<span class="hljs-attr">value</span>: <span class="hljs-keyword">async</span>});
<span class="hljs-keyword">var</span> errors = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./errors"</span>);
<span class="hljs-keyword">var</span> <span class="hljs-built_in">TypeError</span> = <span class="hljs-built_in">Promise</span>.TypeError = errors.TypeError;
<span class="hljs-built_in">Promise</span>.RangeError = errors.RangeError;
<span class="hljs-keyword">var</span> CancellationError = <span class="hljs-built_in">Promise</span>.CancellationError = errors.CancellationError;
<span class="hljs-built_in">Promise</span>.TimeoutError = errors.TimeoutError;
<span class="hljs-built_in">Promise</span>.OperationalError = errors.OperationalError;
<span class="hljs-built_in">Promise</span>.RejectionError = errors.OperationalError;
<span class="hljs-built_in">Promise</span>.AggregateError = errors.AggregateError;
<span class="hljs-keyword">var</span> INTERNAL = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{};
<span class="hljs-keyword">var</span> APPLY = {};
<span class="hljs-keyword">var</span> NEXT_FILTER = {};
<span class="hljs-keyword">var</span> tryConvertToPromise = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./thenables"</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL);
<span class="hljs-keyword">var</span> PromiseArray =
    <span class="hljs-built_in">require</span>(<span class="hljs-string">"./promise_array"</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL,
                               tryConvertToPromise, apiRejection, Proxyable);
<span class="hljs-keyword">var</span> Context = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./context"</span>)(<span class="hljs-built_in">Promise</span>);
 <span class="hljs-comment">/*jshint unused:false*/</span>
<span class="hljs-keyword">var</span> createContext = Context.create;
<span class="hljs-keyword">var</span> debug = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./debuggability"</span>)(<span class="hljs-built_in">Promise</span>, Context);
<span class="hljs-keyword">var</span> CapturedTrace = debug.CapturedTrace;
<span class="hljs-keyword">var</span> PassThroughHandlerContext =
    <span class="hljs-built_in">require</span>(<span class="hljs-string">"./finally"</span>)(<span class="hljs-built_in">Promise</span>, tryConvertToPromise);
<span class="hljs-keyword">var</span> catchFilter = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./catch_filter"</span>)(NEXT_FILTER);
<span class="hljs-keyword">var</span> nodebackForPromise = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./nodeback"</span>);
<span class="hljs-keyword">var</span> errorObj = util.errorObj;
<span class="hljs-keyword">var</span> tryCatch = util.tryCatch;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params">self, executor</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> executor !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"expecting a function but got "</span> + util.classString(executor));
    }
    <span class="hljs-keyword">if</span> (self.constructor !== <span class="hljs-built_in">Promise</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"the promise constructor cannot be invoked directly\u000a\u000a    See http://goo.gl/MqrFmX\u000a"</span>);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Promise</span>(<span class="hljs-params">executor</span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>._fulfillmentHandler0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._rejectionHandler0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._promise0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._receiver0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">if</span> (executor !== INTERNAL) {
        check(<span class="hljs-keyword">this</span>, executor);
        <span class="hljs-keyword">this</span>._resolveFromExecutor(executor);
    }
    <span class="hljs-keyword">this</span>._promiseCreated();
    <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseCreated"</span>, <span class="hljs-keyword">this</span>);
}

<span class="hljs-built_in">Promise</span>.prototype.toString = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"[object Promise]"</span>;
};

<span class="hljs-built_in">Promise</span>.prototype.caught = <span class="hljs-built_in">Promise</span>.prototype[<span class="hljs-string">"catch"</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">var</span> len = <span class="hljs-built_in">arguments</span>.length;
    <span class="hljs-keyword">if</span> (len &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">var</span> catchInstances = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(len - <span class="hljs-number">1</span>),
            j = <span class="hljs-number">0</span>, i;
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len - <span class="hljs-number">1</span>; ++i) {
            <span class="hljs-keyword">var</span> item = <span class="hljs-built_in">arguments</span>[i];
            <span class="hljs-keyword">if</span> (util.isObject(item)) {
                catchInstances[j++] = item;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> apiRejection(<span class="hljs-string">"expecting an object but got "</span> +
                    <span class="hljs-string">"A catch statement predicate "</span> + util.classString(item));
            }
        }
        catchInstances.length = j;
        fn = <span class="hljs-built_in">arguments</span>[i];
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.then(<span class="hljs-literal">undefined</span>, catchFilter(catchInstances, fn, <span class="hljs-keyword">this</span>));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.then(<span class="hljs-literal">undefined</span>, fn);
};

<span class="hljs-built_in">Promise</span>.prototype.reflect = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._then(reflectHandler,
        reflectHandler, <span class="hljs-literal">undefined</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">undefined</span>);
};

<span class="hljs-built_in">Promise</span>.prototype.then = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">didFulfill, didReject</span>) </span>{
    <span class="hljs-keyword">if</span> (debug.warnings() &amp;&amp; <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">0</span> &amp;&amp;
        <span class="hljs-keyword">typeof</span> didFulfill !== <span class="hljs-string">"function"</span> &amp;&amp;
        <span class="hljs-keyword">typeof</span> didReject !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">var</span> msg = <span class="hljs-string">".then() only accepts functions but was passed: "</span> +
                util.classString(didFulfill);
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span>) {
            msg += <span class="hljs-string">", "</span> + util.classString(didReject);
        }
        <span class="hljs-keyword">this</span>._warn(msg);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._then(didFulfill, didReject, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>);
};

<span class="hljs-built_in">Promise</span>.prototype.done = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">didFulfill, didReject</span>) </span>{
    <span class="hljs-keyword">var</span> promise =
        <span class="hljs-keyword">this</span>._then(didFulfill, didReject, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>);
    promise._setIsFinal();
};

<span class="hljs-built_in">Promise</span>.prototype.spread = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">return</span> apiRejection(<span class="hljs-string">"expecting a function but got "</span> + util.classString(fn));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.all()._then(fn, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, APPLY, <span class="hljs-literal">undefined</span>);
};

<span class="hljs-built_in">Promise</span>.prototype.toJSON = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> ret = {
        <span class="hljs-attr">isFulfilled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRejected</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">fulfillmentValue</span>: <span class="hljs-literal">undefined</span>,
        <span class="hljs-attr">rejectionReason</span>: <span class="hljs-literal">undefined</span>
    };
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isFulfilled()) {
        ret.fulfillmentValue = <span class="hljs-keyword">this</span>.value();
        ret.isFulfilled = <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isRejected()) {
        ret.rejectionReason = <span class="hljs-keyword">this</span>.reason();
        ret.isRejected = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.prototype.all = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>._warn(<span class="hljs-string">".all() was passed arguments but it does not take any"</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PromiseArray(<span class="hljs-keyword">this</span>).promise();
};

<span class="hljs-built_in">Promise</span>.prototype.error = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.caught(util.originatesFromRejection, fn);
};

<span class="hljs-built_in">Promise</span>.getNewLibraryCopy = <span class="hljs-built_in">module</span>.exports;

<span class="hljs-built_in">Promise</span>.is = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
    <span class="hljs-keyword">return</span> val <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>;
};

<span class="hljs-built_in">Promise</span>.fromNode = <span class="hljs-built_in">Promise</span>.fromCallback = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    ret._captureStackTrace();
    <span class="hljs-keyword">var</span> multiArgs = <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span> ? !!<span class="hljs-built_in">Object</span>(<span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>]).multiArgs
                                         : <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> result = tryCatch(fn)(nodebackForPromise(ret, multiArgs));
    <span class="hljs-keyword">if</span> (result === errorObj) {
        ret._rejectCallback(result.e, <span class="hljs-literal">true</span>);
    }
    <span class="hljs-keyword">if</span> (!ret._isFateSealed()) ret._setAsyncGuaranteed();
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.all = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">promises</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PromiseArray(promises).promise();
};

<span class="hljs-built_in">Promise</span>.cast = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">var</span> ret = tryConvertToPromise(obj);
    <span class="hljs-keyword">if</span> (!(ret <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>)) {
        ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
        ret._captureStackTrace();
        ret._setFulfilled();
        ret._rejectionHandler0 = obj;
    }
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.resolve = <span class="hljs-built_in">Promise</span>.fulfilled = <span class="hljs-built_in">Promise</span>.cast;

<span class="hljs-built_in">Promise</span>.reject = <span class="hljs-built_in">Promise</span>.rejected = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    ret._captureStackTrace();
    ret._rejectCallback(reason, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.setScheduler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"expecting a function but got "</span> + util.classString(fn));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span>.setScheduler(fn);
};

<span class="hljs-built_in">Promise</span>.prototype._then = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">
    didFulfill,
    didReject,
    _,    receiver,
    internalData
</span>) </span>{
    <span class="hljs-keyword">var</span> haveInternalData = internalData !== <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">var</span> promise = haveInternalData ? internalData : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    <span class="hljs-keyword">var</span> target = <span class="hljs-keyword">this</span>._target();
    <span class="hljs-keyword">var</span> bitField = target._bitField;

    <span class="hljs-keyword">if</span> (!haveInternalData) {
        promise._propagateFrom(<span class="hljs-keyword">this</span>, <span class="hljs-number">3</span>);
        promise._captureStackTrace();
        <span class="hljs-keyword">if</span> (receiver === <span class="hljs-literal">undefined</span> &amp;&amp;
            ((<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">2097152</span>) !== <span class="hljs-number">0</span>)) {
            <span class="hljs-keyword">if</span> (!((bitField &amp; <span class="hljs-number">50397184</span>) === <span class="hljs-number">0</span>)) {
                receiver = <span class="hljs-keyword">this</span>._boundValue();
            } <span class="hljs-keyword">else</span> {
                receiver = target === <span class="hljs-keyword">this</span> ? <span class="hljs-literal">undefined</span> : <span class="hljs-keyword">this</span>._boundTo;
            }
        }
        <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseChained"</span>, <span class="hljs-keyword">this</span>, promise);
    }

    <span class="hljs-keyword">var</span> domain = getDomain();
    <span class="hljs-keyword">if</span> (!((bitField &amp; <span class="hljs-number">50397184</span>) === <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">var</span> handler, value, settler = target._settlePromiseCtx;
        <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
            value = target._rejectionHandler0;
            handler = didFulfill;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">16777216</span>) !== <span class="hljs-number">0</span>)) {
            value = target._fulfillmentHandler0;
            handler = didReject;
            target._unsetRejectionIsUnhandled();
        } <span class="hljs-keyword">else</span> {
            settler = target._settlePromiseLateCancellationObserver;
            value = <span class="hljs-keyword">new</span> CancellationError(<span class="hljs-string">"late cancellation observer"</span>);
            target._attachExtraTrace(value);
            handler = didReject;
        }

        <span class="hljs-keyword">async</span>.invoke(settler, target, {
            <span class="hljs-attr">handler</span>: domain === <span class="hljs-literal">null</span> ? handler
                : (<span class="hljs-keyword">typeof</span> handler === <span class="hljs-string">"function"</span> &amp;&amp;
                    util.domainBind(domain, handler)),
            <span class="hljs-attr">promise</span>: promise,
            <span class="hljs-attr">receiver</span>: receiver,
            <span class="hljs-attr">value</span>: value
        });
    } <span class="hljs-keyword">else</span> {
        target._addCallbacks(didFulfill, didReject, promise, receiver, domain);
    }

    <span class="hljs-keyword">return</span> promise;
};

<span class="hljs-built_in">Promise</span>.prototype._length = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">65535</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._isFateSealed = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">117506048</span>) !== <span class="hljs-number">0</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._isFollowing = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">67108864</span>) === <span class="hljs-number">67108864</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._setLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">len</span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">-65536</span>) |
        (len &amp; <span class="hljs-number">65535</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setFulfilled = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">33554432</span>;
    <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseFulfilled"</span>, <span class="hljs-keyword">this</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setRejected = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">16777216</span>;
    <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseRejected"</span>, <span class="hljs-keyword">this</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setFollowing = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">67108864</span>;
    <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseResolved"</span>, <span class="hljs-keyword">this</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setIsFinal = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">4194304</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._isFinal = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">4194304</span>) &gt; <span class="hljs-number">0</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._unsetCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField &amp; (~<span class="hljs-number">65536</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">65536</span>;
    <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseCancelled"</span>, <span class="hljs-keyword">this</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setWillBeCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">8388608</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._setAsyncGuaranteed = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span>.hasCustomScheduler()) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">134217728</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._receiverAt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
    <span class="hljs-keyword">var</span> ret = index === <span class="hljs-number">0</span> ? <span class="hljs-keyword">this</span>._receiver0 : <span class="hljs-keyword">this</span>[
            index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span> + <span class="hljs-number">3</span>];
    <span class="hljs-keyword">if</span> (ret === UNDEFINED_BINDING) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ret === <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-keyword">this</span>._isBound()) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._boundValue();
    }
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.prototype._promiseAt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[
            index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span> + <span class="hljs-number">2</span>];
};

<span class="hljs-built_in">Promise</span>.prototype._fulfillmentHandlerAt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[
            index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span> + <span class="hljs-number">0</span>];
};

<span class="hljs-built_in">Promise</span>.prototype._rejectionHandlerAt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[
            index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span> + <span class="hljs-number">1</span>];
};

<span class="hljs-built_in">Promise</span>.prototype._boundValue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};

<span class="hljs-built_in">Promise</span>.prototype._migrateCallback0 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">follower</span>) </span>{
    <span class="hljs-keyword">var</span> bitField = follower._bitField;
    <span class="hljs-keyword">var</span> fulfill = follower._fulfillmentHandler0;
    <span class="hljs-keyword">var</span> reject = follower._rejectionHandler0;
    <span class="hljs-keyword">var</span> promise = follower._promise0;
    <span class="hljs-keyword">var</span> receiver = follower._receiverAt(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (receiver === <span class="hljs-literal">undefined</span>) receiver = UNDEFINED_BINDING;
    <span class="hljs-keyword">this</span>._addCallbacks(fulfill, reject, promise, receiver, <span class="hljs-literal">null</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._migrateCallbackAt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">follower, index</span>) </span>{
    <span class="hljs-keyword">var</span> fulfill = follower._fulfillmentHandlerAt(index);
    <span class="hljs-keyword">var</span> reject = follower._rejectionHandlerAt(index);
    <span class="hljs-keyword">var</span> promise = follower._promiseAt(index);
    <span class="hljs-keyword">var</span> receiver = follower._receiverAt(index);
    <span class="hljs-keyword">if</span> (receiver === <span class="hljs-literal">undefined</span>) receiver = UNDEFINED_BINDING;
    <span class="hljs-keyword">this</span>._addCallbacks(fulfill, reject, promise, receiver, <span class="hljs-literal">null</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._addCallbacks = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">
    fulfill,
    reject,
    promise,
    receiver,
    domain
</span>) </span>{
    <span class="hljs-keyword">var</span> index = <span class="hljs-keyword">this</span>._length();

    <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">65535</span> - <span class="hljs-number">4</span>) {
        index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>._setLength(<span class="hljs-number">0</span>);
    }

    <span class="hljs-keyword">if</span> (index === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>._promise0 = promise;
        <span class="hljs-keyword">this</span>._receiver0 = receiver;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fulfill === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">this</span>._fulfillmentHandler0 =
                domain === <span class="hljs-literal">null</span> ? fulfill : util.domainBind(domain, fulfill);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> reject === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">this</span>._rejectionHandler0 =
                domain === <span class="hljs-literal">null</span> ? reject : util.domainBind(domain, reject);
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> base = index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span>;
        <span class="hljs-keyword">this</span>[base + <span class="hljs-number">2</span>] = promise;
        <span class="hljs-keyword">this</span>[base + <span class="hljs-number">3</span>] = receiver;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fulfill === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">this</span>[base + <span class="hljs-number">0</span>] =
                domain === <span class="hljs-literal">null</span> ? fulfill : util.domainBind(domain, fulfill);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> reject === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">this</span>[base + <span class="hljs-number">1</span>] =
                domain === <span class="hljs-literal">null</span> ? reject : util.domainBind(domain, reject);
        }
    }
    <span class="hljs-keyword">this</span>._setLength(index + <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> index;
};

<span class="hljs-built_in">Promise</span>.prototype._proxy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">proxyable, arg</span>) </span>{
    <span class="hljs-keyword">this</span>._addCallbacks(<span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, arg, proxyable, <span class="hljs-literal">null</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._resolveCallback = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, shouldBind</span>) </span>{
    <span class="hljs-keyword">if</span> (((<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">117506048</span>) !== <span class="hljs-number">0</span>)) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span> (value === <span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rejectCallback(makeSelfResolutionError(), <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">var</span> maybePromise = tryConvertToPromise(value, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">if</span> (!(maybePromise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._fulfill(value);

    <span class="hljs-keyword">if</span> (shouldBind) <span class="hljs-keyword">this</span>._propagateFrom(maybePromise, <span class="hljs-number">2</span>);

    <span class="hljs-keyword">var</span> promise = maybePromise._target();

    <span class="hljs-keyword">if</span> (promise === <span class="hljs-keyword">this</span>) {
        <span class="hljs-keyword">this</span>._reject(makeSelfResolutionError());
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> bitField = promise._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">50397184</span>) === <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">var</span> len = <span class="hljs-keyword">this</span>._length();
        <span class="hljs-keyword">if</span> (len &gt; <span class="hljs-number">0</span>) promise._migrateCallback0(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; len; ++i) {
            promise._migrateCallbackAt(<span class="hljs-keyword">this</span>, i);
        }
        <span class="hljs-keyword">this</span>._setFollowing();
        <span class="hljs-keyword">this</span>._setLength(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">this</span>._setFollowee(promise);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">this</span>._fulfill(promise._value());
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">16777216</span>) !== <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">this</span>._reject(promise._reason());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> reason = <span class="hljs-keyword">new</span> CancellationError(<span class="hljs-string">"late cancellation observer"</span>);
        promise._attachExtraTrace(reason);
        <span class="hljs-keyword">this</span>._reject(reason);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._rejectCallback =
<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">reason, synchronous, ignoreNonErrorWarnings</span>) </span>{
    <span class="hljs-keyword">var</span> trace = util.ensureErrorObject(reason);
    <span class="hljs-keyword">var</span> hasStack = trace === reason;
    <span class="hljs-keyword">if</span> (!hasStack &amp;&amp; !ignoreNonErrorWarnings &amp;&amp; debug.warnings()) {
        <span class="hljs-keyword">var</span> message = <span class="hljs-string">"a promise was rejected with a non-error: "</span> +
            util.classString(reason);
        <span class="hljs-keyword">this</span>._warn(message, <span class="hljs-literal">true</span>);
    }
    <span class="hljs-keyword">this</span>._attachExtraTrace(trace, synchronous ? hasStack : <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">this</span>._reject(reason);
};

<span class="hljs-built_in">Promise</span>.prototype._resolveFromExecutor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">executor</span>) </span>{
    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">this</span>._captureStackTrace();
    <span class="hljs-keyword">this</span>._pushContext();
    <span class="hljs-keyword">var</span> synchronous = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">this</span>._execute(executor, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
        promise._resolveCallback(value);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
        promise._rejectCallback(reason, synchronous);
    });
    synchronous = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>._popContext();

    <span class="hljs-keyword">if</span> (r !== <span class="hljs-literal">undefined</span>) {
        promise._rejectCallback(r, <span class="hljs-literal">true</span>);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromiseFromHandler = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">
    handler, receiver, value, promise
</span>) </span>{
    <span class="hljs-keyword">var</span> bitField = promise._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">65536</span>) !== <span class="hljs-number">0</span>)) <span class="hljs-keyword">return</span>;
    promise._pushContext();
    <span class="hljs-keyword">var</span> x;
    <span class="hljs-keyword">if</span> (receiver === APPLY) {
        <span class="hljs-keyword">if</span> (!value || <span class="hljs-keyword">typeof</span> value.length !== <span class="hljs-string">"number"</span>) {
            x = errorObj;
            x.e = <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"cannot .spread() a non-array: "</span> +
                                    util.classString(value));
        } <span class="hljs-keyword">else</span> {
            x = tryCatch(handler).apply(<span class="hljs-keyword">this</span>._boundValue(), value);
        }
    } <span class="hljs-keyword">else</span> {
        x = tryCatch(handler).call(receiver, value);
    }
    <span class="hljs-keyword">var</span> promiseCreated = promise._popContext();
    bitField = promise._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">65536</span>) !== <span class="hljs-number">0</span>)) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">if</span> (x === NEXT_FILTER) {
        promise._reject(value);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x === errorObj) {
        promise._rejectCallback(x.e, <span class="hljs-literal">false</span>);
    } <span class="hljs-keyword">else</span> {
        debug.checkForgottenReturns(x, promiseCreated, <span class="hljs-string">""</span>,  promise, <span class="hljs-keyword">this</span>);
        promise._resolveCallback(x);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._target = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">while</span> (ret._isFollowing()) ret = ret._followee();
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.prototype._followee = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rejectionHandler0;
};

<span class="hljs-built_in">Promise</span>.prototype._setFollowee = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">promise</span>) </span>{
    <span class="hljs-keyword">this</span>._rejectionHandler0 = promise;
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromise = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">promise, handler, receiver, value</span>) </span>{
    <span class="hljs-keyword">var</span> isPromise = promise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>;
    <span class="hljs-keyword">var</span> bitField = <span class="hljs-keyword">this</span>._bitField;
    <span class="hljs-keyword">var</span> asyncGuaranteed = ((bitField &amp; <span class="hljs-number">134217728</span>) !== <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">65536</span>) !== <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">if</span> (isPromise) promise._invokeInternalOnCancel();

        <span class="hljs-keyword">if</span> (receiver <span class="hljs-keyword">instanceof</span> PassThroughHandlerContext &amp;&amp;
            receiver.isFinallyHandler()) {
            receiver.cancelPromise = promise;
            <span class="hljs-keyword">if</span> (tryCatch(handler).call(receiver, value) === errorObj) {
                promise._reject(errorObj.e);
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (handler === reflectHandler) {
            promise._fulfill(reflectHandler.call(receiver));
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (receiver <span class="hljs-keyword">instanceof</span> Proxyable) {
            receiver._promiseCancelled(promise);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isPromise || promise <span class="hljs-keyword">instanceof</span> PromiseArray) {
            promise._cancel();
        } <span class="hljs-keyword">else</span> {
            receiver.cancel();
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> handler === <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">if</span> (!isPromise) {
            handler.call(receiver, value, promise);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (asyncGuaranteed) promise._setAsyncGuaranteed();
            <span class="hljs-keyword">this</span>._settlePromiseFromHandler(handler, receiver, value, promise);
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (receiver <span class="hljs-keyword">instanceof</span> Proxyable) {
        <span class="hljs-keyword">if</span> (!receiver._isResolved()) {
            <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
                receiver._promiseFulfilled(value, promise);
            } <span class="hljs-keyword">else</span> {
                receiver._promiseRejected(value, promise);
            }
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isPromise) {
        <span class="hljs-keyword">if</span> (asyncGuaranteed) promise._setAsyncGuaranteed();
        <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
            promise._fulfill(value);
        } <span class="hljs-keyword">else</span> {
            promise._reject(value);
        }
    }
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromiseLateCancellationObserver = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ctx</span>) </span>{
    <span class="hljs-keyword">var</span> handler = ctx.handler;
    <span class="hljs-keyword">var</span> promise = ctx.promise;
    <span class="hljs-keyword">var</span> receiver = ctx.receiver;
    <span class="hljs-keyword">var</span> value = ctx.value;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> handler === <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">if</span> (!(promise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>)) {
            handler.call(receiver, value, promise);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>._settlePromiseFromHandler(handler, receiver, value, promise);
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (promise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) {
        promise._reject(value);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromiseCtx = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ctx</span>) </span>{
    <span class="hljs-keyword">this</span>._settlePromise(ctx.promise, ctx.handler, ctx.receiver, ctx.value);
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromise0 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">handler, value, bitField</span>) </span>{
    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>._promise0;
    <span class="hljs-keyword">var</span> receiver = <span class="hljs-keyword">this</span>._receiverAt(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">this</span>._promise0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._receiver0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._settlePromise(promise, handler, receiver, value);
};

<span class="hljs-built_in">Promise</span>.prototype._clearCallbackDataAtIndex = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index</span>) </span>{
    <span class="hljs-keyword">var</span> base = index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span>;
    <span class="hljs-keyword">this</span>[base + <span class="hljs-number">2</span>] =
    <span class="hljs-keyword">this</span>[base + <span class="hljs-number">3</span>] =
    <span class="hljs-keyword">this</span>[base + <span class="hljs-number">0</span>] =
    <span class="hljs-keyword">this</span>[base + <span class="hljs-number">1</span>] = <span class="hljs-literal">undefined</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._fulfill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">var</span> bitField = <span class="hljs-keyword">this</span>._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">117506048</span>) &gt;&gt;&gt; <span class="hljs-number">16</span>)) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span> (value === <span class="hljs-keyword">this</span>) {
        <span class="hljs-keyword">var</span> err = makeSelfResolutionError();
        <span class="hljs-keyword">this</span>._attachExtraTrace(err);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._reject(err);
    }
    <span class="hljs-keyword">this</span>._setFulfilled();
    <span class="hljs-keyword">this</span>._rejectionHandler0 = value;

    <span class="hljs-keyword">if</span> ((bitField &amp; <span class="hljs-number">65535</span>) &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">134217728</span>) !== <span class="hljs-number">0</span>)) {
            <span class="hljs-keyword">this</span>._settlePromises();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">async</span>.settlePromises(<span class="hljs-keyword">this</span>);
        }
    }
};

<span class="hljs-built_in">Promise</span>.prototype._reject = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
    <span class="hljs-keyword">var</span> bitField = <span class="hljs-keyword">this</span>._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">117506048</span>) &gt;&gt;&gt; <span class="hljs-number">16</span>)) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>._setRejected();
    <span class="hljs-keyword">this</span>._fulfillmentHandler0 = reason;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isFinal()) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span>.fatalError(reason, util.isNode);
    }

    <span class="hljs-keyword">if</span> ((bitField &amp; <span class="hljs-number">65535</span>) &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">async</span>.settlePromises(<span class="hljs-keyword">this</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>._ensurePossibleRejectionHandled();
    }
};

<span class="hljs-built_in">Promise</span>.prototype._fulfillPromises = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">len, value</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; len; i++) {
        <span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">this</span>._fulfillmentHandlerAt(i);
        <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>._promiseAt(i);
        <span class="hljs-keyword">var</span> receiver = <span class="hljs-keyword">this</span>._receiverAt(i);
        <span class="hljs-keyword">this</span>._clearCallbackDataAtIndex(i);
        <span class="hljs-keyword">this</span>._settlePromise(promise, handler, receiver, value);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._rejectPromises = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">len, reason</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; len; i++) {
        <span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">this</span>._rejectionHandlerAt(i);
        <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>._promiseAt(i);
        <span class="hljs-keyword">var</span> receiver = <span class="hljs-keyword">this</span>._receiverAt(i);
        <span class="hljs-keyword">this</span>._clearCallbackDataAtIndex(i);
        <span class="hljs-keyword">this</span>._settlePromise(promise, handler, receiver, reason);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromises = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> bitField = <span class="hljs-keyword">this</span>._bitField;
    <span class="hljs-keyword">var</span> len = (bitField &amp; <span class="hljs-number">65535</span>);

    <span class="hljs-keyword">if</span> (len &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">16842752</span>) !== <span class="hljs-number">0</span>)) {
            <span class="hljs-keyword">var</span> reason = <span class="hljs-keyword">this</span>._fulfillmentHandler0;
            <span class="hljs-keyword">this</span>._settlePromise0(<span class="hljs-keyword">this</span>._rejectionHandler0, reason, bitField);
            <span class="hljs-keyword">this</span>._rejectPromises(len, reason);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> value = <span class="hljs-keyword">this</span>._rejectionHandler0;
            <span class="hljs-keyword">this</span>._settlePromise0(<span class="hljs-keyword">this</span>._fulfillmentHandler0, value, bitField);
            <span class="hljs-keyword">this</span>._fulfillPromises(len, value);
        }
        <span class="hljs-keyword">this</span>._setLength(<span class="hljs-number">0</span>);
    }
    <span class="hljs-keyword">this</span>._clearCancellationData();
};

<span class="hljs-built_in">Promise</span>.prototype._settledValue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> bitField = <span class="hljs-keyword">this</span>._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rejectionHandler0;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">16777216</span>) !== <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._fulfillmentHandler0;
    }
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deferResolve</span>(<span class="hljs-params">v</span>) </span>{<span class="hljs-keyword">this</span>.promise._resolveCallback(v);}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deferReject</span>(<span class="hljs-params">v</span>) </span>{<span class="hljs-keyword">this</span>.promise._rejectCallback(v, <span class="hljs-literal">false</span>);}

<span class="hljs-built_in">Promise</span>.defer = <span class="hljs-built_in">Promise</span>.pending = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    debug.deprecated(<span class="hljs-string">"Promise.defer"</span>, <span class="hljs-string">"new Promise"</span>);
    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">promise</span>: promise,
        <span class="hljs-attr">resolve</span>: deferResolve,
        <span class="hljs-attr">reject</span>: deferReject
    };
};

util.notEnumerableProp(<span class="hljs-built_in">Promise</span>,
                       <span class="hljs-string">"_makeSelfResolutionError"</span>,
                       makeSelfResolutionError);

<span class="hljs-built_in">require</span>(<span class="hljs-string">"./method"</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL, tryConvertToPromise, apiRejection,
    debug);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./bind"</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL, tryConvertToPromise, debug);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./cancel"</span>)(<span class="hljs-built_in">Promise</span>, PromiseArray, apiRejection, debug);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./direct_resolve"</span>)(<span class="hljs-built_in">Promise</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./synchronous_inspection"</span>)(<span class="hljs-built_in">Promise</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">"./join"</span>)(
    <span class="hljs-built_in">Promise</span>, PromiseArray, tryConvertToPromise, INTERNAL, <span class="hljs-keyword">async</span>, getDomain);
<span class="hljs-built_in">Promise</span>.Promise = <span class="hljs-built_in">Promise</span>;
<span class="hljs-built_in">Promise</span>.version = <span class="hljs-string">"3.4.7"</span>;
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./map.js'</span>)(<span class="hljs-built_in">Promise</span>, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL, debug);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./call_get.js'</span>)(<span class="hljs-built_in">Promise</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./using.js'</span>)(<span class="hljs-built_in">Promise</span>, apiRejection, tryConvertToPromise, createContext, INTERNAL, debug);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./timers.js'</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL, debug);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./generators.js'</span>)(<span class="hljs-built_in">Promise</span>, apiRejection, INTERNAL, tryConvertToPromise, Proxyable, debug);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./nodeify.js'</span>)(<span class="hljs-built_in">Promise</span>);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./promisify.js'</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./props.js'</span>)(<span class="hljs-built_in">Promise</span>, PromiseArray, tryConvertToPromise, apiRejection);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./race.js'</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL, tryConvertToPromise, apiRejection);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./reduce.js'</span>)(<span class="hljs-built_in">Promise</span>, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL, debug);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./settle.js'</span>)(<span class="hljs-built_in">Promise</span>, PromiseArray, debug);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./some.js'</span>)(<span class="hljs-built_in">Promise</span>, PromiseArray, apiRejection);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./filter.js'</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./each.js'</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL);
<span class="hljs-built_in">require</span>(<span class="hljs-string">'./any.js'</span>)(<span class="hljs-built_in">Promise</span>);
                                                         
    util.toFastProperties(<span class="hljs-built_in">Promise</span>);                                          
    util.toFastProperties(<span class="hljs-built_in">Promise</span>.prototype);                                
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fillTypes</span>(<span class="hljs-params">value</span>) </span>{                                              
        <span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);                                       
        p._fulfillmentHandler0 = value;                                      
        p._rejectionHandler0 = value;                                        
        p._promise0 = value;                                                 
        p._receiver0 = value;                                                
    }                                                                        
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Complete slack tracking, opt out of field-type tracking and<br>
stabilize map</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    fillTypes({<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>});                                                       
    fillTypes({<span class="hljs-attr">b</span>: <span class="hljs-number">2</span>});                                                       
    fillTypes({<span class="hljs-attr">c</span>: <span class="hljs-number">3</span>});                                                       
    fillTypes(<span class="hljs-number">1</span>);                                                            
    fillTypes(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{});                                                 
    fillTypes(<span class="hljs-literal">undefined</span>);                                                    
    fillTypes(<span class="hljs-literal">false</span>);                                                        
    fillTypes(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL));                                        
    debug.setBounds(Async.firstLineError, util.lastLineError);               
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>;                                                          

};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
