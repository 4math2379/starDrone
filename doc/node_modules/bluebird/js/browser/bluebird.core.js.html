<!DOCTYPE html>
<html>
<head>
  <title>bluebird.core.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node_modules/bluebird/js/browser/bluebird.core.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>bluebird.core.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>
<div class="dox">
<div class="summary">
<p>bluebird build version 3.4.7
Features enabled: core
Features disabled: race, call_get, generators, map, nodeify, promisify, props, reduce, settle, some, using, timers, filter, any, each</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">!<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{<span class="hljs-keyword">if</span>(<span class="hljs-string">"object"</span>==<span class="hljs-keyword">typeof</span> exports&amp;&amp;<span class="hljs-string">"undefined"</span>!=<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span>)<span class="hljs-built_in">module</span>.exports=e();<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-string">"function"</span>==<span class="hljs-keyword">typeof</span> define&amp;&amp;define.amd)define([],e);<span class="hljs-keyword">else</span>{<span class="hljs-keyword">var</span> f;<span class="hljs-string">"undefined"</span>!=<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span>?f=<span class="hljs-built_in">window</span>:<span class="hljs-string">"undefined"</span>!=<span class="hljs-keyword">typeof</span> global?f=global:<span class="hljs-string">"undefined"</span>!=<span class="hljs-keyword">typeof</span> self&amp;&amp;(f=self),f.Promise=e()}}(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{<span class="hljs-keyword">var</span> define,<span class="hljs-built_in">module</span>,exports;<span class="hljs-keyword">return</span> (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">e</span>(<span class="hljs-params">t,n,r</span>)</span>{<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">s</span>(<span class="hljs-params">o,u</span>)</span>{<span class="hljs-keyword">if</span>(!n[o]){<span class="hljs-keyword">if</span>(!t[o]){<span class="hljs-keyword">var</span> a=<span class="hljs-keyword">typeof</span> _dereq_==<span class="hljs-string">"function"</span>&amp;&amp;_dereq_;<span class="hljs-keyword">if</span>(!u&amp;&amp;a)<span class="hljs-keyword">return</span> a(o,!<span class="hljs-number">0</span>);<span class="hljs-keyword">if</span>(i)<span class="hljs-keyword">return</span> i(o,!<span class="hljs-number">0</span>);<span class="hljs-keyword">var</span> f=<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Cannot find module '"</span>+o+<span class="hljs-string">"'"</span>);<span class="hljs-keyword">throw</span> f.code=<span class="hljs-string">"MODULE_NOT_FOUND"</span>,f}<span class="hljs-keyword">var</span> l=n[o]={<span class="hljs-attr">exports</span>:{}};t[o][<span class="hljs-number">0</span>].call(l.exports,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{<span class="hljs-keyword">var</span> n=t[o][<span class="hljs-number">1</span>][e];<span class="hljs-keyword">return</span> s(n?n:e)},l,l.exports,e,t,n,r)}<span class="hljs-keyword">return</span> n[o].exports}<span class="hljs-keyword">var</span> i=<span class="hljs-keyword">typeof</span> _dereq_==<span class="hljs-string">"function"</span>&amp;&amp;_dereq_;<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> o=<span class="hljs-number">0</span>;o&lt;r.length;o++)s(r[o]);<span class="hljs-keyword">return</span> s})({<span class="hljs-number">1</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-keyword">var</span> firstLineError;
<span class="hljs-keyword">try</span> {<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(); } <span class="hljs-keyword">catch</span> (e) {firstLineError = e;}
<span class="hljs-keyword">var</span> schedule = _dereq_(<span class="hljs-string">"./schedule"</span>);
<span class="hljs-keyword">var</span> Queue = _dereq_(<span class="hljs-string">"./queue"</span>);
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Async</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._customScheduler = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>._isTickUsed = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>._lateQueue = <span class="hljs-keyword">new</span> Queue(<span class="hljs-number">16</span>);
    <span class="hljs-keyword">this</span>._normalQueue = <span class="hljs-keyword">new</span> Queue(<span class="hljs-number">16</span>);
    <span class="hljs-keyword">this</span>._haveDrainedQueues = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>._trampolineEnabled = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">this</span>.drainQueues = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        self._drainQueues();
    };
    <span class="hljs-keyword">this</span>._schedule = schedule;
}

Async.prototype.setScheduler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">var</span> prev = <span class="hljs-keyword">this</span>._schedule;
    <span class="hljs-keyword">this</span>._schedule = fn;
    <span class="hljs-keyword">this</span>._customScheduler = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> prev;
};

Async.prototype.hasCustomScheduler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._customScheduler;
};

Async.prototype.enableTrampoline = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._trampolineEnabled = <span class="hljs-literal">true</span>;
};

Async.prototype.disableTrampolineIfNecessary = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (util.hasDevTools) {
        <span class="hljs-keyword">this</span>._trampolineEnabled = <span class="hljs-literal">false</span>;
    }
};

Async.prototype.haveItemsQueued = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._isTickUsed || <span class="hljs-keyword">this</span>._haveDrainedQueues;
};


Async.prototype.fatalError = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, isNode</span>) </span>{
    <span class="hljs-keyword">if</span> (isNode) {
        process.stderr.write(<span class="hljs-string">"Fatal "</span> + (e <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span> ? e.stack : e) +
            <span class="hljs-string">"\n"</span>);
        process.exit(<span class="hljs-number">2</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.throwLater(e);
    }
};

Async.prototype.throwLater = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn, arg</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) {
        arg = fn;
        fn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">throw</span> arg; };
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> setTimeout !== <span class="hljs-string">"undefined"</span>) {
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            fn(arg);
        }, <span class="hljs-number">0</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">this</span>._schedule(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            fn(arg);
        });
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"No async scheduler available\u000a\u000a    See http://goo.gl/MqrFmX\u000a"</span>);
    }
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">AsyncInvokeLater</span>(<span class="hljs-params">fn, receiver, arg</span>) </span>{
    <span class="hljs-keyword">this</span>._lateQueue.push(fn, receiver, arg);
    <span class="hljs-keyword">this</span>._queueTick();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">AsyncInvoke</span>(<span class="hljs-params">fn, receiver, arg</span>) </span>{
    <span class="hljs-keyword">this</span>._normalQueue.push(fn, receiver, arg);
    <span class="hljs-keyword">this</span>._queueTick();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">AsyncSettlePromises</span>(<span class="hljs-params">promise</span>) </span>{
    <span class="hljs-keyword">this</span>._normalQueue._pushOne(promise);
    <span class="hljs-keyword">this</span>._queueTick();
}

<span class="hljs-keyword">if</span> (!util.hasDevTools) {
    Async.prototype.invokeLater = AsyncInvokeLater;
    Async.prototype.invoke = AsyncInvoke;
    Async.prototype.settlePromises = AsyncSettlePromises;
} <span class="hljs-keyword">else</span> {
    Async.prototype.invokeLater = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn, receiver, arg</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._trampolineEnabled) {
            AsyncInvokeLater.call(<span class="hljs-keyword">this</span>, fn, receiver, arg);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>._schedule(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    fn.call(receiver, arg);
                }, <span class="hljs-number">100</span>);
            });
        }
    };

    Async.prototype.invoke = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn, receiver, arg</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._trampolineEnabled) {
            AsyncInvoke.call(<span class="hljs-keyword">this</span>, fn, receiver, arg);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>._schedule(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                fn.call(receiver, arg);
            });
        }
    };

    Async.prototype.settlePromises = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">promise</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._trampolineEnabled) {
            AsyncSettlePromises.call(<span class="hljs-keyword">this</span>, promise);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>._schedule(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                promise._settlePromises();
            });
        }
    };
}

Async.prototype._drainQueue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queue</span>) </span>{
    <span class="hljs-keyword">while</span> (queue.length() &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">var</span> fn = queue.shift();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">"function"</span>) {
            fn._settlePromises();
            <span class="hljs-keyword">continue</span>;
        }
        <span class="hljs-keyword">var</span> receiver = queue.shift();
        <span class="hljs-keyword">var</span> arg = queue.shift();
        fn.call(receiver, arg);
    }
};

Async.prototype._drainQueues = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._drainQueue(<span class="hljs-keyword">this</span>._normalQueue);
    <span class="hljs-keyword">this</span>._reset();
    <span class="hljs-keyword">this</span>._haveDrainedQueues = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">this</span>._drainQueue(<span class="hljs-keyword">this</span>._lateQueue);
};

Async.prototype._queueTick = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._isTickUsed) {
        <span class="hljs-keyword">this</span>._isTickUsed = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">this</span>._schedule(<span class="hljs-keyword">this</span>.drainQueues);
    }
};

Async.prototype._reset = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._isTickUsed = <span class="hljs-literal">false</span>;
};

<span class="hljs-built_in">module</span>.exports = Async;
<span class="hljs-built_in">module</span>.exports.firstLineError = firstLineError;

},{<span class="hljs-string">"./queue"</span>:<span class="hljs-number">17</span>,<span class="hljs-string">"./schedule"</span>:<span class="hljs-number">18</span>,<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">2</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Promise, INTERNAL, tryConvertToPromise, debug</span>) </span>{
<span class="hljs-keyword">var</span> calledBind = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">var</span> rejectThis = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_, e</span>) </span>{
    <span class="hljs-keyword">this</span>._reject(e);
};

<span class="hljs-keyword">var</span> targetRejected = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, context</span>) </span>{
    context.promiseRejectionQueued = <span class="hljs-literal">true</span>;
    context.bindingPromise._then(rejectThis, rejectThis, <span class="hljs-literal">null</span>, <span class="hljs-keyword">this</span>, e);
};

<span class="hljs-keyword">var</span> bindingResolved = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">thisArg, context</span>) </span>{
    <span class="hljs-keyword">if</span> (((<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">50397184</span>) === <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">this</span>._resolveCallback(context.target);
    }
};

<span class="hljs-keyword">var</span> bindingRejected = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e, context</span>) </span>{
    <span class="hljs-keyword">if</span> (!context.promiseRejectionQueued) <span class="hljs-keyword">this</span>._reject(e);
};

<span class="hljs-built_in">Promise</span>.prototype.bind = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">thisArg</span>) </span>{
    <span class="hljs-keyword">if</span> (!calledBind) {
        calledBind = <span class="hljs-literal">true</span>;
        <span class="hljs-built_in">Promise</span>.prototype._propagateFrom = debug.propagateFromFunction();
        <span class="hljs-built_in">Promise</span>.prototype._boundValue = debug.boundValueFunction();
    }
    <span class="hljs-keyword">var</span> maybePromise = tryConvertToPromise(thisArg);
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    ret._propagateFrom(<span class="hljs-keyword">this</span>, <span class="hljs-number">1</span>);
    <span class="hljs-keyword">var</span> target = <span class="hljs-keyword">this</span>._target();
    ret._setBoundTo(maybePromise);
    <span class="hljs-keyword">if</span> (maybePromise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) {
        <span class="hljs-keyword">var</span> context = {
            <span class="hljs-attr">promiseRejectionQueued</span>: <span class="hljs-literal">false</span>,
            <span class="hljs-attr">promise</span>: ret,
            <span class="hljs-attr">target</span>: target,
            <span class="hljs-attr">bindingPromise</span>: maybePromise
        };
        target._then(INTERNAL, targetRejected, <span class="hljs-literal">undefined</span>, ret, context);
        maybePromise._then(
            bindingResolved, bindingRejected, <span class="hljs-literal">undefined</span>, ret, context);
        ret._setOnCancel(maybePromise);
    } <span class="hljs-keyword">else</span> {
        ret._resolveCallback(target);
    }
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.prototype._setBoundTo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">if</span> (obj !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">2097152</span>;
        <span class="hljs-keyword">this</span>._boundTo = obj;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField &amp; (~<span class="hljs-number">2097152</span>);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._isBound = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">2097152</span>) === <span class="hljs-number">2097152</span>;
};

<span class="hljs-built_in">Promise</span>.bind = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">thisArg, value</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.resolve(value).bind(thisArg);
};
};

},{}],<span class="hljs-number">3</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-keyword">var</span> old;
<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Promise</span> !== <span class="hljs-string">"undefined"</span>) old = <span class="hljs-built_in">Promise</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">noConflict</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">try</span> { <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Promise</span> === bluebird) <span class="hljs-built_in">Promise</span> = old; }
    <span class="hljs-keyword">catch</span> (e) {}
    <span class="hljs-keyword">return</span> bluebird;
}
<span class="hljs-keyword">var</span> bluebird = _dereq_(<span class="hljs-string">"./promise"</span>)();
bluebird.noConflict = noConflict;
<span class="hljs-built_in">module</span>.exports = bluebird;

},{<span class="hljs-string">"./promise"</span>:<span class="hljs-number">15</span>}],<span class="hljs-number">4</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Promise, PromiseArray, apiRejection, debug</span>) </span>{
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> tryCatch = util.tryCatch;
<span class="hljs-keyword">var</span> errorObj = util.errorObj;
<span class="hljs-keyword">var</span> <span class="hljs-keyword">async</span> = <span class="hljs-built_in">Promise</span>._async;

<span class="hljs-built_in">Promise</span>.prototype[<span class="hljs-string">"break"</span>] = <span class="hljs-built_in">Promise</span>.prototype.cancel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (!debug.cancellation()) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._warn(<span class="hljs-string">"cancellation is disabled"</span>);

    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">var</span> child = promise;
    <span class="hljs-keyword">while</span> (promise._isCancellable()) {
        <span class="hljs-keyword">if</span> (!promise._cancelBy(child)) {
            <span class="hljs-keyword">if</span> (child._isFollowing()) {
                child._followee().cancel();
            } <span class="hljs-keyword">else</span> {
                child._cancelBranched();
            }
            <span class="hljs-keyword">break</span>;
        }

        <span class="hljs-keyword">var</span> parent = promise._cancellationParent;
        <span class="hljs-keyword">if</span> (parent == <span class="hljs-literal">null</span> || !parent._isCancellable()) {
            <span class="hljs-keyword">if</span> (promise._isFollowing()) {
                promise._followee().cancel();
            } <span class="hljs-keyword">else</span> {
                promise._cancelBranched();
            }
            <span class="hljs-keyword">break</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (promise._isFollowing()) promise._followee().cancel();
            promise._setWillBeCancelled();
            child = promise;
            promise = parent;
        }
    }
};

<span class="hljs-built_in">Promise</span>.prototype._branchHasCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._branchesRemainingToCancel--;
};

<span class="hljs-built_in">Promise</span>.prototype._enoughBranchesHaveCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._branchesRemainingToCancel === <span class="hljs-literal">undefined</span> ||
           <span class="hljs-keyword">this</span>._branchesRemainingToCancel &lt;= <span class="hljs-number">0</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._cancelBy = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">canceller</span>) </span>{
    <span class="hljs-keyword">if</span> (canceller === <span class="hljs-keyword">this</span>) {
        <span class="hljs-keyword">this</span>._branchesRemainingToCancel = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>._invokeOnCancel();
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>._branchHasCancelled();
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._enoughBranchesHaveCancelled()) {
            <span class="hljs-keyword">this</span>._invokeOnCancel();
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._cancelBranched = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._enoughBranchesHaveCancelled()) {
        <span class="hljs-keyword">this</span>._cancel();
    }
};

<span class="hljs-built_in">Promise</span>.prototype._cancel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._isCancellable()) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>._setCancelled();
    <span class="hljs-keyword">async</span>.invoke(<span class="hljs-keyword">this</span>._cancelPromises, <span class="hljs-keyword">this</span>, <span class="hljs-literal">undefined</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._cancelPromises = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._length() &gt; <span class="hljs-number">0</span>) <span class="hljs-keyword">this</span>._settlePromises();
};

<span class="hljs-built_in">Promise</span>.prototype._unsetOnCancel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._onCancelField = <span class="hljs-literal">undefined</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._isCancellable = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.isPending() &amp;&amp; !<span class="hljs-keyword">this</span>._isCancelled();
};

<span class="hljs-built_in">Promise</span>.prototype.isCancellable = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.isPending() &amp;&amp; !<span class="hljs-keyword">this</span>.isCancelled();
};

<span class="hljs-built_in">Promise</span>.prototype._doInvokeOnCancel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">onCancelCallback, internalOnly</span>) </span>{
    <span class="hljs-keyword">if</span> (util.isArray(onCancelCallback)) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; onCancelCallback.length; ++i) {
            <span class="hljs-keyword">this</span>._doInvokeOnCancel(onCancelCallback[i], internalOnly);
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (onCancelCallback !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> onCancelCallback === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">if</span> (!internalOnly) {
                <span class="hljs-keyword">var</span> e = tryCatch(onCancelCallback).call(<span class="hljs-keyword">this</span>._boundValue());
                <span class="hljs-keyword">if</span> (e === errorObj) {
                    <span class="hljs-keyword">this</span>._attachExtraTrace(e.e);
                    <span class="hljs-keyword">async</span>.throwLater(e.e);
                }
            }
        } <span class="hljs-keyword">else</span> {
            onCancelCallback._resultCancelled(<span class="hljs-keyword">this</span>);
        }
    }
};

<span class="hljs-built_in">Promise</span>.prototype._invokeOnCancel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> onCancelCallback = <span class="hljs-keyword">this</span>._onCancel();
    <span class="hljs-keyword">this</span>._unsetOnCancel();
    <span class="hljs-keyword">async</span>.invoke(<span class="hljs-keyword">this</span>._doInvokeOnCancel, <span class="hljs-keyword">this</span>, onCancelCallback);
};

<span class="hljs-built_in">Promise</span>.prototype._invokeInternalOnCancel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isCancellable()) {
        <span class="hljs-keyword">this</span>._doInvokeOnCancel(<span class="hljs-keyword">this</span>._onCancel(), <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">this</span>._unsetOnCancel();
    }
};

<span class="hljs-built_in">Promise</span>.prototype._resultCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>.cancel();
};

};

},{<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">5</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">NEXT_FILTER</span>) </span>{
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> getKeys = _dereq_(<span class="hljs-string">"./es5"</span>).keys;
<span class="hljs-keyword">var</span> tryCatch = util.tryCatch;
<span class="hljs-keyword">var</span> errorObj = util.errorObj;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">catchFilter</span>(<span class="hljs-params">instances, cb, promise</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">var</span> boundTo = promise._boundValue();
        predicateLoop: <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; instances.length; ++i) {
            <span class="hljs-keyword">var</span> item = instances[i];

            <span class="hljs-keyword">if</span> (item === <span class="hljs-built_in">Error</span> ||
                (item != <span class="hljs-literal">null</span> &amp;&amp; item.prototype <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>)) {
                <span class="hljs-keyword">if</span> (e <span class="hljs-keyword">instanceof</span> item) {
                    <span class="hljs-keyword">return</span> tryCatch(cb).call(boundTo, e);
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> item === <span class="hljs-string">"function"</span>) {
                <span class="hljs-keyword">var</span> matchesPredicate = tryCatch(item).call(boundTo, e);
                <span class="hljs-keyword">if</span> (matchesPredicate === errorObj) {
                    <span class="hljs-keyword">return</span> matchesPredicate;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (matchesPredicate) {
                    <span class="hljs-keyword">return</span> tryCatch(cb).call(boundTo, e);
                }
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (util.isObject(e)) {
                <span class="hljs-keyword">var</span> keys = getKeys(item);
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; keys.length; ++j) {
                    <span class="hljs-keyword">var</span> key = keys[j];
                    <span class="hljs-keyword">if</span> (item[key] != e[key]) {
                        <span class="hljs-keyword">continue</span> predicateLoop;
                    }
                }
                <span class="hljs-keyword">return</span> tryCatch(cb).call(boundTo, e);
            }
        }
        <span class="hljs-keyword">return</span> NEXT_FILTER;
    };
}

<span class="hljs-keyword">return</span> catchFilter;
};

},{<span class="hljs-string">"./es5"</span>:<span class="hljs-number">10</span>,<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">6</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Promise</span>) </span>{
<span class="hljs-keyword">var</span> longStackTraces = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">var</span> contextStack = [];

<span class="hljs-built_in">Promise</span>.prototype._promiseCreated = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};
<span class="hljs-built_in">Promise</span>.prototype._pushContext = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};
<span class="hljs-built_in">Promise</span>.prototype._popContext = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;};
<span class="hljs-built_in">Promise</span>._peekContext = <span class="hljs-built_in">Promise</span>.prototype._peekContext = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Context</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._trace = <span class="hljs-keyword">new</span> Context.CapturedTrace(peekContext());
}
Context.prototype._pushContext = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._trace !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">this</span>._trace._promiseCreated = <span class="hljs-literal">null</span>;
        contextStack.push(<span class="hljs-keyword">this</span>._trace);
    }
};

Context.prototype._popContext = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._trace !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">var</span> trace = contextStack.pop();
        <span class="hljs-keyword">var</span> ret = trace._promiseCreated;
        trace._promiseCreated = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">return</span> ret;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createContext</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (longStackTraces) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Context();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">peekContext</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> lastIndex = contextStack.length - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (lastIndex &gt;= <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> contextStack[lastIndex];
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
}
Context.CapturedTrace = <span class="hljs-literal">null</span>;
Context.create = createContext;
Context.deactivateLongStackTraces = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};
Context.activateLongStackTraces = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> Promise_pushContext = <span class="hljs-built_in">Promise</span>.prototype._pushContext;
    <span class="hljs-keyword">var</span> Promise_popContext = <span class="hljs-built_in">Promise</span>.prototype._popContext;
    <span class="hljs-keyword">var</span> Promise_PeekContext = <span class="hljs-built_in">Promise</span>._peekContext;
    <span class="hljs-keyword">var</span> Promise_peekContext = <span class="hljs-built_in">Promise</span>.prototype._peekContext;
    <span class="hljs-keyword">var</span> Promise_promiseCreated = <span class="hljs-built_in">Promise</span>.prototype._promiseCreated;
    Context.deactivateLongStackTraces = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">Promise</span>.prototype._pushContext = Promise_pushContext;
        <span class="hljs-built_in">Promise</span>.prototype._popContext = Promise_popContext;
        <span class="hljs-built_in">Promise</span>._peekContext = Promise_PeekContext;
        <span class="hljs-built_in">Promise</span>.prototype._peekContext = Promise_peekContext;
        <span class="hljs-built_in">Promise</span>.prototype._promiseCreated = Promise_promiseCreated;
        longStackTraces = <span class="hljs-literal">false</span>;
    };
    longStackTraces = <span class="hljs-literal">true</span>;
    <span class="hljs-built_in">Promise</span>.prototype._pushContext = Context.prototype._pushContext;
    <span class="hljs-built_in">Promise</span>.prototype._popContext = Context.prototype._popContext;
    <span class="hljs-built_in">Promise</span>._peekContext = <span class="hljs-built_in">Promise</span>.prototype._peekContext = peekContext;
    <span class="hljs-built_in">Promise</span>.prototype._promiseCreated = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> ctx = <span class="hljs-keyword">this</span>._peekContext();
        <span class="hljs-keyword">if</span> (ctx &amp;&amp; ctx._promiseCreated == <span class="hljs-literal">null</span>) ctx._promiseCreated = <span class="hljs-keyword">this</span>;
    };
};
<span class="hljs-keyword">return</span> Context;
};

},{}],<span class="hljs-number">7</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Promise, Context</span>) </span>{
<span class="hljs-keyword">var</span> getDomain = <span class="hljs-built_in">Promise</span>._getDomain;
<span class="hljs-keyword">var</span> <span class="hljs-keyword">async</span> = <span class="hljs-built_in">Promise</span>._async;
<span class="hljs-keyword">var</span> Warning = _dereq_(<span class="hljs-string">"./errors"</span>).Warning;
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> canAttachTrace = util.canAttachTrace;
<span class="hljs-keyword">var</span> unhandledRejectionHandled;
<span class="hljs-keyword">var</span> possiblyUnhandledRejection;
<span class="hljs-keyword">var</span> bluebirdFramePattern =
    <span class="hljs-regexp">/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/</span>;
<span class="hljs-keyword">var</span> nodeFramePattern = <span class="hljs-regexp">/\((?:timers\.js):\d+:\d+\)/</span>;
<span class="hljs-keyword">var</span> parseLinePattern = <span class="hljs-regexp">/[\/&lt;\(](.+?):(\d+):(\d+)\)?\s*$/</span>;
<span class="hljs-keyword">var</span> stackFramePattern = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">var</span> formatStack = <span class="hljs-literal">null</span>;
<span class="hljs-keyword">var</span> indentStackFrames = <span class="hljs-literal">false</span>;
<span class="hljs-keyword">var</span> printWarning;
<span class="hljs-keyword">var</span> debugging = !!(util.env(<span class="hljs-string">"BLUEBIRD_DEBUG"</span>) != <span class="hljs-number">0</span> &amp;&amp;
                        (<span class="hljs-literal">true</span> ||
                         util.env(<span class="hljs-string">"BLUEBIRD_DEBUG"</span>) ||
                         util.env(<span class="hljs-string">"NODE_ENV"</span>) === <span class="hljs-string">"development"</span>));

<span class="hljs-keyword">var</span> warnings = !!(util.env(<span class="hljs-string">"BLUEBIRD_WARNINGS"</span>) != <span class="hljs-number">0</span> &amp;&amp;
    (debugging || util.env(<span class="hljs-string">"BLUEBIRD_WARNINGS"</span>)));

<span class="hljs-keyword">var</span> longStackTraces = !!(util.env(<span class="hljs-string">"BLUEBIRD_LONG_STACK_TRACES"</span>) != <span class="hljs-number">0</span> &amp;&amp;
    (debugging || util.env(<span class="hljs-string">"BLUEBIRD_LONG_STACK_TRACES"</span>)));

<span class="hljs-keyword">var</span> wForgottenReturn = util.env(<span class="hljs-string">"BLUEBIRD_W_FORGOTTEN_RETURN"</span>) != <span class="hljs-number">0</span> &amp;&amp;
    (warnings || !!util.env(<span class="hljs-string">"BLUEBIRD_W_FORGOTTEN_RETURN"</span>));

<span class="hljs-built_in">Promise</span>.prototype.suppressUnhandledRejections = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> target = <span class="hljs-keyword">this</span>._target();
    target._bitField = ((target._bitField &amp; (~<span class="hljs-number">1048576</span>)) |
                      <span class="hljs-number">524288</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._ensurePossibleRejectionHandled = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">524288</span>) !== <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>._setRejectionIsUnhandled();
    <span class="hljs-keyword">async</span>.invokeLater(<span class="hljs-keyword">this</span>._notifyUnhandledRejection, <span class="hljs-keyword">this</span>, <span class="hljs-literal">undefined</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._notifyUnhandledRejectionIsHandled = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    fireRejectionEvent(<span class="hljs-string">"rejectionHandled"</span>,
                                  unhandledRejectionHandled, <span class="hljs-literal">undefined</span>, <span class="hljs-keyword">this</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setReturnedNonUndefined = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">268435456</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._returnedNonUndefined = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">268435456</span>) !== <span class="hljs-number">0</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._notifyUnhandledRejection = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isRejectionUnhandled()) {
        <span class="hljs-keyword">var</span> reason = <span class="hljs-keyword">this</span>._settledValue();
        <span class="hljs-keyword">this</span>._setUnhandledRejectionIsNotified();
        fireRejectionEvent(<span class="hljs-string">"unhandledRejection"</span>,
                                      possiblyUnhandledRejection, reason, <span class="hljs-keyword">this</span>);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._setUnhandledRejectionIsNotified = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">262144</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._unsetUnhandledRejectionIsNotified = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField &amp; (~<span class="hljs-number">262144</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._isUnhandledRejectionNotified = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">262144</span>) &gt; <span class="hljs-number">0</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._setRejectionIsUnhandled = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">1048576</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._unsetRejectionIsUnhandled = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField &amp; (~<span class="hljs-number">1048576</span>);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isUnhandledRejectionNotified()) {
        <span class="hljs-keyword">this</span>._unsetUnhandledRejectionIsNotified();
        <span class="hljs-keyword">this</span>._notifyUnhandledRejectionIsHandled();
    }
};

<span class="hljs-built_in">Promise</span>.prototype._isRejectionUnhandled = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">1048576</span>) &gt; <span class="hljs-number">0</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._warn = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message, shouldUseOwnTrace, promise</span>) </span>{
    <span class="hljs-keyword">return</span> warn(message, shouldUseOwnTrace, promise || <span class="hljs-keyword">this</span>);
};

<span class="hljs-built_in">Promise</span>.onPossiblyUnhandledRejection = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">var</span> domain = getDomain();
    possiblyUnhandledRejection =
        <span class="hljs-keyword">typeof</span> fn === <span class="hljs-string">"function"</span> ? (domain === <span class="hljs-literal">null</span> ?
                                            fn : util.domainBind(domain, fn))
                                 : <span class="hljs-literal">undefined</span>;
};

<span class="hljs-built_in">Promise</span>.onUnhandledRejectionHandled = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">var</span> domain = getDomain();
    unhandledRejectionHandled =
        <span class="hljs-keyword">typeof</span> fn === <span class="hljs-string">"function"</span> ? (domain === <span class="hljs-literal">null</span> ?
                                            fn : util.domainBind(domain, fn))
                                 : <span class="hljs-literal">undefined</span>;
};

<span class="hljs-keyword">var</span> disableLongStackTraces = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};
<span class="hljs-built_in">Promise</span>.longStackTraces = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span>.haveItemsQueued() &amp;&amp; !config.longStackTraces) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"cannot enable long stack traces after promises have been created\u000a\u000a    See http://goo.gl/MqrFmX\u000a"</span>);
    }
    <span class="hljs-keyword">if</span> (!config.longStackTraces &amp;&amp; longStackTracesIsSupported()) {
        <span class="hljs-keyword">var</span> Promise_captureStackTrace = <span class="hljs-built_in">Promise</span>.prototype._captureStackTrace;
        <span class="hljs-keyword">var</span> Promise_attachExtraTrace = <span class="hljs-built_in">Promise</span>.prototype._attachExtraTrace;
        config.longStackTraces = <span class="hljs-literal">true</span>;
        disableLongStackTraces = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span>.haveItemsQueued() &amp;&amp; !config.longStackTraces) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"cannot enable long stack traces after promises have been created\u000a\u000a    See http://goo.gl/MqrFmX\u000a"</span>);
            }
            <span class="hljs-built_in">Promise</span>.prototype._captureStackTrace = Promise_captureStackTrace;
            <span class="hljs-built_in">Promise</span>.prototype._attachExtraTrace = Promise_attachExtraTrace;
            Context.deactivateLongStackTraces();
            <span class="hljs-keyword">async</span>.enableTrampoline();
            config.longStackTraces = <span class="hljs-literal">false</span>;
        };
        <span class="hljs-built_in">Promise</span>.prototype._captureStackTrace = longStackTracesCaptureStackTrace;
        <span class="hljs-built_in">Promise</span>.prototype._attachExtraTrace = longStackTracesAttachExtraTrace;
        Context.activateLongStackTraces();
        <span class="hljs-keyword">async</span>.disableTrampolineIfNecessary();
    }
};

<span class="hljs-built_in">Promise</span>.hasLongStackTraces = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> config.longStackTraces &amp;&amp; longStackTracesIsSupported();
};

<span class="hljs-keyword">var</span> fireDomEvent = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> CustomEvent === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">var</span> event = <span class="hljs-keyword">new</span> CustomEvent(<span class="hljs-string">"CustomEvent"</span>);
            util.global.dispatchEvent(event);
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, event</span>) </span>{
                <span class="hljs-keyword">var</span> domEvent = <span class="hljs-keyword">new</span> CustomEvent(name.toLowerCase(), {
                    <span class="hljs-attr">detail</span>: event,
                    <span class="hljs-attr">cancelable</span>: <span class="hljs-literal">true</span>
                });
                <span class="hljs-keyword">return</span> !util.global.dispatchEvent(domEvent);
            };
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> Event === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">var</span> event = <span class="hljs-keyword">new</span> Event(<span class="hljs-string">"CustomEvent"</span>);
            util.global.dispatchEvent(event);
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, event</span>) </span>{
                <span class="hljs-keyword">var</span> domEvent = <span class="hljs-keyword">new</span> Event(name.toLowerCase(), {
                    <span class="hljs-attr">cancelable</span>: <span class="hljs-literal">true</span>
                });
                domEvent.detail = event;
                <span class="hljs-keyword">return</span> !util.global.dispatchEvent(domEvent);
            };
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> event = <span class="hljs-built_in">document</span>.createEvent(<span class="hljs-string">"CustomEvent"</span>);
            event.initCustomEvent(<span class="hljs-string">"testingtheevent"</span>, <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>, {});
            util.global.dispatchEvent(event);
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, event</span>) </span>{
                <span class="hljs-keyword">var</span> domEvent = <span class="hljs-built_in">document</span>.createEvent(<span class="hljs-string">"CustomEvent"</span>);
                domEvent.initCustomEvent(name.toLowerCase(), <span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>,
                    event);
                <span class="hljs-keyword">return</span> !util.global.dispatchEvent(domEvent);
            };
        }
    } <span class="hljs-keyword">catch</span> (e) {}
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };
})();

<span class="hljs-keyword">var</span> fireGlobalEvent = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (util.isNode) {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> process.emit.apply(process, <span class="hljs-built_in">arguments</span>);
        };
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (!util.global) {
            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            };
        }
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
            <span class="hljs-keyword">var</span> methodName = <span class="hljs-string">"on"</span> + name.toLowerCase();
            <span class="hljs-keyword">var</span> method = util.global[methodName];
            <span class="hljs-keyword">if</span> (!method) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            method.apply(util.global, [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>));
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        };
    }
})();

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">generatePromiseLifecycleEventObject</span>(<span class="hljs-params">name, promise</span>) </span>{
    <span class="hljs-keyword">return</span> {<span class="hljs-attr">promise</span>: promise};
}

<span class="hljs-keyword">var</span> eventToObjectGenerator = {
    <span class="hljs-attr">promiseCreated</span>: generatePromiseLifecycleEventObject,
    <span class="hljs-attr">promiseFulfilled</span>: generatePromiseLifecycleEventObject,
    <span class="hljs-attr">promiseRejected</span>: generatePromiseLifecycleEventObject,
    <span class="hljs-attr">promiseResolved</span>: generatePromiseLifecycleEventObject,
    <span class="hljs-attr">promiseCancelled</span>: generatePromiseLifecycleEventObject,
    <span class="hljs-attr">promiseChained</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, promise, child</span>) </span>{
        <span class="hljs-keyword">return</span> {<span class="hljs-attr">promise</span>: promise, <span class="hljs-attr">child</span>: child};
    },
    <span class="hljs-attr">warning</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, warning</span>) </span>{
        <span class="hljs-keyword">return</span> {<span class="hljs-attr">warning</span>: warning};
    },
    <span class="hljs-attr">unhandledRejection</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name, reason, promise</span>) </span>{
        <span class="hljs-keyword">return</span> {<span class="hljs-attr">reason</span>: reason, <span class="hljs-attr">promise</span>: promise};
    },
    <span class="hljs-attr">rejectionHandled</span>: generatePromiseLifecycleEventObject
};

<span class="hljs-keyword">var</span> activeFireEvent = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
    <span class="hljs-keyword">var</span> globalEventFired = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">try</span> {
        globalEventFired = fireGlobalEvent.apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">async</span>.throwLater(e);
        globalEventFired = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">var</span> domEventFired = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">try</span> {
        domEventFired = fireDomEvent(name,
                    eventToObjectGenerator[name].apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>));
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">async</span>.throwLater(e);
        domEventFired = <span class="hljs-literal">true</span>;
    }

    <span class="hljs-keyword">return</span> domEventFired || globalEventFired;
};

<span class="hljs-built_in">Promise</span>.config = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opts</span>) </span>{
    opts = <span class="hljs-built_in">Object</span>(opts);
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"longStackTraces"</span> <span class="hljs-keyword">in</span> opts) {
        <span class="hljs-keyword">if</span> (opts.longStackTraces) {
            <span class="hljs-built_in">Promise</span>.longStackTraces();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!opts.longStackTraces &amp;&amp; <span class="hljs-built_in">Promise</span>.hasLongStackTraces()) {
            disableLongStackTraces();
        }
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"warnings"</span> <span class="hljs-keyword">in</span> opts) {
        <span class="hljs-keyword">var</span> warningsOption = opts.warnings;
        config.warnings = !!warningsOption;
        wForgottenReturn = config.warnings;

        <span class="hljs-keyword">if</span> (util.isObject(warningsOption)) {
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"wForgottenReturn"</span> <span class="hljs-keyword">in</span> warningsOption) {
                wForgottenReturn = !!warningsOption.wForgottenReturn;
            }
        }
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"cancellation"</span> <span class="hljs-keyword">in</span> opts &amp;&amp; opts.cancellation &amp;&amp; !config.cancellation) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span>.haveItemsQueued()) {
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
                <span class="hljs-string">"cannot enable cancellation after promises are in use"</span>);
        }
        <span class="hljs-built_in">Promise</span>.prototype._clearCancellationData =
            cancellationClearCancellationData;
        <span class="hljs-built_in">Promise</span>.prototype._propagateFrom = cancellationPropagateFrom;
        <span class="hljs-built_in">Promise</span>.prototype._onCancel = cancellationOnCancel;
        <span class="hljs-built_in">Promise</span>.prototype._setOnCancel = cancellationSetOnCancel;
        <span class="hljs-built_in">Promise</span>.prototype._attachCancellationCallback =
            cancellationAttachCancellationCallback;
        <span class="hljs-built_in">Promise</span>.prototype._execute = cancellationExecute;
        propagateFromFunction = cancellationPropagateFrom;
        config.cancellation = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-string">"monitoring"</span> <span class="hljs-keyword">in</span> opts) {
        <span class="hljs-keyword">if</span> (opts.monitoring &amp;&amp; !config.monitoring) {
            config.monitoring = <span class="hljs-literal">true</span>;
            <span class="hljs-built_in">Promise</span>.prototype._fireEvent = activeFireEvent;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!opts.monitoring &amp;&amp; config.monitoring) {
            config.monitoring = <span class="hljs-literal">false</span>;
            <span class="hljs-built_in">Promise</span>.prototype._fireEvent = defaultFireEvent;
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>;
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">defaultFireEvent</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; }

<span class="hljs-built_in">Promise</span>.prototype._fireEvent = defaultFireEvent;
<span class="hljs-built_in">Promise</span>.prototype._execute = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">executor, resolve, reject</span>) </span>{
    <span class="hljs-keyword">try</span> {
        executor(resolve, reject);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> e;
    }
};
<span class="hljs-built_in">Promise</span>.prototype._onCancel = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{};
<span class="hljs-built_in">Promise</span>.prototype._setOnCancel = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">handler</span>) </span>{ ; };
<span class="hljs-built_in">Promise</span>.prototype._attachCancellationCallback = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">onCancel</span>) </span>{
    ;
};
<span class="hljs-built_in">Promise</span>.prototype._captureStackTrace = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{};
<span class="hljs-built_in">Promise</span>.prototype._attachExtraTrace = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{};
<span class="hljs-built_in">Promise</span>.prototype._clearCancellationData = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};
<span class="hljs-built_in">Promise</span>.prototype._propagateFrom = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">parent, flags</span>) </span>{
    ;
    ;
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cancellationExecute</span>(<span class="hljs-params">executor, resolve, reject</span>) </span>{
    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">try</span> {
        executor(resolve, reject, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">onCancel</span>) </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> onCancel !== <span class="hljs-string">"function"</span>) {
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"onCancel must be a function, got: "</span> +
                                    util.toString(onCancel));
            }
            promise._attachCancellationCallback(onCancel);
        });
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> e;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cancellationAttachCancellationCallback</span>(<span class="hljs-params">onCancel</span>) </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._isCancellable()) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;

    <span class="hljs-keyword">var</span> previousOnCancel = <span class="hljs-keyword">this</span>._onCancel();
    <span class="hljs-keyword">if</span> (previousOnCancel !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">if</span> (util.isArray(previousOnCancel)) {
            previousOnCancel.push(onCancel);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>._setOnCancel([previousOnCancel, onCancel]);
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>._setOnCancel(onCancel);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cancellationOnCancel</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._onCancelField;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cancellationSetOnCancel</span>(<span class="hljs-params">onCancel</span>) </span>{
    <span class="hljs-keyword">this</span>._onCancelField = onCancel;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cancellationClearCancellationData</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._cancellationParent = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._onCancelField = <span class="hljs-literal">undefined</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cancellationPropagateFrom</span>(<span class="hljs-params">parent, flags</span>) </span>{
    <span class="hljs-keyword">if</span> ((flags &amp; <span class="hljs-number">1</span>) !== <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>._cancellationParent = parent;
        <span class="hljs-keyword">var</span> branchesRemainingToCancel = parent._branchesRemainingToCancel;
        <span class="hljs-keyword">if</span> (branchesRemainingToCancel === <span class="hljs-literal">undefined</span>) {
            branchesRemainingToCancel = <span class="hljs-number">0</span>;
        }
        parent._branchesRemainingToCancel = branchesRemainingToCancel + <span class="hljs-number">1</span>;
    }
    <span class="hljs-keyword">if</span> ((flags &amp; <span class="hljs-number">2</span>) !== <span class="hljs-number">0</span> &amp;&amp; parent._isBound()) {
        <span class="hljs-keyword">this</span>._setBoundTo(parent._boundTo);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">bindingPropagateFrom</span>(<span class="hljs-params">parent, flags</span>) </span>{
    <span class="hljs-keyword">if</span> ((flags &amp; <span class="hljs-number">2</span>) !== <span class="hljs-number">0</span> &amp;&amp; parent._isBound()) {
        <span class="hljs-keyword">this</span>._setBoundTo(parent._boundTo);
    }
}
<span class="hljs-keyword">var</span> propagateFromFunction = bindingPropagateFrom;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">boundValueFunction</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">this</span>._boundTo;
    <span class="hljs-keyword">if</span> (ret !== <span class="hljs-literal">undefined</span>) {
        <span class="hljs-keyword">if</span> (ret <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) {
            <span class="hljs-keyword">if</span> (ret.isFulfilled()) {
                <span class="hljs-keyword">return</span> ret.value();
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
            }
        }
    }
    <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">longStackTracesCaptureStackTrace</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._trace = <span class="hljs-keyword">new</span> CapturedTrace(<span class="hljs-keyword">this</span>._peekContext());
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">longStackTracesAttachExtraTrace</span>(<span class="hljs-params">error, ignoreSelf</span>) </span>{
    <span class="hljs-keyword">if</span> (canAttachTrace(error)) {
        <span class="hljs-keyword">var</span> trace = <span class="hljs-keyword">this</span>._trace;
        <span class="hljs-keyword">if</span> (trace !== <span class="hljs-literal">undefined</span>) {
            <span class="hljs-keyword">if</span> (ignoreSelf) trace = trace._parent;
        }
        <span class="hljs-keyword">if</span> (trace !== <span class="hljs-literal">undefined</span>) {
            trace.attachExtraTrace(error);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!error.__stackCleaned__) {
            <span class="hljs-keyword">var</span> parsed = parseStackAndMessage(error);
            util.notEnumerableProp(error, <span class="hljs-string">"stack"</span>,
                parsed.message + <span class="hljs-string">"\n"</span> + parsed.stack.join(<span class="hljs-string">"\n"</span>));
            util.notEnumerableProp(error, <span class="hljs-string">"__stackCleaned__"</span>, <span class="hljs-literal">true</span>);
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkForgottenReturns</span>(<span class="hljs-params">returnValue, promiseCreated, name, promise,
                               parent</span>) </span>{
    <span class="hljs-keyword">if</span> (returnValue === <span class="hljs-literal">undefined</span> &amp;&amp; promiseCreated !== <span class="hljs-literal">null</span> &amp;&amp;
        wForgottenReturn) {
        <span class="hljs-keyword">if</span> (parent !== <span class="hljs-literal">undefined</span> &amp;&amp; parent._returnedNonUndefined()) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> ((promise._bitField &amp; <span class="hljs-number">65535</span>) === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">if</span> (name) name = name + <span class="hljs-string">" "</span>;
        <span class="hljs-keyword">var</span> handlerLine = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> creatorLine = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span> (promiseCreated._trace) {
            <span class="hljs-keyword">var</span> traceLines = promiseCreated._trace.stack.split(<span class="hljs-string">"\n"</span>);
            <span class="hljs-keyword">var</span> stack = cleanStack(traceLines);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = stack.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; --i) {
                <span class="hljs-keyword">var</span> line = stack[i];
                <span class="hljs-keyword">if</span> (!nodeFramePattern.test(line)) {
                    <span class="hljs-keyword">var</span> lineMatches = line.match(parseLinePattern);
                    <span class="hljs-keyword">if</span> (lineMatches) {
                        handlerLine  = <span class="hljs-string">"at "</span> + lineMatches[<span class="hljs-number">1</span>] +
                            <span class="hljs-string">":"</span> + lineMatches[<span class="hljs-number">2</span>] + <span class="hljs-string">":"</span> + lineMatches[<span class="hljs-number">3</span>] + <span class="hljs-string">" "</span>;
                    }
                    <span class="hljs-keyword">break</span>;
                }
            }

            <span class="hljs-keyword">if</span> (stack.length &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">var</span> firstUserLine = stack[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; traceLines.length; ++i) {

                    <span class="hljs-keyword">if</span> (traceLines[i] === firstUserLine) {
                        <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span>) {
                            creatorLine = <span class="hljs-string">"\n"</span> + traceLines[i - <span class="hljs-number">1</span>];
                        }
                        <span class="hljs-keyword">break</span>;
                    }
                }

            }
        }
        <span class="hljs-keyword">var</span> msg = <span class="hljs-string">"a promise was created in a "</span> + name +
            <span class="hljs-string">"handler "</span> + handlerLine + <span class="hljs-string">"but was not returned from it, "</span> +
            <span class="hljs-string">"see http://goo.gl/rRqMUw"</span> +
            creatorLine;
        promise._warn(msg, <span class="hljs-literal">true</span>, promiseCreated);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deprecated</span>(<span class="hljs-params">name, replacement</span>) </span>{
    <span class="hljs-keyword">var</span> message = name +
        <span class="hljs-string">" is deprecated and will be removed in a future version."</span>;
    <span class="hljs-keyword">if</span> (replacement) message += <span class="hljs-string">" Use "</span> + replacement + <span class="hljs-string">" instead."</span>;
    <span class="hljs-keyword">return</span> warn(message);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">warn</span>(<span class="hljs-params">message, shouldUseOwnTrace, promise</span>) </span>{
    <span class="hljs-keyword">if</span> (!config.warnings) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">var</span> warning = <span class="hljs-keyword">new</span> Warning(message);
    <span class="hljs-keyword">var</span> ctx;
    <span class="hljs-keyword">if</span> (shouldUseOwnTrace) {
        promise._attachExtraTrace(warning);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (config.longStackTraces &amp;&amp; (ctx = <span class="hljs-built_in">Promise</span>._peekContext())) {
        ctx.attachExtraTrace(warning);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> parsed = parseStackAndMessage(warning);
        warning.stack = parsed.message + <span class="hljs-string">"\n"</span> + parsed.stack.join(<span class="hljs-string">"\n"</span>);
    }

    <span class="hljs-keyword">if</span> (!activeFireEvent(<span class="hljs-string">"warning"</span>, warning)) {
        formatAndLogError(warning, <span class="hljs-string">""</span>, <span class="hljs-literal">true</span>);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reconstructStack</span>(<span class="hljs-params">message, stacks</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; stacks.length - <span class="hljs-number">1</span>; ++i) {
        stacks[i].push(<span class="hljs-string">"From previous event:"</span>);
        stacks[i] = stacks[i].join(<span class="hljs-string">"\n"</span>);
    }
    <span class="hljs-keyword">if</span> (i &lt; stacks.length) {
        stacks[i] = stacks[i].join(<span class="hljs-string">"\n"</span>);
    }
    <span class="hljs-keyword">return</span> message + <span class="hljs-string">"\n"</span> + stacks.join(<span class="hljs-string">"\n"</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeDuplicateOrEmptyJumps</span>(<span class="hljs-params">stacks</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; stacks.length; ++i) {
        <span class="hljs-keyword">if</span> (stacks[i].length === <span class="hljs-number">0</span> ||
            ((i + <span class="hljs-number">1</span> &lt; stacks.length) &amp;&amp; stacks[i][<span class="hljs-number">0</span>] === stacks[i+<span class="hljs-number">1</span>][<span class="hljs-number">0</span>])) {
            stacks.splice(i, <span class="hljs-number">1</span>);
            i--;
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">removeCommonRoots</span>(<span class="hljs-params">stacks</span>) </span>{
    <span class="hljs-keyword">var</span> current = stacks[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; stacks.length; ++i) {
        <span class="hljs-keyword">var</span> prev = stacks[i];
        <span class="hljs-keyword">var</span> currentLastIndex = current.length - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">var</span> currentLastLine = current[currentLastIndex];
        <span class="hljs-keyword">var</span> commonRootMeetPoint = <span class="hljs-number">-1</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = prev.length - <span class="hljs-number">1</span>; j &gt;= <span class="hljs-number">0</span>; --j) {
            <span class="hljs-keyword">if</span> (prev[j] === currentLastLine) {
                commonRootMeetPoint = j;
                <span class="hljs-keyword">break</span>;
            }
        }

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = commonRootMeetPoint; j &gt;= <span class="hljs-number">0</span>; --j) {
            <span class="hljs-keyword">var</span> line = prev[j];
            <span class="hljs-keyword">if</span> (current[currentLastIndex] === line) {
                current.pop();
                currentLastIndex--;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">break</span>;
            }
        }
        current = prev;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanStack</span>(<span class="hljs-params">stack</span>) </span>{
    <span class="hljs-keyword">var</span> ret = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; stack.length; ++i) {
        <span class="hljs-keyword">var</span> line = stack[i];
        <span class="hljs-keyword">var</span> isTraceLine = <span class="hljs-string">"    (No stack trace)"</span> === line ||
            stackFramePattern.test(line);
        <span class="hljs-keyword">var</span> isInternalFrame = isTraceLine &amp;&amp; shouldIgnore(line);
        <span class="hljs-keyword">if</span> (isTraceLine &amp;&amp; !isInternalFrame) {
            <span class="hljs-keyword">if</span> (indentStackFrames &amp;&amp; line.charAt(<span class="hljs-number">0</span>) !== <span class="hljs-string">" "</span>) {
                line = <span class="hljs-string">"    "</span> + line;
            }
            ret.push(line);
        }
    }
    <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stackFramesAsArray</span>(<span class="hljs-params">error</span>) </span>{
    <span class="hljs-keyword">var</span> stack = error.stack.replace(<span class="hljs-regexp">/\s+$/g</span>, <span class="hljs-string">""</span>).split(<span class="hljs-string">"\n"</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; stack.length; ++i) {
        <span class="hljs-keyword">var</span> line = stack[i];
        <span class="hljs-keyword">if</span> (<span class="hljs-string">"    (No stack trace)"</span> === line || stackFramePattern.test(line)) {
            <span class="hljs-keyword">break</span>;
        }
    }
    <span class="hljs-keyword">if</span> (i &gt; <span class="hljs-number">0</span> &amp;&amp; error.name != <span class="hljs-string">"SyntaxError"</span>) {
        stack = stack.slice(i);
    }
    <span class="hljs-keyword">return</span> stack;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseStackAndMessage</span>(<span class="hljs-params">error</span>) </span>{
    <span class="hljs-keyword">var</span> stack = error.stack;
    <span class="hljs-keyword">var</span> message = error.toString();
    stack = <span class="hljs-keyword">typeof</span> stack === <span class="hljs-string">"string"</span> &amp;&amp; stack.length &gt; <span class="hljs-number">0</span>
                ? stackFramesAsArray(error) : [<span class="hljs-string">"    (No stack trace)"</span>];
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">message</span>: message,
        <span class="hljs-attr">stack</span>: error.name == <span class="hljs-string">"SyntaxError"</span> ? stack : cleanStack(stack)
    };
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatAndLogError</span>(<span class="hljs-params">error, title, isSoft</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">console</span> !== <span class="hljs-string">"undefined"</span>) {
        <span class="hljs-keyword">var</span> message;
        <span class="hljs-keyword">if</span> (util.isObject(error)) {
            <span class="hljs-keyword">var</span> stack = error.stack;
            message = title + formatStack(stack, error);
        } <span class="hljs-keyword">else</span> {
            message = title + <span class="hljs-built_in">String</span>(error);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> printWarning === <span class="hljs-string">"function"</span>) {
            printWarning(message, isSoft);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">console</span>.log === <span class="hljs-string">"function"</span> ||
            <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">console</span>.log === <span class="hljs-string">"object"</span>) {
            <span class="hljs-built_in">console</span>.log(message);
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fireRejectionEvent</span>(<span class="hljs-params">name, localHandler, reason, promise</span>) </span>{
    <span class="hljs-keyword">var</span> localEventFired = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> localHandler === <span class="hljs-string">"function"</span>) {
            localEventFired = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">if</span> (name === <span class="hljs-string">"rejectionHandled"</span>) {
                localHandler(promise);
            } <span class="hljs-keyword">else</span> {
                localHandler(reason, promise);
            }
        }
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">async</span>.throwLater(e);
    }

    <span class="hljs-keyword">if</span> (name === <span class="hljs-string">"unhandledRejection"</span>) {
        <span class="hljs-keyword">if</span> (!activeFireEvent(name, reason, promise) &amp;&amp; !localEventFired) {
            formatAndLogError(reason, <span class="hljs-string">"Unhandled rejection "</span>);
        }
    } <span class="hljs-keyword">else</span> {
        activeFireEvent(name, promise);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatNonError</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">var</span> str;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"function"</span>) {
        str = <span class="hljs-string">"[function "</span> +
            (obj.name || <span class="hljs-string">"anonymous"</span>) +
            <span class="hljs-string">"]"</span>;
    } <span class="hljs-keyword">else</span> {
        str = obj &amp;&amp; <span class="hljs-keyword">typeof</span> obj.toString === <span class="hljs-string">"function"</span>
            ? obj.toString() : util.toString(obj);
        <span class="hljs-keyword">var</span> ruselessToString = <span class="hljs-regexp">/\[object [a-zA-Z0-9$_]+\]/</span>;
        <span class="hljs-keyword">if</span> (ruselessToString.test(str)) {
            <span class="hljs-keyword">try</span> {
                <span class="hljs-keyword">var</span> newStr = <span class="hljs-built_in">JSON</span>.stringify(obj);
                str = newStr;
            }
            <span class="hljs-keyword">catch</span>(e) {

            }
        }
        <span class="hljs-keyword">if</span> (str.length === <span class="hljs-number">0</span>) {
            str = <span class="hljs-string">"(empty array)"</span>;
        }
    }
    <span class="hljs-keyword">return</span> (<span class="hljs-string">"(&lt;"</span> + snip(str) + <span class="hljs-string">"&gt;, no stack trace)"</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">snip</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">var</span> maxChars = <span class="hljs-number">41</span>;
    <span class="hljs-keyword">if</span> (str.length &lt; maxChars) {
        <span class="hljs-keyword">return</span> str;
    }
    <span class="hljs-keyword">return</span> str.substr(<span class="hljs-number">0</span>, maxChars - <span class="hljs-number">3</span>) + <span class="hljs-string">"..."</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">longStackTracesIsSupported</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> captureStackTrace === <span class="hljs-string">"function"</span>;
}

<span class="hljs-keyword">var</span> shouldIgnore = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; };
<span class="hljs-keyword">var</span> parseLineInfoRegex = <span class="hljs-regexp">/[\/&lt;\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseLineInfo</span>(<span class="hljs-params">line</span>) </span>{
    <span class="hljs-keyword">var</span> matches = line.match(parseLineInfoRegex);
    <span class="hljs-keyword">if</span> (matches) {
        <span class="hljs-keyword">return</span> {
            <span class="hljs-attr">fileName</span>: matches[<span class="hljs-number">1</span>],
            <span class="hljs-attr">line</span>: <span class="hljs-built_in">parseInt</span>(matches[<span class="hljs-number">2</span>], <span class="hljs-number">10</span>)
        };
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setBounds</span>(<span class="hljs-params">firstLineError, lastLineError</span>) </span>{
    <span class="hljs-keyword">if</span> (!longStackTracesIsSupported()) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">var</span> firstStackLines = firstLineError.stack.split(<span class="hljs-string">"\n"</span>);
    <span class="hljs-keyword">var</span> lastStackLines = lastLineError.stack.split(<span class="hljs-string">"\n"</span>);
    <span class="hljs-keyword">var</span> firstIndex = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">var</span> lastIndex = <span class="hljs-number">-1</span>;
    <span class="hljs-keyword">var</span> firstFileName;
    <span class="hljs-keyword">var</span> lastFileName;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; firstStackLines.length; ++i) {
        <span class="hljs-keyword">var</span> result = parseLineInfo(firstStackLines[i]);
        <span class="hljs-keyword">if</span> (result) {
            firstFileName = result.fileName;
            firstIndex = result.line;
            <span class="hljs-keyword">break</span>;
        }
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; lastStackLines.length; ++i) {
        <span class="hljs-keyword">var</span> result = parseLineInfo(lastStackLines[i]);
        <span class="hljs-keyword">if</span> (result) {
            lastFileName = result.fileName;
            lastIndex = result.line;
            <span class="hljs-keyword">break</span>;
        }
    }
    <span class="hljs-keyword">if</span> (firstIndex &lt; <span class="hljs-number">0</span> || lastIndex &lt; <span class="hljs-number">0</span> || !firstFileName || !lastFileName ||
        firstFileName !== lastFileName || firstIndex &gt;= lastIndex) {
        <span class="hljs-keyword">return</span>;
    }

    shouldIgnore = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">line</span>) </span>{
        <span class="hljs-keyword">if</span> (bluebirdFramePattern.test(line)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> info = parseLineInfo(line);
        <span class="hljs-keyword">if</span> (info) {
            <span class="hljs-keyword">if</span> (info.fileName === firstFileName &amp;&amp;
                (firstIndex &lt;= info.line &amp;&amp; info.line &lt;= lastIndex)) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">CapturedTrace</span>(<span class="hljs-params">parent</span>) </span>{
    <span class="hljs-keyword">this</span>._parent = parent;
    <span class="hljs-keyword">this</span>._promisesCreated = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> length = <span class="hljs-keyword">this</span>._length = <span class="hljs-number">1</span> + (parent === <span class="hljs-literal">undefined</span> ? <span class="hljs-number">0</span> : parent._length);
    captureStackTrace(<span class="hljs-keyword">this</span>, CapturedTrace);
    <span class="hljs-keyword">if</span> (length &gt; <span class="hljs-number">32</span>) <span class="hljs-keyword">this</span>.uncycle();
}
util.inherits(CapturedTrace, <span class="hljs-built_in">Error</span>);
Context.CapturedTrace = CapturedTrace;

CapturedTrace.prototype.uncycle = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> length = <span class="hljs-keyword">this</span>._length;
    <span class="hljs-keyword">if</span> (length &lt; <span class="hljs-number">2</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">var</span> nodes = [];
    <span class="hljs-keyword">var</span> stackToIndex = {};

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, node = <span class="hljs-keyword">this</span>; node !== <span class="hljs-literal">undefined</span>; ++i) {
        nodes.push(node);
        node = node._parent;
    }
    length = <span class="hljs-keyword">this</span>._length = i;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; --i) {
        <span class="hljs-keyword">var</span> stack = nodes[i].stack;
        <span class="hljs-keyword">if</span> (stackToIndex[stack] === <span class="hljs-literal">undefined</span>) {
            stackToIndex[stack] = i;
        }
    }
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; length; ++i) {
        <span class="hljs-keyword">var</span> currentStack = nodes[i].stack;
        <span class="hljs-keyword">var</span> index = stackToIndex[currentStack];
        <span class="hljs-keyword">if</span> (index !== <span class="hljs-literal">undefined</span> &amp;&amp; index !== i) {
            <span class="hljs-keyword">if</span> (index &gt; <span class="hljs-number">0</span>) {
                nodes[index - <span class="hljs-number">1</span>]._parent = <span class="hljs-literal">undefined</span>;
                nodes[index - <span class="hljs-number">1</span>]._length = <span class="hljs-number">1</span>;
            }
            nodes[i]._parent = <span class="hljs-literal">undefined</span>;
            nodes[i]._length = <span class="hljs-number">1</span>;
            <span class="hljs-keyword">var</span> cycleEdgeNode = i &gt; <span class="hljs-number">0</span> ? nodes[i - <span class="hljs-number">1</span>] : <span class="hljs-keyword">this</span>;

            <span class="hljs-keyword">if</span> (index &lt; length - <span class="hljs-number">1</span>) {
                cycleEdgeNode._parent = nodes[index + <span class="hljs-number">1</span>];
                cycleEdgeNode._parent.uncycle();
                cycleEdgeNode._length =
                    cycleEdgeNode._parent._length + <span class="hljs-number">1</span>;
            } <span class="hljs-keyword">else</span> {
                cycleEdgeNode._parent = <span class="hljs-literal">undefined</span>;
                cycleEdgeNode._length = <span class="hljs-number">1</span>;
            }
            <span class="hljs-keyword">var</span> currentChildLength = cycleEdgeNode._length + <span class="hljs-number">1</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = i - <span class="hljs-number">2</span>; j &gt;= <span class="hljs-number">0</span>; --j) {
                nodes[j]._length = currentChildLength;
                currentChildLength++;
            }
            <span class="hljs-keyword">return</span>;
        }
    }
};

CapturedTrace.prototype.attachExtraTrace = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
    <span class="hljs-keyword">if</span> (error.__stackCleaned__) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>.uncycle();
    <span class="hljs-keyword">var</span> parsed = parseStackAndMessage(error);
    <span class="hljs-keyword">var</span> message = parsed.message;
    <span class="hljs-keyword">var</span> stacks = [parsed.stack];

    <span class="hljs-keyword">var</span> trace = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">while</span> (trace !== <span class="hljs-literal">undefined</span>) {
        stacks.push(cleanStack(trace.stack.split(<span class="hljs-string">"\n"</span>)));
        trace = trace._parent;
    }
    removeCommonRoots(stacks);
    removeDuplicateOrEmptyJumps(stacks);
    util.notEnumerableProp(error, <span class="hljs-string">"stack"</span>, reconstructStack(message, stacks));
    util.notEnumerableProp(error, <span class="hljs-string">"__stackCleaned__"</span>, <span class="hljs-literal">true</span>);
};

<span class="hljs-keyword">var</span> captureStackTrace = (<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">stackDetection</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> v8stackFramePattern = <span class="hljs-regexp">/^\s*at\s*/</span>;
    <span class="hljs-keyword">var</span> v8stackFormatter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">stack, error</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> stack === <span class="hljs-string">"string"</span>) <span class="hljs-keyword">return</span> stack;

        <span class="hljs-keyword">if</span> (error.name !== <span class="hljs-literal">undefined</span> &amp;&amp;
            error.message !== <span class="hljs-literal">undefined</span>) {
            <span class="hljs-keyword">return</span> error.toString();
        }
        <span class="hljs-keyword">return</span> formatNonError(error);
    };

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Error</span>.stackTraceLimit === <span class="hljs-string">"number"</span> &amp;&amp;
        <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Error</span>.captureStackTrace === <span class="hljs-string">"function"</span>) {
        <span class="hljs-built_in">Error</span>.stackTraceLimit += <span class="hljs-number">6</span>;
        stackFramePattern = v8stackFramePattern;
        formatStack = v8stackFormatter;
        <span class="hljs-keyword">var</span> captureStackTrace = <span class="hljs-built_in">Error</span>.captureStackTrace;

        shouldIgnore = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">line</span>) </span>{
            <span class="hljs-keyword">return</span> bluebirdFramePattern.test(line);
        };
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">receiver, ignoreUntil</span>) </span>{
            <span class="hljs-built_in">Error</span>.stackTraceLimit += <span class="hljs-number">6</span>;
            captureStackTrace(receiver, ignoreUntil);
            <span class="hljs-built_in">Error</span>.stackTraceLimit -= <span class="hljs-number">6</span>;
        };
    }
    <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>();

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> err.stack === <span class="hljs-string">"string"</span> &amp;&amp;
        err.stack.split(<span class="hljs-string">"\n"</span>)[<span class="hljs-number">0</span>].indexOf(<span class="hljs-string">"stackDetection@"</span>) &gt;= <span class="hljs-number">0</span>) {
        stackFramePattern = <span class="hljs-regexp">/@/</span>;
        formatStack = v8stackFormatter;
        indentStackFrames = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">captureStackTrace</span>(<span class="hljs-params">o</span>) </span>{
            o.stack = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>().stack;
        };
    }

    <span class="hljs-keyword">var</span> hasStackAfterThrow;
    <span class="hljs-keyword">try</span> { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(); }
    <span class="hljs-keyword">catch</span>(e) {
        hasStackAfterThrow = (<span class="hljs-string">"stack"</span> <span class="hljs-keyword">in</span> e);
    }
    <span class="hljs-keyword">if</span> (!(<span class="hljs-string">"stack"</span> <span class="hljs-keyword">in</span> err) &amp;&amp; hasStackAfterThrow &amp;&amp;
        <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Error</span>.stackTraceLimit === <span class="hljs-string">"number"</span>) {
        stackFramePattern = v8stackFramePattern;
        formatStack = v8stackFormatter;
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">captureStackTrace</span>(<span class="hljs-params">o</span>) </span>{
            <span class="hljs-built_in">Error</span>.stackTraceLimit += <span class="hljs-number">6</span>;
            <span class="hljs-keyword">try</span> { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(); }
            <span class="hljs-keyword">catch</span>(e) { o.stack = e.stack; }
            <span class="hljs-built_in">Error</span>.stackTraceLimit -= <span class="hljs-number">6</span>;
        };
    }

    formatStack = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">stack, error</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> stack === <span class="hljs-string">"string"</span>) <span class="hljs-keyword">return</span> stack;

        <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">typeof</span> error === <span class="hljs-string">"object"</span> ||
            <span class="hljs-keyword">typeof</span> error === <span class="hljs-string">"function"</span>) &amp;&amp;
            error.name !== <span class="hljs-literal">undefined</span> &amp;&amp;
            error.message !== <span class="hljs-literal">undefined</span>) {
            <span class="hljs-keyword">return</span> error.toString();
        }
        <span class="hljs-keyword">return</span> formatNonError(error);
    };

    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;

})([]);

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">console</span> !== <span class="hljs-string">"undefined"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">console</span>.warn !== <span class="hljs-string">"undefined"</span>) {
    printWarning = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">message</span>) </span>{
        <span class="hljs-built_in">console</span>.warn(message);
    };
    <span class="hljs-keyword">if</span> (util.isNode &amp;&amp; process.stderr.isTTY) {
        printWarning = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message, isSoft</span>) </span>{
            <span class="hljs-keyword">var</span> color = isSoft ? <span class="hljs-string">"\u001b[33m"</span> : <span class="hljs-string">"\u001b[31m"</span>;
            <span class="hljs-built_in">console</span>.warn(color + message + <span class="hljs-string">"\u001b[0m\n"</span>);
        };
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!util.isNode &amp;&amp; <span class="hljs-keyword">typeof</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>().stack) === <span class="hljs-string">"string"</span>) {
        printWarning = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message, isSoft</span>) </span>{
            <span class="hljs-built_in">console</span>.warn(<span class="hljs-string">"%c"</span> + message,
                        isSoft ? <span class="hljs-string">"color: darkorange"</span> : <span class="hljs-string">"color: red"</span>);
        };
    }
}

<span class="hljs-keyword">var</span> config = {
    <span class="hljs-attr">warnings</span>: warnings,
    <span class="hljs-attr">longStackTraces</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">cancellation</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">monitoring</span>: <span class="hljs-literal">false</span>
};

<span class="hljs-keyword">if</span> (longStackTraces) <span class="hljs-built_in">Promise</span>.longStackTraces();

<span class="hljs-keyword">return</span> {
    <span class="hljs-attr">longStackTraces</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> config.longStackTraces;
    },
    <span class="hljs-attr">warnings</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> config.warnings;
    },
    <span class="hljs-attr">cancellation</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> config.cancellation;
    },
    <span class="hljs-attr">monitoring</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> config.monitoring;
    },
    <span class="hljs-attr">propagateFromFunction</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> propagateFromFunction;
    },
    <span class="hljs-attr">boundValueFunction</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> boundValueFunction;
    },
    <span class="hljs-attr">checkForgottenReturns</span>: checkForgottenReturns,
    <span class="hljs-attr">setBounds</span>: setBounds,
    <span class="hljs-attr">warn</span>: warn,
    <span class="hljs-attr">deprecated</span>: deprecated,
    <span class="hljs-attr">CapturedTrace</span>: CapturedTrace,
    <span class="hljs-attr">fireDomEvent</span>: fireDomEvent,
    <span class="hljs-attr">fireGlobalEvent</span>: fireGlobalEvent
};
};

},{<span class="hljs-string">"./errors"</span>:<span class="hljs-number">9</span>,<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">8</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Promise</span>) </span>{
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">returner</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.value;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">thrower</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">this</span>.reason;
}

<span class="hljs-built_in">Promise</span>.prototype[<span class="hljs-string">"return"</span>] =
<span class="hljs-built_in">Promise</span>.prototype.thenReturn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) value.suppressUnhandledRejections();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._then(
        returner, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, {<span class="hljs-attr">value</span>: value}, <span class="hljs-literal">undefined</span>);
};

<span class="hljs-built_in">Promise</span>.prototype[<span class="hljs-string">"throw"</span>] =
<span class="hljs-built_in">Promise</span>.prototype.thenThrow = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._then(
        thrower, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, {<span class="hljs-attr">reason</span>: reason}, <span class="hljs-literal">undefined</span>);
};

<span class="hljs-built_in">Promise</span>.prototype.catchThrow = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &lt;= <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._then(
            <span class="hljs-literal">undefined</span>, thrower, <span class="hljs-literal">undefined</span>, {<span class="hljs-attr">reason</span>: reason}, <span class="hljs-literal">undefined</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> _reason = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">var</span> handler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<span class="hljs-keyword">throw</span> _reason;};
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.caught(reason, handler);
    }
};

<span class="hljs-built_in">Promise</span>.prototype.catchReturn = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &lt;= <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">if</span> (value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) value.suppressUnhandledRejections();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._then(
            <span class="hljs-literal">undefined</span>, returner, <span class="hljs-literal">undefined</span>, {<span class="hljs-attr">value</span>: value}, <span class="hljs-literal">undefined</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> _value = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">if</span> (_value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) _value.suppressUnhandledRejections();
        <span class="hljs-keyword">var</span> handler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{<span class="hljs-keyword">return</span> _value;};
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.caught(value, handler);
    }
};
};

},{}],<span class="hljs-number">9</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-keyword">var</span> es5 = _dereq_(<span class="hljs-string">"./es5"</span>);
<span class="hljs-keyword">var</span> Objectfreeze = es5.freeze;
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> inherits = util.inherits;
<span class="hljs-keyword">var</span> notEnumerableProp = util.notEnumerableProp;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subError</span>(<span class="hljs-params">nameProperty, defaultMessage</span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SubError</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> SubError)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> SubError(message);
        notEnumerableProp(<span class="hljs-keyword">this</span>, <span class="hljs-string">"message"</span>,
            <span class="hljs-keyword">typeof</span> message === <span class="hljs-string">"string"</span> ? message : defaultMessage);
        notEnumerableProp(<span class="hljs-keyword">this</span>, <span class="hljs-string">"name"</span>, nameProperty);
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Error</span>.captureStackTrace) {
            <span class="hljs-built_in">Error</span>.captureStackTrace(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.constructor);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">Error</span>.call(<span class="hljs-keyword">this</span>);
        }
    }
    inherits(SubError, <span class="hljs-built_in">Error</span>);
    <span class="hljs-keyword">return</span> SubError;
}

<span class="hljs-keyword">var</span> _TypeError, _RangeError;
<span class="hljs-keyword">var</span> Warning = subError(<span class="hljs-string">"Warning"</span>, <span class="hljs-string">"warning"</span>);
<span class="hljs-keyword">var</span> CancellationError = subError(<span class="hljs-string">"CancellationError"</span>, <span class="hljs-string">"cancellation error"</span>);
<span class="hljs-keyword">var</span> TimeoutError = subError(<span class="hljs-string">"TimeoutError"</span>, <span class="hljs-string">"timeout error"</span>);
<span class="hljs-keyword">var</span> AggregateError = subError(<span class="hljs-string">"AggregateError"</span>, <span class="hljs-string">"aggregate error"</span>);
<span class="hljs-keyword">try</span> {
    _TypeError = <span class="hljs-built_in">TypeError</span>;
    _RangeError = <span class="hljs-built_in">RangeError</span>;
} <span class="hljs-keyword">catch</span>(e) {
    _TypeError = subError(<span class="hljs-string">"TypeError"</span>, <span class="hljs-string">"type error"</span>);
    _RangeError = subError(<span class="hljs-string">"RangeError"</span>, <span class="hljs-string">"range error"</span>);
}

<span class="hljs-keyword">var</span> methods = (<span class="hljs-string">"join pop push shift unshift slice filter forEach some "</span> +
    <span class="hljs-string">"every map indexOf lastIndexOf reduce reduceRight sort reverse"</span>).split(<span class="hljs-string">" "</span>);

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; methods.length; ++i) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Array</span>.prototype[methods[i]] === <span class="hljs-string">"function"</span>) {
        AggregateError.prototype[methods[i]] = <span class="hljs-built_in">Array</span>.prototype[methods[i]];
    }
}

es5.defineProperty(AggregateError.prototype, <span class="hljs-string">"length"</span>, {
    <span class="hljs-attr">value</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">configurable</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>
});
AggregateError.prototype[<span class="hljs-string">"isOperational"</span>] = <span class="hljs-literal">true</span>;
<span class="hljs-keyword">var</span> level = <span class="hljs-number">0</span>;
AggregateError.prototype.toString = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> indent = <span class="hljs-built_in">Array</span>(level * <span class="hljs-number">4</span> + <span class="hljs-number">1</span>).join(<span class="hljs-string">" "</span>);
    <span class="hljs-keyword">var</span> ret = <span class="hljs-string">"\n"</span> + indent + <span class="hljs-string">"AggregateError of:"</span> + <span class="hljs-string">"\n"</span>;
    level++;
    indent = <span class="hljs-built_in">Array</span>(level * <span class="hljs-number">4</span> + <span class="hljs-number">1</span>).join(<span class="hljs-string">" "</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.length; ++i) {
        <span class="hljs-keyword">var</span> str = <span class="hljs-keyword">this</span>[i] === <span class="hljs-keyword">this</span> ? <span class="hljs-string">"[Circular AggregateError]"</span> : <span class="hljs-keyword">this</span>[i] + <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> lines = str.split(<span class="hljs-string">"\n"</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; lines.length; ++j) {
            lines[j] = indent + lines[j];
        }
        str = lines.join(<span class="hljs-string">"\n"</span>);
        ret += str + <span class="hljs-string">"\n"</span>;
    }
    level--;
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">OperationalError</span>(<span class="hljs-params">message</span>) </span>{
    <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> OperationalError))
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> OperationalError(message);
    notEnumerableProp(<span class="hljs-keyword">this</span>, <span class="hljs-string">"name"</span>, <span class="hljs-string">"OperationalError"</span>);
    notEnumerableProp(<span class="hljs-keyword">this</span>, <span class="hljs-string">"message"</span>, message);
    <span class="hljs-keyword">this</span>.cause = message;
    <span class="hljs-keyword">this</span>[<span class="hljs-string">"isOperational"</span>] = <span class="hljs-literal">true</span>;

    <span class="hljs-keyword">if</span> (message <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>) {
        notEnumerableProp(<span class="hljs-keyword">this</span>, <span class="hljs-string">"message"</span>, message.message);
        notEnumerableProp(<span class="hljs-keyword">this</span>, <span class="hljs-string">"stack"</span>, message.stack);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Error</span>.captureStackTrace) {
        <span class="hljs-built_in">Error</span>.captureStackTrace(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.constructor);
    }

}
inherits(OperationalError, <span class="hljs-built_in">Error</span>);

<span class="hljs-keyword">var</span> errorTypes = <span class="hljs-built_in">Error</span>[<span class="hljs-string">"__BluebirdErrorTypes__"</span>];
<span class="hljs-keyword">if</span> (!errorTypes) {
    errorTypes = Objectfreeze({
        <span class="hljs-attr">CancellationError</span>: CancellationError,
        <span class="hljs-attr">TimeoutError</span>: TimeoutError,
        <span class="hljs-attr">OperationalError</span>: OperationalError,
        <span class="hljs-attr">RejectionError</span>: OperationalError,
        <span class="hljs-attr">AggregateError</span>: AggregateError
    });
    es5.defineProperty(<span class="hljs-built_in">Error</span>, <span class="hljs-string">"__BluebirdErrorTypes__"</span>, {
        <span class="hljs-attr">value</span>: errorTypes,
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">false</span>
    });
}

<span class="hljs-built_in">module</span>.exports = {
    <span class="hljs-attr">Error</span>: <span class="hljs-built_in">Error</span>,
    <span class="hljs-attr">TypeError</span>: _TypeError,
    <span class="hljs-attr">RangeError</span>: _RangeError,
    <span class="hljs-attr">CancellationError</span>: errorTypes.CancellationError,
    <span class="hljs-attr">OperationalError</span>: errorTypes.OperationalError,
    <span class="hljs-attr">TimeoutError</span>: errorTypes.TimeoutError,
    <span class="hljs-attr">AggregateError</span>: errorTypes.AggregateError,
    <span class="hljs-attr">Warning</span>: Warning
};

},{<span class="hljs-string">"./es5"</span>:<span class="hljs-number">10</span>,<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">10</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-keyword">var</span> isES5 = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
<span class="hljs-meta">    "use strict"</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span> === <span class="hljs-literal">undefined</span>;
})();

<span class="hljs-keyword">if</span> (isES5) {
    <span class="hljs-built_in">module</span>.exports = {
        <span class="hljs-attr">freeze</span>: <span class="hljs-built_in">Object</span>.freeze,
        <span class="hljs-attr">defineProperty</span>: <span class="hljs-built_in">Object</span>.defineProperty,
        <span class="hljs-attr">getDescriptor</span>: <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor,
        <span class="hljs-attr">keys</span>: <span class="hljs-built_in">Object</span>.keys,
        <span class="hljs-attr">names</span>: <span class="hljs-built_in">Object</span>.getOwnPropertyNames,
        <span class="hljs-attr">getPrototypeOf</span>: <span class="hljs-built_in">Object</span>.getPrototypeOf,
        <span class="hljs-attr">isArray</span>: <span class="hljs-built_in">Array</span>.isArray,
        <span class="hljs-attr">isES5</span>: isES5,
        <span class="hljs-attr">propertyIsWritable</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj, prop</span>) </span>{
            <span class="hljs-keyword">var</span> descriptor = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(obj, prop);
            <span class="hljs-keyword">return</span> !!(!descriptor || descriptor.writable || descriptor.set);
        }
    };
} <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> has = {}.hasOwnProperty;
    <span class="hljs-keyword">var</span> str = {}.toString;
    <span class="hljs-keyword">var</span> proto = {}.constructor.prototype;

    <span class="hljs-keyword">var</span> ObjectKeys = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">o</span>) </span>{
        <span class="hljs-keyword">var</span> ret = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> o) {
            <span class="hljs-keyword">if</span> (has.call(o, key)) {
                ret.push(key);
            }
        }
        <span class="hljs-keyword">return</span> ret;
    };

    <span class="hljs-keyword">var</span> ObjectGetDescriptor = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">o, key</span>) </span>{
        <span class="hljs-keyword">return</span> {<span class="hljs-attr">value</span>: o[key]};
    };

    <span class="hljs-keyword">var</span> ObjectDefineProperty = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">o, key, desc</span>) </span>{
        o[key] = desc.value;
        <span class="hljs-keyword">return</span> o;
    };

    <span class="hljs-keyword">var</span> ObjectFreeze = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
        <span class="hljs-keyword">return</span> obj;
    };

    <span class="hljs-keyword">var</span> ObjectGetPrototypeOf = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>(obj).constructor.prototype;
        }
        <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-keyword">return</span> proto;
        }
    };

    <span class="hljs-keyword">var</span> ArrayIsArray = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">return</span> str.call(obj) === <span class="hljs-string">"[object Array]"</span>;
        }
        <span class="hljs-keyword">catch</span>(e) {
            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
        }
    };

    <span class="hljs-built_in">module</span>.exports = {
        <span class="hljs-attr">isArray</span>: ArrayIsArray,
        <span class="hljs-attr">keys</span>: ObjectKeys,
        <span class="hljs-attr">names</span>: ObjectKeys,
        <span class="hljs-attr">defineProperty</span>: ObjectDefineProperty,
        <span class="hljs-attr">getDescriptor</span>: ObjectGetDescriptor,
        <span class="hljs-attr">freeze</span>: ObjectFreeze,
        <span class="hljs-attr">getPrototypeOf</span>: ObjectGetPrototypeOf,
        <span class="hljs-attr">isES5</span>: isES5,
        <span class="hljs-attr">propertyIsWritable</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        }
    };
}

},{}],<span class="hljs-number">11</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Promise, tryConvertToPromise</span>) </span>{
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> CancellationError = <span class="hljs-built_in">Promise</span>.CancellationError;
<span class="hljs-keyword">var</span> errorObj = util.errorObj;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">PassThroughHandlerContext</span>(<span class="hljs-params">promise, type, handler</span>) </span>{
    <span class="hljs-keyword">this</span>.promise = promise;
    <span class="hljs-keyword">this</span>.type = type;
    <span class="hljs-keyword">this</span>.handler = handler;
    <span class="hljs-keyword">this</span>.called = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>.cancelPromise = <span class="hljs-literal">null</span>;
}

PassThroughHandlerContext.prototype.isFinallyHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.type === <span class="hljs-number">0</span>;
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">FinallyHandlerCancelReaction</span>(<span class="hljs-params">finallyHandler</span>) </span>{
    <span class="hljs-keyword">this</span>.finallyHandler = finallyHandler;
}

FinallyHandlerCancelReaction.prototype._resultCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    checkCancel(<span class="hljs-keyword">this</span>.finallyHandler);
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkCancel</span>(<span class="hljs-params">ctx, reason</span>) </span>{
    <span class="hljs-keyword">if</span> (ctx.cancelPromise != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span>) {
            ctx.cancelPromise._reject(reason);
        } <span class="hljs-keyword">else</span> {
            ctx.cancelPromise._cancel();
        }
        ctx.cancelPromise = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">succeed</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> finallyHandler.call(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>.promise._target()._settledValue());
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fail</span>(<span class="hljs-params">reason</span>) </span>{
    <span class="hljs-keyword">if</span> (checkCancel(<span class="hljs-keyword">this</span>, reason)) <span class="hljs-keyword">return</span>;
    errorObj.e = reason;
    <span class="hljs-keyword">return</span> errorObj;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finallyHandler</span>(<span class="hljs-params">reasonOrValue</span>) </span>{
    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>.promise;
    <span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">this</span>.handler;

    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.called) {
        <span class="hljs-keyword">this</span>.called = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">this</span>.isFinallyHandler()
            ? handler.call(promise._boundValue())
            : handler.call(promise._boundValue(), reasonOrValue);
        <span class="hljs-keyword">if</span> (ret !== <span class="hljs-literal">undefined</span>) {
            promise._setReturnedNonUndefined();
            <span class="hljs-keyword">var</span> maybePromise = tryConvertToPromise(ret, promise);
            <span class="hljs-keyword">if</span> (maybePromise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.cancelPromise != <span class="hljs-literal">null</span>) {
                    <span class="hljs-keyword">if</span> (maybePromise._isCancelled()) {
                        <span class="hljs-keyword">var</span> reason =
                            <span class="hljs-keyword">new</span> CancellationError(<span class="hljs-string">"late cancellation observer"</span>);
                        promise._attachExtraTrace(reason);
                        errorObj.e = reason;
                        <span class="hljs-keyword">return</span> errorObj;
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (maybePromise.isPending()) {
                        maybePromise._attachCancellationCallback(
                            <span class="hljs-keyword">new</span> FinallyHandlerCancelReaction(<span class="hljs-keyword">this</span>));
                    }
                }
                <span class="hljs-keyword">return</span> maybePromise._then(
                    succeed, fail, <span class="hljs-literal">undefined</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">undefined</span>);
            }
        }
    }

    <span class="hljs-keyword">if</span> (promise.isRejected()) {
        checkCancel(<span class="hljs-keyword">this</span>);
        errorObj.e = reasonOrValue;
        <span class="hljs-keyword">return</span> errorObj;
    } <span class="hljs-keyword">else</span> {
        checkCancel(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">return</span> reasonOrValue;
    }
}

<span class="hljs-built_in">Promise</span>.prototype._passThrough = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">handler, type, success, fail</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> handler !== <span class="hljs-string">"function"</span>) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.then();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._then(success,
                      fail,
                      <span class="hljs-literal">undefined</span>,
                      <span class="hljs-keyword">new</span> PassThroughHandlerContext(<span class="hljs-keyword">this</span>, type, handler),
                      <span class="hljs-literal">undefined</span>);
};

<span class="hljs-built_in">Promise</span>.prototype.lastly =
<span class="hljs-built_in">Promise</span>.prototype[<span class="hljs-string">"finally"</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">handler</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._passThrough(handler,
                             <span class="hljs-number">0</span>,
                             finallyHandler,
                             finallyHandler);
};

<span class="hljs-built_in">Promise</span>.prototype.tap = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">handler</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._passThrough(handler, <span class="hljs-number">1</span>, finallyHandler);
};

<span class="hljs-keyword">return</span> PassThroughHandlerContext;
};

},{<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">12</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports =
<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Promise, PromiseArray, tryConvertToPromise, INTERNAL, async,
         getDomain</span>) </span>{
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> canEvaluate = util.canEvaluate;
<span class="hljs-keyword">var</span> tryCatch = util.tryCatch;
<span class="hljs-keyword">var</span> errorObj = util.errorObj;
<span class="hljs-keyword">var</span> reject;

<span class="hljs-keyword">if</span> (!<span class="hljs-literal">true</span>) {
<span class="hljs-keyword">if</span> (canEvaluate) {
    <span class="hljs-keyword">var</span> thenCallback = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(<span class="hljs-string">"value"</span>, <span class="hljs-string">"holder"</span>, <span class="hljs-string">"                             \n\
            'use strict';                                                    \n\
            holder.pIndex = value;                                           \n\
            holder.checkFulfillment(this);                                   \n\
            "</span>.replace(<span class="hljs-regexp">/Index/g</span>, i));
    };

    <span class="hljs-keyword">var</span> promiseSetter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">i</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(<span class="hljs-string">"promise"</span>, <span class="hljs-string">"holder"</span>, <span class="hljs-string">"                           \n\
            'use strict';                                                    \n\
            holder.pIndex = promise;                                         \n\
            "</span>.replace(<span class="hljs-regexp">/Index/g</span>, i));
    };

    <span class="hljs-keyword">var</span> generateHolderClass = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">total</span>) </span>{
        <span class="hljs-keyword">var</span> props = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(total);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; props.length; ++i) {
            props[i] = <span class="hljs-string">"this.p"</span> + (i+<span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">var</span> assignment = props.join(<span class="hljs-string">" = "</span>) + <span class="hljs-string">" = null;"</span>;
        <span class="hljs-keyword">var</span> cancellationCode= <span class="hljs-string">"var promise;\n"</span> + props.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">prop</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">"                                                         \n\
                promise = "</span> + prop + <span class="hljs-string">";                                      \n\
                if (promise instanceof Promise) {                            \n\
                    promise.cancel();                                        \n\
                }                                                            \n\
            "</span>;
        }).join(<span class="hljs-string">"\n"</span>);
        <span class="hljs-keyword">var</span> passedArguments = props.join(<span class="hljs-string">", "</span>);
        <span class="hljs-keyword">var</span> name = <span class="hljs-string">"Holder$"</span> + total;


        <span class="hljs-keyword">var</span> code = <span class="hljs-string">"return function(tryCatch, errorObj, Promise, async) {    \n\
            'use strict';                                                    \n\
            function [TheName](fn) {                                         \n\
                [TheProperties]                                              \n\
                this.fn = fn;                                                \n\
                this.asyncNeeded = true;                                     \n\
                this.now = 0;                                                \n\
            }                                                                \n\
                                                                             \n\
            [TheName].prototype._callFunction = function(promise) {          \n\
                promise._pushContext();                                      \n\
                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n\
                promise._popContext();                                       \n\
                if (ret === errorObj) {                                      \n\
                    promise._rejectCallback(ret.e, false);                   \n\
                } else {                                                     \n\
                    promise._resolveCallback(ret);                           \n\
                }                                                            \n\
            };                                                               \n\
                                                                             \n\
            [TheName].prototype.checkFulfillment = function(promise) {       \n\
                var now = ++this.now;                                        \n\
                if (now === [TheTotal]) {                                    \n\
                    if (this.asyncNeeded) {                                  \n\
                        async.invoke(this._callFunction, this, promise);     \n\
                    } else {                                                 \n\
                        this._callFunction(promise);                         \n\
                    }                                                        \n\
                                                                             \n\
                }                                                            \n\
            };                                                               \n\
                                                                             \n\
            [TheName].prototype._resultCancelled = function() {              \n\
                [CancellationCode]                                           \n\
            };                                                               \n\
                                                                             \n\
            return [TheName];                                                \n\
        }(tryCatch, errorObj, Promise, async);                               \n\
        "</span>;

        code = code.replace(<span class="hljs-regexp">/\[TheName\]/g</span>, name)
            .replace(<span class="hljs-regexp">/\[TheTotal\]/g</span>, total)
            .replace(<span class="hljs-regexp">/\[ThePassedArguments\]/g</span>, passedArguments)
            .replace(<span class="hljs-regexp">/\[TheProperties\]/g</span>, assignment)
            .replace(<span class="hljs-regexp">/\[CancellationCode\]/g</span>, cancellationCode);

        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Function</span>(<span class="hljs-string">"tryCatch"</span>, <span class="hljs-string">"errorObj"</span>, <span class="hljs-string">"Promise"</span>, <span class="hljs-string">"async"</span>, code)
                           (tryCatch, errorObj, <span class="hljs-built_in">Promise</span>, <span class="hljs-keyword">async</span>);
    };

    <span class="hljs-keyword">var</span> holderClasses = [];
    <span class="hljs-keyword">var</span> thenCallbacks = [];
    <span class="hljs-keyword">var</span> promiseSetters = [];

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; ++i) {
        holderClasses.push(generateHolderClass(i + <span class="hljs-number">1</span>));
        thenCallbacks.push(thenCallback(i + <span class="hljs-number">1</span>));
        promiseSetters.push(promiseSetter(i + <span class="hljs-number">1</span>));
    }

    reject = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
        <span class="hljs-keyword">this</span>._reject(reason);
    };
}}

<span class="hljs-built_in">Promise</span>.join = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> last = <span class="hljs-built_in">arguments</span>.length - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">var</span> fn;
    <span class="hljs-keyword">if</span> (last &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">arguments</span>[last] === <span class="hljs-string">"function"</span>) {
        fn = <span class="hljs-built_in">arguments</span>[last];
        <span class="hljs-keyword">if</span> (!<span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">if</span> (last &lt;= <span class="hljs-number">8</span> &amp;&amp; canEvaluate) {
                <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
                ret._captureStackTrace();
                <span class="hljs-keyword">var</span> HolderClass = holderClasses[last - <span class="hljs-number">1</span>];
                <span class="hljs-keyword">var</span> holder = <span class="hljs-keyword">new</span> HolderClass(fn);
                <span class="hljs-keyword">var</span> callbacks = thenCallbacks;

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; last; ++i) {
                    <span class="hljs-keyword">var</span> maybePromise = tryConvertToPromise(<span class="hljs-built_in">arguments</span>[i], ret);
                    <span class="hljs-keyword">if</span> (maybePromise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) {
                        maybePromise = maybePromise._target();
                        <span class="hljs-keyword">var</span> bitField = maybePromise._bitField;
                        ;
                        <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">50397184</span>) === <span class="hljs-number">0</span>)) {
                            maybePromise._then(callbacks[i], reject,
                                               <span class="hljs-literal">undefined</span>, ret, holder);
                            promiseSetters[i](maybePromise, holder);
                            holder.asyncNeeded = <span class="hljs-literal">false</span>;
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
                            callbacks[i].call(ret,
                                              maybePromise._value(), holder);
                        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">16777216</span>) !== <span class="hljs-number">0</span>)) {
                            ret._reject(maybePromise._reason());
                        } <span class="hljs-keyword">else</span> {
                            ret._cancel();
                        }
                    } <span class="hljs-keyword">else</span> {
                        callbacks[i].call(ret, maybePromise, holder);
                    }
                }

                <span class="hljs-keyword">if</span> (!ret._isFateSealed()) {
                    <span class="hljs-keyword">if</span> (holder.asyncNeeded) {
                        <span class="hljs-keyword">var</span> domain = getDomain();
                        <span class="hljs-keyword">if</span> (domain !== <span class="hljs-literal">null</span>) {
                            holder.fn = util.domainBind(domain, holder.fn);
                        }
                    }
                    ret._setAsyncGuaranteed();
                    ret._setOnCancel(holder);
                }
                <span class="hljs-keyword">return</span> ret;
            }
        }
    }
    <span class="hljs-keyword">var</span> args = [].slice.call(<span class="hljs-built_in">arguments</span>);;
    <span class="hljs-keyword">if</span> (fn) args.pop();
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> PromiseArray(args).promise();
    <span class="hljs-keyword">return</span> fn !== <span class="hljs-literal">undefined</span> ? ret.spread(fn) : ret;
};

};

},{<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">13</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports =
<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Promise, INTERNAL, tryConvertToPromise, apiRejection, debug</span>) </span>{
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> tryCatch = util.tryCatch;

<span class="hljs-built_in">Promise</span>.method = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>.TypeError(<span class="hljs-string">"expecting a function but got "</span> + util.classString(fn));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
        ret._captureStackTrace();
        ret._pushContext();
        <span class="hljs-keyword">var</span> value = tryCatch(fn).apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
        <span class="hljs-keyword">var</span> promiseCreated = ret._popContext();
        debug.checkForgottenReturns(
            value, promiseCreated, <span class="hljs-string">"Promise.method"</span>, ret);
        ret._resolveFromSyncValue(value);
        <span class="hljs-keyword">return</span> ret;
    };
};

<span class="hljs-built_in">Promise</span>.attempt = <span class="hljs-built_in">Promise</span>[<span class="hljs-string">"try"</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">return</span> apiRejection(<span class="hljs-string">"expecting a function but got "</span> + util.classString(fn));
    }
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    ret._captureStackTrace();
    ret._pushContext();
    <span class="hljs-keyword">var</span> value;
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span>) {
        debug.deprecated(<span class="hljs-string">"calling Promise.try with more than 1 argument"</span>);
        <span class="hljs-keyword">var</span> arg = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">var</span> ctx = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">2</span>];
        value = util.isArray(arg) ? tryCatch(fn).apply(ctx, arg)
                                  : tryCatch(fn).call(ctx, arg);
    } <span class="hljs-keyword">else</span> {
        value = tryCatch(fn)();
    }
    <span class="hljs-keyword">var</span> promiseCreated = ret._popContext();
    debug.checkForgottenReturns(
        value, promiseCreated, <span class="hljs-string">"Promise.try"</span>, ret);
    ret._resolveFromSyncValue(value);
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.prototype._resolveFromSyncValue = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">if</span> (value === util.errorObj) {
        <span class="hljs-keyword">this</span>._rejectCallback(value.e, <span class="hljs-literal">false</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>._resolveCallback(value, <span class="hljs-literal">true</span>);
    }
};
};

},{<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">14</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> maybeWrapAsError = util.maybeWrapAsError;
<span class="hljs-keyword">var</span> errors = _dereq_(<span class="hljs-string">"./errors"</span>);
<span class="hljs-keyword">var</span> OperationalError = errors.OperationalError;
<span class="hljs-keyword">var</span> es5 = _dereq_(<span class="hljs-string">"./es5"</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isUntypedError</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">return</span> obj <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span> &amp;&amp;
        es5.getPrototypeOf(obj) === <span class="hljs-built_in">Error</span>.prototype;
}

<span class="hljs-keyword">var</span> rErrorKey = <span class="hljs-regexp">/^(?:name|message|stack|cause)$/</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrapAsOperationalError</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">var</span> ret;
    <span class="hljs-keyword">if</span> (isUntypedError(obj)) {
        ret = <span class="hljs-keyword">new</span> OperationalError(obj);
        ret.name = obj.name;
        ret.message = obj.message;
        ret.stack = obj.stack;
        <span class="hljs-keyword">var</span> keys = es5.keys(obj);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; keys.length; ++i) {
            <span class="hljs-keyword">var</span> key = keys[i];
            <span class="hljs-keyword">if</span> (!rErrorKey.test(key)) {
                ret[key] = obj[key];
            }
        }
        <span class="hljs-keyword">return</span> ret;
    }
    util.markAsOriginatingFromRejection(obj);
    <span class="hljs-keyword">return</span> obj;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nodebackForPromise</span>(<span class="hljs-params">promise, multiArgs</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, value</span>) </span>{
        <span class="hljs-keyword">if</span> (promise === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">if</span> (err) {
            <span class="hljs-keyword">var</span> wrapped = wrapAsOperationalError(maybeWrapAsError(err));
            promise._attachExtraTrace(wrapped);
            promise._reject(wrapped);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!multiArgs) {
            promise._fulfill(value);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> args = [].slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);;
            promise._fulfill(args);
        }
        promise = <span class="hljs-literal">null</span>;
    };
}

<span class="hljs-built_in">module</span>.exports = nodebackForPromise;

},{<span class="hljs-string">"./errors"</span>:<span class="hljs-number">9</span>,<span class="hljs-string">"./es5"</span>:<span class="hljs-number">10</span>,<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">15</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-keyword">var</span> makeSelfResolutionError = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"circular promise resolution chain\u000a\u000a    See http://goo.gl/MqrFmX\u000a"</span>);
};
<span class="hljs-keyword">var</span> reflectHandler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>.PromiseInspection(<span class="hljs-keyword">this</span>._target());
};
<span class="hljs-keyword">var</span> apiRejection = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>.reject(<span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(msg));
};
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Proxyable</span>(<span class="hljs-params"></span>) </span>{}
<span class="hljs-keyword">var</span> UNDEFINED_BINDING = {};
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);

<span class="hljs-keyword">var</span> getDomain;
<span class="hljs-keyword">if</span> (util.isNode) {
    getDomain = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> ret = process.domain;
        <span class="hljs-keyword">if</span> (ret === <span class="hljs-literal">undefined</span>) ret = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">return</span> ret;
    };
} <span class="hljs-keyword">else</span> {
    getDomain = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    };
}
util.notEnumerableProp(<span class="hljs-built_in">Promise</span>, <span class="hljs-string">"_getDomain"</span>, getDomain);

<span class="hljs-keyword">var</span> es5 = _dereq_(<span class="hljs-string">"./es5"</span>);
<span class="hljs-keyword">var</span> Async = _dereq_(<span class="hljs-string">"./async"</span>);
<span class="hljs-keyword">var</span> <span class="hljs-keyword">async</span> = <span class="hljs-keyword">new</span> Async();
es5.defineProperty(<span class="hljs-built_in">Promise</span>, <span class="hljs-string">"_async"</span>, {<span class="hljs-attr">value</span>: <span class="hljs-keyword">async</span>});
<span class="hljs-keyword">var</span> errors = _dereq_(<span class="hljs-string">"./errors"</span>);
<span class="hljs-keyword">var</span> <span class="hljs-built_in">TypeError</span> = <span class="hljs-built_in">Promise</span>.TypeError = errors.TypeError;
<span class="hljs-built_in">Promise</span>.RangeError = errors.RangeError;
<span class="hljs-keyword">var</span> CancellationError = <span class="hljs-built_in">Promise</span>.CancellationError = errors.CancellationError;
<span class="hljs-built_in">Promise</span>.TimeoutError = errors.TimeoutError;
<span class="hljs-built_in">Promise</span>.OperationalError = errors.OperationalError;
<span class="hljs-built_in">Promise</span>.RejectionError = errors.OperationalError;
<span class="hljs-built_in">Promise</span>.AggregateError = errors.AggregateError;
<span class="hljs-keyword">var</span> INTERNAL = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{};
<span class="hljs-keyword">var</span> APPLY = {};
<span class="hljs-keyword">var</span> NEXT_FILTER = {};
<span class="hljs-keyword">var</span> tryConvertToPromise = _dereq_(<span class="hljs-string">"./thenables"</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL);
<span class="hljs-keyword">var</span> PromiseArray =
    _dereq_(<span class="hljs-string">"./promise_array"</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL,
                               tryConvertToPromise, apiRejection, Proxyable);
<span class="hljs-keyword">var</span> Context = _dereq_(<span class="hljs-string">"./context"</span>)(<span class="hljs-built_in">Promise</span>);
 <span class="hljs-comment">/*jshint unused:false*/</span>
<span class="hljs-keyword">var</span> createContext = Context.create;
<span class="hljs-keyword">var</span> debug = _dereq_(<span class="hljs-string">"./debuggability"</span>)(<span class="hljs-built_in">Promise</span>, Context);
<span class="hljs-keyword">var</span> CapturedTrace = debug.CapturedTrace;
<span class="hljs-keyword">var</span> PassThroughHandlerContext =
    _dereq_(<span class="hljs-string">"./finally"</span>)(<span class="hljs-built_in">Promise</span>, tryConvertToPromise);
<span class="hljs-keyword">var</span> catchFilter = _dereq_(<span class="hljs-string">"./catch_filter"</span>)(NEXT_FILTER);
<span class="hljs-keyword">var</span> nodebackForPromise = _dereq_(<span class="hljs-string">"./nodeback"</span>);
<span class="hljs-keyword">var</span> errorObj = util.errorObj;
<span class="hljs-keyword">var</span> tryCatch = util.tryCatch;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">check</span>(<span class="hljs-params">self, executor</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> executor !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"expecting a function but got "</span> + util.classString(executor));
    }
    <span class="hljs-keyword">if</span> (self.constructor !== <span class="hljs-built_in">Promise</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"the promise constructor cannot be invoked directly\u000a\u000a    See http://goo.gl/MqrFmX\u000a"</span>);
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Promise</span>(<span class="hljs-params">executor</span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>._fulfillmentHandler0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._rejectionHandler0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._promise0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._receiver0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">if</span> (executor !== INTERNAL) {
        check(<span class="hljs-keyword">this</span>, executor);
        <span class="hljs-keyword">this</span>._resolveFromExecutor(executor);
    }
    <span class="hljs-keyword">this</span>._promiseCreated();
    <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseCreated"</span>, <span class="hljs-keyword">this</span>);
}

<span class="hljs-built_in">Promise</span>.prototype.toString = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-string">"[object Promise]"</span>;
};

<span class="hljs-built_in">Promise</span>.prototype.caught = <span class="hljs-built_in">Promise</span>.prototype[<span class="hljs-string">"catch"</span>] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">var</span> len = <span class="hljs-built_in">arguments</span>.length;
    <span class="hljs-keyword">if</span> (len &gt; <span class="hljs-number">1</span>) {
        <span class="hljs-keyword">var</span> catchInstances = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(len - <span class="hljs-number">1</span>),
            j = <span class="hljs-number">0</span>, i;
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len - <span class="hljs-number">1</span>; ++i) {
            <span class="hljs-keyword">var</span> item = <span class="hljs-built_in">arguments</span>[i];
            <span class="hljs-keyword">if</span> (util.isObject(item)) {
                catchInstances[j++] = item;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> apiRejection(<span class="hljs-string">"expecting an object but got "</span> +
                    <span class="hljs-string">"A catch statement predicate "</span> + util.classString(item));
            }
        }
        catchInstances.length = j;
        fn = <span class="hljs-built_in">arguments</span>[i];
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.then(<span class="hljs-literal">undefined</span>, catchFilter(catchInstances, fn, <span class="hljs-keyword">this</span>));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.then(<span class="hljs-literal">undefined</span>, fn);
};

<span class="hljs-built_in">Promise</span>.prototype.reflect = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._then(reflectHandler,
        reflectHandler, <span class="hljs-literal">undefined</span>, <span class="hljs-keyword">this</span>, <span class="hljs-literal">undefined</span>);
};

<span class="hljs-built_in">Promise</span>.prototype.then = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">didFulfill, didReject</span>) </span>{
    <span class="hljs-keyword">if</span> (debug.warnings() &amp;&amp; <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">0</span> &amp;&amp;
        <span class="hljs-keyword">typeof</span> didFulfill !== <span class="hljs-string">"function"</span> &amp;&amp;
        <span class="hljs-keyword">typeof</span> didReject !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">var</span> msg = <span class="hljs-string">".then() only accepts functions but was passed: "</span> +
                util.classString(didFulfill);
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span>) {
            msg += <span class="hljs-string">", "</span> + util.classString(didReject);
        }
        <span class="hljs-keyword">this</span>._warn(msg);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._then(didFulfill, didReject, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>);
};

<span class="hljs-built_in">Promise</span>.prototype.done = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">didFulfill, didReject</span>) </span>{
    <span class="hljs-keyword">var</span> promise =
        <span class="hljs-keyword">this</span>._then(didFulfill, didReject, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>);
    promise._setIsFinal();
};

<span class="hljs-built_in">Promise</span>.prototype.spread = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">return</span> apiRejection(<span class="hljs-string">"expecting a function but got "</span> + util.classString(fn));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.all()._then(fn, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, APPLY, <span class="hljs-literal">undefined</span>);
};

<span class="hljs-built_in">Promise</span>.prototype.toJSON = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> ret = {
        <span class="hljs-attr">isFulfilled</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">isRejected</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">fulfillmentValue</span>: <span class="hljs-literal">undefined</span>,
        <span class="hljs-attr">rejectionReason</span>: <span class="hljs-literal">undefined</span>
    };
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isFulfilled()) {
        ret.fulfillmentValue = <span class="hljs-keyword">this</span>.value();
        ret.isFulfilled = <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isRejected()) {
        ret.rejectionReason = <span class="hljs-keyword">this</span>.reason();
        ret.isRejected = <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.prototype.all = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>._warn(<span class="hljs-string">".all() was passed arguments but it does not take any"</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PromiseArray(<span class="hljs-keyword">this</span>).promise();
};

<span class="hljs-built_in">Promise</span>.prototype.error = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.caught(util.originatesFromRejection, fn);
};

<span class="hljs-built_in">Promise</span>.getNewLibraryCopy = <span class="hljs-built_in">module</span>.exports;

<span class="hljs-built_in">Promise</span>.is = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
    <span class="hljs-keyword">return</span> val <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>;
};

<span class="hljs-built_in">Promise</span>.fromNode = <span class="hljs-built_in">Promise</span>.fromCallback = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    ret._captureStackTrace();
    <span class="hljs-keyword">var</span> multiArgs = <span class="hljs-built_in">arguments</span>.length &gt; <span class="hljs-number">1</span> ? !!<span class="hljs-built_in">Object</span>(<span class="hljs-built_in">arguments</span>[<span class="hljs-number">1</span>]).multiArgs
                                         : <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> result = tryCatch(fn)(nodebackForPromise(ret, multiArgs));
    <span class="hljs-keyword">if</span> (result === errorObj) {
        ret._rejectCallback(result.e, <span class="hljs-literal">true</span>);
    }
    <span class="hljs-keyword">if</span> (!ret._isFateSealed()) ret._setAsyncGuaranteed();
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.all = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">promises</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> PromiseArray(promises).promise();
};

<span class="hljs-built_in">Promise</span>.cast = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">var</span> ret = tryConvertToPromise(obj);
    <span class="hljs-keyword">if</span> (!(ret <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>)) {
        ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
        ret._captureStackTrace();
        ret._setFulfilled();
        ret._rejectionHandler0 = obj;
    }
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.resolve = <span class="hljs-built_in">Promise</span>.fulfilled = <span class="hljs-built_in">Promise</span>.cast;

<span class="hljs-built_in">Promise</span>.reject = <span class="hljs-built_in">Promise</span>.rejected = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    ret._captureStackTrace();
    ret._rejectCallback(reason, <span class="hljs-literal">true</span>);
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.setScheduler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn !== <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"expecting a function but got "</span> + util.classString(fn));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span>.setScheduler(fn);
};

<span class="hljs-built_in">Promise</span>.prototype._then = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">
    didFulfill,
    didReject,
    _,    receiver,
    internalData
</span>) </span>{
    <span class="hljs-keyword">var</span> haveInternalData = internalData !== <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">var</span> promise = haveInternalData ? internalData : <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    <span class="hljs-keyword">var</span> target = <span class="hljs-keyword">this</span>._target();
    <span class="hljs-keyword">var</span> bitField = target._bitField;

    <span class="hljs-keyword">if</span> (!haveInternalData) {
        promise._propagateFrom(<span class="hljs-keyword">this</span>, <span class="hljs-number">3</span>);
        promise._captureStackTrace();
        <span class="hljs-keyword">if</span> (receiver === <span class="hljs-literal">undefined</span> &amp;&amp;
            ((<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">2097152</span>) !== <span class="hljs-number">0</span>)) {
            <span class="hljs-keyword">if</span> (!((bitField &amp; <span class="hljs-number">50397184</span>) === <span class="hljs-number">0</span>)) {
                receiver = <span class="hljs-keyword">this</span>._boundValue();
            } <span class="hljs-keyword">else</span> {
                receiver = target === <span class="hljs-keyword">this</span> ? <span class="hljs-literal">undefined</span> : <span class="hljs-keyword">this</span>._boundTo;
            }
        }
        <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseChained"</span>, <span class="hljs-keyword">this</span>, promise);
    }

    <span class="hljs-keyword">var</span> domain = getDomain();
    <span class="hljs-keyword">if</span> (!((bitField &amp; <span class="hljs-number">50397184</span>) === <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">var</span> handler, value, settler = target._settlePromiseCtx;
        <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
            value = target._rejectionHandler0;
            handler = didFulfill;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">16777216</span>) !== <span class="hljs-number">0</span>)) {
            value = target._fulfillmentHandler0;
            handler = didReject;
            target._unsetRejectionIsUnhandled();
        } <span class="hljs-keyword">else</span> {
            settler = target._settlePromiseLateCancellationObserver;
            value = <span class="hljs-keyword">new</span> CancellationError(<span class="hljs-string">"late cancellation observer"</span>);
            target._attachExtraTrace(value);
            handler = didReject;
        }

        <span class="hljs-keyword">async</span>.invoke(settler, target, {
            <span class="hljs-attr">handler</span>: domain === <span class="hljs-literal">null</span> ? handler
                : (<span class="hljs-keyword">typeof</span> handler === <span class="hljs-string">"function"</span> &amp;&amp;
                    util.domainBind(domain, handler)),
            <span class="hljs-attr">promise</span>: promise,
            <span class="hljs-attr">receiver</span>: receiver,
            <span class="hljs-attr">value</span>: value
        });
    } <span class="hljs-keyword">else</span> {
        target._addCallbacks(didFulfill, didReject, promise, receiver, domain);
    }

    <span class="hljs-keyword">return</span> promise;
};

<span class="hljs-built_in">Promise</span>.prototype._length = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">65535</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._isFateSealed = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">117506048</span>) !== <span class="hljs-number">0</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._isFollowing = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">67108864</span>) === <span class="hljs-number">67108864</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._setLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">len</span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">-65536</span>) |
        (len &amp; <span class="hljs-number">65535</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setFulfilled = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">33554432</span>;
    <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseFulfilled"</span>, <span class="hljs-keyword">this</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setRejected = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">16777216</span>;
    <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseRejected"</span>, <span class="hljs-keyword">this</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setFollowing = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">67108864</span>;
    <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseResolved"</span>, <span class="hljs-keyword">this</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setIsFinal = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">4194304</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._isFinal = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">4194304</span>) &gt; <span class="hljs-number">0</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._unsetCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField &amp; (~<span class="hljs-number">65536</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">65536</span>;
    <span class="hljs-keyword">this</span>._fireEvent(<span class="hljs-string">"promiseCancelled"</span>, <span class="hljs-keyword">this</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._setWillBeCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">8388608</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._setAsyncGuaranteed = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span>.hasCustomScheduler()) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>._bitField = <span class="hljs-keyword">this</span>._bitField | <span class="hljs-number">134217728</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._receiverAt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
    <span class="hljs-keyword">var</span> ret = index === <span class="hljs-number">0</span> ? <span class="hljs-keyword">this</span>._receiver0 : <span class="hljs-keyword">this</span>[
            index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span> + <span class="hljs-number">3</span>];
    <span class="hljs-keyword">if</span> (ret === UNDEFINED_BINDING) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ret === <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-keyword">this</span>._isBound()) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._boundValue();
    }
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.prototype._promiseAt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[
            index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span> + <span class="hljs-number">2</span>];
};

<span class="hljs-built_in">Promise</span>.prototype._fulfillmentHandlerAt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[
            index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span> + <span class="hljs-number">0</span>];
};

<span class="hljs-built_in">Promise</span>.prototype._rejectionHandlerAt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">index</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>[
            index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span> + <span class="hljs-number">1</span>];
};

<span class="hljs-built_in">Promise</span>.prototype._boundValue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};

<span class="hljs-built_in">Promise</span>.prototype._migrateCallback0 = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">follower</span>) </span>{
    <span class="hljs-keyword">var</span> bitField = follower._bitField;
    <span class="hljs-keyword">var</span> fulfill = follower._fulfillmentHandler0;
    <span class="hljs-keyword">var</span> reject = follower._rejectionHandler0;
    <span class="hljs-keyword">var</span> promise = follower._promise0;
    <span class="hljs-keyword">var</span> receiver = follower._receiverAt(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (receiver === <span class="hljs-literal">undefined</span>) receiver = UNDEFINED_BINDING;
    <span class="hljs-keyword">this</span>._addCallbacks(fulfill, reject, promise, receiver, <span class="hljs-literal">null</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._migrateCallbackAt = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">follower, index</span>) </span>{
    <span class="hljs-keyword">var</span> fulfill = follower._fulfillmentHandlerAt(index);
    <span class="hljs-keyword">var</span> reject = follower._rejectionHandlerAt(index);
    <span class="hljs-keyword">var</span> promise = follower._promiseAt(index);
    <span class="hljs-keyword">var</span> receiver = follower._receiverAt(index);
    <span class="hljs-keyword">if</span> (receiver === <span class="hljs-literal">undefined</span>) receiver = UNDEFINED_BINDING;
    <span class="hljs-keyword">this</span>._addCallbacks(fulfill, reject, promise, receiver, <span class="hljs-literal">null</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._addCallbacks = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">
    fulfill,
    reject,
    promise,
    receiver,
    domain
</span>) </span>{
    <span class="hljs-keyword">var</span> index = <span class="hljs-keyword">this</span>._length();

    <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">65535</span> - <span class="hljs-number">4</span>) {
        index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>._setLength(<span class="hljs-number">0</span>);
    }

    <span class="hljs-keyword">if</span> (index === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">this</span>._promise0 = promise;
        <span class="hljs-keyword">this</span>._receiver0 = receiver;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fulfill === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">this</span>._fulfillmentHandler0 =
                domain === <span class="hljs-literal">null</span> ? fulfill : util.domainBind(domain, fulfill);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> reject === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">this</span>._rejectionHandler0 =
                domain === <span class="hljs-literal">null</span> ? reject : util.domainBind(domain, reject);
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> base = index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span>;
        <span class="hljs-keyword">this</span>[base + <span class="hljs-number">2</span>] = promise;
        <span class="hljs-keyword">this</span>[base + <span class="hljs-number">3</span>] = receiver;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fulfill === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">this</span>[base + <span class="hljs-number">0</span>] =
                domain === <span class="hljs-literal">null</span> ? fulfill : util.domainBind(domain, fulfill);
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> reject === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">this</span>[base + <span class="hljs-number">1</span>] =
                domain === <span class="hljs-literal">null</span> ? reject : util.domainBind(domain, reject);
        }
    }
    <span class="hljs-keyword">this</span>._setLength(index + <span class="hljs-number">1</span>);
    <span class="hljs-keyword">return</span> index;
};

<span class="hljs-built_in">Promise</span>.prototype._proxy = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">proxyable, arg</span>) </span>{
    <span class="hljs-keyword">this</span>._addCallbacks(<span class="hljs-literal">undefined</span>, <span class="hljs-literal">undefined</span>, arg, proxyable, <span class="hljs-literal">null</span>);
};

<span class="hljs-built_in">Promise</span>.prototype._resolveCallback = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, shouldBind</span>) </span>{
    <span class="hljs-keyword">if</span> (((<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">117506048</span>) !== <span class="hljs-number">0</span>)) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span> (value === <span class="hljs-keyword">this</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rejectCallback(makeSelfResolutionError(), <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">var</span> maybePromise = tryConvertToPromise(value, <span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">if</span> (!(maybePromise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._fulfill(value);

    <span class="hljs-keyword">if</span> (shouldBind) <span class="hljs-keyword">this</span>._propagateFrom(maybePromise, <span class="hljs-number">2</span>);

    <span class="hljs-keyword">var</span> promise = maybePromise._target();

    <span class="hljs-keyword">if</span> (promise === <span class="hljs-keyword">this</span>) {
        <span class="hljs-keyword">this</span>._reject(makeSelfResolutionError());
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> bitField = promise._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">50397184</span>) === <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">var</span> len = <span class="hljs-keyword">this</span>._length();
        <span class="hljs-keyword">if</span> (len &gt; <span class="hljs-number">0</span>) promise._migrateCallback0(<span class="hljs-keyword">this</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; len; ++i) {
            promise._migrateCallbackAt(<span class="hljs-keyword">this</span>, i);
        }
        <span class="hljs-keyword">this</span>._setFollowing();
        <span class="hljs-keyword">this</span>._setLength(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">this</span>._setFollowee(promise);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">this</span>._fulfill(promise._value());
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">16777216</span>) !== <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">this</span>._reject(promise._reason());
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> reason = <span class="hljs-keyword">new</span> CancellationError(<span class="hljs-string">"late cancellation observer"</span>);
        promise._attachExtraTrace(reason);
        <span class="hljs-keyword">this</span>._reject(reason);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._rejectCallback =
<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">reason, synchronous, ignoreNonErrorWarnings</span>) </span>{
    <span class="hljs-keyword">var</span> trace = util.ensureErrorObject(reason);
    <span class="hljs-keyword">var</span> hasStack = trace === reason;
    <span class="hljs-keyword">if</span> (!hasStack &amp;&amp; !ignoreNonErrorWarnings &amp;&amp; debug.warnings()) {
        <span class="hljs-keyword">var</span> message = <span class="hljs-string">"a promise was rejected with a non-error: "</span> +
            util.classString(reason);
        <span class="hljs-keyword">this</span>._warn(message, <span class="hljs-literal">true</span>);
    }
    <span class="hljs-keyword">this</span>._attachExtraTrace(trace, synchronous ? hasStack : <span class="hljs-literal">false</span>);
    <span class="hljs-keyword">this</span>._reject(reason);
};

<span class="hljs-built_in">Promise</span>.prototype._resolveFromExecutor = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">executor</span>) </span>{
    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">this</span>._captureStackTrace();
    <span class="hljs-keyword">this</span>._pushContext();
    <span class="hljs-keyword">var</span> synchronous = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">this</span>._execute(executor, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
        promise._resolveCallback(value);
    }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
        promise._rejectCallback(reason, synchronous);
    });
    synchronous = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">this</span>._popContext();

    <span class="hljs-keyword">if</span> (r !== <span class="hljs-literal">undefined</span>) {
        promise._rejectCallback(r, <span class="hljs-literal">true</span>);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromiseFromHandler = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">
    handler, receiver, value, promise
</span>) </span>{
    <span class="hljs-keyword">var</span> bitField = promise._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">65536</span>) !== <span class="hljs-number">0</span>)) <span class="hljs-keyword">return</span>;
    promise._pushContext();
    <span class="hljs-keyword">var</span> x;
    <span class="hljs-keyword">if</span> (receiver === APPLY) {
        <span class="hljs-keyword">if</span> (!value || <span class="hljs-keyword">typeof</span> value.length !== <span class="hljs-string">"number"</span>) {
            x = errorObj;
            x.e = <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"cannot .spread() a non-array: "</span> +
                                    util.classString(value));
        } <span class="hljs-keyword">else</span> {
            x = tryCatch(handler).apply(<span class="hljs-keyword">this</span>._boundValue(), value);
        }
    } <span class="hljs-keyword">else</span> {
        x = tryCatch(handler).call(receiver, value);
    }
    <span class="hljs-keyword">var</span> promiseCreated = promise._popContext();
    bitField = promise._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">65536</span>) !== <span class="hljs-number">0</span>)) <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">if</span> (x === NEXT_FILTER) {
        promise._reject(value);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (x === errorObj) {
        promise._rejectCallback(x.e, <span class="hljs-literal">false</span>);
    } <span class="hljs-keyword">else</span> {
        debug.checkForgottenReturns(x, promiseCreated, <span class="hljs-string">""</span>,  promise, <span class="hljs-keyword">this</span>);
        promise._resolveCallback(x);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._target = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">this</span>;
    <span class="hljs-keyword">while</span> (ret._isFollowing()) ret = ret._followee();
    <span class="hljs-keyword">return</span> ret;
};

<span class="hljs-built_in">Promise</span>.prototype._followee = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rejectionHandler0;
};

<span class="hljs-built_in">Promise</span>.prototype._setFollowee = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">promise</span>) </span>{
    <span class="hljs-keyword">this</span>._rejectionHandler0 = promise;
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromise = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">promise, handler, receiver, value</span>) </span>{
    <span class="hljs-keyword">var</span> isPromise = promise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>;
    <span class="hljs-keyword">var</span> bitField = <span class="hljs-keyword">this</span>._bitField;
    <span class="hljs-keyword">var</span> asyncGuaranteed = ((bitField &amp; <span class="hljs-number">134217728</span>) !== <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">65536</span>) !== <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">if</span> (isPromise) promise._invokeInternalOnCancel();

        <span class="hljs-keyword">if</span> (receiver <span class="hljs-keyword">instanceof</span> PassThroughHandlerContext &amp;&amp;
            receiver.isFinallyHandler()) {
            receiver.cancelPromise = promise;
            <span class="hljs-keyword">if</span> (tryCatch(handler).call(receiver, value) === errorObj) {
                promise._reject(errorObj.e);
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (handler === reflectHandler) {
            promise._fulfill(reflectHandler.call(receiver));
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (receiver <span class="hljs-keyword">instanceof</span> Proxyable) {
            receiver._promiseCancelled(promise);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isPromise || promise <span class="hljs-keyword">instanceof</span> PromiseArray) {
            promise._cancel();
        } <span class="hljs-keyword">else</span> {
            receiver.cancel();
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> handler === <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">if</span> (!isPromise) {
            handler.call(receiver, value, promise);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">if</span> (asyncGuaranteed) promise._setAsyncGuaranteed();
            <span class="hljs-keyword">this</span>._settlePromiseFromHandler(handler, receiver, value, promise);
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (receiver <span class="hljs-keyword">instanceof</span> Proxyable) {
        <span class="hljs-keyword">if</span> (!receiver._isResolved()) {
            <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
                receiver._promiseFulfilled(value, promise);
            } <span class="hljs-keyword">else</span> {
                receiver._promiseRejected(value, promise);
            }
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isPromise) {
        <span class="hljs-keyword">if</span> (asyncGuaranteed) promise._setAsyncGuaranteed();
        <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
            promise._fulfill(value);
        } <span class="hljs-keyword">else</span> {
            promise._reject(value);
        }
    }
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromiseLateCancellationObserver = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ctx</span>) </span>{
    <span class="hljs-keyword">var</span> handler = ctx.handler;
    <span class="hljs-keyword">var</span> promise = ctx.promise;
    <span class="hljs-keyword">var</span> receiver = ctx.receiver;
    <span class="hljs-keyword">var</span> value = ctx.value;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> handler === <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">if</span> (!(promise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>)) {
            handler.call(receiver, value, promise);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>._settlePromiseFromHandler(handler, receiver, value, promise);
        }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (promise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) {
        promise._reject(value);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromiseCtx = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ctx</span>) </span>{
    <span class="hljs-keyword">this</span>._settlePromise(ctx.promise, ctx.handler, ctx.receiver, ctx.value);
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromise0 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">handler, value, bitField</span>) </span>{
    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>._promise0;
    <span class="hljs-keyword">var</span> receiver = <span class="hljs-keyword">this</span>._receiverAt(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">this</span>._promise0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._receiver0 = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._settlePromise(promise, handler, receiver, value);
};

<span class="hljs-built_in">Promise</span>.prototype._clearCallbackDataAtIndex = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index</span>) </span>{
    <span class="hljs-keyword">var</span> base = index * <span class="hljs-number">4</span> - <span class="hljs-number">4</span>;
    <span class="hljs-keyword">this</span>[base + <span class="hljs-number">2</span>] =
    <span class="hljs-keyword">this</span>[base + <span class="hljs-number">3</span>] =
    <span class="hljs-keyword">this</span>[base + <span class="hljs-number">0</span>] =
    <span class="hljs-keyword">this</span>[base + <span class="hljs-number">1</span>] = <span class="hljs-literal">undefined</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._fulfill = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">var</span> bitField = <span class="hljs-keyword">this</span>._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">117506048</span>) &gt;&gt;&gt; <span class="hljs-number">16</span>)) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">if</span> (value === <span class="hljs-keyword">this</span>) {
        <span class="hljs-keyword">var</span> err = makeSelfResolutionError();
        <span class="hljs-keyword">this</span>._attachExtraTrace(err);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._reject(err);
    }
    <span class="hljs-keyword">this</span>._setFulfilled();
    <span class="hljs-keyword">this</span>._rejectionHandler0 = value;

    <span class="hljs-keyword">if</span> ((bitField &amp; <span class="hljs-number">65535</span>) &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">134217728</span>) !== <span class="hljs-number">0</span>)) {
            <span class="hljs-keyword">this</span>._settlePromises();
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">async</span>.settlePromises(<span class="hljs-keyword">this</span>);
        }
    }
};

<span class="hljs-built_in">Promise</span>.prototype._reject = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
    <span class="hljs-keyword">var</span> bitField = <span class="hljs-keyword">this</span>._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">117506048</span>) &gt;&gt;&gt; <span class="hljs-number">16</span>)) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>._setRejected();
    <span class="hljs-keyword">this</span>._fulfillmentHandler0 = reason;

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isFinal()) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">async</span>.fatalError(reason, util.isNode);
    }

    <span class="hljs-keyword">if</span> ((bitField &amp; <span class="hljs-number">65535</span>) &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">async</span>.settlePromises(<span class="hljs-keyword">this</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>._ensurePossibleRejectionHandled();
    }
};

<span class="hljs-built_in">Promise</span>.prototype._fulfillPromises = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">len, value</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; len; i++) {
        <span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">this</span>._fulfillmentHandlerAt(i);
        <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>._promiseAt(i);
        <span class="hljs-keyword">var</span> receiver = <span class="hljs-keyword">this</span>._receiverAt(i);
        <span class="hljs-keyword">this</span>._clearCallbackDataAtIndex(i);
        <span class="hljs-keyword">this</span>._settlePromise(promise, handler, receiver, value);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._rejectPromises = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">len, reason</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt; len; i++) {
        <span class="hljs-keyword">var</span> handler = <span class="hljs-keyword">this</span>._rejectionHandlerAt(i);
        <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>._promiseAt(i);
        <span class="hljs-keyword">var</span> receiver = <span class="hljs-keyword">this</span>._receiverAt(i);
        <span class="hljs-keyword">this</span>._clearCallbackDataAtIndex(i);
        <span class="hljs-keyword">this</span>._settlePromise(promise, handler, receiver, reason);
    }
};

<span class="hljs-built_in">Promise</span>.prototype._settlePromises = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> bitField = <span class="hljs-keyword">this</span>._bitField;
    <span class="hljs-keyword">var</span> len = (bitField &amp; <span class="hljs-number">65535</span>);

    <span class="hljs-keyword">if</span> (len &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">16842752</span>) !== <span class="hljs-number">0</span>)) {
            <span class="hljs-keyword">var</span> reason = <span class="hljs-keyword">this</span>._fulfillmentHandler0;
            <span class="hljs-keyword">this</span>._settlePromise0(<span class="hljs-keyword">this</span>._rejectionHandler0, reason, bitField);
            <span class="hljs-keyword">this</span>._rejectPromises(len, reason);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> value = <span class="hljs-keyword">this</span>._rejectionHandler0;
            <span class="hljs-keyword">this</span>._settlePromise0(<span class="hljs-keyword">this</span>._fulfillmentHandler0, value, bitField);
            <span class="hljs-keyword">this</span>._fulfillPromises(len, value);
        }
        <span class="hljs-keyword">this</span>._setLength(<span class="hljs-number">0</span>);
    }
    <span class="hljs-keyword">this</span>._clearCancellationData();
};

<span class="hljs-built_in">Promise</span>.prototype._settledValue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> bitField = <span class="hljs-keyword">this</span>._bitField;
    <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._rejectionHandler0;
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">16777216</span>) !== <span class="hljs-number">0</span>)) {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._fulfillmentHandler0;
    }
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deferResolve</span>(<span class="hljs-params">v</span>) </span>{<span class="hljs-keyword">this</span>.promise._resolveCallback(v);}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deferReject</span>(<span class="hljs-params">v</span>) </span>{<span class="hljs-keyword">this</span>.promise._rejectCallback(v, <span class="hljs-literal">false</span>);}

<span class="hljs-built_in">Promise</span>.defer = <span class="hljs-built_in">Promise</span>.pending = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    debug.deprecated(<span class="hljs-string">"Promise.defer"</span>, <span class="hljs-string">"new Promise"</span>);
    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    <span class="hljs-keyword">return</span> {
        <span class="hljs-attr">promise</span>: promise,
        <span class="hljs-attr">resolve</span>: deferResolve,
        <span class="hljs-attr">reject</span>: deferReject
    };
};

util.notEnumerableProp(<span class="hljs-built_in">Promise</span>,
                       <span class="hljs-string">"_makeSelfResolutionError"</span>,
                       makeSelfResolutionError);

_dereq_(<span class="hljs-string">"./method"</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL, tryConvertToPromise, apiRejection,
    debug);
_dereq_(<span class="hljs-string">"./bind"</span>)(<span class="hljs-built_in">Promise</span>, INTERNAL, tryConvertToPromise, debug);
_dereq_(<span class="hljs-string">"./cancel"</span>)(<span class="hljs-built_in">Promise</span>, PromiseArray, apiRejection, debug);
_dereq_(<span class="hljs-string">"./direct_resolve"</span>)(<span class="hljs-built_in">Promise</span>);
_dereq_(<span class="hljs-string">"./synchronous_inspection"</span>)(<span class="hljs-built_in">Promise</span>);
_dereq_(<span class="hljs-string">"./join"</span>)(
    <span class="hljs-built_in">Promise</span>, PromiseArray, tryConvertToPromise, INTERNAL, <span class="hljs-keyword">async</span>, getDomain);
<span class="hljs-built_in">Promise</span>.Promise = <span class="hljs-built_in">Promise</span>;
<span class="hljs-built_in">Promise</span>.version = <span class="hljs-string">"3.4.7"</span>;
                                                         
    util.toFastProperties(<span class="hljs-built_in">Promise</span>);                                          
    util.toFastProperties(<span class="hljs-built_in">Promise</span>.prototype);                                
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fillTypes</span>(<span class="hljs-params">value</span>) </span>{                                              
        <span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);                                       
        p._fulfillmentHandler0 = value;                                      
        p._rejectionHandler0 = value;                                        
        p._promise0 = value;                                                 
        p._receiver0 = value;                                                
    }                                                                        
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Complete slack tracking, opt out of field-type tracking and<br>
stabilize map</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    fillTypes({<span class="hljs-attr">a</span>: <span class="hljs-number">1</span>});                                                       
    fillTypes({<span class="hljs-attr">b</span>: <span class="hljs-number">2</span>});                                                       
    fillTypes({<span class="hljs-attr">c</span>: <span class="hljs-number">3</span>});                                                       
    fillTypes(<span class="hljs-number">1</span>);                                                            
    fillTypes(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{});                                                 
    fillTypes(<span class="hljs-literal">undefined</span>);                                                    
    fillTypes(<span class="hljs-literal">false</span>);                                                        
    fillTypes(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL));                                        
    debug.setBounds(Async.firstLineError, util.lastLineError);               
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>;                                                          

};

},{<span class="hljs-string">"./async"</span>:<span class="hljs-number">1</span>,<span class="hljs-string">"./bind"</span>:<span class="hljs-number">2</span>,<span class="hljs-string">"./cancel"</span>:<span class="hljs-number">4</span>,<span class="hljs-string">"./catch_filter"</span>:<span class="hljs-number">5</span>,<span class="hljs-string">"./context"</span>:<span class="hljs-number">6</span>,<span class="hljs-string">"./debuggability"</span>:<span class="hljs-number">7</span>,<span class="hljs-string">"./direct_resolve"</span>:<span class="hljs-number">8</span>,<span class="hljs-string">"./errors"</span>:<span class="hljs-number">9</span>,<span class="hljs-string">"./es5"</span>:<span class="hljs-number">10</span>,<span class="hljs-string">"./finally"</span>:<span class="hljs-number">11</span>,<span class="hljs-string">"./join"</span>:<span class="hljs-number">12</span>,<span class="hljs-string">"./method"</span>:<span class="hljs-number">13</span>,<span class="hljs-string">"./nodeback"</span>:<span class="hljs-number">14</span>,<span class="hljs-string">"./promise_array"</span>:<span class="hljs-number">16</span>,<span class="hljs-string">"./synchronous_inspection"</span>:<span class="hljs-number">19</span>,<span class="hljs-string">"./thenables"</span>:<span class="hljs-number">20</span>,<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">16</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Promise, INTERNAL, tryConvertToPromise,
    apiRejection, Proxyable</span>) </span>{
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> isArray = util.isArray;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toResolutionValue</span>(<span class="hljs-params">val</span>) </span>{
    <span class="hljs-keyword">switch</span>(val) {
    <span class="hljs-keyword">case</span> <span class="hljs-number">-2</span>: <span class="hljs-keyword">return</span> [];
    <span class="hljs-keyword">case</span> <span class="hljs-number">-3</span>: <span class="hljs-keyword">return</span> {};
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">PromiseArray</span>(<span class="hljs-params">values</span>) </span>{
    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">this</span>._promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    <span class="hljs-keyword">if</span> (values <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) {
        promise._propagateFrom(values, <span class="hljs-number">3</span>);
    }
    promise._setOnCancel(<span class="hljs-keyword">this</span>);
    <span class="hljs-keyword">this</span>._values = values;
    <span class="hljs-keyword">this</span>._length = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>._totalResolved = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>._init(<span class="hljs-literal">undefined</span>, <span class="hljs-number">-2</span>);
}
util.inherits(PromiseArray, Proxyable);

PromiseArray.prototype.length = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._length;
};

PromiseArray.prototype.promise = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._promise;
};

PromiseArray.prototype._init = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span>(<span class="hljs-params">_, resolveValueIfEmpty</span>) </span>{
    <span class="hljs-keyword">var</span> values = tryConvertToPromise(<span class="hljs-keyword">this</span>._values, <span class="hljs-keyword">this</span>._promise);
    <span class="hljs-keyword">if</span> (values <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) {
        values = values._target();
        <span class="hljs-keyword">var</span> bitField = values._bitField;
        ;
        <span class="hljs-keyword">this</span>._values = values;

        <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">50397184</span>) === <span class="hljs-number">0</span>)) {
            <span class="hljs-keyword">this</span>._promise._setAsyncGuaranteed();
            <span class="hljs-keyword">return</span> values._then(
                init,
                <span class="hljs-keyword">this</span>._reject,
                <span class="hljs-literal">undefined</span>,
                <span class="hljs-keyword">this</span>,
                resolveValueIfEmpty
           );
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
            values = values._value();
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">16777216</span>) !== <span class="hljs-number">0</span>)) {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._reject(values._reason());
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._cancel();
        }
    }
    values = util.asArray(values);
    <span class="hljs-keyword">if</span> (values === <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">var</span> err = apiRejection(
            <span class="hljs-string">"expecting an array or an iterable object but got "</span> + util.classString(values)).reason();
        <span class="hljs-keyword">this</span>._promise._rejectCallback(err, <span class="hljs-literal">false</span>);
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">if</span> (values.length === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (resolveValueIfEmpty === <span class="hljs-number">-5</span>) {
            <span class="hljs-keyword">this</span>._resolveEmptyArray();
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>._resolve(toResolutionValue(resolveValueIfEmpty));
        }
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">this</span>._iterate(values);
};

PromiseArray.prototype._iterate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">values</span>) </span>{
    <span class="hljs-keyword">var</span> len = <span class="hljs-keyword">this</span>.getActualLength(values.length);
    <span class="hljs-keyword">this</span>._length = len;
    <span class="hljs-keyword">this</span>._values = <span class="hljs-keyword">this</span>.shouldCopyValues() ? <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(len) : <span class="hljs-keyword">this</span>._values;
    <span class="hljs-keyword">var</span> result = <span class="hljs-keyword">this</span>._promise;
    <span class="hljs-keyword">var</span> isResolved = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> bitField = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; len; ++i) {
        <span class="hljs-keyword">var</span> maybePromise = tryConvertToPromise(values[i], result);

        <span class="hljs-keyword">if</span> (maybePromise <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) {
            maybePromise = maybePromise._target();
            bitField = maybePromise._bitField;
        } <span class="hljs-keyword">else</span> {
            bitField = <span class="hljs-literal">null</span>;
        }

        <span class="hljs-keyword">if</span> (isResolved) {
            <span class="hljs-keyword">if</span> (bitField !== <span class="hljs-literal">null</span>) {
                maybePromise.suppressUnhandledRejections();
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (bitField !== <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">50397184</span>) === <span class="hljs-number">0</span>)) {
                maybePromise._proxy(<span class="hljs-keyword">this</span>, i);
                <span class="hljs-keyword">this</span>._values[i] = maybePromise;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>)) {
                isResolved = <span class="hljs-keyword">this</span>._promiseFulfilled(maybePromise._value(), i);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (((bitField &amp; <span class="hljs-number">16777216</span>) !== <span class="hljs-number">0</span>)) {
                isResolved = <span class="hljs-keyword">this</span>._promiseRejected(maybePromise._reason(), i);
            } <span class="hljs-keyword">else</span> {
                isResolved = <span class="hljs-keyword">this</span>._promiseCancelled(i);
            }
        } <span class="hljs-keyword">else</span> {
            isResolved = <span class="hljs-keyword">this</span>._promiseFulfilled(maybePromise, i);
        }
    }
    <span class="hljs-keyword">if</span> (!isResolved) result._setAsyncGuaranteed();
};

PromiseArray.prototype._isResolved = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._values === <span class="hljs-literal">null</span>;
};

PromiseArray.prototype._resolve = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">this</span>._values = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>._promise._fulfill(value);
};

PromiseArray.prototype._cancel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isResolved() || !<span class="hljs-keyword">this</span>._promise._isCancellable()) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>._values = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>._promise._cancel();
};

PromiseArray.prototype._reject = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
    <span class="hljs-keyword">this</span>._values = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>._promise._rejectCallback(reason, <span class="hljs-literal">false</span>);
};

PromiseArray.prototype._promiseFulfilled = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value, index</span>) </span>{
    <span class="hljs-keyword">this</span>._values[index] = value;
    <span class="hljs-keyword">var</span> totalResolved = ++<span class="hljs-keyword">this</span>._totalResolved;
    <span class="hljs-keyword">if</span> (totalResolved &gt;= <span class="hljs-keyword">this</span>._length) {
        <span class="hljs-keyword">this</span>._resolve(<span class="hljs-keyword">this</span>._values);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
};

PromiseArray.prototype._promiseCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._cancel();
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};

PromiseArray.prototype._promiseRejected = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">reason</span>) </span>{
    <span class="hljs-keyword">this</span>._totalResolved++;
    <span class="hljs-keyword">this</span>._reject(reason);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};

PromiseArray.prototype._resultCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isResolved()) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">var</span> values = <span class="hljs-keyword">this</span>._values;
    <span class="hljs-keyword">this</span>._cancel();
    <span class="hljs-keyword">if</span> (values <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) {
        values.cancel();
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; values.length; ++i) {
            <span class="hljs-keyword">if</span> (values[i] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) {
                values[i].cancel();
            }
        }
    }
};

PromiseArray.prototype.shouldCopyValues = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};

PromiseArray.prototype.getActualLength = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">len</span>) </span>{
    <span class="hljs-keyword">return</span> len;
};

<span class="hljs-keyword">return</span> PromiseArray;
};

},{<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">17</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">arrayMove</span>(<span class="hljs-params">src, srcIndex, dst, dstIndex, len</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; len; ++j) {
        dst[j + dstIndex] = src[j + srcIndex];
        src[j + srcIndex] = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Queue</span>(<span class="hljs-params">capacity</span>) </span>{
    <span class="hljs-keyword">this</span>._capacity = capacity;
    <span class="hljs-keyword">this</span>._length = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>._front = <span class="hljs-number">0</span>;
}

Queue.prototype._willBeOverCapacity = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">size</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._capacity &lt; size;
};

Queue.prototype._pushOne = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{
    <span class="hljs-keyword">var</span> length = <span class="hljs-keyword">this</span>.length();
    <span class="hljs-keyword">this</span>._checkCapacity(length + <span class="hljs-number">1</span>);
    <span class="hljs-keyword">var</span> i = (<span class="hljs-keyword">this</span>._front + length) &amp; (<span class="hljs-keyword">this</span>._capacity - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">this</span>[i] = arg;
    <span class="hljs-keyword">this</span>._length = length + <span class="hljs-number">1</span>;
};

Queue.prototype.push = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn, receiver, arg</span>) </span>{
    <span class="hljs-keyword">var</span> length = <span class="hljs-keyword">this</span>.length() + <span class="hljs-number">3</span>;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._willBeOverCapacity(length)) {
        <span class="hljs-keyword">this</span>._pushOne(fn);
        <span class="hljs-keyword">this</span>._pushOne(receiver);
        <span class="hljs-keyword">this</span>._pushOne(arg);
        <span class="hljs-keyword">return</span>;
    }
    <span class="hljs-keyword">var</span> j = <span class="hljs-keyword">this</span>._front + length - <span class="hljs-number">3</span>;
    <span class="hljs-keyword">this</span>._checkCapacity(length);
    <span class="hljs-keyword">var</span> wrapMask = <span class="hljs-keyword">this</span>._capacity - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">this</span>[(j + <span class="hljs-number">0</span>) &amp; wrapMask] = fn;
    <span class="hljs-keyword">this</span>[(j + <span class="hljs-number">1</span>) &amp; wrapMask] = receiver;
    <span class="hljs-keyword">this</span>[(j + <span class="hljs-number">2</span>) &amp; wrapMask] = arg;
    <span class="hljs-keyword">this</span>._length = length;
};

Queue.prototype.shift = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> front = <span class="hljs-keyword">this</span>._front,
        ret = <span class="hljs-keyword">this</span>[front];

    <span class="hljs-keyword">this</span>[front] = <span class="hljs-literal">undefined</span>;
    <span class="hljs-keyword">this</span>._front = (front + <span class="hljs-number">1</span>) &amp; (<span class="hljs-keyword">this</span>._capacity - <span class="hljs-number">1</span>);
    <span class="hljs-keyword">this</span>._length--;
    <span class="hljs-keyword">return</span> ret;
};

Queue.prototype.length = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._length;
};

Queue.prototype._checkCapacity = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">size</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._capacity &lt; size) {
        <span class="hljs-keyword">this</span>._resizeTo(<span class="hljs-keyword">this</span>._capacity &lt;&lt; <span class="hljs-number">1</span>);
    }
};

Queue.prototype._resizeTo = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">capacity</span>) </span>{
    <span class="hljs-keyword">var</span> oldCapacity = <span class="hljs-keyword">this</span>._capacity;
    <span class="hljs-keyword">this</span>._capacity = capacity;
    <span class="hljs-keyword">var</span> front = <span class="hljs-keyword">this</span>._front;
    <span class="hljs-keyword">var</span> length = <span class="hljs-keyword">this</span>._length;
    <span class="hljs-keyword">var</span> moveItemsCount = (front + length) &amp; (oldCapacity - <span class="hljs-number">1</span>);
    arrayMove(<span class="hljs-keyword">this</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>, oldCapacity, moveItemsCount);
};

<span class="hljs-built_in">module</span>.exports = Queue;

},{}],<span class="hljs-number">18</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> schedule;
<span class="hljs-keyword">var</span> noAsyncScheduler = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"No async scheduler available\u000a\u000a    See http://goo.gl/MqrFmX\u000a"</span>);
};
<span class="hljs-keyword">var</span> NativePromise = util.getNativePromise();
<span class="hljs-keyword">if</span> (util.isNode &amp;&amp; <span class="hljs-keyword">typeof</span> MutationObserver === <span class="hljs-string">"undefined"</span>) {
    <span class="hljs-keyword">var</span> GlobalSetImmediate = global.setImmediate;
    <span class="hljs-keyword">var</span> ProcessNextTick = process.nextTick;
    schedule = util.isRecentNode
                ? <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{ GlobalSetImmediate.call(global, fn); }
                : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{ ProcessNextTick.call(process, fn); };
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> NativePromise === <span class="hljs-string">"function"</span> &amp;&amp;
           <span class="hljs-keyword">typeof</span> NativePromise.resolve === <span class="hljs-string">"function"</span>) {
    <span class="hljs-keyword">var</span> nativePromise = NativePromise.resolve();
    schedule = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
        nativePromise.then(fn);
    };
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((<span class="hljs-keyword">typeof</span> MutationObserver !== <span class="hljs-string">"undefined"</span>) &amp;&amp;
          !(<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> !== <span class="hljs-string">"undefined"</span> &amp;&amp;
            <span class="hljs-built_in">window</span>.navigator &amp;&amp;
            (<span class="hljs-built_in">window</span>.navigator.standalone || <span class="hljs-built_in">window</span>.cordova))) {
    schedule = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> div = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"div"</span>);
        <span class="hljs-keyword">var</span> opts = {<span class="hljs-attr">attributes</span>: <span class="hljs-literal">true</span>};
        <span class="hljs-keyword">var</span> toggleScheduled = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> div2 = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">"div"</span>);
        <span class="hljs-keyword">var</span> o2 = <span class="hljs-keyword">new</span> MutationObserver(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            div.classList.toggle(<span class="hljs-string">"foo"</span>);
            toggleScheduled = <span class="hljs-literal">false</span>;
        });
        o2.observe(div2, opts);

        <span class="hljs-keyword">var</span> scheduleToggle = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">if</span> (toggleScheduled) <span class="hljs-keyword">return</span>;
                toggleScheduled = <span class="hljs-literal">true</span>;
                div2.classList.toggle(<span class="hljs-string">"foo"</span>);
            };

            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">schedule</span>(<span class="hljs-params">fn</span>) </span>{
            <span class="hljs-keyword">var</span> o = <span class="hljs-keyword">new</span> MutationObserver(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                o.disconnect();
                fn();
            });
            o.observe(div, opts);
            scheduleToggle();
        };
    })();
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> setImmediate !== <span class="hljs-string">"undefined"</span>) {
    schedule = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
        setImmediate(fn);
    };
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> setTimeout !== <span class="hljs-string">"undefined"</span>) {
    schedule = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">fn</span>) </span>{
        setTimeout(fn, <span class="hljs-number">0</span>);
    };
} <span class="hljs-keyword">else</span> {
    schedule = noAsyncScheduler;
}
<span class="hljs-built_in">module</span>.exports = schedule;

},{<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">19</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Promise</span>) </span>{
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">PromiseInspection</span>(<span class="hljs-params">promise</span>) </span>{
    <span class="hljs-keyword">if</span> (promise !== <span class="hljs-literal">undefined</span>) {
        promise = promise._target();
        <span class="hljs-keyword">this</span>._bitField = promise._bitField;
        <span class="hljs-keyword">this</span>._settledValueField = promise._isFateSealed()
            ? promise._settledValue() : <span class="hljs-literal">undefined</span>;
    }
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>._bitField = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>._settledValueField = <span class="hljs-literal">undefined</span>;
    }
}

PromiseInspection.prototype._settledValue = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._settledValueField;
};

<span class="hljs-keyword">var</span> value = PromiseInspection.prototype.value = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isFulfilled()) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"cannot get fulfillment value of a non-fulfilled promise\u000a\u000a    See http://goo.gl/MqrFmX\u000a"</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._settledValue();
};

<span class="hljs-keyword">var</span> reason = PromiseInspection.prototype.error =
PromiseInspection.prototype.reason = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.isRejected()) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">"cannot get rejection reason of a non-rejected promise\u000a\u000a    See http://goo.gl/MqrFmX\u000a"</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._settledValue();
};

<span class="hljs-keyword">var</span> isFulfilled = PromiseInspection.prototype.isFulfilled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">33554432</span>) !== <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">var</span> isRejected = PromiseInspection.prototype.isRejected = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">16777216</span>) !== <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">var</span> isPending = PromiseInspection.prototype.isPending = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">50397184</span>) === <span class="hljs-number">0</span>;
};

<span class="hljs-keyword">var</span> isResolved = PromiseInspection.prototype.isResolved = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">50331648</span>) !== <span class="hljs-number">0</span>;
};

PromiseInspection.prototype.isCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">8454144</span>) !== <span class="hljs-number">0</span>;
};

<span class="hljs-built_in">Promise</span>.prototype.__isCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._bitField &amp; <span class="hljs-number">65536</span>) === <span class="hljs-number">65536</span>;
};

<span class="hljs-built_in">Promise</span>.prototype._isCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._target().__isCancelled();
};

<span class="hljs-built_in">Promise</span>.prototype.isCancelled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._target()._bitField &amp; <span class="hljs-number">8454144</span>) !== <span class="hljs-number">0</span>;
};

<span class="hljs-built_in">Promise</span>.prototype.isPending = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> isPending.call(<span class="hljs-keyword">this</span>._target());
};

<span class="hljs-built_in">Promise</span>.prototype.isRejected = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> isRejected.call(<span class="hljs-keyword">this</span>._target());
};

<span class="hljs-built_in">Promise</span>.prototype.isFulfilled = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> isFulfilled.call(<span class="hljs-keyword">this</span>._target());
};

<span class="hljs-built_in">Promise</span>.prototype.isResolved = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> isResolved.call(<span class="hljs-keyword">this</span>._target());
};

<span class="hljs-built_in">Promise</span>.prototype.value = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> value.call(<span class="hljs-keyword">this</span>._target());
};

<span class="hljs-built_in">Promise</span>.prototype.reason = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> target = <span class="hljs-keyword">this</span>._target();
    target._unsetRejectionIsUnhandled();
    <span class="hljs-keyword">return</span> reason.call(target);
};

<span class="hljs-built_in">Promise</span>.prototype._value = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._settledValue();
};

<span class="hljs-built_in">Promise</span>.prototype._reason = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">this</span>._unsetRejectionIsUnhandled();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._settledValue();
};

<span class="hljs-built_in">Promise</span>.PromiseInspection = PromiseInspection;
};

},{}],<span class="hljs-number">20</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Promise, INTERNAL</span>) </span>{
<span class="hljs-keyword">var</span> util = _dereq_(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> errorObj = util.errorObj;
<span class="hljs-keyword">var</span> isObject = util.isObject;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tryConvertToPromise</span>(<span class="hljs-params">obj, context</span>) </span>{
    <span class="hljs-keyword">if</span> (isObject(obj)) {
        <span class="hljs-keyword">if</span> (obj <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Promise</span>) <span class="hljs-keyword">return</span> obj;
        <span class="hljs-keyword">var</span> then = getThen(obj);
        <span class="hljs-keyword">if</span> (then === errorObj) {
            <span class="hljs-keyword">if</span> (context) context._pushContext();
            <span class="hljs-keyword">var</span> ret = <span class="hljs-built_in">Promise</span>.reject(then.e);
            <span class="hljs-keyword">if</span> (context) context._popContext();
            <span class="hljs-keyword">return</span> ret;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> then === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">if</span> (isAnyBluebirdPromise(obj)) {
                <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
                obj._then(
                    ret._fulfill,
                    ret._reject,
                    <span class="hljs-literal">undefined</span>,
                    ret,
                    <span class="hljs-literal">null</span>
                );
                <span class="hljs-keyword">return</span> ret;
            }
            <span class="hljs-keyword">return</span> doThenable(obj, then, context);
        }
    }
    <span class="hljs-keyword">return</span> obj;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doGetThen</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">return</span> obj.then;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getThen</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> doGetThen(obj);
    } <span class="hljs-keyword">catch</span> (e) {
        errorObj.e = e;
        <span class="hljs-keyword">return</span> errorObj;
    }
}

<span class="hljs-keyword">var</span> hasProp = {}.hasOwnProperty;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isAnyBluebirdPromise</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> hasProp.call(obj, <span class="hljs-string">"_promise0"</span>);
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doThenable</span>(<span class="hljs-params">x, then, context</span>) </span>{
    <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(INTERNAL);
    <span class="hljs-keyword">var</span> ret = promise;
    <span class="hljs-keyword">if</span> (context) context._pushContext();
    promise._captureStackTrace();
    <span class="hljs-keyword">if</span> (context) context._popContext();
    <span class="hljs-keyword">var</span> synchronous = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">var</span> result = util.tryCatch(then).call(x, resolve, reject);
    synchronous = <span class="hljs-literal">false</span>;

    <span class="hljs-keyword">if</span> (promise &amp;&amp; result === errorObj) {
        promise._rejectCallback(result.e, <span class="hljs-literal">true</span>, <span class="hljs-literal">true</span>);
        promise = <span class="hljs-literal">null</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolve</span>(<span class="hljs-params">value</span>) </span>{
        <span class="hljs-keyword">if</span> (!promise) <span class="hljs-keyword">return</span>;
        promise._resolveCallback(value);
        promise = <span class="hljs-literal">null</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reject</span>(<span class="hljs-params">reason</span>) </span>{
        <span class="hljs-keyword">if</span> (!promise) <span class="hljs-keyword">return</span>;
        promise._rejectCallback(reason, synchronous, <span class="hljs-literal">true</span>);
        promise = <span class="hljs-literal">null</span>;
    }
    <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-keyword">return</span> tryConvertToPromise;
};

},{<span class="hljs-string">"./util"</span>:<span class="hljs-number">21</span>}],<span class="hljs-number">21</span>:[<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_dereq_,module,exports</span>)</span>{
<span class="hljs-meta">"use strict"</span>;
<span class="hljs-keyword">var</span> es5 = _dereq_(<span class="hljs-string">"./es5"</span>);
<span class="hljs-keyword">var</span> canEvaluate = <span class="hljs-keyword">typeof</span> navigator == <span class="hljs-string">"undefined"</span>;

<span class="hljs-keyword">var</span> errorObj = {<span class="hljs-attr">e</span>: {}};
<span class="hljs-keyword">var</span> tryCatchTarget;
<span class="hljs-keyword">var</span> globalObject = <span class="hljs-keyword">typeof</span> self !== <span class="hljs-string">"undefined"</span> ? self :
    <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> !== <span class="hljs-string">"undefined"</span> ? <span class="hljs-built_in">window</span> :
    <span class="hljs-keyword">typeof</span> global !== <span class="hljs-string">"undefined"</span> ? global :
    <span class="hljs-keyword">this</span> !== <span class="hljs-literal">undefined</span> ? <span class="hljs-keyword">this</span> : <span class="hljs-literal">null</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tryCatcher</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">var</span> target = tryCatchTarget;
        tryCatchTarget = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">return</span> target.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>);
    } <span class="hljs-keyword">catch</span> (e) {
        errorObj.e = e;
        <span class="hljs-keyword">return</span> errorObj;
    }
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tryCatch</span>(<span class="hljs-params">fn</span>) </span>{
    tryCatchTarget = fn;
    <span class="hljs-keyword">return</span> tryCatcher;
}

<span class="hljs-keyword">var</span> inherits = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Child, Parent</span>) </span>{
    <span class="hljs-keyword">var</span> hasProp = {}.hasOwnProperty;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">T</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">this</span>.constructor = Child;
        <span class="hljs-keyword">this</span>.constructor$ = Parent;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> propertyName <span class="hljs-keyword">in</span> Parent.prototype) {
            <span class="hljs-keyword">if</span> (hasProp.call(Parent.prototype, propertyName) &amp;&amp;
                propertyName.charAt(propertyName.length<span class="hljs-number">-1</span>) !== <span class="hljs-string">"$"</span>
           ) {
                <span class="hljs-keyword">this</span>[propertyName + <span class="hljs-string">"$"</span>] = Parent.prototype[propertyName];
            }
        }
    }
    T.prototype = Parent.prototype;
    Child.prototype = <span class="hljs-keyword">new</span> T();
    <span class="hljs-keyword">return</span> Child.prototype;
};


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isPrimitive</span>(<span class="hljs-params">val</span>) </span>{
    <span class="hljs-keyword">return</span> val == <span class="hljs-literal">null</span> || val === <span class="hljs-literal">true</span> || val === <span class="hljs-literal">false</span> ||
        <span class="hljs-keyword">typeof</span> val === <span class="hljs-string">"string"</span> || <span class="hljs-keyword">typeof</span> val === <span class="hljs-string">"number"</span>;

}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isObject</span>(<span class="hljs-params">value</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">"function"</span> ||
           <span class="hljs-keyword">typeof</span> value === <span class="hljs-string">"object"</span> &amp;&amp; value !== <span class="hljs-literal">null</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">maybeWrapAsError</span>(<span class="hljs-params">maybeError</span>) </span>{
    <span class="hljs-keyword">if</span> (!isPrimitive(maybeError)) <span class="hljs-keyword">return</span> maybeError;

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(safeToString(maybeError));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">withAppended</span>(<span class="hljs-params">target, appendee</span>) </span>{
    <span class="hljs-keyword">var</span> len = target.length;
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(len + <span class="hljs-number">1</span>);
    <span class="hljs-keyword">var</span> i;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; ++i) {
        ret[i] = target[i];
    }
    ret[i] = appendee;
    <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDataPropertyOrDefault</span>(<span class="hljs-params">obj, key, defaultValue</span>) </span>{
    <span class="hljs-keyword">if</span> (es5.isES5) {
        <span class="hljs-keyword">var</span> desc = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(obj, key);

        <span class="hljs-keyword">if</span> (desc != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">return</span> desc.get == <span class="hljs-literal">null</span> &amp;&amp; desc.set == <span class="hljs-literal">null</span>
                    ? desc.value
                    : defaultValue;
        }
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> {}.hasOwnProperty.call(obj, key) ? obj[key] : <span class="hljs-literal">undefined</span>;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">notEnumerableProp</span>(<span class="hljs-params">obj, name, value</span>) </span>{
    <span class="hljs-keyword">if</span> (isPrimitive(obj)) <span class="hljs-keyword">return</span> obj;
    <span class="hljs-keyword">var</span> descriptor = {
        <span class="hljs-attr">value</span>: value,
        <span class="hljs-attr">configurable</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">writable</span>: <span class="hljs-literal">true</span>
    };
    es5.defineProperty(obj, name, descriptor);
    <span class="hljs-keyword">return</span> obj;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">thrower</span>(<span class="hljs-params">r</span>) </span>{
    <span class="hljs-keyword">throw</span> r;
}

<span class="hljs-keyword">var</span> inheritedDataKeys = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> excludedPrototypes = [
        <span class="hljs-built_in">Array</span>.prototype,
        <span class="hljs-built_in">Object</span>.prototype,
        <span class="hljs-built_in">Function</span>.prototype
    ];

    <span class="hljs-keyword">var</span> isExcludedProto = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">val</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; excludedPrototypes.length; ++i) {
            <span class="hljs-keyword">if</span> (excludedPrototypes[i] === val) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    };

    <span class="hljs-keyword">if</span> (es5.isES5) {
        <span class="hljs-keyword">var</span> getKeys = <span class="hljs-built_in">Object</span>.getOwnPropertyNames;
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) </span>{
            <span class="hljs-keyword">var</span> ret = [];
            <span class="hljs-keyword">var</span> visitedKeys = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
            <span class="hljs-keyword">while</span> (obj != <span class="hljs-literal">null</span> &amp;&amp; !isExcludedProto(obj)) {
                <span class="hljs-keyword">var</span> keys;
                <span class="hljs-keyword">try</span> {
                    keys = getKeys(obj);
                } <span class="hljs-keyword">catch</span> (e) {
                    <span class="hljs-keyword">return</span> ret;
                }
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; keys.length; ++i) {
                    <span class="hljs-keyword">var</span> key = keys[i];
                    <span class="hljs-keyword">if</span> (visitedKeys[key]) <span class="hljs-keyword">continue</span>;
                    visitedKeys[key] = <span class="hljs-literal">true</span>;
                    <span class="hljs-keyword">var</span> desc = <span class="hljs-built_in">Object</span>.getOwnPropertyDescriptor(obj, key);
                    <span class="hljs-keyword">if</span> (desc != <span class="hljs-literal">null</span> &amp;&amp; desc.get == <span class="hljs-literal">null</span> &amp;&amp; desc.set == <span class="hljs-literal">null</span>) {
                        ret.push(key);
                    }
                }
                obj = es5.getPrototypeOf(obj);
            }
            <span class="hljs-keyword">return</span> ret;
        };
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> hasProp = {}.hasOwnProperty;
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) </span>{
            <span class="hljs-keyword">if</span> (isExcludedProto(obj)) <span class="hljs-keyword">return</span> [];
            <span class="hljs-keyword">var</span> ret = [];

            <span class="hljs-comment">/*jshint forin:false */</span>
            enumeration: <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> obj) {
                <span class="hljs-keyword">if</span> (hasProp.call(obj, key)) {
                    ret.push(key);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; excludedPrototypes.length; ++i) {
                        <span class="hljs-keyword">if</span> (hasProp.call(excludedPrototypes[i], key)) {
                            <span class="hljs-keyword">continue</span> enumeration;
                        }
                    }
                    ret.push(key);
                }
            }
            <span class="hljs-keyword">return</span> ret;
        };
    }

})();

<span class="hljs-keyword">var</span> thisAssignmentPattern = <span class="hljs-regexp">/this\s*\.\s*\S+\s*=/</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isClass</span>(<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> fn === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">var</span> keys = es5.names(fn.prototype);

            <span class="hljs-keyword">var</span> hasMethods = es5.isES5 &amp;&amp; keys.length &gt; <span class="hljs-number">1</span>;
            <span class="hljs-keyword">var</span> hasMethodsOtherThanConstructor = keys.length &gt; <span class="hljs-number">0</span> &amp;&amp;
                !(keys.length === <span class="hljs-number">1</span> &amp;&amp; keys[<span class="hljs-number">0</span>] === <span class="hljs-string">"constructor"</span>);
            <span class="hljs-keyword">var</span> hasThisAssignmentAndStaticMethods =
                thisAssignmentPattern.test(fn + <span class="hljs-string">""</span>) &amp;&amp; es5.names(fn).length &gt; <span class="hljs-number">0</span>;

            <span class="hljs-keyword">if</span> (hasMethods || hasMethodsOtherThanConstructor ||
                hasThisAssignmentAndStaticMethods) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">toFastProperties</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-comment">/*jshint -W027,-W055,-W031*/</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">FakeConstructor</span>(<span class="hljs-params"></span>) </span>{}
    FakeConstructor.prototype = obj;
    <span class="hljs-keyword">var</span> l = <span class="hljs-number">8</span>;
    <span class="hljs-keyword">while</span> (l--) <span class="hljs-keyword">new</span> FakeConstructor();
    <span class="hljs-keyword">return</span> obj;
    <span class="hljs-built_in">eval</span>(obj);
}

<span class="hljs-keyword">var</span> rident = <span class="hljs-regexp">/^[a-z$_][a-z$_0-9]*$/i</span>;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isIdentifier</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">return</span> rident.test(str);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filledRange</span>(<span class="hljs-params">count, prefix, suffix</span>) </span>{
    <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(count);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; count; ++i) {
        ret[i] = prefix + i + suffix;
    }
    <span class="hljs-keyword">return</span> ret;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safeToString</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">return</span> obj + <span class="hljs-string">""</span>;
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-string">"[no string representation]"</span>;
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isError</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">return</span> obj !== <span class="hljs-literal">null</span> &amp;&amp;
           <span class="hljs-keyword">typeof</span> obj === <span class="hljs-string">"object"</span> &amp;&amp;
           <span class="hljs-keyword">typeof</span> obj.message === <span class="hljs-string">"string"</span> &amp;&amp;
           <span class="hljs-keyword">typeof</span> obj.name === <span class="hljs-string">"string"</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">markAsOriginatingFromRejection</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">try</span> {
        notEnumerableProp(e, <span class="hljs-string">"isOperational"</span>, <span class="hljs-literal">true</span>);
    }
    <span class="hljs-keyword">catch</span>(ignore) {}
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">originatesFromRejection</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">if</span> (e == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">return</span> ((e <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>[<span class="hljs-string">"__BluebirdErrorTypes__"</span>].OperationalError) ||
        e[<span class="hljs-string">"isOperational"</span>] === <span class="hljs-literal">true</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">canAttachTrace</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">return</span> isError(obj) &amp;&amp; es5.propertyIsWritable(obj, <span class="hljs-string">"stack"</span>);
}

<span class="hljs-keyword">var</span> ensureErrorObject = (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (!(<span class="hljs-string">"stack"</span> <span class="hljs-keyword">in</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>())) {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
            <span class="hljs-keyword">if</span> (canAttachTrace(value)) <span class="hljs-keyword">return</span> value;
            <span class="hljs-keyword">try</span> {<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(safeToString(value));}
            <span class="hljs-keyword">catch</span>(err) {<span class="hljs-keyword">return</span> err;}
        };
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value</span>) </span>{
            <span class="hljs-keyword">if</span> (canAttachTrace(value)) <span class="hljs-keyword">return</span> value;
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(safeToString(value));
        };
    }
})();

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">classString</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">return</span> {}.toString.call(obj);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">copyDescriptors</span>(<span class="hljs-params">from, to, filter</span>) </span>{
    <span class="hljs-keyword">var</span> keys = es5.names(<span class="hljs-keyword">from</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; keys.length; ++i) {
        <span class="hljs-keyword">var</span> key = keys[i];
        <span class="hljs-keyword">if</span> (filter(key)) {
            <span class="hljs-keyword">try</span> {
                es5.defineProperty(to, key, es5.getDescriptor(<span class="hljs-keyword">from</span>, key));
            } <span class="hljs-keyword">catch</span> (ignore) {}
        }
    }
}

<span class="hljs-keyword">var</span> asArray = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
    <span class="hljs-keyword">if</span> (es5.isArray(v)) {
        <span class="hljs-keyword">return</span> v;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
};

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Symbol</span> !== <span class="hljs-string">"undefined"</span> &amp;&amp; <span class="hljs-built_in">Symbol</span>.iterator) {
    <span class="hljs-keyword">var</span> ArrayFrom = <span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Array</span>.from === <span class="hljs-string">"function"</span> ? <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.from(v);
    } : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
        <span class="hljs-keyword">var</span> ret = [];
        <span class="hljs-keyword">var</span> it = v[<span class="hljs-built_in">Symbol</span>.iterator]();
        <span class="hljs-keyword">var</span> itResult;
        <span class="hljs-keyword">while</span> (!((itResult = it.next()).done)) {
            ret.push(itResult.value);
        }
        <span class="hljs-keyword">return</span> ret;
    };

    asArray = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">v</span>) </span>{
        <span class="hljs-keyword">if</span> (es5.isArray(v)) {
            <span class="hljs-keyword">return</span> v;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (v != <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-keyword">typeof</span> v[<span class="hljs-built_in">Symbol</span>.iterator] === <span class="hljs-string">"function"</span>) {
            <span class="hljs-keyword">return</span> ArrayFrom(v);
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    };
}

<span class="hljs-keyword">var</span> isNode = <span class="hljs-keyword">typeof</span> process !== <span class="hljs-string">"undefined"</span> &amp;&amp;
        classString(process).toLowerCase() === <span class="hljs-string">"[object process]"</span>;

<span class="hljs-keyword">var</span> hasEnvVariables = <span class="hljs-keyword">typeof</span> process !== <span class="hljs-string">"undefined"</span> &amp;&amp;
    <span class="hljs-keyword">typeof</span> process.env !== <span class="hljs-string">"undefined"</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">env</span>(<span class="hljs-params">key</span>) </span>{
    <span class="hljs-keyword">return</span> hasEnvVariables ? process.env[key] : <span class="hljs-literal">undefined</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNativePromise</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Promise</span> === <span class="hljs-string">"function"</span>) {
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> promise = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{});
            <span class="hljs-keyword">if</span> ({}.toString.call(promise) === <span class="hljs-string">"[object Promise]"</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-built_in">Promise</span>;
            }
        } <span class="hljs-keyword">catch</span> (e) {}
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">domainBind</span>(<span class="hljs-params">self, cb</span>) </span>{
    <span class="hljs-keyword">return</span> self.bind(cb);
}

<span class="hljs-keyword">var</span> ret = {
    <span class="hljs-attr">isClass</span>: isClass,
    <span class="hljs-attr">isIdentifier</span>: isIdentifier,
    <span class="hljs-attr">inheritedDataKeys</span>: inheritedDataKeys,
    <span class="hljs-attr">getDataPropertyOrDefault</span>: getDataPropertyOrDefault,
    <span class="hljs-attr">thrower</span>: thrower,
    <span class="hljs-attr">isArray</span>: es5.isArray,
    <span class="hljs-attr">asArray</span>: asArray,
    <span class="hljs-attr">notEnumerableProp</span>: notEnumerableProp,
    <span class="hljs-attr">isPrimitive</span>: isPrimitive,
    <span class="hljs-attr">isObject</span>: isObject,
    <span class="hljs-attr">isError</span>: isError,
    <span class="hljs-attr">canEvaluate</span>: canEvaluate,
    <span class="hljs-attr">errorObj</span>: errorObj,
    <span class="hljs-attr">tryCatch</span>: tryCatch,
    <span class="hljs-attr">inherits</span>: inherits,
    <span class="hljs-attr">withAppended</span>: withAppended,
    <span class="hljs-attr">maybeWrapAsError</span>: maybeWrapAsError,
    <span class="hljs-attr">toFastProperties</span>: toFastProperties,
    <span class="hljs-attr">filledRange</span>: filledRange,
    <span class="hljs-attr">toString</span>: safeToString,
    <span class="hljs-attr">canAttachTrace</span>: canAttachTrace,
    <span class="hljs-attr">ensureErrorObject</span>: ensureErrorObject,
    <span class="hljs-attr">originatesFromRejection</span>: originatesFromRejection,
    <span class="hljs-attr">markAsOriginatingFromRejection</span>: markAsOriginatingFromRejection,
    <span class="hljs-attr">classString</span>: classString,
    <span class="hljs-attr">copyDescriptors</span>: copyDescriptors,
    <span class="hljs-attr">hasDevTools</span>: <span class="hljs-keyword">typeof</span> chrome !== <span class="hljs-string">"undefined"</span> &amp;&amp; chrome &amp;&amp;
                 <span class="hljs-keyword">typeof</span> chrome.loadTimes === <span class="hljs-string">"function"</span>,
    <span class="hljs-attr">isNode</span>: isNode,
    <span class="hljs-attr">hasEnvVariables</span>: hasEnvVariables,
    <span class="hljs-attr">env</span>: env,
    <span class="hljs-attr">global</span>: globalObject,
    <span class="hljs-attr">getNativePromise</span>: getNativePromise,
    <span class="hljs-attr">domainBind</span>: domainBind
};
ret.isRecentNode = ret.isNode &amp;&amp; (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> version = process.versions.node.split(<span class="hljs-string">"."</span>).map(<span class="hljs-built_in">Number</span>);
    <span class="hljs-keyword">return</span> (version[<span class="hljs-number">0</span>] === <span class="hljs-number">0</span> &amp;&amp; version[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">10</span>) || (version[<span class="hljs-number">0</span>] &gt; <span class="hljs-number">0</span>);
})();

<span class="hljs-keyword">if</span> (ret.isNode) ret.toFastProperties(process);

<span class="hljs-keyword">try</span> {<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(); } <span class="hljs-keyword">catch</span> (e) {ret.lastLineError = e;}
<span class="hljs-built_in">module</span>.exports = ret;

},{<span class="hljs-string">"./es5"</span>:<span class="hljs-number">10</span>}]},{},[<span class="hljs-number">3</span>])(<span class="hljs-number">3</span>)
});                    ;<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-built_in">window</span> !== <span class="hljs-literal">null</span>) {                               <span class="hljs-built_in">window</span>.P = <span class="hljs-built_in">window</span>.Promise;                                                     } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> self !== <span class="hljs-string">'undefined'</span> &amp;&amp; self !== <span class="hljs-literal">null</span>) {                             self.P = self.Promise;                                                         }
</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
