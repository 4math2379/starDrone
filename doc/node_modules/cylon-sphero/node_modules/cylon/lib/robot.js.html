<!DOCTYPE html>
<html>
<head>
  <title>robot.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/cylon-sphero/node_modules/cylon/lib/robot.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>robot.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;

<span class="hljs-keyword">var</span> initializer = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./initializer"</span>),
    Logger = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./logger"</span>),
    Utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./utils"</span>),
    Config = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./config"</span>),
    _ = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./utils/helpers"</span>);

<span class="hljs-keyword">var</span> validator = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./validator"</span>);

<span class="hljs-keyword">var</span> EventEmitter = <span class="hljs-built_in">require</span>(<span class="hljs-string">"events"</span>).EventEmitter;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>used when creating default robot names</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> ROBOT_ID = <span class="hljs-number">1</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Creates a new Robot instance based on provided options</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opts</span>
<span class="dox_type">Object</span>
<span>object with Robot options
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[name]</span>
<span class="dox_type">String</span>
<span>the name the robot should have
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[connections]</span>
<span class="dox_type">Object</span>
<span>object containing connection info for the Robot
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[devices]</span>
<span class="dox_type">Object</span>
<span>object containing device information for the Robot
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[work]</span>
<span class="dox_type">Function</span>
<span>a function the Robot will run when started
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> Robot = <span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Robot</span>(<span class="hljs-params">opts</span>) </span>{
  Utils.classCallCheck(<span class="hljs-keyword">this</span>, Robot);

  opts = opts || {};

  validator.validate(opts);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>auto-bind prototype methods</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> <span class="hljs-built_in">Object</span>.getPrototypeOf(<span class="hljs-keyword">this</span>)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>[prop] &amp;&amp; prop !== <span class="hljs-string">"constructor"</span>) {
      <span class="hljs-keyword">this</span>[prop] = <span class="hljs-keyword">this</span>[prop].bind(<span class="hljs-keyword">this</span>);
    }
  }

  <span class="hljs-keyword">this</span>.initRobot(opts);

  _.each(opts, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opt, name</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>[name] !== <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">if</span> (_.isFunction(opt)) {
      <span class="hljs-keyword">this</span>[name] = opt.bind(<span class="hljs-keyword">this</span>);

      <span class="hljs-keyword">if</span> (opts.commands == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">this</span>.commands[name] = opt.bind(<span class="hljs-keyword">this</span>);
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>[name] = opt;
    }
  }, <span class="hljs-keyword">this</span>);

  <span class="hljs-keyword">if</span> (opts.commands) {
    <span class="hljs-keyword">var</span> cmds;

    <span class="hljs-keyword">if</span> (_.isFunction(opts.commands)) {
      cmds = opts.commands.call(<span class="hljs-keyword">this</span>);
    } <span class="hljs-keyword">else</span> {
      cmds = opts.commands;
    }

    <span class="hljs-keyword">if</span> (_.isObject(cmds)) {
      <span class="hljs-keyword">this</span>.commands = cmds;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">var</span> err = <span class="hljs-string">"#commands must be an object "</span>;
      err += <span class="hljs-string">"or a function that returns an object"</span>;
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(err);
    }
  }

  <span class="hljs-keyword">var</span> mode = Utils.fetch(Config, <span class="hljs-string">"mode"</span>, <span class="hljs-string">"manual"</span>);

  <span class="hljs-keyword">if</span> (mode === <span class="hljs-string">"auto"</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>run on the next tick, to allow for &quot;work&quot; event handlers to be set up</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    setTimeout(<span class="hljs-keyword">this</span>.start, <span class="hljs-number">0</span>);
  }
};

Utils.subclass(Robot, EventEmitter);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>Condenses information on a Robot to a JSON-serializable format</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
<span>serializable information on the Robot
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.toJSON = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> {
    <span class="hljs-attr">name</span>: <span class="hljs-keyword">this</span>.name,
    <span class="hljs-attr">connections</span>: _.invoke(<span class="hljs-keyword">this</span>.connections, <span class="hljs-string">"toJSON"</span>),
    <span class="hljs-attr">devices</span>: _.invoke(<span class="hljs-keyword">this</span>.devices, <span class="hljs-string">"toJSON"</span>),
    <span class="hljs-attr">commands</span>: <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.commands),
    <span class="hljs-attr">events</span>: _.isArray(<span class="hljs-keyword">this</span>.events) ? <span class="hljs-keyword">this</span>.events : []
  };
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Adds a new Connection to the Robot with the provided name and details.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">name</span>
<span class="dox_type">String</span>
<span>string name for the Connection to use
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">conn</span>
<span class="dox_type">Object</span>
<span>options for the Connection initializer
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
<span>the robot
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.connection = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, conn</span>) </span>{
  conn.robot = <span class="hljs-keyword">this</span>;
  conn.name = name;

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.connections[conn.name]) {
    <span class="hljs-keyword">var</span> original = conn.name,
        str;

    conn.name = Utils.makeUnique(original, <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.connections));

    str = <span class="hljs-string">"Connection names must be unique."</span>;
    str += <span class="hljs-string">"Renaming '"</span> + original + <span class="hljs-string">"' to '"</span> + conn.name + <span class="hljs-string">"'"</span>;
    <span class="hljs-keyword">this</span>.log(str);
  }

  <span class="hljs-keyword">this</span>.connections[conn.name] = initializer(<span class="hljs-string">"adaptor"</span>, conn);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<p>Initializes all values for a new Robot.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">opts</span>
<span class="dox_type">Object</span>
<span>object passed to Robot constructor
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.initRobot = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">opts</span>) </span>{
  <span class="hljs-keyword">this</span>.name = opts.name || <span class="hljs-string">"Robot "</span> + ROBOT_ID++;
  <span class="hljs-keyword">this</span>.running = <span class="hljs-literal">false</span>;

  <span class="hljs-keyword">this</span>.connections = {};
  <span class="hljs-keyword">this</span>.devices = {};

  <span class="hljs-keyword">this</span>.work = opts.work || opts.play;

  <span class="hljs-keyword">this</span>.commands = {};

  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.work) {
    <span class="hljs-keyword">this</span>.work = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">this</span>.log(<span class="hljs-string">"No work yet."</span>); };
  }

  _.each(opts.connections, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conn, key</span>) </span>{
    <span class="hljs-keyword">var</span> name = _.isString(key) ? key : conn.name;

    <span class="hljs-keyword">if</span> (conn.devices) {
      opts.devices = opts.devices || {};

      _.each(conn.devices, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">device, d</span>) </span>{
        device.connection = name;
        opts.devices[d] = device;
      });

      <span class="hljs-keyword">delete</span> conn.devices;
    }

    <span class="hljs-keyword">this</span>.connection(name, _.extend({}, conn));
  }, <span class="hljs-keyword">this</span>);

  _.each(opts.devices, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">device, key</span>) </span>{
    <span class="hljs-keyword">var</span> name = _.isString(key) ? key : device.name;
    <span class="hljs-keyword">this</span>.device(name, _.extend({}, device));
  }, <span class="hljs-keyword">this</span>);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>Adds a new Device to the Robot with the provided name and details.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">name</span>
<span class="dox_type">String</span>
<span>string name for the Device to use
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">device</span>
<span class="dox_type">Object</span>
<span>options for the Device initializer
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
<span>the robot
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.device = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, device</span>) </span>{
  <span class="hljs-keyword">var</span> str;

  device.robot = <span class="hljs-keyword">this</span>;
  device.name = name;

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.devices[device.name]) {
    <span class="hljs-keyword">var</span> original = device.name;
    device.name = Utils.makeUnique(original, <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.devices));

    str = <span class="hljs-string">"Device names must be unique."</span>;
    str += <span class="hljs-string">"Renaming '"</span> + original + <span class="hljs-string">"' to '"</span> + device.name + <span class="hljs-string">"'"</span>;
    <span class="hljs-keyword">this</span>.log(str);
  }

  <span class="hljs-keyword">if</span> (_.isString(device.connection)) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.connections[device.connection] == <span class="hljs-literal">null</span>) {
      str = <span class="hljs-string">"No connection found with the name "</span> + device.connection + <span class="hljs-string">".\n"</span>;
      <span class="hljs-keyword">this</span>.log(str);
      process.emit(<span class="hljs-string">"SIGINT"</span>);
    }

    device.connection = <span class="hljs-keyword">this</span>.connections[device.connection];
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> c <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.connections) {
      device.connection = <span class="hljs-keyword">this</span>.connections[c];
      <span class="hljs-keyword">break</span>;
    }
  }

  <span class="hljs-keyword">this</span>.devices[device.name] = initializer(<span class="hljs-string">"driver"</span>, device);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<div class="dox">
<div class="summary">
<p>Starts the Robot's connections, then devices, then work.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">Function</span>
<span>function to be triggered when the Robot has started working
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">Object</span>
<span>the Robot
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.start = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.running) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  }

  <span class="hljs-keyword">var</span> mode = Utils.fetch(Config, <span class="hljs-string">"workMode"</span>, <span class="hljs-string">"async"</span>);

  <span class="hljs-keyword">var</span> start = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span> (mode === <span class="hljs-string">"async"</span>) {
      <span class="hljs-keyword">this</span>.startWork();
    }
  }.bind(<span class="hljs-keyword">this</span>);

  _.series([
    <span class="hljs-keyword">this</span>.startConnections,
    <span class="hljs-keyword">this</span>.startDevices,
    start
  ], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, results</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">this</span>.log(<span class="hljs-string">"An error occured while trying to start the robot:"</span>);
      <span class="hljs-keyword">this</span>.log(err);

      <span class="hljs-keyword">this</span>.halt(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (_.isFunction(<span class="hljs-keyword">this</span>.error)) {
          <span class="hljs-keyword">this</span>.error.call(<span class="hljs-keyword">this</span>, err);
        }

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.listeners(<span class="hljs-string">"error"</span>).length) {
          <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">"error"</span>, err);
        }
      }.bind(<span class="hljs-keyword">this</span>));
    }

    <span class="hljs-keyword">if</span> (_.isFunction(callback)) {
      callback(err, results);
    }
  }.bind(<span class="hljs-keyword">this</span>));

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<div class="dox">
<div class="summary">
<p>Starts the Robot's work function</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.startWork = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">this</span>.log(<span class="hljs-string">"Working."</span>);

  <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">"ready"</span>, <span class="hljs-keyword">this</span>);
  <span class="hljs-keyword">this</span>.work.call(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>);
  <span class="hljs-keyword">this</span>.running = <span class="hljs-literal">true</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<div class="dox">
<div class="summary">
<p>Starts the Robot's connections</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">Function</span>
<span>function to be triggered after the connections are started
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.startConnections = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
  <span class="hljs-keyword">this</span>.log(<span class="hljs-string">"Starting connections."</span>);

  <span class="hljs-keyword">var</span> starters = _.map(<span class="hljs-keyword">this</span>.connections, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">conn</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.startConnection(conn, cb);
    }.bind(<span class="hljs-keyword">this</span>);
  }, <span class="hljs-keyword">this</span>);

  <span class="hljs-keyword">return</span> _.parallel(starters, callback);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<div class="dox">
<div class="summary">
<p>Starts a single connection on Robot</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">connection</span>
<span class="dox_type">Object</span>
<span>to start
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">Function</span>
<span>function to be triggered after the connection is started
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.startConnection = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">connection, callback</span>) </span>{
  <span class="hljs-keyword">if</span> (connection.connected === <span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">return</span> callback.call(connection);
  }

  <span class="hljs-keyword">var</span> str = <span class="hljs-string">"Starting connection '"</span> + connection.name + <span class="hljs-string">"'"</span>;

  <span class="hljs-keyword">if</span> (connection.host) {
    str += <span class="hljs-string">" on host "</span> + connection.host;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (connection.port) {
    str += <span class="hljs-string">" on port "</span> + connection.port;
  }

  <span class="hljs-keyword">this</span>.log(str + <span class="hljs-string">"."</span>);
  connection.connect.call(connection, callback);
  connection.connected = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<div class="dox">
<div class="summary">
<p>Starts the Robot's devices</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">Function</span>
<span>function to be triggered after the devices are started
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.startDevices = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
  <span class="hljs-keyword">var</span> log = <span class="hljs-keyword">this</span>.log;

  log(<span class="hljs-string">"Starting devices."</span>);

  <span class="hljs-keyword">var</span> starters = _.map(<span class="hljs-keyword">this</span>.devices, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">device</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.startDevice(device, cb);
    }.bind(<span class="hljs-keyword">this</span>);
  }, <span class="hljs-keyword">this</span>);

  <span class="hljs-keyword">return</span> _.parallel(starters, callback);
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<div class="dox">
<div class="summary">
<p>Starts a single device on Robot</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">device</span>
<span class="dox_type">Object</span>
<span>to start
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">Function</span>
<span>function to be triggered after the device is started
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.startDevice = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">device, callback</span>) </span>{
  <span class="hljs-keyword">if</span> (device.started === <span class="hljs-literal">true</span>) {
    <span class="hljs-keyword">return</span> callback.call(device);
  }

  <span class="hljs-keyword">var</span> log = <span class="hljs-keyword">this</span>.log;
  <span class="hljs-keyword">var</span> str = <span class="hljs-string">"Starting device '"</span> + device.name + <span class="hljs-string">"'"</span>;

  <span class="hljs-keyword">if</span> (device.pin) {
    str += <span class="hljs-string">" on pin "</span> + device.pin;
  }

  log(str + <span class="hljs-string">"."</span>);
  <span class="hljs-keyword">this</span>[device.name] = device;
  device.start.call(device, callback);
  device.started = <span class="hljs-literal">true</span>;

  <span class="hljs-keyword">return</span> device.started;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<div class="dox">
<div class="summary">
<p>Halts the Robot, attempting to gracefully stop devices and connections.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">Function</span>
<span>to be triggered when the Robot has stopped
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.halt = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
  callback = callback || <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{};

  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.running) {
    <span class="hljs-keyword">return</span> callback();
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>ensures callback(err) won't prevent others from halting</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wrap</span>(<span class="hljs-params">fn</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{ fn.call(<span class="hljs-literal">null</span>, cb.bind(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>)); };
  }

  <span class="hljs-keyword">var</span> devices = _.pluck(<span class="hljs-keyword">this</span>.devices, <span class="hljs-string">"halt"</span>).map(wrap),
      connections = _.pluck(<span class="hljs-keyword">this</span>.connections, <span class="hljs-string">"disconnect"</span>).map(wrap);

  <span class="hljs-keyword">try</span> {
    _.parallel(devices, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      _.parallel(connections, callback);
    });
  } <span class="hljs-keyword">catch</span> (e) {
    <span class="hljs-keyword">var</span> msg = <span class="hljs-string">"An error occured while attempting to safely halt the robot"</span>;
    <span class="hljs-keyword">this</span>.log(msg);
    <span class="hljs-keyword">this</span>.log(e.message);
  }

  <span class="hljs-keyword">this</span>.running = <span class="hljs-literal">false</span>;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<div class="dox">
<div class="summary">
<p>Generates a String representation of a Robot</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span class="dox_type">String</span>
<span>representation of a Robot
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">Robot.prototype.toString = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">"[Robot name='"</span> + <span class="hljs-keyword">this</span>.name + <span class="hljs-string">"']"</span>;
};

Robot.prototype.log = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
  Logger.log(<span class="hljs-string">"["</span> + <span class="hljs-keyword">this</span>.name + <span class="hljs-string">"] - "</span> + str);
};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
