<!DOCTYPE html>
<html>
<head>
  <title>collision.markdown</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node_modules/cylon-sphero/examples/collision/collision.markdown";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#sphero-collisions">Sphero Collisions</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="sphero-collisions">
  <h1>
    <a href="#sphero-collisions" name="sphero-collisions" class="pilcrow"></a>
Sphero Collisions
  </h1>
</div>
<p>For this Cylon example, we're going to set up a Sphero such that it will change
it's color and roll in a random direction when it has a collision.</p>
<p>Before we get started, make sure you have the <code>cylon-sphero</code> module installed.</p>
<p>First, let's load up Cylon:</p>
<pre><code>var Cylon = require('cylon');
</code></pre>
<p>With that loaded, we can begin defining our robot.</p>
<pre><code>Cylon.robot({
</code></pre>
<p>We're going to have one connection, and one device for this robot, both the same
Sphero.</p>
<pre><code>  connections: {
    sphero: { adaptor: 'sphero', port: '/dev/rfcomm0' }
  },

  devices: {
    sphero: { driver: 'sphero' }
  },
</code></pre>
<p>With the necessary hardware defined, we can now start telling Cylon about the
work our robot will be performing.</p>
<pre><code>  work: function(me) {
</code></pre>
<p>We'll assign some variables here for later, a basic color for our sphero and
a variable we'll use for a bitwise math operation later.</p>
<pre><code>    var color = 0x00FF00,
        bitFilter = 0xFFFF00;

    console.log(&quot;Setting up Collision Detection...&quot;);
</code></pre>
<p>We add a listener on <code>collision</code>, since we want to be notified when our Sphero detects a collision.</p>
<pre><code>    me.sphero.on('collision', function(data) {
      console.log(&quot;Collision:&quot;);
</code></pre>
<p>We get the new color for a Sphero by doing a bitwise XOR operation on it, using
the bitfilter above.</p>
<pre><code>      color = color ^ bitFilter;
</code></pre>
<p>With our new color in hand, we can let the user know what color we're using now,
and change the Sphero to that color. We'll also tell the Sphero to roll in
a random direction, at speed 90.</p>
<pre><code>      console.log(&quot;Color: &quot; + (color.toString(16)) + &quot; &quot;);
      me.sphero.color(color);
      me.sphero.roll(90, Math.floor(Math.random() * 360));
    });
  }
</code></pre>
<p>Once the <code>collision</code> listener is been added, we change the color and start detecting collisions.</p>
<pre><code>  me.sphero.color(color);
  me.sphero.detectCollisions();
</code></pre>
<p>And with all that said and done, we can now start the robot.</p>
<pre><code>}).start();
</code></pre>
</div>
  </div>
</body>
</html>
