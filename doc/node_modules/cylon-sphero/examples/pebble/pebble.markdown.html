<!DOCTYPE html>
<html>
<head>
  <title>pebble.markdown</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node_modules/cylon-sphero/examples/pebble/pebble.markdown";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#sphero-+-pebble">Sphero + Pebble</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="sphero-+-pebble">
  <h1>
    <a href="#sphero-+-pebble" name="sphero-+-pebble" class="pilcrow"></a>
Sphero + Pebble
  </h1>
</div>
<p>For this Cylon example, we're going to hook up to a Sphero,
and control it using pebble accelerometer.</p>
<p>Before we get started, make sure you've got the <code>cylon-sphero</code> module installed.</p>
<p>To get started, let's import the Cylon module:</p>
<pre><code>var Cylon = require('cylon');
</code></pre>
<p>Then we setup API to listen on port 8080:</p>
<pre><code>Cylon.api({
  host: '0.0.0.0',
  port: '8080',
  ssl:  false
});
</code></pre>
<p>With that set up, we can start defining our robot:</p>
<pre><code>Cylon.robot({
</code></pre>
<p>We setup connections an devices for sphero and pebble:</p>
<pre><code>connections: {
  sphero: { adaptor: 'sphero', port: '/dev/tty.Sphero-YBW-RN-SPP' },
  pebble: { adaptor: 'pebble' }
},

devices: {
  sphero: { driver: 'sphero' },
  pebble: { driver: 'pebble' }
},
</code></pre>
<p>Then we create and set variable heading and speed to 0:</p>
<pre><code>heading: 0,
speed:  0,
</code></pre>
<p>And now we can start defining our robot's work.</p>
<pre><code>work: function(my) {
</code></pre>
<p>Every second we will change update sphero direction using calculated heading value:</p>
<pre><code>every((0.1).second(), function() {
  my.sphero.roll(100, my.heading);
});
</code></pre>
<p>When we receive data from pebble accelerometer we calculate new heading value:</p>
<pre><code>my.pebble.on('accel', function(data) {
  values = data.split(&quot;,&quot;);
  x      = values[0];
  y      = values[1];


  my.speed   = Math.round(Math.max(Math.abs(x)/6, Math.abs(y)/6));
  my.heading = Math.round(((180.0 - (Math.atan2(y,x) * (180.0 / Math.PI)))));
});
</code></pre>
<p>And with all that done, we can finally start the robot.</p>
<pre><code>}).start();
</code></pre>
</div>
  </div>
</body>
</html>
