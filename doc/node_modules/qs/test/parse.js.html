<!DOCTYPE html>
<html>
<head>
  <title>parse.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/qs/test/parse.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>parse.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">var</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>);
<span class="hljs-keyword">var</span> qs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../'</span>);
<span class="hljs-keyword">var</span> iconv = <span class="hljs-built_in">require</span>(<span class="hljs-string">'iconv-lite'</span>);

test(<span class="hljs-string">'parse()'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
    t.test(<span class="hljs-string">'parses a simple string'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'0=foo'</span>), { <span class="hljs-string">'0'</span>: <span class="hljs-string">'foo'</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo=c++'</span>), { <span class="hljs-attr">foo</span>: <span class="hljs-string">'c  '</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[&gt;=]=23'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'&gt;='</span>: <span class="hljs-string">'23'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[&lt;=&gt;]==23'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'&lt;=&gt;'</span>: <span class="hljs-string">'=23'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[==]=23'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'=='</span>: <span class="hljs-string">'23'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo'</span>, { <span class="hljs-attr">strictNullHandling</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: <span class="hljs-literal">null</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo'</span>), { <span class="hljs-attr">foo</span>: <span class="hljs-string">''</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo='</span>), { <span class="hljs-attr">foo</span>: <span class="hljs-string">''</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo=bar'</span>), { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">' foo = bar = baz '</span>), { <span class="hljs-string">' foo '</span>: <span class="hljs-string">' bar = baz '</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo=bar=baz'</span>), { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar=baz'</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo=bar&amp;bar=baz'</span>), { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span>, <span class="hljs-attr">bar</span>: <span class="hljs-string">'baz'</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo2=bar2&amp;baz2='</span>), { <span class="hljs-attr">foo2</span>: <span class="hljs-string">'bar2'</span>, <span class="hljs-attr">baz2</span>: <span class="hljs-string">''</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo=bar&amp;baz'</span>, { <span class="hljs-attr">strictNullHandling</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span>, <span class="hljs-attr">baz</span>: <span class="hljs-literal">null</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo=bar&amp;baz'</span>), { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span>, <span class="hljs-attr">baz</span>: <span class="hljs-string">''</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'cht=p3&amp;chd=t:60,40&amp;chs=250x100&amp;chl=Hello|World'</span>), {
            <span class="hljs-attr">cht</span>: <span class="hljs-string">'p3'</span>,
            <span class="hljs-attr">chd</span>: <span class="hljs-string">'t:60,40'</span>,
            <span class="hljs-attr">chs</span>: <span class="hljs-string">'250x100'</span>,
            <span class="hljs-attr">chl</span>: <span class="hljs-string">'Hello|World'</span>
        });
        st.end();
    });

    t.test(<span class="hljs-string">'allows enabling dot notation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a.b=c'</span>), { <span class="hljs-string">'a.b'</span>: <span class="hljs-string">'c'</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'a.b=c'</span>, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: <span class="hljs-string">'c'</span> } });
        st.end();
    });

    t.deepEqual(qs.parse(<span class="hljs-string">'a[b]=c'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: <span class="hljs-string">'c'</span> } }, <span class="hljs-string">'parses a single nested string'</span>);
    t.deepEqual(qs.parse(<span class="hljs-string">'a[b][c]=d'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: { <span class="hljs-attr">c</span>: <span class="hljs-string">'d'</span> } } }, <span class="hljs-string">'parses a double nested string'</span>);
    t.deepEqual(
        qs.parse(<span class="hljs-string">'a[b][c][d][e][f][g][h]=i'</span>),
        { <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: { <span class="hljs-attr">c</span>: { <span class="hljs-attr">d</span>: { <span class="hljs-attr">e</span>: { <span class="hljs-attr">f</span>: { <span class="hljs-string">'[g][h]'</span>: <span class="hljs-string">'i'</span> } } } } } } },
        <span class="hljs-string">'defaults to a depth of 5'</span>
    );

    t.test(<span class="hljs-string">'only parses one level when depth = 1'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[b][c]=d'</span>, { <span class="hljs-attr">depth</span>: <span class="hljs-number">1</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: { <span class="hljs-string">'[c]'</span>: <span class="hljs-string">'d'</span> } } });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[b][c][d]=e'</span>, { <span class="hljs-attr">depth</span>: <span class="hljs-number">1</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: { <span class="hljs-string">'[c][d]'</span>: <span class="hljs-string">'e'</span> } } });
        st.end();
    });

    t.deepEqual(qs.parse(<span class="hljs-string">'a=b&amp;a=c'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] }, <span class="hljs-string">'parses a simple array'</span>);

    t.test(<span class="hljs-string">'parses an explicit array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[]=b'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[]=b&amp;a[]=c'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[]=b&amp;a[]=c&amp;a[]=d'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>] });
        st.end();
    });

    t.test(<span class="hljs-string">'parses a mix of simple and explicit arrays'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a=b&amp;a[]=c'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[]=b&amp;a=c'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[0]=b&amp;a=c'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a=b&amp;a[0]=c'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[1]=b&amp;a=c'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a=b&amp;a[1]=c'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] });
        st.end();
    });

    t.test(<span class="hljs-string">'parses a nested array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[b][]=c&amp;a[b][]=d'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: [<span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>] } });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[&gt;=]=25'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'&gt;='</span>: <span class="hljs-string">'25'</span> } });
        st.end();
    });

    t.test(<span class="hljs-string">'allows to specify array indices'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[1]=c&amp;a[0]=b&amp;a[2]=d'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">'d'</span>] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[1]=c&amp;a[0]=b'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[1]=c'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'c'</span>] });
        st.end();
    });

    t.test(<span class="hljs-string">'limits specific array indices to 20'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[20]=a'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'a'</span>] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[21]=a'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'21'</span>: <span class="hljs-string">'a'</span> } });
        st.end();
    });

    t.deepEqual(qs.parse(<span class="hljs-string">'a[12b]=c'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'12b'</span>: <span class="hljs-string">'c'</span> } }, <span class="hljs-string">'supports keys that begin with a number'</span>);

    t.test(<span class="hljs-string">'supports encoded = signs'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'he%3Dllo=th%3Dere'</span>), { <span class="hljs-string">'he=llo'</span>: <span class="hljs-string">'th=ere'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'is ok with url encoded strings'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[b%20c]=d'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'b c'</span>: <span class="hljs-string">'d'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[b]=c%20d'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: <span class="hljs-string">'c d'</span> } });
        st.end();
    });

    t.test(<span class="hljs-string">'allows brackets in the value'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'pets=["tobi"]'</span>), { <span class="hljs-attr">pets</span>: <span class="hljs-string">'["tobi"]'</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'operators=["&gt;=", "&lt;="]'</span>), { <span class="hljs-attr">operators</span>: <span class="hljs-string">'["&gt;=", "&lt;="]'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'allows empty values'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">''</span>), {});
        st.deepEqual(qs.parse(<span class="hljs-literal">null</span>), {});
        st.deepEqual(qs.parse(<span class="hljs-literal">undefined</span>), {});
        st.end();
    });

    t.test(<span class="hljs-string">'transforms arrays to objects'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[0]=bar&amp;foo[bad]=baz'</span>), { <span class="hljs-attr">foo</span>: { <span class="hljs-string">'0'</span>: <span class="hljs-string">'bar'</span>, <span class="hljs-attr">bad</span>: <span class="hljs-string">'baz'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[bad]=baz&amp;foo[0]=bar'</span>), { <span class="hljs-attr">foo</span>: { <span class="hljs-attr">bad</span>: <span class="hljs-string">'baz'</span>, <span class="hljs-string">'0'</span>: <span class="hljs-string">'bar'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[bad]=baz&amp;foo[]=bar'</span>), { <span class="hljs-attr">foo</span>: { <span class="hljs-attr">bad</span>: <span class="hljs-string">'baz'</span>, <span class="hljs-string">'0'</span>: <span class="hljs-string">'bar'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[]=bar&amp;foo[bad]=baz'</span>), { <span class="hljs-attr">foo</span>: { <span class="hljs-string">'0'</span>: <span class="hljs-string">'bar'</span>, <span class="hljs-attr">bad</span>: <span class="hljs-string">'baz'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[bad]=baz&amp;foo[]=bar&amp;foo[]=foo'</span>), { <span class="hljs-attr">foo</span>: { <span class="hljs-attr">bad</span>: <span class="hljs-string">'baz'</span>, <span class="hljs-string">'0'</span>: <span class="hljs-string">'bar'</span>, <span class="hljs-string">'1'</span>: <span class="hljs-string">'foo'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[0][a]=a&amp;foo[0][b]=b&amp;foo[1][a]=aa&amp;foo[1][b]=bb'</span>), { <span class="hljs-attr">foo</span>: [{ <span class="hljs-attr">a</span>: <span class="hljs-string">'a'</span>, <span class="hljs-attr">b</span>: <span class="hljs-string">'b'</span> }, { <span class="hljs-attr">a</span>: <span class="hljs-string">'aa'</span>, <span class="hljs-attr">b</span>: <span class="hljs-string">'bb'</span> }] });

        st.deepEqual(qs.parse(<span class="hljs-string">'a[]=b&amp;a[t]=u&amp;a[hasOwnProperty]=c'</span>, { <span class="hljs-attr">allowPrototypes</span>: <span class="hljs-literal">false</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'0'</span>: <span class="hljs-string">'b'</span>, <span class="hljs-attr">c</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">t</span>: <span class="hljs-string">'u'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[]=b&amp;a[t]=u&amp;a[hasOwnProperty]=c'</span>, { <span class="hljs-attr">allowPrototypes</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'0'</span>: <span class="hljs-string">'b'</span>, <span class="hljs-attr">t</span>: <span class="hljs-string">'u'</span>, <span class="hljs-attr">hasOwnProperty</span>: <span class="hljs-string">'c'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[]=b&amp;a[hasOwnProperty]=c&amp;a[x]=y'</span>, { <span class="hljs-attr">allowPrototypes</span>: <span class="hljs-literal">false</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'0'</span>: <span class="hljs-string">'b'</span>, <span class="hljs-string">'1'</span>: <span class="hljs-string">'c'</span>, <span class="hljs-attr">x</span>: <span class="hljs-string">'y'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[]=b&amp;a[hasOwnProperty]=c&amp;a[x]=y'</span>, { <span class="hljs-attr">allowPrototypes</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'0'</span>: <span class="hljs-string">'b'</span>, <span class="hljs-attr">hasOwnProperty</span>: <span class="hljs-string">'c'</span>, <span class="hljs-attr">x</span>: <span class="hljs-string">'y'</span> } });
        st.end();
    });

    t.test(<span class="hljs-string">'transforms arrays to objects (dot notation)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[0].baz=bar&amp;fool.bad=baz'</span>, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: [{ <span class="hljs-attr">baz</span>: <span class="hljs-string">'bar'</span> }], <span class="hljs-attr">fool</span>: { <span class="hljs-attr">bad</span>: <span class="hljs-string">'baz'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[0].baz=bar&amp;fool.bad.boo=baz'</span>, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: [{ <span class="hljs-attr">baz</span>: <span class="hljs-string">'bar'</span> }], <span class="hljs-attr">fool</span>: { <span class="hljs-attr">bad</span>: { <span class="hljs-attr">boo</span>: <span class="hljs-string">'baz'</span> } } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[0][0].baz=bar&amp;fool.bad=baz'</span>, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: [[{ <span class="hljs-attr">baz</span>: <span class="hljs-string">'bar'</span> }]], <span class="hljs-attr">fool</span>: { <span class="hljs-attr">bad</span>: <span class="hljs-string">'baz'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[0].baz[0]=15&amp;foo[0].bar=2'</span>, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: [{ <span class="hljs-attr">baz</span>: [<span class="hljs-string">'15'</span>], <span class="hljs-attr">bar</span>: <span class="hljs-string">'2'</span> }] });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[0].baz[0]=15&amp;foo[0].baz[1]=16&amp;foo[0].bar=2'</span>, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: [{ <span class="hljs-attr">baz</span>: [<span class="hljs-string">'15'</span>, <span class="hljs-string">'16'</span>], <span class="hljs-attr">bar</span>: <span class="hljs-string">'2'</span> }] });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo.bad=baz&amp;foo[0]=bar'</span>, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: { <span class="hljs-attr">bad</span>: <span class="hljs-string">'baz'</span>, <span class="hljs-string">'0'</span>: <span class="hljs-string">'bar'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo.bad=baz&amp;foo[]=bar'</span>, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: { <span class="hljs-attr">bad</span>: <span class="hljs-string">'baz'</span>, <span class="hljs-string">'0'</span>: <span class="hljs-string">'bar'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[]=bar&amp;foo.bad=baz'</span>, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: { <span class="hljs-string">'0'</span>: <span class="hljs-string">'bar'</span>, <span class="hljs-attr">bad</span>: <span class="hljs-string">'baz'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo.bad=baz&amp;foo[]=bar&amp;foo[]=foo'</span>, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: { <span class="hljs-attr">bad</span>: <span class="hljs-string">'baz'</span>, <span class="hljs-string">'0'</span>: <span class="hljs-string">'bar'</span>, <span class="hljs-string">'1'</span>: <span class="hljs-string">'foo'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo[0].a=a&amp;foo[0].b=b&amp;foo[1].a=aa&amp;foo[1].b=bb'</span>, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">foo</span>: [{ <span class="hljs-attr">a</span>: <span class="hljs-string">'a'</span>, <span class="hljs-attr">b</span>: <span class="hljs-string">'b'</span> }, { <span class="hljs-attr">a</span>: <span class="hljs-string">'aa'</span>, <span class="hljs-attr">b</span>: <span class="hljs-string">'bb'</span> }] });
        st.end();
    });

    t.deepEqual(qs.parse(<span class="hljs-string">'a[b]=c&amp;a=d'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: <span class="hljs-string">'c'</span>, <span class="hljs-attr">d</span>: <span class="hljs-literal">true</span> } }, <span class="hljs-string">'can add keys to objects'</span>);

    t.test(<span class="hljs-string">'correctly prunes undefined values when converting an array to an object'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[2]=b&amp;a[99999999]=c'</span>), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'2'</span>: <span class="hljs-string">'b'</span>, <span class="hljs-string">'99999999'</span>: <span class="hljs-string">'c'</span> } });
        st.end();
    });

    t.test(<span class="hljs-string">'supports malformed uri characters'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'{%:%}'</span>, { <span class="hljs-attr">strictNullHandling</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-string">'{%:%}'</span>: <span class="hljs-literal">null</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'{%:%}='</span>), { <span class="hljs-string">'{%:%}'</span>: <span class="hljs-string">''</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'foo=%:%}'</span>), { <span class="hljs-attr">foo</span>: <span class="hljs-string">'%:%}'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'doesn\'t produce empty keys'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'_r=1&amp;'</span>), { <span class="hljs-string">'_r'</span>: <span class="hljs-string">'1'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'cannot access Object prototype'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        qs.parse(<span class="hljs-string">'constructor[prototype][bad]=bad'</span>);
        qs.parse(<span class="hljs-string">'bad[constructor][prototype][bad]=bad'</span>);
        st.equal(<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">Object</span>.prototype.bad, <span class="hljs-string">'undefined'</span>);
        st.end();
    });

    t.test(<span class="hljs-string">'parses arrays of objects'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[][b]=c'</span>), { <span class="hljs-attr">a</span>: [{ <span class="hljs-attr">b</span>: <span class="hljs-string">'c'</span> }] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[0][b]=c'</span>), { <span class="hljs-attr">a</span>: [{ <span class="hljs-attr">b</span>: <span class="hljs-string">'c'</span> }] });
        st.end();
    });

    t.test(<span class="hljs-string">'allows for empty strings in arrays'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[]=b&amp;a[]=&amp;a[]=c'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'c'</span>] });

        st.deepEqual(
            qs.parse(<span class="hljs-string">'a[0]=b&amp;a[1]&amp;a[2]=c&amp;a[19]='</span>, { <span class="hljs-attr">strictNullHandling</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">arrayLimit</span>: <span class="hljs-number">20</span> }),
            { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">''</span>] },
            <span class="hljs-string">'with arrayLimit 20 + array indices: null then empty string works'</span>
        );
        st.deepEqual(
            qs.parse(<span class="hljs-string">'a[]=b&amp;a[]&amp;a[]=c&amp;a[]='</span>, { <span class="hljs-attr">strictNullHandling</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">arrayLimit</span>: <span class="hljs-number">0</span> }),
            { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'c'</span>, <span class="hljs-string">''</span>] },
            <span class="hljs-string">'with arrayLimit 0 + array brackets: null then empty string works'</span>
        );

        st.deepEqual(
            qs.parse(<span class="hljs-string">'a[0]=b&amp;a[1]=&amp;a[2]=c&amp;a[19]'</span>, { <span class="hljs-attr">strictNullHandling</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">arrayLimit</span>: <span class="hljs-number">20</span> }),
            { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'c'</span>, <span class="hljs-literal">null</span>] },
            <span class="hljs-string">'with arrayLimit 20 + array indices: empty string then null works'</span>
        );
        st.deepEqual(
            qs.parse(<span class="hljs-string">'a[]=b&amp;a[]=&amp;a[]=c&amp;a[]'</span>, { <span class="hljs-attr">strictNullHandling</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">arrayLimit</span>: <span class="hljs-number">0</span> }),
            { <span class="hljs-attr">a</span>: [<span class="hljs-string">'b'</span>, <span class="hljs-string">''</span>, <span class="hljs-string">'c'</span>, <span class="hljs-literal">null</span>] },
            <span class="hljs-string">'with arrayLimit 0 + array brackets: empty string then null works'</span>
        );

        st.deepEqual(
            qs.parse(<span class="hljs-string">'a[]=&amp;a[]=b&amp;a[]=c'</span>),
            { <span class="hljs-attr">a</span>: [<span class="hljs-string">''</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>] },
            <span class="hljs-string">'array brackets: empty strings work'</span>
        );
        st.end();
    });

    t.test(<span class="hljs-string">'compacts sparse arrays'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[10]=1&amp;a[2]=2'</span>), { <span class="hljs-attr">a</span>: [<span class="hljs-string">'2'</span>, <span class="hljs-string">'1'</span>] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[1][b][2][c]=1'</span>), { <span class="hljs-attr">a</span>: [{ <span class="hljs-attr">b</span>: [{ <span class="hljs-attr">c</span>: <span class="hljs-string">'1'</span> }] }] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[1][2][3][c]=1'</span>), { <span class="hljs-attr">a</span>: [[[{ <span class="hljs-attr">c</span>: <span class="hljs-string">'1'</span> }]]] });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[1][2][3][c][1]=1'</span>), { <span class="hljs-attr">a</span>: [[[{ <span class="hljs-attr">c</span>: [<span class="hljs-string">'1'</span>] }]]] });
        st.end();
    });

    t.test(<span class="hljs-string">'parses semi-parsed strings'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse({ <span class="hljs-string">'a[b]'</span>: <span class="hljs-string">'c'</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: <span class="hljs-string">'c'</span> } });
        st.deepEqual(qs.parse({ <span class="hljs-string">'a[b]'</span>: <span class="hljs-string">'c'</span>, <span class="hljs-string">'a[d]'</span>: <span class="hljs-string">'e'</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-attr">b</span>: <span class="hljs-string">'c'</span>, <span class="hljs-attr">d</span>: <span class="hljs-string">'e'</span> } });
        st.end();
    });

    t.test(<span class="hljs-string">'parses buffers correctly'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> b = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">'test'</span>);
        st.deepEqual(qs.parse({ <span class="hljs-attr">a</span>: b }), { <span class="hljs-attr">a</span>: b });
        st.end();
    });

    t.test(<span class="hljs-string">'continues parsing when no parent is found'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'[]=&amp;a=b'</span>), { <span class="hljs-string">'0'</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">a</span>: <span class="hljs-string">'b'</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'[]&amp;a=b'</span>, { <span class="hljs-attr">strictNullHandling</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-string">'0'</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">a</span>: <span class="hljs-string">'b'</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'[foo]=bar'</span>), { <span class="hljs-attr">foo</span>: <span class="hljs-string">'bar'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'does not error when parsing a very long array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> str = <span class="hljs-string">'a[]=a'</span>;
        <span class="hljs-keyword">while</span> (Buffer.byteLength(str) &lt; <span class="hljs-number">128</span> * <span class="hljs-number">1024</span>) {
            str = str + <span class="hljs-string">'&amp;'</span> + str;
        }

        st.doesNotThrow(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ qs.parse(str); });

        st.end();
    });

    t.test(<span class="hljs-string">'should not throw when a native prototype has an enumerable property'</span>, { <span class="hljs-attr">parallel</span>: <span class="hljs-literal">false</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-built_in">Object</span>.prototype.crash = <span class="hljs-string">''</span>;
        <span class="hljs-built_in">Array</span>.prototype.crash = <span class="hljs-string">''</span>;
        st.doesNotThrow(qs.parse.bind(<span class="hljs-literal">null</span>, <span class="hljs-string">'a=b'</span>));
        st.deepEqual(qs.parse(<span class="hljs-string">'a=b'</span>), { <span class="hljs-attr">a</span>: <span class="hljs-string">'b'</span> });
        st.doesNotThrow(qs.parse.bind(<span class="hljs-literal">null</span>, <span class="hljs-string">'a[][b]=c'</span>));
        st.deepEqual(qs.parse(<span class="hljs-string">'a[][b]=c'</span>), { <span class="hljs-attr">a</span>: [{ <span class="hljs-attr">b</span>: <span class="hljs-string">'c'</span> }] });
        <span class="hljs-keyword">delete</span> <span class="hljs-built_in">Object</span>.prototype.crash;
        <span class="hljs-keyword">delete</span> <span class="hljs-built_in">Array</span>.prototype.crash;
        st.end();
    });

    t.test(<span class="hljs-string">'parses a string with an alternative string delimiter'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a=b;c=d'</span>, { <span class="hljs-attr">delimiter</span>: <span class="hljs-string">';'</span> }), { <span class="hljs-attr">a</span>: <span class="hljs-string">'b'</span>, <span class="hljs-attr">c</span>: <span class="hljs-string">'d'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'parses a string with an alternative RegExp delimiter'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a=b; c=d'</span>, { <span class="hljs-attr">delimiter</span>: <span class="hljs-regexp">/[;,] */</span> }), { <span class="hljs-attr">a</span>: <span class="hljs-string">'b'</span>, <span class="hljs-attr">c</span>: <span class="hljs-string">'d'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'does not use non-splittable objects as delimiters'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a=b&amp;c=d'</span>, { <span class="hljs-attr">delimiter</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">a</span>: <span class="hljs-string">'b'</span>, <span class="hljs-attr">c</span>: <span class="hljs-string">'d'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'allows overriding parameter limit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a=b&amp;c=d'</span>, { <span class="hljs-attr">parameterLimit</span>: <span class="hljs-number">1</span> }), { <span class="hljs-attr">a</span>: <span class="hljs-string">'b'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'allows setting the parameter limit to Infinity'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a=b&amp;c=d'</span>, { <span class="hljs-attr">parameterLimit</span>: <span class="hljs-literal">Infinity</span> }), { <span class="hljs-attr">a</span>: <span class="hljs-string">'b'</span>, <span class="hljs-attr">c</span>: <span class="hljs-string">'d'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'allows overriding array limit'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[0]=b'</span>, { <span class="hljs-attr">arrayLimit</span>: <span class="hljs-number">-1</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'0'</span>: <span class="hljs-string">'b'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[-1]=b'</span>, { <span class="hljs-attr">arrayLimit</span>: <span class="hljs-number">-1</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'-1'</span>: <span class="hljs-string">'b'</span> } });
        st.deepEqual(qs.parse(<span class="hljs-string">'a[0]=b&amp;a[1]=c'</span>, { <span class="hljs-attr">arrayLimit</span>: <span class="hljs-number">0</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'0'</span>: <span class="hljs-string">'b'</span>, <span class="hljs-string">'1'</span>: <span class="hljs-string">'c'</span> } });
        st.end();
    });

    t.test(<span class="hljs-string">'allows disabling array parsing'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[0]=b&amp;a[1]=c'</span>, { <span class="hljs-attr">parseArrays</span>: <span class="hljs-literal">false</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-string">'0'</span>: <span class="hljs-string">'b'</span>, <span class="hljs-string">'1'</span>: <span class="hljs-string">'c'</span> } });
        st.end();
    });

    t.test(<span class="hljs-string">'parses an object'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> input = {
            <span class="hljs-string">'user[name]'</span>: { <span class="hljs-string">'pop[bob]'</span>: <span class="hljs-number">3</span> },
            <span class="hljs-string">'user[email]'</span>: <span class="hljs-literal">null</span>
        };

        <span class="hljs-keyword">var</span> expected = {
            <span class="hljs-attr">user</span>: {
                <span class="hljs-attr">name</span>: { <span class="hljs-string">'pop[bob]'</span>: <span class="hljs-number">3</span> },
                <span class="hljs-attr">email</span>: <span class="hljs-literal">null</span>
            }
        };

        <span class="hljs-keyword">var</span> result = qs.parse(input);

        st.deepEqual(result, expected);
        st.end();
    });

    t.test(<span class="hljs-string">'parses an object in dot notation'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> input = {
            <span class="hljs-string">'user.name'</span>: { <span class="hljs-string">'pop[bob]'</span>: <span class="hljs-number">3</span> },
            <span class="hljs-string">'user.email.'</span>: <span class="hljs-literal">null</span>
        };

        <span class="hljs-keyword">var</span> expected = {
            <span class="hljs-attr">user</span>: {
                <span class="hljs-attr">name</span>: { <span class="hljs-string">'pop[bob]'</span>: <span class="hljs-number">3</span> },
                <span class="hljs-attr">email</span>: <span class="hljs-literal">null</span>
            }
        };

        <span class="hljs-keyword">var</span> result = qs.parse(input, { <span class="hljs-attr">allowDots</span>: <span class="hljs-literal">true</span> });

        st.deepEqual(result, expected);
        st.end();
    });

    t.test(<span class="hljs-string">'parses an object and not child values'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> input = {
            <span class="hljs-string">'user[name]'</span>: { <span class="hljs-string">'pop[bob]'</span>: { <span class="hljs-string">'test'</span>: <span class="hljs-number">3</span> } },
            <span class="hljs-string">'user[email]'</span>: <span class="hljs-literal">null</span>
        };

        <span class="hljs-keyword">var</span> expected = {
            <span class="hljs-attr">user</span>: {
                <span class="hljs-attr">name</span>: { <span class="hljs-string">'pop[bob]'</span>: { <span class="hljs-string">'test'</span>: <span class="hljs-number">3</span> } },
                <span class="hljs-attr">email</span>: <span class="hljs-literal">null</span>
            }
        };

        <span class="hljs-keyword">var</span> result = qs.parse(input);

        st.deepEqual(result, expected);
        st.end();
    });

    t.test(<span class="hljs-string">'does not blow up when Buffer global is missing'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> tempBuffer = global.Buffer;
        <span class="hljs-keyword">delete</span> global.Buffer;
        <span class="hljs-keyword">var</span> result = qs.parse(<span class="hljs-string">'a=b&amp;c=d'</span>);
        global.Buffer = tempBuffer;
        st.deepEqual(result, { <span class="hljs-attr">a</span>: <span class="hljs-string">'b'</span>, <span class="hljs-attr">c</span>: <span class="hljs-string">'d'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'does not crash when parsing circular references'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> a = {};
        a.b = a;

        <span class="hljs-keyword">var</span> parsed;

        st.doesNotThrow(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            parsed = qs.parse({ <span class="hljs-string">'foo[bar]'</span>: <span class="hljs-string">'baz'</span>, <span class="hljs-string">'foo[baz]'</span>: a });
        });

        st.equal(<span class="hljs-string">'foo'</span> <span class="hljs-keyword">in</span> parsed, <span class="hljs-literal">true</span>, <span class="hljs-string">'parsed has "foo" property'</span>);
        st.equal(<span class="hljs-string">'bar'</span> <span class="hljs-keyword">in</span> parsed.foo, <span class="hljs-literal">true</span>);
        st.equal(<span class="hljs-string">'baz'</span> <span class="hljs-keyword">in</span> parsed.foo, <span class="hljs-literal">true</span>);
        st.equal(parsed.foo.bar, <span class="hljs-string">'baz'</span>);
        st.deepEqual(parsed.foo.baz, a);
        st.end();
    });

    t.test(<span class="hljs-string">'parses plain objects correctly'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> a = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
        a.b = <span class="hljs-string">'c'</span>;

        st.deepEqual(qs.parse(a), { <span class="hljs-attr">b</span>: <span class="hljs-string">'c'</span> });
        <span class="hljs-keyword">var</span> result = qs.parse({ <span class="hljs-attr">a</span>: a });
        st.equal(<span class="hljs-string">'a'</span> <span class="hljs-keyword">in</span> result, <span class="hljs-literal">true</span>, <span class="hljs-string">'result has "a" property'</span>);
        st.deepEqual(result.a, a);
        st.end();
    });

    t.test(<span class="hljs-string">'parses dates correctly'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> now = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
        st.deepEqual(qs.parse({ <span class="hljs-attr">a</span>: now }), { <span class="hljs-attr">a</span>: now });
        st.end();
    });

    t.test(<span class="hljs-string">'parses regular expressions correctly'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> re = <span class="hljs-regexp">/^test$/</span>;
        st.deepEqual(qs.parse({ <span class="hljs-attr">a</span>: re }), { <span class="hljs-attr">a</span>: re });
        st.end();
    });

    t.test(<span class="hljs-string">'can allow overwriting prototype properties'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'a[hasOwnProperty]=b'</span>, { <span class="hljs-attr">allowPrototypes</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">a</span>: { <span class="hljs-attr">hasOwnProperty</span>: <span class="hljs-string">'b'</span> } }, { <span class="hljs-attr">prototype</span>: <span class="hljs-literal">false</span> });
        st.deepEqual(qs.parse(<span class="hljs-string">'hasOwnProperty=b'</span>, { <span class="hljs-attr">allowPrototypes</span>: <span class="hljs-literal">true</span> }), { <span class="hljs-attr">hasOwnProperty</span>: <span class="hljs-string">'b'</span> }, { <span class="hljs-attr">prototype</span>: <span class="hljs-literal">false</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'can return plain objects'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        <span class="hljs-keyword">var</span> expected = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
        expected.a = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
        expected.a.b = <span class="hljs-string">'c'</span>;
        expected.a.hasOwnProperty = <span class="hljs-string">'d'</span>;
        st.deepEqual(qs.parse(<span class="hljs-string">'a[b]=c&amp;a[hasOwnProperty]=d'</span>, { <span class="hljs-attr">plainObjects</span>: <span class="hljs-literal">true</span> }), expected);
        st.deepEqual(qs.parse(<span class="hljs-literal">null</span>, { <span class="hljs-attr">plainObjects</span>: <span class="hljs-literal">true</span> }), <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>));
        <span class="hljs-keyword">var</span> expectedArray = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
        expectedArray.a = <span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>);
        expectedArray.a[<span class="hljs-string">'0'</span>] = <span class="hljs-string">'b'</span>;
        expectedArray.a.c = <span class="hljs-string">'d'</span>;
        st.deepEqual(qs.parse(<span class="hljs-string">'a[]=b&amp;a[c]=d'</span>, { <span class="hljs-attr">plainObjects</span>: <span class="hljs-literal">true</span> }), expectedArray);
        st.end();
    });

    t.test(<span class="hljs-string">'can parse with custom encoding'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.deepEqual(qs.parse(<span class="hljs-string">'%8c%a7=%91%e5%8d%e3%95%7b'</span>, {
            <span class="hljs-attr">decoder</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">str</span>) </span>{
                <span class="hljs-keyword">var</span> reg = <span class="hljs-regexp">/\%([0-9A-F]{2})/ig</span>;
                <span class="hljs-keyword">var</span> result = [];
                <span class="hljs-keyword">var</span> parts;
                <span class="hljs-keyword">var</span> last = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">while</span> (parts = reg.exec(str)) {
                    result.push(<span class="hljs-built_in">parseInt</span>(parts[<span class="hljs-number">1</span>], <span class="hljs-number">16</span>));
                    last = parts.index + parts[<span class="hljs-number">0</span>].length;
                }
                <span class="hljs-keyword">return</span> iconv.decode(<span class="hljs-keyword">new</span> Buffer(result), <span class="hljs-string">'shift_jis'</span>).toString();
            }
        }), { 県: <span class="hljs-string">'大阪府'</span> });
        st.end();
    });

    t.test(<span class="hljs-string">'throws error with wrong decoder'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">st</span>) </span>{
        st.throws(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            qs.parse({}, {
                <span class="hljs-attr">decoder</span>: <span class="hljs-string">'string'</span>
            });
        }, <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'Decoder has to be a function.'</span>));
        st.end();
    });
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
