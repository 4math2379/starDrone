<!DOCTYPE html>
<html>
<head>
  <title>dashdash.bash_completion.in</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/dashdash/etc/dashdash.bash_completion.in";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#this-is-a-bash-completion-file-for-the-name-command.you-can-install">
This is a Bash completion file for the &#39;{{name}}&#39; command. You can install</a>
      </div>

      <div class="heading h1">
        <a href="#with-either">with either:</a>
      </div>

      <div class="heading h1">
        <a href="#cp-file-usrlocaletcbash_completion.dname-mac">
cp FILE /usr/local/etc/bash_completion.d/{{name}}   # Mac</a>
      </div>

      <div class="heading h1">
        <a href="#cp-file-etcbash_completion.dname-linux">cp FILE /etc/bash_completion.d/{{name}}             # Linux</a>
      </div>

      <div class="heading h1">
        <a href="#or">
or:</a>
      </div>

      <div class="heading h1">
        <a href="#cp-file-greater-~.name.completion">
cp FILE &amp;gt; ~/.{{name}}.completion</a>
      </div>

      <div class="heading h1">
        <a href="#echo-source-~.name.completion-greatergreater-~.bashrc">echo &amp;quot;source ~/.{{name}}.completion&amp;quot; &amp;gt;&amp;gt; ~/.bashrc</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>dashdash.bash_completion.in</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="sh"><span class="hljs-meta">#!/bin/bash
</span></pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Bash completion generated for '{{name}}' at {{date}}.</p>
<p>The original template lives here:
https://github.com/trentm/node-dashdash/blob/master/etc/dashdash.bash_completion.in</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Copyright 2016 Trent Mick
Copyright 2016 Joyent, Inc.</p>
<p>A generic Bash completion driver script.</p>
<p>This is meant to provide a re-usable chunk of Bash to use for
&quot;etc/bash_completion.d/&quot; files for individual tools. Only the &quot;Configuration&quot;
section with tool-specific info need differ. Features:</p>
<ul>
<li>support for short and long opts</li>
<li>support for knowing which options take arguments</li>
<li>support for subcommands (e.g. 'git log <TAB>' to show just options for the
log subcommand)</li>
<li>does the right thing with &quot;--&quot; to stop options</li>
<li>custom optarg and arg types for custom completions</li>
<li>(TODO) support for shells other than Bash (tcsh, zsh, fish?, etc.)</li>
</ul>
<p>Examples/design:</p>
<ol>
<li>
<p>Bash &quot;default&quot; completion. By default Bash's 'complete -o default' is
enabled. That means when there are no completions (e.g. if no opts match
the current word), then you'll get Bash's default completion. Most notably
that means you get filename completion. E.g.:
$ tool ./<TAB>
$ tool READ<TAB></p>
</li>
<li>
<p>all opts and subcmds:
$ tool <TAB>
$ tool -v <TAB>     # assuming '-v' doesn't take an arg
$ tool -<TAB>       # matching opts
$ git lo<TAB>       # matching subcmds</p>
<p>Long opt completions are given <em>without</em> the '=', i.e. we prefer space
separated because that's easier for good completions.</p>
</li>
<li>
<p>long opt arg with '='
$ tool --file=<TAB>
$ tool --file=./d<TAB>
We maintain the &quot;--file=&quot; prefix. Limitation: With the attached prefix
the 'complete -o filenames' doesn't know to do dirname '/' suffixing. Meh.</p>
</li>
<li>
<p>envvars:
$ tool $<TAB>
$ tool $P<TAB>
Limitation: Currently only getting exported vars, so we miss &quot;PS1&quot; and
others.</p>
</li>
<li>
<p>Defer to other completion in a subshell:
$ tool --file $(cat ./<TAB>
We get this from 'complete -o default ...'.</p>
</li>
<li>
<p>Custom completion types from a provided bash function.
$ tool --profile <TAB>        # complete available &quot;profiles&quot;</p>
</li>
</ol>
<p>Dev Notes:</p>
<ul>
<li>compgen notes, from http://unix.stackexchange.com/questions/151118/understand-compgen-builtin-command</li>
<li>https://www.gnu.org/software/bash/manual/html_node/Programmable-Completion-Builtins.html</li>
</ul>

        </td>
        <td class="code highlight">
          <pre class="sh">

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Debugging this completion:</p>
<ol>
<li>Uncomment the &quot;_{{name}}_log_file=...&quot; line.</li>
<li>'tail -f /var/tmp/dashdash-completion.log' in one terminal.</li>
<li>Re-source this bash completion file.
_{{name}}_log=/var/tmp/dashdash-completion.log</li>
</ol>

        </td>
        <td class="code highlight">
          <pre class="sh">
<span class="hljs-keyword">function</span> _{{name}}_completer {

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>---- cmd definition</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
    {{spec}}


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>---- locals</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
    <span class="hljs-built_in">declare</span> <span class="hljs-_">-a</span> argv


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>---- support functions</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
    <span class="hljs-keyword">function</span> trace {
        [[ -n <span class="hljs-string">"<span class="hljs-variable">$_</span>{{name}}_log"</span> ]] &amp;&amp; <span class="hljs-built_in">echo</span> <span class="hljs-string">"$*"</span> &gt;&amp;2
    }

    <span class="hljs-keyword">function</span> _dashdash_complete {
        <span class="hljs-built_in">local</span> idx context
        idx=<span class="hljs-variable">$1</span>
        context=<span class="hljs-variable">$2</span>

        <span class="hljs-built_in">local</span> shortopts longopts optargs subcmds allsubcmds argtypes
        shortopts=<span class="hljs-string">"<span class="hljs-variable">$(eval "echo \${cmd${context}_shortopts}")</span>"</span>
        longopts=<span class="hljs-string">"<span class="hljs-variable">$(eval "echo \${cmd${context}_longopts}")</span>"</span>
        optargs=<span class="hljs-string">"<span class="hljs-variable">$(eval "echo \${cmd${context}_optargs}")</span>"</span>
        subcmds=<span class="hljs-string">"<span class="hljs-variable">$(eval "echo \${cmd${context}_subcmds}")</span>"</span>
        allsubcmds=<span class="hljs-string">"<span class="hljs-variable">$(eval "echo \${cmd${context}_allsubcmds}")</span>"</span>
        IFS=<span class="hljs-string">', '</span> <span class="hljs-built_in">read</span> -r <span class="hljs-_">-a</span> argtypes &lt;&lt;&lt; <span class="hljs-string">"<span class="hljs-variable">$(eval "echo \${cmd${context}_argtypes}")</span>"</span>

        trace <span class="hljs-string">""</span>
        trace <span class="hljs-string">"_dashdash_complete(idx=<span class="hljs-variable">$idx</span>, context=<span class="hljs-variable">$context</span>)"</span>
        trace <span class="hljs-string">"  shortopts: <span class="hljs-variable">$shortopts</span>"</span>
        trace <span class="hljs-string">"  longopts: <span class="hljs-variable">$longopts</span>"</span>
        trace <span class="hljs-string">"  optargs: <span class="hljs-variable">$optargs</span>"</span>
        trace <span class="hljs-string">"  subcmds: <span class="hljs-variable">$subcmds</span>"</span>
        trace <span class="hljs-string">"  allsubcmds: <span class="hljs-variable">$allsubcmds</span>"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Get 'state' of option parsing at this COMP_POINT.
Copying &quot;dashdash.js#parse()&quot; behaviour here.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">        <span class="hljs-built_in">local</span> state=
        <span class="hljs-built_in">local</span> nargs=0
        <span class="hljs-built_in">local</span> i=<span class="hljs-variable">$idx</span>
        <span class="hljs-built_in">local</span> argtype
        <span class="hljs-built_in">local</span> optname
        <span class="hljs-built_in">local</span> prefix
        <span class="hljs-built_in">local</span> word
        <span class="hljs-built_in">local</span> dashdashseen=
        <span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$i</span> <span class="hljs-_">-lt</span> <span class="hljs-variable">$len</span> &amp;&amp; <span class="hljs-variable">$i</span> -le <span class="hljs-variable">$COMP_CWORD</span> ]]; <span class="hljs-keyword">do</span>
            argtype=
            optname=
            prefix=
            word=

            arg=<span class="hljs-variable">${argv[$i]}</span>
            trace <span class="hljs-string">"  consider argv[<span class="hljs-variable">$i</span>]: '<span class="hljs-variable">$arg</span>'"</span>

            <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$arg</span>"</span> == <span class="hljs-string">"--"</span> &amp;&amp; <span class="hljs-variable">$i</span> <span class="hljs-_">-lt</span> <span class="hljs-variable">$COMP_CWORD</span> ]]; <span class="hljs-keyword">then</span>
                trace <span class="hljs-string">"    dashdash seen"</span>
                dashdashseen=yes
                state=arg
                word=<span class="hljs-variable">$arg</span>
            <span class="hljs-keyword">elif</span> [[ -z <span class="hljs-string">"<span class="hljs-variable">$dashdashseen</span>"</span> &amp;&amp; <span class="hljs-string">"<span class="hljs-variable">${arg:0:2}</span>"</span> == <span class="hljs-string">"--"</span> ]]; <span class="hljs-keyword">then</span>
                arg=<span class="hljs-variable">${arg:2}</span>
                <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$arg</span>"</span> == *<span class="hljs-string">"="</span>* ]]; <span class="hljs-keyword">then</span>
                    optname=<span class="hljs-variable">${arg%%=*}</span>
                    val=<span class="hljs-variable">${arg##*=}</span>
                    trace <span class="hljs-string">"    long opt: optname='<span class="hljs-variable">$optname</span>' val='<span class="hljs-variable">$val</span>'"</span>
                    state=arg
                    argtype=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$optargs</span>"</span> | awk -F <span class="hljs-string">"-<span class="hljs-variable">$optname</span>="</span> <span class="hljs-string">'{print $2}'</span> | cut <span class="hljs-_">-d</span><span class="hljs-string">' '</span> <span class="hljs-_">-f</span>1)
                    word=<span class="hljs-variable">$val</span>
                    prefix=<span class="hljs-string">"--<span class="hljs-variable">$optname</span>="</span>
                <span class="hljs-keyword">else</span>
                    optname=<span class="hljs-variable">$arg</span>
                    val=
                    trace <span class="hljs-string">"    long opt: optname='<span class="hljs-variable">$optname</span>'"</span>
                    state=longopt
                    word=--<span class="hljs-variable">$optname</span>

                    <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$optargs</span>"</span> == *<span class="hljs-string">"-<span class="hljs-variable">$optname</span>="</span>* &amp;&amp; <span class="hljs-variable">$i</span> <span class="hljs-_">-lt</span> <span class="hljs-variable">$COMP_CWORD</span> ]]; <span class="hljs-keyword">then</span>
                        i=$(( <span class="hljs-variable">$i</span> + 1 ))
                        state=arg
                        argtype=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$optargs</span>"</span> | awk -F <span class="hljs-string">"-<span class="hljs-variable">$optname</span>="</span> <span class="hljs-string">'{print $2}'</span> | cut <span class="hljs-_">-d</span><span class="hljs-string">' '</span> <span class="hljs-_">-f</span>1)
                        word=<span class="hljs-variable">${argv[$i]}</span>
                        trace <span class="hljs-string">"    takes arg (consume argv[<span class="hljs-variable">$i</span>], word='<span class="hljs-variable">$word</span>')"</span>
                    <span class="hljs-keyword">fi</span>
                <span class="hljs-keyword">fi</span>
            <span class="hljs-keyword">elif</span> [[ -z <span class="hljs-string">"<span class="hljs-variable">$dashdashseen</span>"</span> &amp;&amp; <span class="hljs-string">"<span class="hljs-variable">${arg:0:1}</span>"</span> == <span class="hljs-string">"-"</span> ]]; <span class="hljs-keyword">then</span>
                trace <span class="hljs-string">"    short opt group"</span>
                state=shortopt
                word=<span class="hljs-variable">$arg</span>

                <span class="hljs-built_in">local</span> j=1
                <span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$j</span> <span class="hljs-_">-lt</span> <span class="hljs-variable">${#arg}</span> ]]; <span class="hljs-keyword">do</span>
                    optname=<span class="hljs-variable">${arg:$j:1}</span>
                    trace <span class="hljs-string">"    consider index <span class="hljs-variable">$j</span>: optname '<span class="hljs-variable">$optname</span>'"</span>

                    <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">$optargs</span>"</span> == *<span class="hljs-string">"-<span class="hljs-variable">$optname</span>="</span>* ]]; <span class="hljs-keyword">then</span>
                        argtype=$(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$optargs</span>"</span> | awk -F <span class="hljs-string">"-<span class="hljs-variable">$optname</span>="</span> <span class="hljs-string">'{print $2}'</span> | cut <span class="hljs-_">-d</span><span class="hljs-string">' '</span> <span class="hljs-_">-f</span>1)
                        <span class="hljs-keyword">if</span> [[ $(( <span class="hljs-variable">$j</span> + 1 )) <span class="hljs-_">-lt</span> <span class="hljs-variable">${#arg}</span> ]]; <span class="hljs-keyword">then</span>
                            state=arg
                            word=<span class="hljs-variable">${arg:$(( $j + 1 ))}</span>
                            trace <span class="hljs-string">"      takes arg (rest of this arg, word='<span class="hljs-variable">$word</span>', argtype='<span class="hljs-variable">$argtype</span>')"</span>
                        <span class="hljs-keyword">elif</span> [[ <span class="hljs-variable">$i</span> <span class="hljs-_">-lt</span> <span class="hljs-variable">$COMP_CWORD</span> ]]; <span class="hljs-keyword">then</span>
                            state=arg
                            i=$(( <span class="hljs-variable">$i</span> + 1 ))
                            word=<span class="hljs-variable">${argv[$i]}</span>
                            trace <span class="hljs-string">"    takes arg (word='<span class="hljs-variable">$word</span>', argtype='<span class="hljs-variable">$argtype</span>')"</span>
                        <span class="hljs-keyword">fi</span>
                        <span class="hljs-built_in">break</span>
                    <span class="hljs-keyword">fi</span>

                    j=$(( <span class="hljs-variable">$j</span> + 1 ))
                <span class="hljs-keyword">done</span>
            <span class="hljs-keyword">elif</span> [[ <span class="hljs-variable">$i</span> <span class="hljs-_">-lt</span> <span class="hljs-variable">$COMP_CWORD</span> &amp;&amp; -n <span class="hljs-string">"<span class="hljs-variable">$arg</span>"</span> ]] &amp;&amp; $(<span class="hljs-built_in">echo</span> <span class="hljs-string">"<span class="hljs-variable">$allsubcmds</span>"</span> | grep -w <span class="hljs-string">"<span class="hljs-variable">$arg</span>"</span> &gt;/dev/null); <span class="hljs-keyword">then</span>
                trace <span class="hljs-string">"    complete subcmd: recurse _dashdash_complete"</span>
                _dashdash_complete $(( <span class="hljs-variable">$i</span> + 1 )) <span class="hljs-string">"<span class="hljs-variable">${context}</span>__<span class="hljs-variable">${arg/-/_}</span>"</span>
                <span class="hljs-built_in">return</span>
            <span class="hljs-keyword">else</span>
                trace <span class="hljs-string">"    not an opt or a complete subcmd"</span>
                state=arg
                word=<span class="hljs-variable">$arg</span>
                nargs=$(( <span class="hljs-variable">$nargs</span> + 1 ))
                <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">${#argtypes[@]}</span> <span class="hljs-_">-gt</span> 0 ]]; <span class="hljs-keyword">then</span>
                    argtype=<span class="hljs-string">"<span class="hljs-variable">${argtypes[$(( $nargs - 1 ))]}</span>"</span>
                    <span class="hljs-keyword">if</span> [[ -z <span class="hljs-string">"<span class="hljs-variable">$argtype</span>"</span> ]]; <span class="hljs-keyword">then</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>If we have more args than argtypes, we use the
last type.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">                        argtype=<span class="hljs-string">"<span class="hljs-variable">${argtypes[@]: -1:1}</span>"</span>
                    <span class="hljs-keyword">fi</span>
                <span class="hljs-keyword">fi</span>
            <span class="hljs-keyword">fi</span>

            trace <span class="hljs-string">"    state=<span class="hljs-variable">$state</span> prefix='<span class="hljs-variable">$prefix</span>' word='<span class="hljs-variable">$word</span>'"</span>
            i=$(( <span class="hljs-variable">$i</span> + 1 ))
        <span class="hljs-keyword">done</span>

        trace <span class="hljs-string">"  parsed: state=<span class="hljs-variable">$state</span> optname='<span class="hljs-variable">$optname</span>' argtype='<span class="hljs-variable">$argtype</span>' prefix='<span class="hljs-variable">$prefix</span>' word='<span class="hljs-variable">$word</span>' dashdashseen=<span class="hljs-variable">$dashdashseen</span>"</span>
        <span class="hljs-built_in">local</span> compgen_opts=
        <span class="hljs-keyword">if</span> [[ -n <span class="hljs-string">"<span class="hljs-variable">$prefix</span>"</span> ]]; <span class="hljs-keyword">then</span>
            compgen_opts=<span class="hljs-string">"<span class="hljs-variable">$compgen_opts</span> -P <span class="hljs-variable">$prefix</span>"</span>
        <span class="hljs-keyword">fi</span>

        <span class="hljs-keyword">case</span> <span class="hljs-variable">$state</span> <span class="hljs-keyword">in</span>
        shortopt)
            compgen <span class="hljs-variable">$compgen_opts</span> -W <span class="hljs-string">"<span class="hljs-variable">$shortopts</span> <span class="hljs-variable">$longopts</span>"</span> -- <span class="hljs-string">"<span class="hljs-variable">$word</span>"</span>
            ;;
        longopt)
            compgen <span class="hljs-variable">$compgen_opts</span> -W <span class="hljs-string">"<span class="hljs-variable">$longopts</span>"</span> -- <span class="hljs-string">"<span class="hljs-variable">$word</span>"</span>
            ;;
        arg)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>If we don't know what completion to do, then emit nothing. We
expect that we are running with:
complete -o default ...
where &quot;default&quot; means: &quot;Use Readline's default completion if
the compspec generates no matches.&quot; This gives us the good filename
completion, completion in subshells/backticks.</p>
<p>We cannot support an argtype=&quot;directory&quot; because
compgen -S '/' -A directory -- &quot;$word&quot;
doesn't give a satisfying result. It doesn't stop at the trailing '/'
so you cannot descend into dirs.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">            <span class="hljs-keyword">if</span> [[ <span class="hljs-string">"<span class="hljs-variable">${word:0:1}</span>"</span> == <span class="hljs-string">'$'</span> ]]; <span class="hljs-keyword">then</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>By default, Bash will complete '$<TAB>' to all envvars. Apparently
'complete -o default' does <em>not</em> give us that. The following
gets <em>close</em> to the same completions: '-A export' misses envvars
like &quot;PS1&quot;.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">                trace <span class="hljs-string">"  completing envvars"</span>
                compgen <span class="hljs-variable">$compgen_opts</span> -P <span class="hljs-string">'$'</span> -A <span class="hljs-built_in">export</span> -- <span class="hljs-string">"<span class="hljs-variable">${word:1}</span>"</span>
            <span class="hljs-keyword">elif</span> [[ -z <span class="hljs-string">"<span class="hljs-variable">$argtype</span>"</span> ]]; <span class="hljs-keyword">then</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Only include opts in completions if $word is not empty.
This is to avoid completing the leading '-', which foils
using 'default' completion.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">                <span class="hljs-keyword">if</span> [[ -n <span class="hljs-string">"<span class="hljs-variable">$dashdashseen</span>"</span> ]]; <span class="hljs-keyword">then</span>
                    trace <span class="hljs-string">"  completing subcmds, if any (no argtype, dashdash seen)"</span>
                    compgen <span class="hljs-variable">$compgen_opts</span> -W <span class="hljs-string">"<span class="hljs-variable">$subcmds</span>"</span> -- <span class="hljs-string">"<span class="hljs-variable">$word</span>"</span>
                <span class="hljs-keyword">elif</span> [[ -z <span class="hljs-string">"<span class="hljs-variable">$word</span>"</span> ]]; <span class="hljs-keyword">then</span>
                    trace <span class="hljs-string">"  completing subcmds, if any (no argtype, empty word)"</span>
                    compgen <span class="hljs-variable">$compgen_opts</span> -W <span class="hljs-string">"<span class="hljs-variable">$subcmds</span>"</span> -- <span class="hljs-string">"<span class="hljs-variable">$word</span>"</span>
                <span class="hljs-keyword">else</span>
                    trace <span class="hljs-string">"  completing opts &amp; subcmds (no argtype)"</span>
                    compgen <span class="hljs-variable">$compgen_opts</span> -W <span class="hljs-string">"<span class="hljs-variable">$shortopts</span> <span class="hljs-variable">$longopts</span> <span class="hljs-variable">$subcmds</span>"</span> -- <span class="hljs-string">"<span class="hljs-variable">$word</span>"</span>
                <span class="hljs-keyword">fi</span>
            <span class="hljs-keyword">elif</span> [[ <span class="hljs-variable">$argtype</span> == <span class="hljs-string">"none"</span> ]]; <span class="hljs-keyword">then</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>We want <em>no</em> completions, i.e. some way to get the active
'complete -o default' to not do filename completion.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">                trace <span class="hljs-string">"  completing 'none' (hack to imply no completions)"</span>
                <span class="hljs-built_in">echo</span> <span class="hljs-string">"##-no completions-##"</span>
            <span class="hljs-keyword">elif</span> [[ <span class="hljs-variable">$argtype</span> == <span class="hljs-string">"file"</span> ]]; <span class="hljs-keyword">then</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>'complete -o default' gives the best filename completion, at least
on Mac.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">                trace <span class="hljs-string">"  completing 'file' (let 'complete -o default' handle it)"</span>
                <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
            <span class="hljs-keyword">elif</span> ! <span class="hljs-built_in">type</span> complete_<span class="hljs-variable">$argtype</span> 2&gt;/dev/null &gt;/dev/null; <span class="hljs-keyword">then</span>
                trace <span class="hljs-string">"  completing '<span class="hljs-variable">$argtype</span>' (fallback to default b/c complete_<span class="hljs-variable">$argtype</span> is unknown)"</span>
                <span class="hljs-built_in">echo</span> <span class="hljs-string">""</span>
            <span class="hljs-keyword">else</span>
                trace <span class="hljs-string">"  completing custom '<span class="hljs-variable">$argtype</span>'"</span>
                completions=$(complete_<span class="hljs-variable">$argtype</span> <span class="hljs-string">"<span class="hljs-variable">$word</span>"</span>)
                <span class="hljs-keyword">if</span> [[ -z <span class="hljs-string">"<span class="hljs-variable">$completions</span>"</span> ]]; <span class="hljs-keyword">then</span>
                    trace <span class="hljs-string">"  no custom '<span class="hljs-variable">$argtype</span>' completions"</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>These are in alpha order so they show up correctly.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">                    <span class="hljs-built_in">echo</span> <span class="hljs-string">"##-no -<span class="hljs-variable">$argtype</span>- completions-##"</span>
                <span class="hljs-keyword">else</span>
                    <span class="hljs-built_in">echo</span> <span class="hljs-variable">$completions</span>
                <span class="hljs-keyword">fi</span>
            <span class="hljs-keyword">fi</span>
            ;;
        *)
            trace <span class="hljs-string">"  unknown state: <span class="hljs-variable">$state</span>"</span>
            ;;
        <span class="hljs-keyword">esac</span>
    }


    trace <span class="hljs-string">""</span>
    trace <span class="hljs-string">"-- <span class="hljs-variable">$(date)</span>"</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>trace &quot;$IFS: '$IFS'&quot;
trace &quot;$@: '$@'&quot;
trace &quot;COMP_WORDBREAKS: '$COMP_WORDBREAKS'&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="sh">    trace <span class="hljs-string">"COMP_CWORD: '<span class="hljs-variable">$COMP_CWORD</span>'"</span>
    trace <span class="hljs-string">"COMP_LINE: '<span class="hljs-variable">$COMP_LINE</span>'"</span>
    trace <span class="hljs-string">"COMP_POINT: <span class="hljs-variable">$COMP_POINT</span>"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>Guard against negative COMP_CWORD. This is a Bash bug at least on
Mac 10.10.4's bash. See
<a href="https://lists.gnu.org/archive/html/bug-bash/2009-07/msg00125.html">https://lists.gnu.org/archive/html/bug-bash/2009-07/msg00125.html</a>.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">    <span class="hljs-keyword">if</span> [[ <span class="hljs-variable">$COMP_CWORD</span> <span class="hljs-_">-lt</span> 0 ]]; <span class="hljs-keyword">then</span>
        trace <span class="hljs-string">"abort on negative COMP_CWORD"</span>
        <span class="hljs-built_in">exit</span> 1;
    <span class="hljs-keyword">fi</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>I don't know how to do array manip on argv vars,
so copy over to argv array to work on them.</p>

        </td>
        <td class="code highlight">
          <pre class="sh">    <span class="hljs-built_in">shift</span>   <span class="hljs-comment"># the leading '--'</span>
    i=0
    len=<span class="hljs-variable">$#</span>
    <span class="hljs-keyword">while</span> [[ <span class="hljs-variable">$#</span> <span class="hljs-_">-gt</span> 0 ]]; <span class="hljs-keyword">do</span>
        argv[<span class="hljs-variable">$i</span>]=<span class="hljs-variable">$1</span>
        <span class="hljs-built_in">shift</span>;
        i=$(( <span class="hljs-variable">$i</span> + 1 ))
    <span class="hljs-keyword">done</span>
    trace <span class="hljs-string">"argv: '<span class="hljs-variable">${argv[@]}</span>'"</span>
    trace <span class="hljs-string">"argv[COMP_CWORD-1]: '<span class="hljs-variable">${argv[$(( $COMP_CWORD - 1 ))]}</span>'"</span>
    trace <span class="hljs-string">"argv[COMP_CWORD]: '<span class="hljs-variable">${argv[$COMP_CWORD]}</span>'"</span>
    trace <span class="hljs-string">"argv len: '<span class="hljs-variable">$len</span>'"</span>

    _dashdash_complete 1 <span class="hljs-string">""</span>
}


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>---- mainline</p>

        </td>
        <td class="code highlight">
          <pre class="sh">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>Note: This if-block to help work with 'compdef' and 'compctl' is
adapted from 'npm completion'.</p>

        </td>
        <td class="code highlight">
          <pre class="sh"><span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> complete &amp;&gt;/dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">function</span> _{{name}}_completion {
        <span class="hljs-built_in">local</span> _log_file=/dev/null
        [[ -z <span class="hljs-string">"<span class="hljs-variable">$_</span>{{name}}_log"</span> ]] || _log_file=<span class="hljs-string">"<span class="hljs-variable">$_</span>{{name}}_log"</span>
        COMPREPLY=($(COMP_CWORD=<span class="hljs-string">"<span class="hljs-variable">$COMP_CWORD</span>"</span> \
            COMP_LINE=<span class="hljs-string">"<span class="hljs-variable">$COMP_LINE</span>"</span> \
            COMP_POINT=<span class="hljs-string">"<span class="hljs-variable">$COMP_POINT</span>"</span> \
            _{{name}}_completer -- <span class="hljs-string">"<span class="hljs-variable">${COMP_WORDS[@]}</span>"</span> \
            2&gt;<span class="hljs-variable">$_log_file</span>)) || <span class="hljs-built_in">return</span> $?
    }
    complete -o default -F _{{name}}_completion {{name}}
<span class="hljs-keyword">elif</span> <span class="hljs-built_in">type</span> compdef &amp;&gt;/dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">function</span> _{{name}}_completion {
        <span class="hljs-built_in">local</span> _log_file=/dev/null
        [[ -z <span class="hljs-string">"<span class="hljs-variable">$_</span>{{name}}_log"</span> ]] || _log_file=<span class="hljs-string">"<span class="hljs-variable">$_</span>{{name}}_log"</span>
        compadd -- $(COMP_CWORD=$((CURRENT-1)) \
            COMP_LINE=<span class="hljs-variable">$BUFFER</span> \
            COMP_POINT=0 \
            _{{name}}_completer -- <span class="hljs-string">"<span class="hljs-variable">${words[@]}</span>"</span> \
            2&gt;<span class="hljs-variable">$_log_file</span>)
    }
    compdef _{{name}}_completion {{name}}
<span class="hljs-keyword">elif</span> <span class="hljs-built_in">type</span> <span class="hljs-built_in">compctl</span> &amp;&gt;/dev/null; <span class="hljs-keyword">then</span>
    <span class="hljs-keyword">function</span> _{{name}}_completion {
        <span class="hljs-built_in">local</span> cword line point words si
        <span class="hljs-built_in">read</span> -Ac words
        <span class="hljs-built_in">read</span> -cn cword
        <span class="hljs-built_in">let</span> cword-=1
        <span class="hljs-built_in">read</span> <span class="hljs-_">-l</span> line
        <span class="hljs-built_in">read</span> -ln point
        <span class="hljs-built_in">local</span> _log_file=/dev/null
        [[ -z <span class="hljs-string">"<span class="hljs-variable">$_</span>{{name}}_log"</span> ]] || _log_file=<span class="hljs-string">"<span class="hljs-variable">$_</span>{{name}}_log"</span>
        reply=($(COMP_CWORD=<span class="hljs-string">"<span class="hljs-variable">$cword</span>"</span> \
            COMP_LINE=<span class="hljs-string">"<span class="hljs-variable">$line</span>"</span> \
            COMP_POINT=<span class="hljs-string">"<span class="hljs-variable">$point</span>"</span> \
            _{{name}}_completer -- <span class="hljs-string">"<span class="hljs-variable">${words[@]}</span>"</span> \
            2&gt;<span class="hljs-variable">$_log_file</span>)) || <span class="hljs-built_in">return</span> $?
    }
    <span class="hljs-built_in">compctl</span> -K _{{name}}_completion {{name}}
<span class="hljs-keyword">fi</span>


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap" id="this-is-a-bash-completion-file-for-the-name-command.you-can-install">
  <h1>
    <a href="#this-is-a-bash-completion-file-for-the-name-command.you-can-install" name="this-is-a-bash-completion-file-for-the-name-command.you-can-install" class="pilcrow"></a>
</h1>
<h1>This is a Bash completion file for the '{{name}}' command. You can install
  </h1>
</div>
<div class="pilwrap" id="with-either">
  <h1>
    <a href="#with-either" name="with-either" class="pilcrow"></a>
with either:
  </h1>
</div>
<div class="pilwrap" id="cp-file-usrlocaletcbash_completion.dname-mac">
  <h1>
    <a href="#cp-file-usrlocaletcbash_completion.dname-mac" name="cp-file-usrlocaletcbash_completion.dname-mac" class="pilcrow"></a>
</h1>
<h1>cp FILE /usr/local/etc/bash_completion.d/{{name}}   # Mac
  </h1>
</div>
<div class="pilwrap" id="cp-file-etcbash_completion.dname-linux">
  <h1>
    <a href="#cp-file-etcbash_completion.dname-linux" name="cp-file-etcbash_completion.dname-linux" class="pilcrow"></a>
cp FILE /etc/bash_completion.d/{{name}}             # Linux
  </h1>
</div>
<div class="pilwrap" id="or">
  <h1>
    <a href="#or" name="or" class="pilcrow"></a>
</h1>
<h1>or:
  </h1>
</div>
<div class="pilwrap" id="cp-file-greater-~.name.completion">
  <h1>
    <a href="#cp-file-greater-~.name.completion" name="cp-file-greater-~.name.completion" class="pilcrow"></a>
</h1>
<h1>cp FILE &gt; ~/.{{name}}.completion
  </h1>
</div>
<div class="pilwrap" id="echo-source-~.name.completion-greatergreater-~.bashrc">
  <h1>
    <a href="#echo-source-~.name.completion-greatergreater-~.bashrc" name="echo-source-~.name.completion-greatergreater-~.bashrc" class="pilcrow"></a>
echo &quot;source ~/.{{name}}.completion&quot; &gt;&gt; ~/.bashrc
  </h1>
</div>
<h1></h1>

        </td>
        <td class="code highlight">
          <pre class="sh"></pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
