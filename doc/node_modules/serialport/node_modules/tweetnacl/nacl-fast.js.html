<!DOCTYPE html>
<html>
<head>
  <title>nacl-fast.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node_modules/serialport/node_modules/tweetnacl/nacl-fast.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>nacl-fast.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">nacl</span>) </span>{
<span class="hljs-meta">'use strict'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Ported in 2014 by Dmitry Chestnykh and Devi Mandiri.
Public domain.</p>
<p>Implementation derived from TweetNaCl version 20140427.
See for details: http://tweetnacl.cr.yp.to/</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> gf = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">init</span>) </span>{
  <span class="hljs-keyword">var</span> i, r = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(<span class="hljs-number">16</span>);
  <span class="hljs-keyword">if</span> (init) <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; init.length; i++) r[i] = init[i];
  <span class="hljs-keyword">return</span> r;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Pluggable, initialized in high-level API below.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> randombytes = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-regexp">/* x, n */</span></span>) </span>{ <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'no PRNG'</span>); };

<span class="hljs-keyword">var</span> _0 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">16</span>);
<span class="hljs-keyword">var</span> _9 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>); _9[<span class="hljs-number">0</span>] = <span class="hljs-number">9</span>;

<span class="hljs-keyword">var</span> gf0 = gf(),
    gf1 = gf([<span class="hljs-number">1</span>]),
    _121665 = gf([<span class="hljs-number">0xdb41</span>, <span class="hljs-number">1</span>]),
    D = gf([<span class="hljs-number">0x78a3</span>, <span class="hljs-number">0x1359</span>, <span class="hljs-number">0x4dca</span>, <span class="hljs-number">0x75eb</span>, <span class="hljs-number">0xd8ab</span>, <span class="hljs-number">0x4141</span>, <span class="hljs-number">0x0a4d</span>, <span class="hljs-number">0x0070</span>, <span class="hljs-number">0xe898</span>, <span class="hljs-number">0x7779</span>, <span class="hljs-number">0x4079</span>, <span class="hljs-number">0x8cc7</span>, <span class="hljs-number">0xfe73</span>, <span class="hljs-number">0x2b6f</span>, <span class="hljs-number">0x6cee</span>, <span class="hljs-number">0x5203</span>]),
    D2 = gf([<span class="hljs-number">0xf159</span>, <span class="hljs-number">0x26b2</span>, <span class="hljs-number">0x9b94</span>, <span class="hljs-number">0xebd6</span>, <span class="hljs-number">0xb156</span>, <span class="hljs-number">0x8283</span>, <span class="hljs-number">0x149a</span>, <span class="hljs-number">0x00e0</span>, <span class="hljs-number">0xd130</span>, <span class="hljs-number">0xeef3</span>, <span class="hljs-number">0x80f2</span>, <span class="hljs-number">0x198e</span>, <span class="hljs-number">0xfce7</span>, <span class="hljs-number">0x56df</span>, <span class="hljs-number">0xd9dc</span>, <span class="hljs-number">0x2406</span>]),
    X = gf([<span class="hljs-number">0xd51a</span>, <span class="hljs-number">0x8f25</span>, <span class="hljs-number">0x2d60</span>, <span class="hljs-number">0xc956</span>, <span class="hljs-number">0xa7b2</span>, <span class="hljs-number">0x9525</span>, <span class="hljs-number">0xc760</span>, <span class="hljs-number">0x692c</span>, <span class="hljs-number">0xdc5c</span>, <span class="hljs-number">0xfdd6</span>, <span class="hljs-number">0xe231</span>, <span class="hljs-number">0xc0a4</span>, <span class="hljs-number">0x53fe</span>, <span class="hljs-number">0xcd6e</span>, <span class="hljs-number">0x36d3</span>, <span class="hljs-number">0x2169</span>]),
    Y = gf([<span class="hljs-number">0x6658</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>]),
    I = gf([<span class="hljs-number">0xa0b0</span>, <span class="hljs-number">0x4a0e</span>, <span class="hljs-number">0x1b27</span>, <span class="hljs-number">0xc4ee</span>, <span class="hljs-number">0xe478</span>, <span class="hljs-number">0xad2f</span>, <span class="hljs-number">0x1806</span>, <span class="hljs-number">0x2f43</span>, <span class="hljs-number">0xd7a7</span>, <span class="hljs-number">0x3dfb</span>, <span class="hljs-number">0x0099</span>, <span class="hljs-number">0x2b4d</span>, <span class="hljs-number">0xdf0b</span>, <span class="hljs-number">0x4fc1</span>, <span class="hljs-number">0x2480</span>, <span class="hljs-number">0x2b83</span>]);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ts64</span>(<span class="hljs-params">x, i, h, l</span>) </span>{
  x[i]   = (h &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">1</span>] = (h &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">2</span>] = (h &gt;&gt;  <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">3</span>] = h &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">4</span>] = (l &gt;&gt; <span class="hljs-number">24</span>)  &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">5</span>] = (l &gt;&gt; <span class="hljs-number">16</span>)  &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">6</span>] = (l &gt;&gt;  <span class="hljs-number">8</span>)  &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">7</span>] = l &amp; <span class="hljs-number">0xff</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vn</span>(<span class="hljs-params">x, xi, y, yi, n</span>) </span>{
  <span class="hljs-keyword">var</span> i,d = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) d |= x[xi+i]^y[yi+i];
  <span class="hljs-keyword">return</span> (<span class="hljs-number">1</span> &amp; ((d - <span class="hljs-number">1</span>) &gt;&gt;&gt; <span class="hljs-number">8</span>)) - <span class="hljs-number">1</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_verify_16</span>(<span class="hljs-params">x, xi, y, yi</span>) </span>{
  <span class="hljs-keyword">return</span> vn(x,xi,y,yi,<span class="hljs-number">16</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_verify_32</span>(<span class="hljs-params">x, xi, y, yi</span>) </span>{
  <span class="hljs-keyword">return</span> vn(x,xi,y,yi,<span class="hljs-number">32</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">core_salsa20</span>(<span class="hljs-params">o, p, k, c</span>) </span>{
  <span class="hljs-keyword">var</span> j0  = c[ <span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xff</span> | (c[ <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (c[ <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (c[ <span class="hljs-number">3</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j1  = k[ <span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xff</span> | (k[ <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[ <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[ <span class="hljs-number">3</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j2  = k[ <span class="hljs-number">4</span>] &amp; <span class="hljs-number">0xff</span> | (k[ <span class="hljs-number">5</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[ <span class="hljs-number">6</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[ <span class="hljs-number">7</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j3  = k[ <span class="hljs-number">8</span>] &amp; <span class="hljs-number">0xff</span> | (k[ <span class="hljs-number">9</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">10</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">11</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j4  = k[<span class="hljs-number">12</span>] &amp; <span class="hljs-number">0xff</span> | (k[<span class="hljs-number">13</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">14</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">15</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j5  = c[ <span class="hljs-number">4</span>] &amp; <span class="hljs-number">0xff</span> | (c[ <span class="hljs-number">5</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (c[ <span class="hljs-number">6</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (c[ <span class="hljs-number">7</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j6  = p[ <span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xff</span> | (p[ <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (p[ <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (p[ <span class="hljs-number">3</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j7  = p[ <span class="hljs-number">4</span>] &amp; <span class="hljs-number">0xff</span> | (p[ <span class="hljs-number">5</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (p[ <span class="hljs-number">6</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (p[ <span class="hljs-number">7</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j8  = p[ <span class="hljs-number">8</span>] &amp; <span class="hljs-number">0xff</span> | (p[ <span class="hljs-number">9</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (p[<span class="hljs-number">10</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (p[<span class="hljs-number">11</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j9  = p[<span class="hljs-number">12</span>] &amp; <span class="hljs-number">0xff</span> | (p[<span class="hljs-number">13</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (p[<span class="hljs-number">14</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (p[<span class="hljs-number">15</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j10 = c[ <span class="hljs-number">8</span>] &amp; <span class="hljs-number">0xff</span> | (c[ <span class="hljs-number">9</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (c[<span class="hljs-number">10</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (c[<span class="hljs-number">11</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j11 = k[<span class="hljs-number">16</span>] &amp; <span class="hljs-number">0xff</span> | (k[<span class="hljs-number">17</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">18</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">19</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j12 = k[<span class="hljs-number">20</span>] &amp; <span class="hljs-number">0xff</span> | (k[<span class="hljs-number">21</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">22</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">23</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j13 = k[<span class="hljs-number">24</span>] &amp; <span class="hljs-number">0xff</span> | (k[<span class="hljs-number">25</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">26</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">27</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j14 = k[<span class="hljs-number">28</span>] &amp; <span class="hljs-number">0xff</span> | (k[<span class="hljs-number">29</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">30</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">31</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j15 = c[<span class="hljs-number">12</span>] &amp; <span class="hljs-number">0xff</span> | (c[<span class="hljs-number">13</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (c[<span class="hljs-number">14</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (c[<span class="hljs-number">15</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>;

  <span class="hljs-keyword">var</span> x0 = j0, x1 = j1, x2 = j2, x3 = j3, x4 = j4, x5 = j5, x6 = j6, x7 = j7,
      x8 = j8, x9 = j9, x10 = j10, x11 = j11, x12 = j12, x13 = j13, x14 = j14,
      x15 = j15, u;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i += <span class="hljs-number">2</span>) {
    u = x0 + x12 | <span class="hljs-number">0</span>;
    x4 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x4 + x0 | <span class="hljs-number">0</span>;
    x8 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x8 + x4 | <span class="hljs-number">0</span>;
    x12 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x12 + x8 | <span class="hljs-number">0</span>;
    x0 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x5 + x1 | <span class="hljs-number">0</span>;
    x9 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x9 + x5 | <span class="hljs-number">0</span>;
    x13 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x13 + x9 | <span class="hljs-number">0</span>;
    x1 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x1 + x13 | <span class="hljs-number">0</span>;
    x5 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x10 + x6 | <span class="hljs-number">0</span>;
    x14 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x14 + x10 | <span class="hljs-number">0</span>;
    x2 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x2 + x14 | <span class="hljs-number">0</span>;
    x6 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x6 + x2 | <span class="hljs-number">0</span>;
    x10 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x15 + x11 | <span class="hljs-number">0</span>;
    x3 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x3 + x15 | <span class="hljs-number">0</span>;
    x7 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x7 + x3 | <span class="hljs-number">0</span>;
    x11 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x11 + x7 | <span class="hljs-number">0</span>;
    x15 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x0 + x3 | <span class="hljs-number">0</span>;
    x1 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x1 + x0 | <span class="hljs-number">0</span>;
    x2 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x2 + x1 | <span class="hljs-number">0</span>;
    x3 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x3 + x2 | <span class="hljs-number">0</span>;
    x0 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x5 + x4 | <span class="hljs-number">0</span>;
    x6 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x6 + x5 | <span class="hljs-number">0</span>;
    x7 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x7 + x6 | <span class="hljs-number">0</span>;
    x4 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x4 + x7 | <span class="hljs-number">0</span>;
    x5 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x10 + x9 | <span class="hljs-number">0</span>;
    x11 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x11 + x10 | <span class="hljs-number">0</span>;
    x8 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x8 + x11 | <span class="hljs-number">0</span>;
    x9 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x9 + x8 | <span class="hljs-number">0</span>;
    x10 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x15 + x14 | <span class="hljs-number">0</span>;
    x12 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x12 + x15 | <span class="hljs-number">0</span>;
    x13 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x13 + x12 | <span class="hljs-number">0</span>;
    x14 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x14 + x13 | <span class="hljs-number">0</span>;
    x15 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);
  }
   x0 =  x0 +  j0 | <span class="hljs-number">0</span>;
   x1 =  x1 +  j1 | <span class="hljs-number">0</span>;
   x2 =  x2 +  j2 | <span class="hljs-number">0</span>;
   x3 =  x3 +  j3 | <span class="hljs-number">0</span>;
   x4 =  x4 +  j4 | <span class="hljs-number">0</span>;
   x5 =  x5 +  j5 | <span class="hljs-number">0</span>;
   x6 =  x6 +  j6 | <span class="hljs-number">0</span>;
   x7 =  x7 +  j7 | <span class="hljs-number">0</span>;
   x8 =  x8 +  j8 | <span class="hljs-number">0</span>;
   x9 =  x9 +  j9 | <span class="hljs-number">0</span>;
  x10 = x10 + j10 | <span class="hljs-number">0</span>;
  x11 = x11 + j11 | <span class="hljs-number">0</span>;
  x12 = x12 + j12 | <span class="hljs-number">0</span>;
  x13 = x13 + j13 | <span class="hljs-number">0</span>;
  x14 = x14 + j14 | <span class="hljs-number">0</span>;
  x15 = x15 + j15 | <span class="hljs-number">0</span>;

  o[ <span class="hljs-number">0</span>] = x0 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">1</span>] = x0 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">2</span>] = x0 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">3</span>] = x0 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[ <span class="hljs-number">4</span>] = x1 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">5</span>] = x1 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">6</span>] = x1 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">7</span>] = x1 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[ <span class="hljs-number">8</span>] = x2 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">9</span>] = x2 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">10</span>] = x2 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">11</span>] = x2 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">12</span>] = x3 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">13</span>] = x3 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">14</span>] = x3 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">15</span>] = x3 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">16</span>] = x4 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">17</span>] = x4 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">18</span>] = x4 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">19</span>] = x4 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">20</span>] = x5 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">21</span>] = x5 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">22</span>] = x5 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">23</span>] = x5 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">24</span>] = x6 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">25</span>] = x6 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">26</span>] = x6 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">27</span>] = x6 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">28</span>] = x7 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">29</span>] = x7 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">30</span>] = x7 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">31</span>] = x7 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">32</span>] = x8 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">33</span>] = x8 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">34</span>] = x8 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">35</span>] = x8 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">36</span>] = x9 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">37</span>] = x9 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">38</span>] = x9 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">39</span>] = x9 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">40</span>] = x10 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">41</span>] = x10 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">42</span>] = x10 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">43</span>] = x10 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">44</span>] = x11 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">45</span>] = x11 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">46</span>] = x11 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">47</span>] = x11 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">48</span>] = x12 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">49</span>] = x12 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">50</span>] = x12 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">51</span>] = x12 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">52</span>] = x13 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">53</span>] = x13 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">54</span>] = x13 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">55</span>] = x13 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">56</span>] = x14 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">57</span>] = x14 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">58</span>] = x14 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">59</span>] = x14 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">60</span>] = x15 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">61</span>] = x15 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">62</span>] = x15 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">63</span>] = x15 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">core_hsalsa20</span>(<span class="hljs-params">o,p,k,c</span>) </span>{
  <span class="hljs-keyword">var</span> j0  = c[ <span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xff</span> | (c[ <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (c[ <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (c[ <span class="hljs-number">3</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j1  = k[ <span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xff</span> | (k[ <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[ <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[ <span class="hljs-number">3</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j2  = k[ <span class="hljs-number">4</span>] &amp; <span class="hljs-number">0xff</span> | (k[ <span class="hljs-number">5</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[ <span class="hljs-number">6</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[ <span class="hljs-number">7</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j3  = k[ <span class="hljs-number">8</span>] &amp; <span class="hljs-number">0xff</span> | (k[ <span class="hljs-number">9</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">10</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">11</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j4  = k[<span class="hljs-number">12</span>] &amp; <span class="hljs-number">0xff</span> | (k[<span class="hljs-number">13</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">14</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">15</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j5  = c[ <span class="hljs-number">4</span>] &amp; <span class="hljs-number">0xff</span> | (c[ <span class="hljs-number">5</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (c[ <span class="hljs-number">6</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (c[ <span class="hljs-number">7</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j6  = p[ <span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xff</span> | (p[ <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (p[ <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (p[ <span class="hljs-number">3</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j7  = p[ <span class="hljs-number">4</span>] &amp; <span class="hljs-number">0xff</span> | (p[ <span class="hljs-number">5</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (p[ <span class="hljs-number">6</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (p[ <span class="hljs-number">7</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j8  = p[ <span class="hljs-number">8</span>] &amp; <span class="hljs-number">0xff</span> | (p[ <span class="hljs-number">9</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (p[<span class="hljs-number">10</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (p[<span class="hljs-number">11</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j9  = p[<span class="hljs-number">12</span>] &amp; <span class="hljs-number">0xff</span> | (p[<span class="hljs-number">13</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (p[<span class="hljs-number">14</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (p[<span class="hljs-number">15</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j10 = c[ <span class="hljs-number">8</span>] &amp; <span class="hljs-number">0xff</span> | (c[ <span class="hljs-number">9</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (c[<span class="hljs-number">10</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (c[<span class="hljs-number">11</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j11 = k[<span class="hljs-number">16</span>] &amp; <span class="hljs-number">0xff</span> | (k[<span class="hljs-number">17</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">18</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">19</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j12 = k[<span class="hljs-number">20</span>] &amp; <span class="hljs-number">0xff</span> | (k[<span class="hljs-number">21</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">22</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">23</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j13 = k[<span class="hljs-number">24</span>] &amp; <span class="hljs-number">0xff</span> | (k[<span class="hljs-number">25</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">26</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">27</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j14 = k[<span class="hljs-number">28</span>] &amp; <span class="hljs-number">0xff</span> | (k[<span class="hljs-number">29</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (k[<span class="hljs-number">30</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (k[<span class="hljs-number">31</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>,
      j15 = c[<span class="hljs-number">12</span>] &amp; <span class="hljs-number">0xff</span> | (c[<span class="hljs-number">13</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">8</span> | (c[<span class="hljs-number">14</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">16</span> | (c[<span class="hljs-number">15</span>] &amp; <span class="hljs-number">0xff</span>)&lt;&lt;<span class="hljs-number">24</span>;

  <span class="hljs-keyword">var</span> x0 = j0, x1 = j1, x2 = j2, x3 = j3, x4 = j4, x5 = j5, x6 = j6, x7 = j7,
      x8 = j8, x9 = j9, x10 = j10, x11 = j11, x12 = j12, x13 = j13, x14 = j14,
      x15 = j15, u;

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i += <span class="hljs-number">2</span>) {
    u = x0 + x12 | <span class="hljs-number">0</span>;
    x4 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x4 + x0 | <span class="hljs-number">0</span>;
    x8 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x8 + x4 | <span class="hljs-number">0</span>;
    x12 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x12 + x8 | <span class="hljs-number">0</span>;
    x0 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x5 + x1 | <span class="hljs-number">0</span>;
    x9 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x9 + x5 | <span class="hljs-number">0</span>;
    x13 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x13 + x9 | <span class="hljs-number">0</span>;
    x1 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x1 + x13 | <span class="hljs-number">0</span>;
    x5 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x10 + x6 | <span class="hljs-number">0</span>;
    x14 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x14 + x10 | <span class="hljs-number">0</span>;
    x2 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x2 + x14 | <span class="hljs-number">0</span>;
    x6 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x6 + x2 | <span class="hljs-number">0</span>;
    x10 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x15 + x11 | <span class="hljs-number">0</span>;
    x3 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x3 + x15 | <span class="hljs-number">0</span>;
    x7 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x7 + x3 | <span class="hljs-number">0</span>;
    x11 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x11 + x7 | <span class="hljs-number">0</span>;
    x15 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x0 + x3 | <span class="hljs-number">0</span>;
    x1 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x1 + x0 | <span class="hljs-number">0</span>;
    x2 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x2 + x1 | <span class="hljs-number">0</span>;
    x3 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x3 + x2 | <span class="hljs-number">0</span>;
    x0 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x5 + x4 | <span class="hljs-number">0</span>;
    x6 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x6 + x5 | <span class="hljs-number">0</span>;
    x7 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x7 + x6 | <span class="hljs-number">0</span>;
    x4 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x4 + x7 | <span class="hljs-number">0</span>;
    x5 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x10 + x9 | <span class="hljs-number">0</span>;
    x11 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x11 + x10 | <span class="hljs-number">0</span>;
    x8 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x8 + x11 | <span class="hljs-number">0</span>;
    x9 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x9 + x8 | <span class="hljs-number">0</span>;
    x10 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);

    u = x15 + x14 | <span class="hljs-number">0</span>;
    x12 ^= u&lt;&lt;<span class="hljs-number">7</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-7</span>);
    u = x12 + x15 | <span class="hljs-number">0</span>;
    x13 ^= u&lt;&lt;<span class="hljs-number">9</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-9</span>);
    u = x13 + x12 | <span class="hljs-number">0</span>;
    x14 ^= u&lt;&lt;<span class="hljs-number">13</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-13</span>);
    u = x14 + x13 | <span class="hljs-number">0</span>;
    x15 ^= u&lt;&lt;<span class="hljs-number">18</span> | u&gt;&gt;&gt;(<span class="hljs-number">32</span><span class="hljs-number">-18</span>);
  }

  o[ <span class="hljs-number">0</span>] = x0 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">1</span>] = x0 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">2</span>] = x0 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">3</span>] = x0 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[ <span class="hljs-number">4</span>] = x5 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">5</span>] = x5 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">6</span>] = x5 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">7</span>] = x5 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[ <span class="hljs-number">8</span>] = x10 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[ <span class="hljs-number">9</span>] = x10 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">10</span>] = x10 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">11</span>] = x10 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">12</span>] = x15 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">13</span>] = x15 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">14</span>] = x15 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">15</span>] = x15 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">16</span>] = x6 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">17</span>] = x6 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">18</span>] = x6 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">19</span>] = x6 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">20</span>] = x7 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">21</span>] = x7 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">22</span>] = x7 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">23</span>] = x7 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">24</span>] = x8 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">25</span>] = x8 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">26</span>] = x8 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">27</span>] = x8 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;

  o[<span class="hljs-number">28</span>] = x9 &gt;&gt;&gt;  <span class="hljs-number">0</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">29</span>] = x9 &gt;&gt;&gt;  <span class="hljs-number">8</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">30</span>] = x9 &gt;&gt;&gt; <span class="hljs-number">16</span> &amp; <span class="hljs-number">0xff</span>;
  o[<span class="hljs-number">31</span>] = x9 &gt;&gt;&gt; <span class="hljs-number">24</span> &amp; <span class="hljs-number">0xff</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_core_salsa20</span>(<span class="hljs-params">out,inp,k,c</span>) </span>{
  core_salsa20(out,inp,k,c);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_core_hsalsa20</span>(<span class="hljs-params">out,inp,k,c</span>) </span>{
  core_hsalsa20(out,inp,k,c);
}

<span class="hljs-keyword">var</span> sigma = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">101</span>, <span class="hljs-number">120</span>, <span class="hljs-number">112</span>, <span class="hljs-number">97</span>, <span class="hljs-number">110</span>, <span class="hljs-number">100</span>, <span class="hljs-number">32</span>, <span class="hljs-number">51</span>, <span class="hljs-number">50</span>, <span class="hljs-number">45</span>, <span class="hljs-number">98</span>, <span class="hljs-number">121</span>, <span class="hljs-number">116</span>, <span class="hljs-number">101</span>, <span class="hljs-number">32</span>, <span class="hljs-number">107</span>]);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>&quot;expand 32-byte k&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_stream_salsa20_xor</span>(<span class="hljs-params">c,cpos,m,mpos,b,n,k</span>) </span>{
  <span class="hljs-keyword">var</span> z = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">16</span>), x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">var</span> u, i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) z[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) z[i] = n[i];
  <span class="hljs-keyword">while</span> (b &gt;= <span class="hljs-number">64</span>) {
    crypto_core_salsa20(x,z,k,sigma);
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) c[cpos+i] = m[mpos+i] ^ x[i];
    u = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">8</span>; i &lt; <span class="hljs-number">16</span>; i++) {
      u = u + (z[i] &amp; <span class="hljs-number">0xff</span>) | <span class="hljs-number">0</span>;
      z[i] = u &amp; <span class="hljs-number">0xff</span>;
      u &gt;&gt;&gt;= <span class="hljs-number">8</span>;
    }
    b -= <span class="hljs-number">64</span>;
    cpos += <span class="hljs-number">64</span>;
    mpos += <span class="hljs-number">64</span>;
  }
  <span class="hljs-keyword">if</span> (b &gt; <span class="hljs-number">0</span>) {
    crypto_core_salsa20(x,z,k,sigma);
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; b; i++) c[cpos+i] = m[mpos+i] ^ x[i];
  }
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_stream_salsa20</span>(<span class="hljs-params">c,cpos,b,n,k</span>) </span>{
  <span class="hljs-keyword">var</span> z = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">16</span>), x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">var</span> u, i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) z[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) z[i] = n[i];
  <span class="hljs-keyword">while</span> (b &gt;= <span class="hljs-number">64</span>) {
    crypto_core_salsa20(x,z,k,sigma);
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) c[cpos+i] = x[i];
    u = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">8</span>; i &lt; <span class="hljs-number">16</span>; i++) {
      u = u + (z[i] &amp; <span class="hljs-number">0xff</span>) | <span class="hljs-number">0</span>;
      z[i] = u &amp; <span class="hljs-number">0xff</span>;
      u &gt;&gt;&gt;= <span class="hljs-number">8</span>;
    }
    b -= <span class="hljs-number">64</span>;
    cpos += <span class="hljs-number">64</span>;
  }
  <span class="hljs-keyword">if</span> (b &gt; <span class="hljs-number">0</span>) {
    crypto_core_salsa20(x,z,k,sigma);
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; b; i++) c[cpos+i] = x[i];
  }
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_stream</span>(<span class="hljs-params">c,cpos,d,n,k</span>) </span>{
  <span class="hljs-keyword">var</span> s = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  crypto_core_hsalsa20(s,n,k,sigma);
  <span class="hljs-keyword">var</span> sn = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">8</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) sn[i] = n[i+<span class="hljs-number">16</span>];
  <span class="hljs-keyword">return</span> crypto_stream_salsa20(c,cpos,d,sn,s);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_stream_xor</span>(<span class="hljs-params">c,cpos,m,mpos,d,n,k</span>) </span>{
  <span class="hljs-keyword">var</span> s = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  crypto_core_hsalsa20(s,n,k,sigma);
  <span class="hljs-keyword">var</span> sn = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">8</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) sn[i] = n[i+<span class="hljs-number">16</span>];
  <span class="hljs-keyword">return</span> crypto_stream_salsa20_xor(c,cpos,m,mpos,d,sn,s);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Port of Andrew Moon's Poly1305-donna-16. Public domain.
https://github.com/floodyberry/poly1305-donna</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> poly1305 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">key</span>) </span>{
  <span class="hljs-keyword">this</span>.buffer = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">16</span>);
  <span class="hljs-keyword">this</span>.r = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint16Array</span>(<span class="hljs-number">10</span>);
  <span class="hljs-keyword">this</span>.h = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint16Array</span>(<span class="hljs-number">10</span>);
  <span class="hljs-keyword">this</span>.pad = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint16Array</span>(<span class="hljs-number">8</span>);
  <span class="hljs-keyword">this</span>.leftover = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">this</span>.fin = <span class="hljs-number">0</span>;

  <span class="hljs-keyword">var</span> t0, t1, t2, t3, t4, t5, t6, t7;

  t0 = key[ <span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xff</span> | (key[ <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; <span class="hljs-keyword">this</span>.r[<span class="hljs-number">0</span>] = ( t0                     ) &amp; <span class="hljs-number">0x1fff</span>;
  t1 = key[ <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span> | (key[ <span class="hljs-number">3</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; <span class="hljs-keyword">this</span>.r[<span class="hljs-number">1</span>] = ((t0 &gt;&gt;&gt; <span class="hljs-number">13</span>) | (t1 &lt;&lt;  <span class="hljs-number">3</span>)) &amp; <span class="hljs-number">0x1fff</span>;
  t2 = key[ <span class="hljs-number">4</span>] &amp; <span class="hljs-number">0xff</span> | (key[ <span class="hljs-number">5</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; <span class="hljs-keyword">this</span>.r[<span class="hljs-number">2</span>] = ((t1 &gt;&gt;&gt; <span class="hljs-number">10</span>) | (t2 &lt;&lt;  <span class="hljs-number">6</span>)) &amp; <span class="hljs-number">0x1f03</span>;
  t3 = key[ <span class="hljs-number">6</span>] &amp; <span class="hljs-number">0xff</span> | (key[ <span class="hljs-number">7</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; <span class="hljs-keyword">this</span>.r[<span class="hljs-number">3</span>] = ((t2 &gt;&gt;&gt;  <span class="hljs-number">7</span>) | (t3 &lt;&lt;  <span class="hljs-number">9</span>)) &amp; <span class="hljs-number">0x1fff</span>;
  t4 = key[ <span class="hljs-number">8</span>] &amp; <span class="hljs-number">0xff</span> | (key[ <span class="hljs-number">9</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; <span class="hljs-keyword">this</span>.r[<span class="hljs-number">4</span>] = ((t3 &gt;&gt;&gt;  <span class="hljs-number">4</span>) | (t4 &lt;&lt; <span class="hljs-number">12</span>)) &amp; <span class="hljs-number">0x00ff</span>;
  <span class="hljs-keyword">this</span>.r[<span class="hljs-number">5</span>] = ((t4 &gt;&gt;&gt;  <span class="hljs-number">1</span>)) &amp; <span class="hljs-number">0x1ffe</span>;
  t5 = key[<span class="hljs-number">10</span>] &amp; <span class="hljs-number">0xff</span> | (key[<span class="hljs-number">11</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; <span class="hljs-keyword">this</span>.r[<span class="hljs-number">6</span>] = ((t4 &gt;&gt;&gt; <span class="hljs-number">14</span>) | (t5 &lt;&lt;  <span class="hljs-number">2</span>)) &amp; <span class="hljs-number">0x1fff</span>;
  t6 = key[<span class="hljs-number">12</span>] &amp; <span class="hljs-number">0xff</span> | (key[<span class="hljs-number">13</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; <span class="hljs-keyword">this</span>.r[<span class="hljs-number">7</span>] = ((t5 &gt;&gt;&gt; <span class="hljs-number">11</span>) | (t6 &lt;&lt;  <span class="hljs-number">5</span>)) &amp; <span class="hljs-number">0x1f81</span>;
  t7 = key[<span class="hljs-number">14</span>] &amp; <span class="hljs-number">0xff</span> | (key[<span class="hljs-number">15</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; <span class="hljs-keyword">this</span>.r[<span class="hljs-number">8</span>] = ((t6 &gt;&gt;&gt;  <span class="hljs-number">8</span>) | (t7 &lt;&lt;  <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0x1fff</span>;
  <span class="hljs-keyword">this</span>.r[<span class="hljs-number">9</span>] = ((t7 &gt;&gt;&gt;  <span class="hljs-number">5</span>)) &amp; <span class="hljs-number">0x007f</span>;

  <span class="hljs-keyword">this</span>.pad[<span class="hljs-number">0</span>] = key[<span class="hljs-number">16</span>] &amp; <span class="hljs-number">0xff</span> | (key[<span class="hljs-number">17</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>;
  <span class="hljs-keyword">this</span>.pad[<span class="hljs-number">1</span>] = key[<span class="hljs-number">18</span>] &amp; <span class="hljs-number">0xff</span> | (key[<span class="hljs-number">19</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>;
  <span class="hljs-keyword">this</span>.pad[<span class="hljs-number">2</span>] = key[<span class="hljs-number">20</span>] &amp; <span class="hljs-number">0xff</span> | (key[<span class="hljs-number">21</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>;
  <span class="hljs-keyword">this</span>.pad[<span class="hljs-number">3</span>] = key[<span class="hljs-number">22</span>] &amp; <span class="hljs-number">0xff</span> | (key[<span class="hljs-number">23</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>;
  <span class="hljs-keyword">this</span>.pad[<span class="hljs-number">4</span>] = key[<span class="hljs-number">24</span>] &amp; <span class="hljs-number">0xff</span> | (key[<span class="hljs-number">25</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>;
  <span class="hljs-keyword">this</span>.pad[<span class="hljs-number">5</span>] = key[<span class="hljs-number">26</span>] &amp; <span class="hljs-number">0xff</span> | (key[<span class="hljs-number">27</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>;
  <span class="hljs-keyword">this</span>.pad[<span class="hljs-number">6</span>] = key[<span class="hljs-number">28</span>] &amp; <span class="hljs-number">0xff</span> | (key[<span class="hljs-number">29</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>;
  <span class="hljs-keyword">this</span>.pad[<span class="hljs-number">7</span>] = key[<span class="hljs-number">30</span>] &amp; <span class="hljs-number">0xff</span> | (key[<span class="hljs-number">31</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>;
};

poly1305.prototype.blocks = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">m, mpos, bytes</span>) </span>{
  <span class="hljs-keyword">var</span> hibit = <span class="hljs-keyword">this</span>.fin ? <span class="hljs-number">0</span> : (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">11</span>);
  <span class="hljs-keyword">var</span> t0, t1, t2, t3, t4, t5, t6, t7, c;
  <span class="hljs-keyword">var</span> d0, d1, d2, d3, d4, d5, d6, d7, d8, d9;

  <span class="hljs-keyword">var</span> h0 = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>],
      h1 = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>],
      h2 = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">2</span>],
      h3 = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">3</span>],
      h4 = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">4</span>],
      h5 = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">5</span>],
      h6 = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">6</span>],
      h7 = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">7</span>],
      h8 = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">8</span>],
      h9 = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">9</span>];

  <span class="hljs-keyword">var</span> r0 = <span class="hljs-keyword">this</span>.r[<span class="hljs-number">0</span>],
      r1 = <span class="hljs-keyword">this</span>.r[<span class="hljs-number">1</span>],
      r2 = <span class="hljs-keyword">this</span>.r[<span class="hljs-number">2</span>],
      r3 = <span class="hljs-keyword">this</span>.r[<span class="hljs-number">3</span>],
      r4 = <span class="hljs-keyword">this</span>.r[<span class="hljs-number">4</span>],
      r5 = <span class="hljs-keyword">this</span>.r[<span class="hljs-number">5</span>],
      r6 = <span class="hljs-keyword">this</span>.r[<span class="hljs-number">6</span>],
      r7 = <span class="hljs-keyword">this</span>.r[<span class="hljs-number">7</span>],
      r8 = <span class="hljs-keyword">this</span>.r[<span class="hljs-number">8</span>],
      r9 = <span class="hljs-keyword">this</span>.r[<span class="hljs-number">9</span>];

  <span class="hljs-keyword">while</span> (bytes &gt;= <span class="hljs-number">16</span>) {
    t0 = m[mpos+ <span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xff</span> | (m[mpos+ <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; h0 += ( t0                     ) &amp; <span class="hljs-number">0x1fff</span>;
    t1 = m[mpos+ <span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span> | (m[mpos+ <span class="hljs-number">3</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; h1 += ((t0 &gt;&gt;&gt; <span class="hljs-number">13</span>) | (t1 &lt;&lt;  <span class="hljs-number">3</span>)) &amp; <span class="hljs-number">0x1fff</span>;
    t2 = m[mpos+ <span class="hljs-number">4</span>] &amp; <span class="hljs-number">0xff</span> | (m[mpos+ <span class="hljs-number">5</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; h2 += ((t1 &gt;&gt;&gt; <span class="hljs-number">10</span>) | (t2 &lt;&lt;  <span class="hljs-number">6</span>)) &amp; <span class="hljs-number">0x1fff</span>;
    t3 = m[mpos+ <span class="hljs-number">6</span>] &amp; <span class="hljs-number">0xff</span> | (m[mpos+ <span class="hljs-number">7</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; h3 += ((t2 &gt;&gt;&gt;  <span class="hljs-number">7</span>) | (t3 &lt;&lt;  <span class="hljs-number">9</span>)) &amp; <span class="hljs-number">0x1fff</span>;
    t4 = m[mpos+ <span class="hljs-number">8</span>] &amp; <span class="hljs-number">0xff</span> | (m[mpos+ <span class="hljs-number">9</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; h4 += ((t3 &gt;&gt;&gt;  <span class="hljs-number">4</span>) | (t4 &lt;&lt; <span class="hljs-number">12</span>)) &amp; <span class="hljs-number">0x1fff</span>;
    h5 += ((t4 &gt;&gt;&gt;  <span class="hljs-number">1</span>)) &amp; <span class="hljs-number">0x1fff</span>;
    t5 = m[mpos+<span class="hljs-number">10</span>] &amp; <span class="hljs-number">0xff</span> | (m[mpos+<span class="hljs-number">11</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; h6 += ((t4 &gt;&gt;&gt; <span class="hljs-number">14</span>) | (t5 &lt;&lt;  <span class="hljs-number">2</span>)) &amp; <span class="hljs-number">0x1fff</span>;
    t6 = m[mpos+<span class="hljs-number">12</span>] &amp; <span class="hljs-number">0xff</span> | (m[mpos+<span class="hljs-number">13</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; h7 += ((t5 &gt;&gt;&gt; <span class="hljs-number">11</span>) | (t6 &lt;&lt;  <span class="hljs-number">5</span>)) &amp; <span class="hljs-number">0x1fff</span>;
    t7 = m[mpos+<span class="hljs-number">14</span>] &amp; <span class="hljs-number">0xff</span> | (m[mpos+<span class="hljs-number">15</span>] &amp; <span class="hljs-number">0xff</span>) &lt;&lt; <span class="hljs-number">8</span>; h8 += ((t6 &gt;&gt;&gt;  <span class="hljs-number">8</span>) | (t7 &lt;&lt;  <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0x1fff</span>;
    h9 += ((t7 &gt;&gt;&gt; <span class="hljs-number">5</span>)) | hibit;

    c = <span class="hljs-number">0</span>;

    d0 = c;
    d0 += h0 * r0;
    d0 += h1 * (<span class="hljs-number">5</span> * r9);
    d0 += h2 * (<span class="hljs-number">5</span> * r8);
    d0 += h3 * (<span class="hljs-number">5</span> * r7);
    d0 += h4 * (<span class="hljs-number">5</span> * r6);
    c = (d0 &gt;&gt;&gt; <span class="hljs-number">13</span>); d0 &amp;= <span class="hljs-number">0x1fff</span>;
    d0 += h5 * (<span class="hljs-number">5</span> * r5);
    d0 += h6 * (<span class="hljs-number">5</span> * r4);
    d0 += h7 * (<span class="hljs-number">5</span> * r3);
    d0 += h8 * (<span class="hljs-number">5</span> * r2);
    d0 += h9 * (<span class="hljs-number">5</span> * r1);
    c += (d0 &gt;&gt;&gt; <span class="hljs-number">13</span>); d0 &amp;= <span class="hljs-number">0x1fff</span>;

    d1 = c;
    d1 += h0 * r1;
    d1 += h1 * r0;
    d1 += h2 * (<span class="hljs-number">5</span> * r9);
    d1 += h3 * (<span class="hljs-number">5</span> * r8);
    d1 += h4 * (<span class="hljs-number">5</span> * r7);
    c = (d1 &gt;&gt;&gt; <span class="hljs-number">13</span>); d1 &amp;= <span class="hljs-number">0x1fff</span>;
    d1 += h5 * (<span class="hljs-number">5</span> * r6);
    d1 += h6 * (<span class="hljs-number">5</span> * r5);
    d1 += h7 * (<span class="hljs-number">5</span> * r4);
    d1 += h8 * (<span class="hljs-number">5</span> * r3);
    d1 += h9 * (<span class="hljs-number">5</span> * r2);
    c += (d1 &gt;&gt;&gt; <span class="hljs-number">13</span>); d1 &amp;= <span class="hljs-number">0x1fff</span>;

    d2 = c;
    d2 += h0 * r2;
    d2 += h1 * r1;
    d2 += h2 * r0;
    d2 += h3 * (<span class="hljs-number">5</span> * r9);
    d2 += h4 * (<span class="hljs-number">5</span> * r8);
    c = (d2 &gt;&gt;&gt; <span class="hljs-number">13</span>); d2 &amp;= <span class="hljs-number">0x1fff</span>;
    d2 += h5 * (<span class="hljs-number">5</span> * r7);
    d2 += h6 * (<span class="hljs-number">5</span> * r6);
    d2 += h7 * (<span class="hljs-number">5</span> * r5);
    d2 += h8 * (<span class="hljs-number">5</span> * r4);
    d2 += h9 * (<span class="hljs-number">5</span> * r3);
    c += (d2 &gt;&gt;&gt; <span class="hljs-number">13</span>); d2 &amp;= <span class="hljs-number">0x1fff</span>;

    d3 = c;
    d3 += h0 * r3;
    d3 += h1 * r2;
    d3 += h2 * r1;
    d3 += h3 * r0;
    d3 += h4 * (<span class="hljs-number">5</span> * r9);
    c = (d3 &gt;&gt;&gt; <span class="hljs-number">13</span>); d3 &amp;= <span class="hljs-number">0x1fff</span>;
    d3 += h5 * (<span class="hljs-number">5</span> * r8);
    d3 += h6 * (<span class="hljs-number">5</span> * r7);
    d3 += h7 * (<span class="hljs-number">5</span> * r6);
    d3 += h8 * (<span class="hljs-number">5</span> * r5);
    d3 += h9 * (<span class="hljs-number">5</span> * r4);
    c += (d3 &gt;&gt;&gt; <span class="hljs-number">13</span>); d3 &amp;= <span class="hljs-number">0x1fff</span>;

    d4 = c;
    d4 += h0 * r4;
    d4 += h1 * r3;
    d4 += h2 * r2;
    d4 += h3 * r1;
    d4 += h4 * r0;
    c = (d4 &gt;&gt;&gt; <span class="hljs-number">13</span>); d4 &amp;= <span class="hljs-number">0x1fff</span>;
    d4 += h5 * (<span class="hljs-number">5</span> * r9);
    d4 += h6 * (<span class="hljs-number">5</span> * r8);
    d4 += h7 * (<span class="hljs-number">5</span> * r7);
    d4 += h8 * (<span class="hljs-number">5</span> * r6);
    d4 += h9 * (<span class="hljs-number">5</span> * r5);
    c += (d4 &gt;&gt;&gt; <span class="hljs-number">13</span>); d4 &amp;= <span class="hljs-number">0x1fff</span>;

    d5 = c;
    d5 += h0 * r5;
    d5 += h1 * r4;
    d5 += h2 * r3;
    d5 += h3 * r2;
    d5 += h4 * r1;
    c = (d5 &gt;&gt;&gt; <span class="hljs-number">13</span>); d5 &amp;= <span class="hljs-number">0x1fff</span>;
    d5 += h5 * r0;
    d5 += h6 * (<span class="hljs-number">5</span> * r9);
    d5 += h7 * (<span class="hljs-number">5</span> * r8);
    d5 += h8 * (<span class="hljs-number">5</span> * r7);
    d5 += h9 * (<span class="hljs-number">5</span> * r6);
    c += (d5 &gt;&gt;&gt; <span class="hljs-number">13</span>); d5 &amp;= <span class="hljs-number">0x1fff</span>;

    d6 = c;
    d6 += h0 * r6;
    d6 += h1 * r5;
    d6 += h2 * r4;
    d6 += h3 * r3;
    d6 += h4 * r2;
    c = (d6 &gt;&gt;&gt; <span class="hljs-number">13</span>); d6 &amp;= <span class="hljs-number">0x1fff</span>;
    d6 += h5 * r1;
    d6 += h6 * r0;
    d6 += h7 * (<span class="hljs-number">5</span> * r9);
    d6 += h8 * (<span class="hljs-number">5</span> * r8);
    d6 += h9 * (<span class="hljs-number">5</span> * r7);
    c += (d6 &gt;&gt;&gt; <span class="hljs-number">13</span>); d6 &amp;= <span class="hljs-number">0x1fff</span>;

    d7 = c;
    d7 += h0 * r7;
    d7 += h1 * r6;
    d7 += h2 * r5;
    d7 += h3 * r4;
    d7 += h4 * r3;
    c = (d7 &gt;&gt;&gt; <span class="hljs-number">13</span>); d7 &amp;= <span class="hljs-number">0x1fff</span>;
    d7 += h5 * r2;
    d7 += h6 * r1;
    d7 += h7 * r0;
    d7 += h8 * (<span class="hljs-number">5</span> * r9);
    d7 += h9 * (<span class="hljs-number">5</span> * r8);
    c += (d7 &gt;&gt;&gt; <span class="hljs-number">13</span>); d7 &amp;= <span class="hljs-number">0x1fff</span>;

    d8 = c;
    d8 += h0 * r8;
    d8 += h1 * r7;
    d8 += h2 * r6;
    d8 += h3 * r5;
    d8 += h4 * r4;
    c = (d8 &gt;&gt;&gt; <span class="hljs-number">13</span>); d8 &amp;= <span class="hljs-number">0x1fff</span>;
    d8 += h5 * r3;
    d8 += h6 * r2;
    d8 += h7 * r1;
    d8 += h8 * r0;
    d8 += h9 * (<span class="hljs-number">5</span> * r9);
    c += (d8 &gt;&gt;&gt; <span class="hljs-number">13</span>); d8 &amp;= <span class="hljs-number">0x1fff</span>;

    d9 = c;
    d9 += h0 * r9;
    d9 += h1 * r8;
    d9 += h2 * r7;
    d9 += h3 * r6;
    d9 += h4 * r5;
    c = (d9 &gt;&gt;&gt; <span class="hljs-number">13</span>); d9 &amp;= <span class="hljs-number">0x1fff</span>;
    d9 += h5 * r4;
    d9 += h6 * r3;
    d9 += h7 * r2;
    d9 += h8 * r1;
    d9 += h9 * r0;
    c += (d9 &gt;&gt;&gt; <span class="hljs-number">13</span>); d9 &amp;= <span class="hljs-number">0x1fff</span>;

    c = (((c &lt;&lt; <span class="hljs-number">2</span>) + c)) | <span class="hljs-number">0</span>;
    c = (c + d0) | <span class="hljs-number">0</span>;
    d0 = c &amp; <span class="hljs-number">0x1fff</span>;
    c = (c &gt;&gt;&gt; <span class="hljs-number">13</span>);
    d1 += c;

    h0 = d0;
    h1 = d1;
    h2 = d2;
    h3 = d3;
    h4 = d4;
    h5 = d5;
    h6 = d6;
    h7 = d7;
    h8 = d8;
    h9 = d9;

    mpos += <span class="hljs-number">16</span>;
    bytes -= <span class="hljs-number">16</span>;
  }
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>] = h0;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>] = h1;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">2</span>] = h2;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">3</span>] = h3;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">4</span>] = h4;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">5</span>] = h5;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">6</span>] = h6;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">7</span>] = h7;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">8</span>] = h8;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">9</span>] = h9;
};

poly1305.prototype.finish = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">mac, macpos</span>) </span>{
  <span class="hljs-keyword">var</span> g = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint16Array</span>(<span class="hljs-number">10</span>);
  <span class="hljs-keyword">var</span> c, mask, f, i;

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.leftover) {
    i = <span class="hljs-keyword">this</span>.leftover;
    <span class="hljs-keyword">this</span>.buffer[i++] = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (; i &lt; <span class="hljs-number">16</span>; i++) <span class="hljs-keyword">this</span>.buffer[i] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.fin = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">this</span>.blocks(<span class="hljs-keyword">this</span>.buffer, <span class="hljs-number">0</span>, <span class="hljs-number">16</span>);
  }

  c = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>] &gt;&gt;&gt; <span class="hljs-number">13</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>] &amp;= <span class="hljs-number">0x1fff</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">2</span>; i &lt; <span class="hljs-number">10</span>; i++) {
    <span class="hljs-keyword">this</span>.h[i] += c;
    c = <span class="hljs-keyword">this</span>.h[i] &gt;&gt;&gt; <span class="hljs-number">13</span>;
    <span class="hljs-keyword">this</span>.h[i] &amp;= <span class="hljs-number">0x1fff</span>;
  }
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>] += (c * <span class="hljs-number">5</span>);
  c = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>] &gt;&gt;&gt; <span class="hljs-number">13</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>] &amp;= <span class="hljs-number">0x1fff</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>] += c;
  c = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>] &gt;&gt;&gt; <span class="hljs-number">13</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>] &amp;= <span class="hljs-number">0x1fff</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">2</span>] += c;

  g[<span class="hljs-number">0</span>] = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>] + <span class="hljs-number">5</span>;
  c = g[<span class="hljs-number">0</span>] &gt;&gt;&gt; <span class="hljs-number">13</span>;
  g[<span class="hljs-number">0</span>] &amp;= <span class="hljs-number">0x1fff</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">10</span>; i++) {
    g[i] = <span class="hljs-keyword">this</span>.h[i] + c;
    c = g[i] &gt;&gt;&gt; <span class="hljs-number">13</span>;
    g[i] &amp;= <span class="hljs-number">0x1fff</span>;
  }
  g[<span class="hljs-number">9</span>] -= (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">13</span>);

  mask = (g[<span class="hljs-number">9</span>] &gt;&gt;&gt; ((<span class="hljs-number">2</span> * <span class="hljs-number">8</span>) - <span class="hljs-number">1</span>)) - <span class="hljs-number">1</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) g[i] &amp;= mask;
  mask = ~mask;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) <span class="hljs-keyword">this</span>.h[i] = (<span class="hljs-keyword">this</span>.h[i] &amp; mask) | g[i];

  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>] = ((<span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>]       ) | (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">13</span>)                    ) &amp; <span class="hljs-number">0xffff</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>] = ((<span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>] &gt;&gt;&gt;  <span class="hljs-number">3</span>) | (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">10</span>)                    ) &amp; <span class="hljs-number">0xffff</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">2</span>] = ((<span class="hljs-keyword">this</span>.h[<span class="hljs-number">2</span>] &gt;&gt;&gt;  <span class="hljs-number">6</span>) | (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">3</span>] &lt;&lt;  <span class="hljs-number">7</span>)                    ) &amp; <span class="hljs-number">0xffff</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">3</span>] = ((<span class="hljs-keyword">this</span>.h[<span class="hljs-number">3</span>] &gt;&gt;&gt;  <span class="hljs-number">9</span>) | (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">4</span>] &lt;&lt;  <span class="hljs-number">4</span>)                    ) &amp; <span class="hljs-number">0xffff</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">4</span>] = ((<span class="hljs-keyword">this</span>.h[<span class="hljs-number">4</span>] &gt;&gt;&gt; <span class="hljs-number">12</span>) | (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">5</span>] &lt;&lt;  <span class="hljs-number">1</span>) | (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">6</span>] &lt;&lt; <span class="hljs-number">14</span>)) &amp; <span class="hljs-number">0xffff</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">5</span>] = ((<span class="hljs-keyword">this</span>.h[<span class="hljs-number">6</span>] &gt;&gt;&gt;  <span class="hljs-number">2</span>) | (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">7</span>] &lt;&lt; <span class="hljs-number">11</span>)                    ) &amp; <span class="hljs-number">0xffff</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">6</span>] = ((<span class="hljs-keyword">this</span>.h[<span class="hljs-number">7</span>] &gt;&gt;&gt;  <span class="hljs-number">5</span>) | (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">8</span>] &lt;&lt;  <span class="hljs-number">8</span>)                    ) &amp; <span class="hljs-number">0xffff</span>;
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">7</span>] = ((<span class="hljs-keyword">this</span>.h[<span class="hljs-number">8</span>] &gt;&gt;&gt;  <span class="hljs-number">8</span>) | (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">9</span>] &lt;&lt;  <span class="hljs-number">5</span>)                    ) &amp; <span class="hljs-number">0xffff</span>;

  f = <span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>] + <span class="hljs-keyword">this</span>.pad[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>] = f &amp; <span class="hljs-number">0xffff</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">8</span>; i++) {
    f = (((<span class="hljs-keyword">this</span>.h[i] + <span class="hljs-keyword">this</span>.pad[i]) | <span class="hljs-number">0</span>) + (f &gt;&gt;&gt; <span class="hljs-number">16</span>)) | <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.h[i] = f &amp; <span class="hljs-number">0xffff</span>;
  }

  mac[macpos+ <span class="hljs-number">0</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>] &gt;&gt;&gt; <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+ <span class="hljs-number">1</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">0</span>] &gt;&gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+ <span class="hljs-number">2</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>] &gt;&gt;&gt; <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+ <span class="hljs-number">3</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">1</span>] &gt;&gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+ <span class="hljs-number">4</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">2</span>] &gt;&gt;&gt; <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+ <span class="hljs-number">5</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">2</span>] &gt;&gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+ <span class="hljs-number">6</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">3</span>] &gt;&gt;&gt; <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+ <span class="hljs-number">7</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">3</span>] &gt;&gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+ <span class="hljs-number">8</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">4</span>] &gt;&gt;&gt; <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+ <span class="hljs-number">9</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">4</span>] &gt;&gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+<span class="hljs-number">10</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">5</span>] &gt;&gt;&gt; <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+<span class="hljs-number">11</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">5</span>] &gt;&gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+<span class="hljs-number">12</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">6</span>] &gt;&gt;&gt; <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+<span class="hljs-number">13</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">6</span>] &gt;&gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+<span class="hljs-number">14</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">7</span>] &gt;&gt;&gt; <span class="hljs-number">0</span>) &amp; <span class="hljs-number">0xff</span>;
  mac[macpos+<span class="hljs-number">15</span>] = (<span class="hljs-keyword">this</span>.h[<span class="hljs-number">7</span>] &gt;&gt;&gt; <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>;
};

poly1305.prototype.update = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">m, mpos, bytes</span>) </span>{
  <span class="hljs-keyword">var</span> i, want;

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.leftover) {
    want = (<span class="hljs-number">16</span> - <span class="hljs-keyword">this</span>.leftover);
    <span class="hljs-keyword">if</span> (want &gt; bytes)
      want = bytes;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; want; i++)
      <span class="hljs-keyword">this</span>.buffer[<span class="hljs-keyword">this</span>.leftover + i] = m[mpos+i];
    bytes -= want;
    mpos += want;
    <span class="hljs-keyword">this</span>.leftover += want;
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.leftover &lt; <span class="hljs-number">16</span>)
      <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">this</span>.blocks(<span class="hljs-keyword">this</span>.buffer, <span class="hljs-number">0</span>, <span class="hljs-number">16</span>);
    <span class="hljs-keyword">this</span>.leftover = <span class="hljs-number">0</span>;
  }

  <span class="hljs-keyword">if</span> (bytes &gt;= <span class="hljs-number">16</span>) {
    want = bytes - (bytes % <span class="hljs-number">16</span>);
    <span class="hljs-keyword">this</span>.blocks(m, mpos, want);
    mpos += want;
    bytes -= want;
  }

  <span class="hljs-keyword">if</span> (bytes) {
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; bytes; i++)
      <span class="hljs-keyword">this</span>.buffer[<span class="hljs-keyword">this</span>.leftover + i] = m[mpos+i];
    <span class="hljs-keyword">this</span>.leftover += bytes;
  }
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_onetimeauth</span>(<span class="hljs-params">out, outpos, m, mpos, n, k</span>) </span>{
  <span class="hljs-keyword">var</span> s = <span class="hljs-keyword">new</span> poly1305(k);
  s.update(m, mpos, n);
  s.finish(out, outpos);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_onetimeauth_verify</span>(<span class="hljs-params">h, hpos, m, mpos, n, k</span>) </span>{
  <span class="hljs-keyword">var</span> x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">16</span>);
  crypto_onetimeauth(x,<span class="hljs-number">0</span>,m,mpos,n,k);
  <span class="hljs-keyword">return</span> crypto_verify_16(h,hpos,x,<span class="hljs-number">0</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_secretbox</span>(<span class="hljs-params">c,m,d,n,k</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">32</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  crypto_stream_xor(c,<span class="hljs-number">0</span>,m,<span class="hljs-number">0</span>,d,n,k);
  crypto_onetimeauth(c, <span class="hljs-number">16</span>, c, <span class="hljs-number">32</span>, d - <span class="hljs-number">32</span>, c);
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) c[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_secretbox_open</span>(<span class="hljs-params">m,c,d,n,k</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">var</span> x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  <span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">32</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  crypto_stream(x,<span class="hljs-number">0</span>,<span class="hljs-number">32</span>,n,k);
  <span class="hljs-keyword">if</span> (crypto_onetimeauth_verify(c, <span class="hljs-number">16</span>,c, <span class="hljs-number">32</span>,d - <span class="hljs-number">32</span>,x) !== <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  crypto_stream_xor(m,<span class="hljs-number">0</span>,c,<span class="hljs-number">0</span>,d,n,k);
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) m[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set25519</span>(<span class="hljs-params">r, a</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) r[i] = a[i]|<span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">car25519</span>(<span class="hljs-params">o</span>) </span>{
  <span class="hljs-keyword">var</span> i, v, c = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
    v = o[i] + c + <span class="hljs-number">65535</span>;
    c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);
    o[i] = v - c * <span class="hljs-number">65536</span>;
  }
  o[<span class="hljs-number">0</span>] += c<span class="hljs-number">-1</span> + <span class="hljs-number">37</span> * (c<span class="hljs-number">-1</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sel25519</span>(<span class="hljs-params">p, q, b</span>) </span>{
  <span class="hljs-keyword">var</span> t, c = ~(b<span class="hljs-number">-1</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
    t = c &amp; (p[i] ^ q[i]);
    p[i] ^= t;
    q[i] ^= t;
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pack25519</span>(<span class="hljs-params">o, n</span>) </span>{
  <span class="hljs-keyword">var</span> i, j, b;
  <span class="hljs-keyword">var</span> m = gf(), t = gf();
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) t[i] = n[i];
  car25519(t);
  car25519(t);
  car25519(t);
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">2</span>; j++) {
    m[<span class="hljs-number">0</span>] = t[<span class="hljs-number">0</span>] - <span class="hljs-number">0xffed</span>;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">15</span>; i++) {
      m[i] = t[i] - <span class="hljs-number">0xffff</span> - ((m[i<span class="hljs-number">-1</span>]&gt;&gt;<span class="hljs-number">16</span>) &amp; <span class="hljs-number">1</span>);
      m[i<span class="hljs-number">-1</span>] &amp;= <span class="hljs-number">0xffff</span>;
    }
    m[<span class="hljs-number">15</span>] = t[<span class="hljs-number">15</span>] - <span class="hljs-number">0x7fff</span> - ((m[<span class="hljs-number">14</span>]&gt;&gt;<span class="hljs-number">16</span>) &amp; <span class="hljs-number">1</span>);
    b = (m[<span class="hljs-number">15</span>]&gt;&gt;<span class="hljs-number">16</span>) &amp; <span class="hljs-number">1</span>;
    m[<span class="hljs-number">14</span>] &amp;= <span class="hljs-number">0xffff</span>;
    sel25519(t, m, <span class="hljs-number">1</span>-b);
  }
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
    o[<span class="hljs-number">2</span>*i] = t[i] &amp; <span class="hljs-number">0xff</span>;
    o[<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>] = t[i]&gt;&gt;<span class="hljs-number">8</span>;
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">neq25519</span>(<span class="hljs-params">a, b</span>) </span>{
  <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>), d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  pack25519(c, a);
  pack25519(d, b);
  <span class="hljs-keyword">return</span> crypto_verify_32(c, <span class="hljs-number">0</span>, d, <span class="hljs-number">0</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">par25519</span>(<span class="hljs-params">a</span>) </span>{
  <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  pack25519(d, a);
  <span class="hljs-keyword">return</span> d[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">1</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unpack25519</span>(<span class="hljs-params">o, n</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) o[i] = n[<span class="hljs-number">2</span>*i] + (n[<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">8</span>);
  o[<span class="hljs-number">15</span>] &amp;= <span class="hljs-number">0x7fff</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">A</span>(<span class="hljs-params">o, a, b</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) o[i] = a[i] + b[i];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Z</span>(<span class="hljs-params">o, a, b</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) o[i] = a[i] - b[i];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">M</span>(<span class="hljs-params">o, a, b</span>) </span>{
  <span class="hljs-keyword">var</span> v, c,
     t0 = <span class="hljs-number">0</span>,  t1 = <span class="hljs-number">0</span>,  t2 = <span class="hljs-number">0</span>,  t3 = <span class="hljs-number">0</span>,  t4 = <span class="hljs-number">0</span>,  t5 = <span class="hljs-number">0</span>,  t6 = <span class="hljs-number">0</span>,  t7 = <span class="hljs-number">0</span>,
     t8 = <span class="hljs-number">0</span>,  t9 = <span class="hljs-number">0</span>, t10 = <span class="hljs-number">0</span>, t11 = <span class="hljs-number">0</span>, t12 = <span class="hljs-number">0</span>, t13 = <span class="hljs-number">0</span>, t14 = <span class="hljs-number">0</span>, t15 = <span class="hljs-number">0</span>,
    t16 = <span class="hljs-number">0</span>, t17 = <span class="hljs-number">0</span>, t18 = <span class="hljs-number">0</span>, t19 = <span class="hljs-number">0</span>, t20 = <span class="hljs-number">0</span>, t21 = <span class="hljs-number">0</span>, t22 = <span class="hljs-number">0</span>, t23 = <span class="hljs-number">0</span>,
    t24 = <span class="hljs-number">0</span>, t25 = <span class="hljs-number">0</span>, t26 = <span class="hljs-number">0</span>, t27 = <span class="hljs-number">0</span>, t28 = <span class="hljs-number">0</span>, t29 = <span class="hljs-number">0</span>, t30 = <span class="hljs-number">0</span>,
    b0 = b[<span class="hljs-number">0</span>],
    b1 = b[<span class="hljs-number">1</span>],
    b2 = b[<span class="hljs-number">2</span>],
    b3 = b[<span class="hljs-number">3</span>],
    b4 = b[<span class="hljs-number">4</span>],
    b5 = b[<span class="hljs-number">5</span>],
    b6 = b[<span class="hljs-number">6</span>],
    b7 = b[<span class="hljs-number">7</span>],
    b8 = b[<span class="hljs-number">8</span>],
    b9 = b[<span class="hljs-number">9</span>],
    b10 = b[<span class="hljs-number">10</span>],
    b11 = b[<span class="hljs-number">11</span>],
    b12 = b[<span class="hljs-number">12</span>],
    b13 = b[<span class="hljs-number">13</span>],
    b14 = b[<span class="hljs-number">14</span>],
    b15 = b[<span class="hljs-number">15</span>];

  v = a[<span class="hljs-number">0</span>];
  t0 += v * b0;
  t1 += v * b1;
  t2 += v * b2;
  t3 += v * b3;
  t4 += v * b4;
  t5 += v * b5;
  t6 += v * b6;
  t7 += v * b7;
  t8 += v * b8;
  t9 += v * b9;
  t10 += v * b10;
  t11 += v * b11;
  t12 += v * b12;
  t13 += v * b13;
  t14 += v * b14;
  t15 += v * b15;
  v = a[<span class="hljs-number">1</span>];
  t1 += v * b0;
  t2 += v * b1;
  t3 += v * b2;
  t4 += v * b3;
  t5 += v * b4;
  t6 += v * b5;
  t7 += v * b6;
  t8 += v * b7;
  t9 += v * b8;
  t10 += v * b9;
  t11 += v * b10;
  t12 += v * b11;
  t13 += v * b12;
  t14 += v * b13;
  t15 += v * b14;
  t16 += v * b15;
  v = a[<span class="hljs-number">2</span>];
  t2 += v * b0;
  t3 += v * b1;
  t4 += v * b2;
  t5 += v * b3;
  t6 += v * b4;
  t7 += v * b5;
  t8 += v * b6;
  t9 += v * b7;
  t10 += v * b8;
  t11 += v * b9;
  t12 += v * b10;
  t13 += v * b11;
  t14 += v * b12;
  t15 += v * b13;
  t16 += v * b14;
  t17 += v * b15;
  v = a[<span class="hljs-number">3</span>];
  t3 += v * b0;
  t4 += v * b1;
  t5 += v * b2;
  t6 += v * b3;
  t7 += v * b4;
  t8 += v * b5;
  t9 += v * b6;
  t10 += v * b7;
  t11 += v * b8;
  t12 += v * b9;
  t13 += v * b10;
  t14 += v * b11;
  t15 += v * b12;
  t16 += v * b13;
  t17 += v * b14;
  t18 += v * b15;
  v = a[<span class="hljs-number">4</span>];
  t4 += v * b0;
  t5 += v * b1;
  t6 += v * b2;
  t7 += v * b3;
  t8 += v * b4;
  t9 += v * b5;
  t10 += v * b6;
  t11 += v * b7;
  t12 += v * b8;
  t13 += v * b9;
  t14 += v * b10;
  t15 += v * b11;
  t16 += v * b12;
  t17 += v * b13;
  t18 += v * b14;
  t19 += v * b15;
  v = a[<span class="hljs-number">5</span>];
  t5 += v * b0;
  t6 += v * b1;
  t7 += v * b2;
  t8 += v * b3;
  t9 += v * b4;
  t10 += v * b5;
  t11 += v * b6;
  t12 += v * b7;
  t13 += v * b8;
  t14 += v * b9;
  t15 += v * b10;
  t16 += v * b11;
  t17 += v * b12;
  t18 += v * b13;
  t19 += v * b14;
  t20 += v * b15;
  v = a[<span class="hljs-number">6</span>];
  t6 += v * b0;
  t7 += v * b1;
  t8 += v * b2;
  t9 += v * b3;
  t10 += v * b4;
  t11 += v * b5;
  t12 += v * b6;
  t13 += v * b7;
  t14 += v * b8;
  t15 += v * b9;
  t16 += v * b10;
  t17 += v * b11;
  t18 += v * b12;
  t19 += v * b13;
  t20 += v * b14;
  t21 += v * b15;
  v = a[<span class="hljs-number">7</span>];
  t7 += v * b0;
  t8 += v * b1;
  t9 += v * b2;
  t10 += v * b3;
  t11 += v * b4;
  t12 += v * b5;
  t13 += v * b6;
  t14 += v * b7;
  t15 += v * b8;
  t16 += v * b9;
  t17 += v * b10;
  t18 += v * b11;
  t19 += v * b12;
  t20 += v * b13;
  t21 += v * b14;
  t22 += v * b15;
  v = a[<span class="hljs-number">8</span>];
  t8 += v * b0;
  t9 += v * b1;
  t10 += v * b2;
  t11 += v * b3;
  t12 += v * b4;
  t13 += v * b5;
  t14 += v * b6;
  t15 += v * b7;
  t16 += v * b8;
  t17 += v * b9;
  t18 += v * b10;
  t19 += v * b11;
  t20 += v * b12;
  t21 += v * b13;
  t22 += v * b14;
  t23 += v * b15;
  v = a[<span class="hljs-number">9</span>];
  t9 += v * b0;
  t10 += v * b1;
  t11 += v * b2;
  t12 += v * b3;
  t13 += v * b4;
  t14 += v * b5;
  t15 += v * b6;
  t16 += v * b7;
  t17 += v * b8;
  t18 += v * b9;
  t19 += v * b10;
  t20 += v * b11;
  t21 += v * b12;
  t22 += v * b13;
  t23 += v * b14;
  t24 += v * b15;
  v = a[<span class="hljs-number">10</span>];
  t10 += v * b0;
  t11 += v * b1;
  t12 += v * b2;
  t13 += v * b3;
  t14 += v * b4;
  t15 += v * b5;
  t16 += v * b6;
  t17 += v * b7;
  t18 += v * b8;
  t19 += v * b9;
  t20 += v * b10;
  t21 += v * b11;
  t22 += v * b12;
  t23 += v * b13;
  t24 += v * b14;
  t25 += v * b15;
  v = a[<span class="hljs-number">11</span>];
  t11 += v * b0;
  t12 += v * b1;
  t13 += v * b2;
  t14 += v * b3;
  t15 += v * b4;
  t16 += v * b5;
  t17 += v * b6;
  t18 += v * b7;
  t19 += v * b8;
  t20 += v * b9;
  t21 += v * b10;
  t22 += v * b11;
  t23 += v * b12;
  t24 += v * b13;
  t25 += v * b14;
  t26 += v * b15;
  v = a[<span class="hljs-number">12</span>];
  t12 += v * b0;
  t13 += v * b1;
  t14 += v * b2;
  t15 += v * b3;
  t16 += v * b4;
  t17 += v * b5;
  t18 += v * b6;
  t19 += v * b7;
  t20 += v * b8;
  t21 += v * b9;
  t22 += v * b10;
  t23 += v * b11;
  t24 += v * b12;
  t25 += v * b13;
  t26 += v * b14;
  t27 += v * b15;
  v = a[<span class="hljs-number">13</span>];
  t13 += v * b0;
  t14 += v * b1;
  t15 += v * b2;
  t16 += v * b3;
  t17 += v * b4;
  t18 += v * b5;
  t19 += v * b6;
  t20 += v * b7;
  t21 += v * b8;
  t22 += v * b9;
  t23 += v * b10;
  t24 += v * b11;
  t25 += v * b12;
  t26 += v * b13;
  t27 += v * b14;
  t28 += v * b15;
  v = a[<span class="hljs-number">14</span>];
  t14 += v * b0;
  t15 += v * b1;
  t16 += v * b2;
  t17 += v * b3;
  t18 += v * b4;
  t19 += v * b5;
  t20 += v * b6;
  t21 += v * b7;
  t22 += v * b8;
  t23 += v * b9;
  t24 += v * b10;
  t25 += v * b11;
  t26 += v * b12;
  t27 += v * b13;
  t28 += v * b14;
  t29 += v * b15;
  v = a[<span class="hljs-number">15</span>];
  t15 += v * b0;
  t16 += v * b1;
  t17 += v * b2;
  t18 += v * b3;
  t19 += v * b4;
  t20 += v * b5;
  t21 += v * b6;
  t22 += v * b7;
  t23 += v * b8;
  t24 += v * b9;
  t25 += v * b10;
  t26 += v * b11;
  t27 += v * b12;
  t28 += v * b13;
  t29 += v * b14;
  t30 += v * b15;

  t0  += <span class="hljs-number">38</span> * t16;
  t1  += <span class="hljs-number">38</span> * t17;
  t2  += <span class="hljs-number">38</span> * t18;
  t3  += <span class="hljs-number">38</span> * t19;
  t4  += <span class="hljs-number">38</span> * t20;
  t5  += <span class="hljs-number">38</span> * t21;
  t6  += <span class="hljs-number">38</span> * t22;
  t7  += <span class="hljs-number">38</span> * t23;
  t8  += <span class="hljs-number">38</span> * t24;
  t9  += <span class="hljs-number">38</span> * t25;
  t10 += <span class="hljs-number">38</span> * t26;
  t11 += <span class="hljs-number">38</span> * t27;
  t12 += <span class="hljs-number">38</span> * t28;
  t13 += <span class="hljs-number">38</span> * t29;
  t14 += <span class="hljs-number">38</span> * t30;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>t15 left as is</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>first car</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  c = <span class="hljs-number">1</span>;
  v =  t0 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t0 = v - c * <span class="hljs-number">65536</span>;
  v =  t1 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t1 = v - c * <span class="hljs-number">65536</span>;
  v =  t2 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t2 = v - c * <span class="hljs-number">65536</span>;
  v =  t3 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t3 = v - c * <span class="hljs-number">65536</span>;
  v =  t4 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t4 = v - c * <span class="hljs-number">65536</span>;
  v =  t5 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t5 = v - c * <span class="hljs-number">65536</span>;
  v =  t6 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t6 = v - c * <span class="hljs-number">65536</span>;
  v =  t7 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t7 = v - c * <span class="hljs-number">65536</span>;
  v =  t8 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t8 = v - c * <span class="hljs-number">65536</span>;
  v =  t9 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t9 = v - c * <span class="hljs-number">65536</span>;
  v = t10 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t10 = v - c * <span class="hljs-number">65536</span>;
  v = t11 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t11 = v - c * <span class="hljs-number">65536</span>;
  v = t12 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t12 = v - c * <span class="hljs-number">65536</span>;
  v = t13 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t13 = v - c * <span class="hljs-number">65536</span>;
  v = t14 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t14 = v - c * <span class="hljs-number">65536</span>;
  v = t15 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t15 = v - c * <span class="hljs-number">65536</span>;
  t0 += c<span class="hljs-number">-1</span> + <span class="hljs-number">37</span> * (c<span class="hljs-number">-1</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>second car</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  c = <span class="hljs-number">1</span>;
  v =  t0 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t0 = v - c * <span class="hljs-number">65536</span>;
  v =  t1 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t1 = v - c * <span class="hljs-number">65536</span>;
  v =  t2 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t2 = v - c * <span class="hljs-number">65536</span>;
  v =  t3 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t3 = v - c * <span class="hljs-number">65536</span>;
  v =  t4 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t4 = v - c * <span class="hljs-number">65536</span>;
  v =  t5 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t5 = v - c * <span class="hljs-number">65536</span>;
  v =  t6 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t6 = v - c * <span class="hljs-number">65536</span>;
  v =  t7 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t7 = v - c * <span class="hljs-number">65536</span>;
  v =  t8 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t8 = v - c * <span class="hljs-number">65536</span>;
  v =  t9 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>);  t9 = v - c * <span class="hljs-number">65536</span>;
  v = t10 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t10 = v - c * <span class="hljs-number">65536</span>;
  v = t11 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t11 = v - c * <span class="hljs-number">65536</span>;
  v = t12 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t12 = v - c * <span class="hljs-number">65536</span>;
  v = t13 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t13 = v - c * <span class="hljs-number">65536</span>;
  v = t14 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t14 = v - c * <span class="hljs-number">65536</span>;
  v = t15 + c + <span class="hljs-number">65535</span>; c = <span class="hljs-built_in">Math</span>.floor(v / <span class="hljs-number">65536</span>); t15 = v - c * <span class="hljs-number">65536</span>;
  t0 += c<span class="hljs-number">-1</span> + <span class="hljs-number">37</span> * (c<span class="hljs-number">-1</span>);

  o[ <span class="hljs-number">0</span>] = t0;
  o[ <span class="hljs-number">1</span>] = t1;
  o[ <span class="hljs-number">2</span>] = t2;
  o[ <span class="hljs-number">3</span>] = t3;
  o[ <span class="hljs-number">4</span>] = t4;
  o[ <span class="hljs-number">5</span>] = t5;
  o[ <span class="hljs-number">6</span>] = t6;
  o[ <span class="hljs-number">7</span>] = t7;
  o[ <span class="hljs-number">8</span>] = t8;
  o[ <span class="hljs-number">9</span>] = t9;
  o[<span class="hljs-number">10</span>] = t10;
  o[<span class="hljs-number">11</span>] = t11;
  o[<span class="hljs-number">12</span>] = t12;
  o[<span class="hljs-number">13</span>] = t13;
  o[<span class="hljs-number">14</span>] = t14;
  o[<span class="hljs-number">15</span>] = t15;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">S</span>(<span class="hljs-params">o, a</span>) </span>{
  M(o, a, a);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inv25519</span>(<span class="hljs-params">o, i</span>) </span>{
  <span class="hljs-keyword">var</span> c = gf();
  <span class="hljs-keyword">var</span> a;
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">0</span>; a &lt; <span class="hljs-number">16</span>; a++) c[a] = i[a];
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">253</span>; a &gt;= <span class="hljs-number">0</span>; a--) {
    S(c, c);
    <span class="hljs-keyword">if</span>(a !== <span class="hljs-number">2</span> &amp;&amp; a !== <span class="hljs-number">4</span>) M(c, c, i);
  }
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">0</span>; a &lt; <span class="hljs-number">16</span>; a++) o[a] = c[a];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pow2523</span>(<span class="hljs-params">o, i</span>) </span>{
  <span class="hljs-keyword">var</span> c = gf();
  <span class="hljs-keyword">var</span> a;
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">0</span>; a &lt; <span class="hljs-number">16</span>; a++) c[a] = i[a];
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">250</span>; a &gt;= <span class="hljs-number">0</span>; a--) {
      S(c, c);
      <span class="hljs-keyword">if</span>(a !== <span class="hljs-number">1</span>) M(c, c, i);
  }
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">0</span>; a &lt; <span class="hljs-number">16</span>; a++) o[a] = c[a];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_scalarmult</span>(<span class="hljs-params">q, n, p</span>) </span>{
  <span class="hljs-keyword">var</span> z = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  <span class="hljs-keyword">var</span> x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(<span class="hljs-number">80</span>), r, i;
  <span class="hljs-keyword">var</span> a = gf(), b = gf(), c = gf(),
      d = gf(), e = gf(), f = gf();
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">31</span>; i++) z[i] = n[i];
  z[<span class="hljs-number">31</span>]=(n[<span class="hljs-number">31</span>]&amp;<span class="hljs-number">127</span>)|<span class="hljs-number">64</span>;
  z[<span class="hljs-number">0</span>]&amp;=<span class="hljs-number">248</span>;
  unpack25519(x,p);
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
    b[i]=x[i];
    d[i]=a[i]=c[i]=<span class="hljs-number">0</span>;
  }
  a[<span class="hljs-number">0</span>]=d[<span class="hljs-number">0</span>]=<span class="hljs-number">1</span>;
  <span class="hljs-keyword">for</span> (i=<span class="hljs-number">254</span>; i&gt;=<span class="hljs-number">0</span>; --i) {
    r=(z[i&gt;&gt;&gt;<span class="hljs-number">3</span>]&gt;&gt;&gt;(i&amp;<span class="hljs-number">7</span>))&amp;<span class="hljs-number">1</span>;
    sel25519(a,b,r);
    sel25519(c,d,r);
    A(e,a,c);
    Z(a,a,c);
    A(c,b,d);
    Z(b,b,d);
    S(d,e);
    S(f,a);
    M(a,c,a);
    M(c,b,e);
    A(e,a,c);
    Z(a,a,c);
    S(b,a);
    Z(c,d,f);
    M(a,c,_121665);
    A(a,a,d);
    M(c,c,a);
    M(a,d,f);
    M(d,b,x);
    S(b,e);
    sel25519(a,b,r);
    sel25519(c,d,r);
  }
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
    x[i+<span class="hljs-number">16</span>]=a[i];
    x[i+<span class="hljs-number">32</span>]=c[i];
    x[i+<span class="hljs-number">48</span>]=b[i];
    x[i+<span class="hljs-number">64</span>]=d[i];
  }
  <span class="hljs-keyword">var</span> x32 = x.subarray(<span class="hljs-number">32</span>);
  <span class="hljs-keyword">var</span> x16 = x.subarray(<span class="hljs-number">16</span>);
  inv25519(x32,x32);
  M(x16,x16,x32);
  pack25519(q,x16);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_scalarmult_base</span>(<span class="hljs-params">q, n</span>) </span>{
  <span class="hljs-keyword">return</span> crypto_scalarmult(q, n, _9);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_box_keypair</span>(<span class="hljs-params">y, x</span>) </span>{
  randombytes(x, <span class="hljs-number">32</span>);
  <span class="hljs-keyword">return</span> crypto_scalarmult_base(y, x);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_box_beforenm</span>(<span class="hljs-params">k, y, x</span>) </span>{
  <span class="hljs-keyword">var</span> s = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  crypto_scalarmult(s, x, y);
  <span class="hljs-keyword">return</span> crypto_core_hsalsa20(k, _0, s, sigma);
}

<span class="hljs-keyword">var</span> crypto_box_afternm = crypto_secretbox;
<span class="hljs-keyword">var</span> crypto_box_open_afternm = crypto_secretbox_open;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_box</span>(<span class="hljs-params">c, m, d, n, y, x</span>) </span>{
  <span class="hljs-keyword">var</span> k = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  crypto_box_beforenm(k, y, x);
  <span class="hljs-keyword">return</span> crypto_box_afternm(c, m, d, n, k);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_box_open</span>(<span class="hljs-params">m, c, d, n, y, x</span>) </span>{
  <span class="hljs-keyword">var</span> k = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  crypto_box_beforenm(k, y, x);
  <span class="hljs-keyword">return</span> crypto_box_open_afternm(m, c, d, n, k);
}

<span class="hljs-keyword">var</span> K = [
  <span class="hljs-number">0x428a2f98</span>, <span class="hljs-number">0xd728ae22</span>, <span class="hljs-number">0x71374491</span>, <span class="hljs-number">0x23ef65cd</span>,
  <span class="hljs-number">0xb5c0fbcf</span>, <span class="hljs-number">0xec4d3b2f</span>, <span class="hljs-number">0xe9b5dba5</span>, <span class="hljs-number">0x8189dbbc</span>,
  <span class="hljs-number">0x3956c25b</span>, <span class="hljs-number">0xf348b538</span>, <span class="hljs-number">0x59f111f1</span>, <span class="hljs-number">0xb605d019</span>,
  <span class="hljs-number">0x923f82a4</span>, <span class="hljs-number">0xaf194f9b</span>, <span class="hljs-number">0xab1c5ed5</span>, <span class="hljs-number">0xda6d8118</span>,
  <span class="hljs-number">0xd807aa98</span>, <span class="hljs-number">0xa3030242</span>, <span class="hljs-number">0x12835b01</span>, <span class="hljs-number">0x45706fbe</span>,
  <span class="hljs-number">0x243185be</span>, <span class="hljs-number">0x4ee4b28c</span>, <span class="hljs-number">0x550c7dc3</span>, <span class="hljs-number">0xd5ffb4e2</span>,
  <span class="hljs-number">0x72be5d74</span>, <span class="hljs-number">0xf27b896f</span>, <span class="hljs-number">0x80deb1fe</span>, <span class="hljs-number">0x3b1696b1</span>,
  <span class="hljs-number">0x9bdc06a7</span>, <span class="hljs-number">0x25c71235</span>, <span class="hljs-number">0xc19bf174</span>, <span class="hljs-number">0xcf692694</span>,
  <span class="hljs-number">0xe49b69c1</span>, <span class="hljs-number">0x9ef14ad2</span>, <span class="hljs-number">0xefbe4786</span>, <span class="hljs-number">0x384f25e3</span>,
  <span class="hljs-number">0x0fc19dc6</span>, <span class="hljs-number">0x8b8cd5b5</span>, <span class="hljs-number">0x240ca1cc</span>, <span class="hljs-number">0x77ac9c65</span>,
  <span class="hljs-number">0x2de92c6f</span>, <span class="hljs-number">0x592b0275</span>, <span class="hljs-number">0x4a7484aa</span>, <span class="hljs-number">0x6ea6e483</span>,
  <span class="hljs-number">0x5cb0a9dc</span>, <span class="hljs-number">0xbd41fbd4</span>, <span class="hljs-number">0x76f988da</span>, <span class="hljs-number">0x831153b5</span>,
  <span class="hljs-number">0x983e5152</span>, <span class="hljs-number">0xee66dfab</span>, <span class="hljs-number">0xa831c66d</span>, <span class="hljs-number">0x2db43210</span>,
  <span class="hljs-number">0xb00327c8</span>, <span class="hljs-number">0x98fb213f</span>, <span class="hljs-number">0xbf597fc7</span>, <span class="hljs-number">0xbeef0ee4</span>,
  <span class="hljs-number">0xc6e00bf3</span>, <span class="hljs-number">0x3da88fc2</span>, <span class="hljs-number">0xd5a79147</span>, <span class="hljs-number">0x930aa725</span>,
  <span class="hljs-number">0x06ca6351</span>, <span class="hljs-number">0xe003826f</span>, <span class="hljs-number">0x14292967</span>, <span class="hljs-number">0x0a0e6e70</span>,
  <span class="hljs-number">0x27b70a85</span>, <span class="hljs-number">0x46d22ffc</span>, <span class="hljs-number">0x2e1b2138</span>, <span class="hljs-number">0x5c26c926</span>,
  <span class="hljs-number">0x4d2c6dfc</span>, <span class="hljs-number">0x5ac42aed</span>, <span class="hljs-number">0x53380d13</span>, <span class="hljs-number">0x9d95b3df</span>,
  <span class="hljs-number">0x650a7354</span>, <span class="hljs-number">0x8baf63de</span>, <span class="hljs-number">0x766a0abb</span>, <span class="hljs-number">0x3c77b2a8</span>,
  <span class="hljs-number">0x81c2c92e</span>, <span class="hljs-number">0x47edaee6</span>, <span class="hljs-number">0x92722c85</span>, <span class="hljs-number">0x1482353b</span>,
  <span class="hljs-number">0xa2bfe8a1</span>, <span class="hljs-number">0x4cf10364</span>, <span class="hljs-number">0xa81a664b</span>, <span class="hljs-number">0xbc423001</span>,
  <span class="hljs-number">0xc24b8b70</span>, <span class="hljs-number">0xd0f89791</span>, <span class="hljs-number">0xc76c51a3</span>, <span class="hljs-number">0x0654be30</span>,
  <span class="hljs-number">0xd192e819</span>, <span class="hljs-number">0xd6ef5218</span>, <span class="hljs-number">0xd6990624</span>, <span class="hljs-number">0x5565a910</span>,
  <span class="hljs-number">0xf40e3585</span>, <span class="hljs-number">0x5771202a</span>, <span class="hljs-number">0x106aa070</span>, <span class="hljs-number">0x32bbd1b8</span>,
  <span class="hljs-number">0x19a4c116</span>, <span class="hljs-number">0xb8d2d0c8</span>, <span class="hljs-number">0x1e376c08</span>, <span class="hljs-number">0x5141ab53</span>,
  <span class="hljs-number">0x2748774c</span>, <span class="hljs-number">0xdf8eeb99</span>, <span class="hljs-number">0x34b0bcb5</span>, <span class="hljs-number">0xe19b48a8</span>,
  <span class="hljs-number">0x391c0cb3</span>, <span class="hljs-number">0xc5c95a63</span>, <span class="hljs-number">0x4ed8aa4a</span>, <span class="hljs-number">0xe3418acb</span>,
  <span class="hljs-number">0x5b9cca4f</span>, <span class="hljs-number">0x7763e373</span>, <span class="hljs-number">0x682e6ff3</span>, <span class="hljs-number">0xd6b2b8a3</span>,
  <span class="hljs-number">0x748f82ee</span>, <span class="hljs-number">0x5defb2fc</span>, <span class="hljs-number">0x78a5636f</span>, <span class="hljs-number">0x43172f60</span>,
  <span class="hljs-number">0x84c87814</span>, <span class="hljs-number">0xa1f0ab72</span>, <span class="hljs-number">0x8cc70208</span>, <span class="hljs-number">0x1a6439ec</span>,
  <span class="hljs-number">0x90befffa</span>, <span class="hljs-number">0x23631e28</span>, <span class="hljs-number">0xa4506ceb</span>, <span class="hljs-number">0xde82bde9</span>,
  <span class="hljs-number">0xbef9a3f7</span>, <span class="hljs-number">0xb2c67915</span>, <span class="hljs-number">0xc67178f2</span>, <span class="hljs-number">0xe372532b</span>,
  <span class="hljs-number">0xca273ece</span>, <span class="hljs-number">0xea26619c</span>, <span class="hljs-number">0xd186b8c7</span>, <span class="hljs-number">0x21c0c207</span>,
  <span class="hljs-number">0xeada7dd6</span>, <span class="hljs-number">0xcde0eb1e</span>, <span class="hljs-number">0xf57d4f7f</span>, <span class="hljs-number">0xee6ed178</span>,
  <span class="hljs-number">0x06f067aa</span>, <span class="hljs-number">0x72176fba</span>, <span class="hljs-number">0x0a637dc5</span>, <span class="hljs-number">0xa2c898a6</span>,
  <span class="hljs-number">0x113f9804</span>, <span class="hljs-number">0xbef90dae</span>, <span class="hljs-number">0x1b710b35</span>, <span class="hljs-number">0x131c471b</span>,
  <span class="hljs-number">0x28db77f5</span>, <span class="hljs-number">0x23047d84</span>, <span class="hljs-number">0x32caab7b</span>, <span class="hljs-number">0x40c72493</span>,
  <span class="hljs-number">0x3c9ebe0a</span>, <span class="hljs-number">0x15c9bebc</span>, <span class="hljs-number">0x431d67c4</span>, <span class="hljs-number">0x9c100d4c</span>,
  <span class="hljs-number">0x4cc5d4be</span>, <span class="hljs-number">0xcb3e42b6</span>, <span class="hljs-number">0x597f299c</span>, <span class="hljs-number">0xfc657e2a</span>,
  <span class="hljs-number">0x5fcb6fab</span>, <span class="hljs-number">0x3ad6faec</span>, <span class="hljs-number">0x6c44198c</span>, <span class="hljs-number">0x4a475817</span>
];

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_hashblocks_hl</span>(<span class="hljs-params">hh, hl, m, n</span>) </span>{
  <span class="hljs-keyword">var</span> wh = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Int32Array</span>(<span class="hljs-number">16</span>), wl = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Int32Array</span>(<span class="hljs-number">16</span>),
      bh0, bh1, bh2, bh3, bh4, bh5, bh6, bh7,
      bl0, bl1, bl2, bl3, bl4, bl5, bl6, bl7,
      th, tl, i, j, h, l, a, b, c, d;

  <span class="hljs-keyword">var</span> ah0 = hh[<span class="hljs-number">0</span>],
      ah1 = hh[<span class="hljs-number">1</span>],
      ah2 = hh[<span class="hljs-number">2</span>],
      ah3 = hh[<span class="hljs-number">3</span>],
      ah4 = hh[<span class="hljs-number">4</span>],
      ah5 = hh[<span class="hljs-number">5</span>],
      ah6 = hh[<span class="hljs-number">6</span>],
      ah7 = hh[<span class="hljs-number">7</span>],

      al0 = hl[<span class="hljs-number">0</span>],
      al1 = hl[<span class="hljs-number">1</span>],
      al2 = hl[<span class="hljs-number">2</span>],
      al3 = hl[<span class="hljs-number">3</span>],
      al4 = hl[<span class="hljs-number">4</span>],
      al5 = hl[<span class="hljs-number">5</span>],
      al6 = hl[<span class="hljs-number">6</span>],
      al7 = hl[<span class="hljs-number">7</span>];

  <span class="hljs-keyword">var</span> pos = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (n &gt;= <span class="hljs-number">128</span>) {
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
      j = <span class="hljs-number">8</span> * i + pos;
      wh[i] = (m[j+<span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-number">24</span>) | (m[j+<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">16</span>) | (m[j+<span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">8</span>) | m[j+<span class="hljs-number">3</span>];
      wl[i] = (m[j+<span class="hljs-number">4</span>] &lt;&lt; <span class="hljs-number">24</span>) | (m[j+<span class="hljs-number">5</span>] &lt;&lt; <span class="hljs-number">16</span>) | (m[j+<span class="hljs-number">6</span>] &lt;&lt; <span class="hljs-number">8</span>) | m[j+<span class="hljs-number">7</span>];
    }
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">80</span>; i++) {
      bh0 = ah0;
      bh1 = ah1;
      bh2 = ah2;
      bh3 = ah3;
      bh4 = ah4;
      bh5 = ah5;
      bh6 = ah6;
      bh7 = ah7;

      bl0 = al0;
      bl1 = al1;
      bl2 = al2;
      bl3 = al3;
      bl4 = al4;
      bl5 = al5;
      bl6 = al6;
      bl7 = al7;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>add</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      h = ah7;
      l = al7;

      a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Sigma1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      h = ((ah4 &gt;&gt;&gt; <span class="hljs-number">14</span>) | (al4 &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-14</span>))) ^ ((ah4 &gt;&gt;&gt; <span class="hljs-number">18</span>) | (al4 &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-18</span>))) ^ ((al4 &gt;&gt;&gt; (<span class="hljs-number">41</span><span class="hljs-number">-32</span>)) | (ah4 &lt;&lt; (<span class="hljs-number">32</span>-(<span class="hljs-number">41</span><span class="hljs-number">-32</span>))));
      l = ((al4 &gt;&gt;&gt; <span class="hljs-number">14</span>) | (ah4 &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-14</span>))) ^ ((al4 &gt;&gt;&gt; <span class="hljs-number">18</span>) | (ah4 &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-18</span>))) ^ ((ah4 &gt;&gt;&gt; (<span class="hljs-number">41</span><span class="hljs-number">-32</span>)) | (al4 &lt;&lt; (<span class="hljs-number">32</span>-(<span class="hljs-number">41</span><span class="hljs-number">-32</span>))));

      a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Ch</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      h = (ah4 &amp; ah5) ^ (~ah4 &amp; ah6);
      l = (al4 &amp; al5) ^ (~al4 &amp; al6);

      a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>K</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      h = K[i*<span class="hljs-number">2</span>];
      l = K[i*<span class="hljs-number">2</span>+<span class="hljs-number">1</span>];

      a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>w</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      h = wh[i%<span class="hljs-number">16</span>];
      l = wl[i%<span class="hljs-number">16</span>];

      a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

      b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
      d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

      th = c &amp; <span class="hljs-number">0xffff</span> | d &lt;&lt; <span class="hljs-number">16</span>;
      tl = a &amp; <span class="hljs-number">0xffff</span> | b &lt;&lt; <span class="hljs-number">16</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>add</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      h = th;
      l = tl;

      a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Sigma0</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      h = ((ah0 &gt;&gt;&gt; <span class="hljs-number">28</span>) | (al0 &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-28</span>))) ^ ((al0 &gt;&gt;&gt; (<span class="hljs-number">34</span><span class="hljs-number">-32</span>)) | (ah0 &lt;&lt; (<span class="hljs-number">32</span>-(<span class="hljs-number">34</span><span class="hljs-number">-32</span>)))) ^ ((al0 &gt;&gt;&gt; (<span class="hljs-number">39</span><span class="hljs-number">-32</span>)) | (ah0 &lt;&lt; (<span class="hljs-number">32</span>-(<span class="hljs-number">39</span><span class="hljs-number">-32</span>))));
      l = ((al0 &gt;&gt;&gt; <span class="hljs-number">28</span>) | (ah0 &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-28</span>))) ^ ((ah0 &gt;&gt;&gt; (<span class="hljs-number">34</span><span class="hljs-number">-32</span>)) | (al0 &lt;&lt; (<span class="hljs-number">32</span>-(<span class="hljs-number">34</span><span class="hljs-number">-32</span>)))) ^ ((ah0 &gt;&gt;&gt; (<span class="hljs-number">39</span><span class="hljs-number">-32</span>)) | (al0 &lt;&lt; (<span class="hljs-number">32</span>-(<span class="hljs-number">39</span><span class="hljs-number">-32</span>))));

      a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>Maj</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      h = (ah0 &amp; ah1) ^ (ah0 &amp; ah2) ^ (ah1 &amp; ah2);
      l = (al0 &amp; al1) ^ (al0 &amp; al2) ^ (al1 &amp; al2);

      a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

      b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
      d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

      bh7 = (c &amp; <span class="hljs-number">0xffff</span>) | (d &lt;&lt; <span class="hljs-number">16</span>);
      bl7 = (a &amp; <span class="hljs-number">0xffff</span>) | (b &lt;&lt; <span class="hljs-number">16</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>add</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      h = bh3;
      l = bl3;

      a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

      h = th;
      l = tl;

      a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

      b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
      c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
      d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

      bh3 = (c &amp; <span class="hljs-number">0xffff</span>) | (d &lt;&lt; <span class="hljs-number">16</span>);
      bl3 = (a &amp; <span class="hljs-number">0xffff</span>) | (b &lt;&lt; <span class="hljs-number">16</span>);

      ah1 = bh0;
      ah2 = bh1;
      ah3 = bh2;
      ah4 = bh3;
      ah5 = bh4;
      ah6 = bh5;
      ah7 = bh6;
      ah0 = bh7;

      al1 = bl0;
      al2 = bl1;
      al3 = bl2;
      al4 = bl3;
      al5 = bl4;
      al6 = bl5;
      al7 = bl6;
      al0 = bl7;

      <span class="hljs-keyword">if</span> (i%<span class="hljs-number">16</span> === <span class="hljs-number">15</span>) {
        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>add</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          h = wh[j];
          l = wl[j];

          a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
          c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

          h = wh[(j+<span class="hljs-number">9</span>)%<span class="hljs-number">16</span>];
          l = wl[(j+<span class="hljs-number">9</span>)%<span class="hljs-number">16</span>];

          a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
          c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>sigma0</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          th = wh[(j+<span class="hljs-number">1</span>)%<span class="hljs-number">16</span>];
          tl = wl[(j+<span class="hljs-number">1</span>)%<span class="hljs-number">16</span>];
          h = ((th &gt;&gt;&gt; <span class="hljs-number">1</span>) | (tl &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-1</span>))) ^ ((th &gt;&gt;&gt; <span class="hljs-number">8</span>) | (tl &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-8</span>))) ^ (th &gt;&gt;&gt; <span class="hljs-number">7</span>);
          l = ((tl &gt;&gt;&gt; <span class="hljs-number">1</span>) | (th &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-1</span>))) ^ ((tl &gt;&gt;&gt; <span class="hljs-number">8</span>) | (th &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-8</span>))) ^ ((tl &gt;&gt;&gt; <span class="hljs-number">7</span>) | (th &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-7</span>)));

          a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
          c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>sigma1</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          th = wh[(j+<span class="hljs-number">14</span>)%<span class="hljs-number">16</span>];
          tl = wl[(j+<span class="hljs-number">14</span>)%<span class="hljs-number">16</span>];
          h = ((th &gt;&gt;&gt; <span class="hljs-number">19</span>) | (tl &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-19</span>))) ^ ((tl &gt;&gt;&gt; (<span class="hljs-number">61</span><span class="hljs-number">-32</span>)) | (th &lt;&lt; (<span class="hljs-number">32</span>-(<span class="hljs-number">61</span><span class="hljs-number">-32</span>)))) ^ (th &gt;&gt;&gt; <span class="hljs-number">6</span>);
          l = ((tl &gt;&gt;&gt; <span class="hljs-number">19</span>) | (th &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-19</span>))) ^ ((th &gt;&gt;&gt; (<span class="hljs-number">61</span><span class="hljs-number">-32</span>)) | (tl &lt;&lt; (<span class="hljs-number">32</span>-(<span class="hljs-number">61</span><span class="hljs-number">-32</span>)))) ^ ((tl &gt;&gt;&gt; <span class="hljs-number">6</span>) | (th &lt;&lt; (<span class="hljs-number">32</span><span class="hljs-number">-6</span>)));

          a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
          c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

          b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
          c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
          d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

          wh[j] = (c &amp; <span class="hljs-number">0xffff</span>) | (d &lt;&lt; <span class="hljs-number">16</span>);
          wl[j] = (a &amp; <span class="hljs-number">0xffff</span>) | (b &lt;&lt; <span class="hljs-number">16</span>);
        }
      }
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>add</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    h = ah0;
    l = al0;

    a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    h = hh[<span class="hljs-number">0</span>];
    l = hl[<span class="hljs-number">0</span>];

    a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
    d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

    hh[<span class="hljs-number">0</span>] = ah0 = (c &amp; <span class="hljs-number">0xffff</span>) | (d &lt;&lt; <span class="hljs-number">16</span>);
    hl[<span class="hljs-number">0</span>] = al0 = (a &amp; <span class="hljs-number">0xffff</span>) | (b &lt;&lt; <span class="hljs-number">16</span>);

    h = ah1;
    l = al1;

    a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    h = hh[<span class="hljs-number">1</span>];
    l = hl[<span class="hljs-number">1</span>];

    a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
    d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

    hh[<span class="hljs-number">1</span>] = ah1 = (c &amp; <span class="hljs-number">0xffff</span>) | (d &lt;&lt; <span class="hljs-number">16</span>);
    hl[<span class="hljs-number">1</span>] = al1 = (a &amp; <span class="hljs-number">0xffff</span>) | (b &lt;&lt; <span class="hljs-number">16</span>);

    h = ah2;
    l = al2;

    a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    h = hh[<span class="hljs-number">2</span>];
    l = hl[<span class="hljs-number">2</span>];

    a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
    d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

    hh[<span class="hljs-number">2</span>] = ah2 = (c &amp; <span class="hljs-number">0xffff</span>) | (d &lt;&lt; <span class="hljs-number">16</span>);
    hl[<span class="hljs-number">2</span>] = al2 = (a &amp; <span class="hljs-number">0xffff</span>) | (b &lt;&lt; <span class="hljs-number">16</span>);

    h = ah3;
    l = al3;

    a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    h = hh[<span class="hljs-number">3</span>];
    l = hl[<span class="hljs-number">3</span>];

    a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
    d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

    hh[<span class="hljs-number">3</span>] = ah3 = (c &amp; <span class="hljs-number">0xffff</span>) | (d &lt;&lt; <span class="hljs-number">16</span>);
    hl[<span class="hljs-number">3</span>] = al3 = (a &amp; <span class="hljs-number">0xffff</span>) | (b &lt;&lt; <span class="hljs-number">16</span>);

    h = ah4;
    l = al4;

    a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    h = hh[<span class="hljs-number">4</span>];
    l = hl[<span class="hljs-number">4</span>];

    a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
    d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

    hh[<span class="hljs-number">4</span>] = ah4 = (c &amp; <span class="hljs-number">0xffff</span>) | (d &lt;&lt; <span class="hljs-number">16</span>);
    hl[<span class="hljs-number">4</span>] = al4 = (a &amp; <span class="hljs-number">0xffff</span>) | (b &lt;&lt; <span class="hljs-number">16</span>);

    h = ah5;
    l = al5;

    a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    h = hh[<span class="hljs-number">5</span>];
    l = hl[<span class="hljs-number">5</span>];

    a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
    d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

    hh[<span class="hljs-number">5</span>] = ah5 = (c &amp; <span class="hljs-number">0xffff</span>) | (d &lt;&lt; <span class="hljs-number">16</span>);
    hl[<span class="hljs-number">5</span>] = al5 = (a &amp; <span class="hljs-number">0xffff</span>) | (b &lt;&lt; <span class="hljs-number">16</span>);

    h = ah6;
    l = al6;

    a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    h = hh[<span class="hljs-number">6</span>];
    l = hl[<span class="hljs-number">6</span>];

    a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
    d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

    hh[<span class="hljs-number">6</span>] = ah6 = (c &amp; <span class="hljs-number">0xffff</span>) | (d &lt;&lt; <span class="hljs-number">16</span>);
    hl[<span class="hljs-number">6</span>] = al6 = (a &amp; <span class="hljs-number">0xffff</span>) | (b &lt;&lt; <span class="hljs-number">16</span>);

    h = ah7;
    l = al7;

    a = l &amp; <span class="hljs-number">0xffff</span>; b = l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c = h &amp; <span class="hljs-number">0xffff</span>; d = h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    h = hh[<span class="hljs-number">7</span>];
    l = hl[<span class="hljs-number">7</span>];

    a += l &amp; <span class="hljs-number">0xffff</span>; b += l &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += h &amp; <span class="hljs-number">0xffff</span>; d += h &gt;&gt;&gt; <span class="hljs-number">16</span>;

    b += a &gt;&gt;&gt; <span class="hljs-number">16</span>;
    c += b &gt;&gt;&gt; <span class="hljs-number">16</span>;
    d += c &gt;&gt;&gt; <span class="hljs-number">16</span>;

    hh[<span class="hljs-number">7</span>] = ah7 = (c &amp; <span class="hljs-number">0xffff</span>) | (d &lt;&lt; <span class="hljs-number">16</span>);
    hl[<span class="hljs-number">7</span>] = al7 = (a &amp; <span class="hljs-number">0xffff</span>) | (b &lt;&lt; <span class="hljs-number">16</span>);

    pos += <span class="hljs-number">128</span>;
    n -= <span class="hljs-number">128</span>;
  }

  <span class="hljs-keyword">return</span> n;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_hash</span>(<span class="hljs-params">out, m, n</span>) </span>{
  <span class="hljs-keyword">var</span> hh = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Int32Array</span>(<span class="hljs-number">8</span>),
      hl = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Int32Array</span>(<span class="hljs-number">8</span>),
      x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">256</span>),
      i, b = n;

  hh[<span class="hljs-number">0</span>] = <span class="hljs-number">0x6a09e667</span>;
  hh[<span class="hljs-number">1</span>] = <span class="hljs-number">0xbb67ae85</span>;
  hh[<span class="hljs-number">2</span>] = <span class="hljs-number">0x3c6ef372</span>;
  hh[<span class="hljs-number">3</span>] = <span class="hljs-number">0xa54ff53a</span>;
  hh[<span class="hljs-number">4</span>] = <span class="hljs-number">0x510e527f</span>;
  hh[<span class="hljs-number">5</span>] = <span class="hljs-number">0x9b05688c</span>;
  hh[<span class="hljs-number">6</span>] = <span class="hljs-number">0x1f83d9ab</span>;
  hh[<span class="hljs-number">7</span>] = <span class="hljs-number">0x5be0cd19</span>;

  hl[<span class="hljs-number">0</span>] = <span class="hljs-number">0xf3bcc908</span>;
  hl[<span class="hljs-number">1</span>] = <span class="hljs-number">0x84caa73b</span>;
  hl[<span class="hljs-number">2</span>] = <span class="hljs-number">0xfe94f82b</span>;
  hl[<span class="hljs-number">3</span>] = <span class="hljs-number">0x5f1d36f1</span>;
  hl[<span class="hljs-number">4</span>] = <span class="hljs-number">0xade682d1</span>;
  hl[<span class="hljs-number">5</span>] = <span class="hljs-number">0x2b3e6c1f</span>;
  hl[<span class="hljs-number">6</span>] = <span class="hljs-number">0xfb41bd6b</span>;
  hl[<span class="hljs-number">7</span>] = <span class="hljs-number">0x137e2179</span>;

  crypto_hashblocks_hl(hh, hl, m, n);
  n %= <span class="hljs-number">128</span>;

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) x[i] = m[b-n+i];
  x[n] = <span class="hljs-number">128</span>;

  n = <span class="hljs-number">256</span><span class="hljs-number">-128</span>*(n&lt;<span class="hljs-number">112</span>?<span class="hljs-number">1</span>:<span class="hljs-number">0</span>);
  x[n<span class="hljs-number">-9</span>] = <span class="hljs-number">0</span>;
  ts64(x, n<span class="hljs-number">-8</span>,  (b / <span class="hljs-number">0x20000000</span>) | <span class="hljs-number">0</span>, b &lt;&lt; <span class="hljs-number">3</span>);
  crypto_hashblocks_hl(hh, hl, x, n);

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) ts64(out, <span class="hljs-number">8</span>*i, hh[i], hl[i]);

  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">p, q</span>) </span>{
  <span class="hljs-keyword">var</span> a = gf(), b = gf(), c = gf(),
      d = gf(), e = gf(), f = gf(),
      g = gf(), h = gf(), t = gf();

  Z(a, p[<span class="hljs-number">1</span>], p[<span class="hljs-number">0</span>]);
  Z(t, q[<span class="hljs-number">1</span>], q[<span class="hljs-number">0</span>]);
  M(a, a, t);
  A(b, p[<span class="hljs-number">0</span>], p[<span class="hljs-number">1</span>]);
  A(t, q[<span class="hljs-number">0</span>], q[<span class="hljs-number">1</span>]);
  M(b, b, t);
  M(c, p[<span class="hljs-number">3</span>], q[<span class="hljs-number">3</span>]);
  M(c, c, D2);
  M(d, p[<span class="hljs-number">2</span>], q[<span class="hljs-number">2</span>]);
  A(d, d, d);
  Z(e, b, a);
  Z(f, d, c);
  A(g, d, c);
  A(h, b, a);

  M(p[<span class="hljs-number">0</span>], e, f);
  M(p[<span class="hljs-number">1</span>], h, g);
  M(p[<span class="hljs-number">2</span>], g, f);
  M(p[<span class="hljs-number">3</span>], e, h);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cswap</span>(<span class="hljs-params">p, q, b</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
    sel25519(p[i], q[i], b);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pack</span>(<span class="hljs-params">r, p</span>) </span>{
  <span class="hljs-keyword">var</span> tx = gf(), ty = gf(), zi = gf();
  inv25519(zi, p[<span class="hljs-number">2</span>]);
  M(tx, p[<span class="hljs-number">0</span>], zi);
  M(ty, p[<span class="hljs-number">1</span>], zi);
  pack25519(r, ty);
  r[<span class="hljs-number">31</span>] ^= par25519(tx) &lt;&lt; <span class="hljs-number">7</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scalarmult</span>(<span class="hljs-params">p, q, s</span>) </span>{
  <span class="hljs-keyword">var</span> b, i;
  set25519(p[<span class="hljs-number">0</span>], gf0);
  set25519(p[<span class="hljs-number">1</span>], gf1);
  set25519(p[<span class="hljs-number">2</span>], gf1);
  set25519(p[<span class="hljs-number">3</span>], gf0);
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">255</span>; i &gt;= <span class="hljs-number">0</span>; --i) {
    b = (s[(i/<span class="hljs-number">8</span>)|<span class="hljs-number">0</span>] &gt;&gt; (i&amp;<span class="hljs-number">7</span>)) &amp; <span class="hljs-number">1</span>;
    cswap(p, q, b);
    add(q, p);
    add(p, p);
    cswap(p, q, b);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scalarbase</span>(<span class="hljs-params">p, s</span>) </span>{
  <span class="hljs-keyword">var</span> q = [gf(), gf(), gf(), gf()];
  set25519(q[<span class="hljs-number">0</span>], X);
  set25519(q[<span class="hljs-number">1</span>], Y);
  set25519(q[<span class="hljs-number">2</span>], gf1);
  M(q[<span class="hljs-number">3</span>], X, Y);
  scalarmult(p, q, s);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_sign_keypair</span>(<span class="hljs-params">pk, sk, seeded</span>) </span>{
  <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">var</span> p = [gf(), gf(), gf(), gf()];
  <span class="hljs-keyword">var</span> i;

  <span class="hljs-keyword">if</span> (!seeded) randombytes(sk, <span class="hljs-number">32</span>);
  crypto_hash(d, sk, <span class="hljs-number">32</span>);
  d[<span class="hljs-number">0</span>] &amp;= <span class="hljs-number">248</span>;
  d[<span class="hljs-number">31</span>] &amp;= <span class="hljs-number">127</span>;
  d[<span class="hljs-number">31</span>] |= <span class="hljs-number">64</span>;

  scalarbase(p, d);
  pack(pk, p);

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) sk[i+<span class="hljs-number">32</span>] = pk[i];
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-keyword">var</span> L = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>([<span class="hljs-number">0xed</span>, <span class="hljs-number">0xd3</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0x5c</span>, <span class="hljs-number">0x1a</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xd6</span>, <span class="hljs-number">0x9c</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0xa2</span>, <span class="hljs-number">0xde</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0xde</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0x10</span>]);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">modL</span>(<span class="hljs-params">r, x</span>) </span>{
  <span class="hljs-keyword">var</span> carry, i, j, k;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">63</span>; i &gt;= <span class="hljs-number">32</span>; --i) {
    carry = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (j = i - <span class="hljs-number">32</span>, k = i - <span class="hljs-number">12</span>; j &lt; k; ++j) {
      x[j] += carry - <span class="hljs-number">16</span> * x[i] * L[j - (i - <span class="hljs-number">32</span>)];
      carry = (x[j] + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>;
      x[j] -= carry * <span class="hljs-number">256</span>;
    }
    x[j] += carry;
    x[i] = <span class="hljs-number">0</span>;
  }
  carry = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">32</span>; j++) {
    x[j] += carry - (x[<span class="hljs-number">31</span>] &gt;&gt; <span class="hljs-number">4</span>) * L[j];
    carry = x[j] &gt;&gt; <span class="hljs-number">8</span>;
    x[j] &amp;= <span class="hljs-number">255</span>;
  }
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">32</span>; j++) x[j] -= carry * L[j];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) {
    x[i+<span class="hljs-number">1</span>] += x[i] &gt;&gt; <span class="hljs-number">8</span>;
    r[i] = x[i] &amp; <span class="hljs-number">255</span>;
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reduce</span>(<span class="hljs-params">r</span>) </span>{
  <span class="hljs-keyword">var</span> x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(<span class="hljs-number">64</span>), i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) x[i] = r[i];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) r[i] = <span class="hljs-number">0</span>;
  modL(r, x);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Note: difference from C - smlen returned, not passed as argument.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_sign</span>(<span class="hljs-params">sm, m, n, sk</span>) </span>{
  <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>), h = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>), r = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">var</span> i, j, x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">var</span> p = [gf(), gf(), gf(), gf()];

  crypto_hash(d, sk, <span class="hljs-number">32</span>);
  d[<span class="hljs-number">0</span>] &amp;= <span class="hljs-number">248</span>;
  d[<span class="hljs-number">31</span>] &amp;= <span class="hljs-number">127</span>;
  d[<span class="hljs-number">31</span>] |= <span class="hljs-number">64</span>;

  <span class="hljs-keyword">var</span> smlen = n + <span class="hljs-number">64</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) sm[<span class="hljs-number">64</span> + i] = m[i];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) sm[<span class="hljs-number">32</span> + i] = d[<span class="hljs-number">32</span> + i];

  crypto_hash(r, sm.subarray(<span class="hljs-number">32</span>), n+<span class="hljs-number">32</span>);
  reduce(r);
  scalarbase(p, r);
  pack(sm, p);

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">32</span>; i &lt; <span class="hljs-number">64</span>; i++) sm[i] = sk[i];
  crypto_hash(h, sm, n + <span class="hljs-number">64</span>);
  reduce(h);

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) x[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) x[i] = r[i];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) {
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">32</span>; j++) {
      x[i+j] += h[i] * d[j];
    }
  }

  modL(sm.subarray(<span class="hljs-number">32</span>), x);
  <span class="hljs-keyword">return</span> smlen;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unpackneg</span>(<span class="hljs-params">r, p</span>) </span>{
  <span class="hljs-keyword">var</span> t = gf(), chk = gf(), num = gf(),
      den = gf(), den2 = gf(), den4 = gf(),
      den6 = gf();

  set25519(r[<span class="hljs-number">2</span>], gf1);
  unpack25519(r[<span class="hljs-number">1</span>], p);
  S(num, r[<span class="hljs-number">1</span>]);
  M(den, num, D);
  Z(num, num, r[<span class="hljs-number">2</span>]);
  A(den, r[<span class="hljs-number">2</span>], den);

  S(den2, den);
  S(den4, den2);
  M(den6, den4, den2);
  M(t, den6, num);
  M(t, t, den);

  pow2523(t, t);
  M(t, t, num);
  M(t, t, den);
  M(t, t, den);
  M(r[<span class="hljs-number">0</span>], t, den);

  S(chk, r[<span class="hljs-number">0</span>]);
  M(chk, chk, den);
  <span class="hljs-keyword">if</span> (neq25519(chk, num)) M(r[<span class="hljs-number">0</span>], r[<span class="hljs-number">0</span>], I);

  S(chk, r[<span class="hljs-number">0</span>]);
  M(chk, chk, den);
  <span class="hljs-keyword">if</span> (neq25519(chk, num)) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;

  <span class="hljs-keyword">if</span> (par25519(r[<span class="hljs-number">0</span>]) === (p[<span class="hljs-number">31</span>]&gt;&gt;<span class="hljs-number">7</span>)) Z(r[<span class="hljs-number">0</span>], gf0, r[<span class="hljs-number">0</span>]);

  M(r[<span class="hljs-number">3</span>], r[<span class="hljs-number">0</span>], r[<span class="hljs-number">1</span>]);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_sign_open</span>(<span class="hljs-params">m, sm, n, pk</span>) </span>{
  <span class="hljs-keyword">var</span> i, mlen;
  <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>), h = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">var</span> p = [gf(), gf(), gf(), gf()],
      q = [gf(), gf(), gf(), gf()];

  mlen = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">64</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;

  <span class="hljs-keyword">if</span> (unpackneg(q, pk)) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) m[i] = sm[i];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) m[i+<span class="hljs-number">32</span>] = pk[i];
  crypto_hash(h, m, n);
  reduce(h);
  scalarmult(p, q, h);

  scalarbase(q, sm.subarray(<span class="hljs-number">32</span>));
  add(p, q);
  pack(t, p);

  n -= <span class="hljs-number">64</span>;
  <span class="hljs-keyword">if</span> (crypto_verify_32(sm, <span class="hljs-number">0</span>, t, <span class="hljs-number">0</span>)) {
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) m[i] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  }

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) m[i] = sm[i + <span class="hljs-number">64</span>];
  mlen = n;
  <span class="hljs-keyword">return</span> mlen;
}

<span class="hljs-keyword">var</span> crypto_secretbox_KEYBYTES = <span class="hljs-number">32</span>,
    crypto_secretbox_NONCEBYTES = <span class="hljs-number">24</span>,
    crypto_secretbox_ZEROBYTES = <span class="hljs-number">32</span>,
    crypto_secretbox_BOXZEROBYTES = <span class="hljs-number">16</span>,
    crypto_scalarmult_BYTES = <span class="hljs-number">32</span>,
    crypto_scalarmult_SCALARBYTES = <span class="hljs-number">32</span>,
    crypto_box_PUBLICKEYBYTES = <span class="hljs-number">32</span>,
    crypto_box_SECRETKEYBYTES = <span class="hljs-number">32</span>,
    crypto_box_BEFORENMBYTES = <span class="hljs-number">32</span>,
    crypto_box_NONCEBYTES = crypto_secretbox_NONCEBYTES,
    crypto_box_ZEROBYTES = crypto_secretbox_ZEROBYTES,
    crypto_box_BOXZEROBYTES = crypto_secretbox_BOXZEROBYTES,
    crypto_sign_BYTES = <span class="hljs-number">64</span>,
    crypto_sign_PUBLICKEYBYTES = <span class="hljs-number">32</span>,
    crypto_sign_SECRETKEYBYTES = <span class="hljs-number">64</span>,
    crypto_sign_SEEDBYTES = <span class="hljs-number">32</span>,
    crypto_hash_BYTES = <span class="hljs-number">64</span>;

nacl.lowlevel = {
  <span class="hljs-attr">crypto_core_hsalsa20</span>: crypto_core_hsalsa20,
  <span class="hljs-attr">crypto_stream_xor</span>: crypto_stream_xor,
  <span class="hljs-attr">crypto_stream</span>: crypto_stream,
  <span class="hljs-attr">crypto_stream_salsa20_xor</span>: crypto_stream_salsa20_xor,
  <span class="hljs-attr">crypto_stream_salsa20</span>: crypto_stream_salsa20,
  <span class="hljs-attr">crypto_onetimeauth</span>: crypto_onetimeauth,
  <span class="hljs-attr">crypto_onetimeauth_verify</span>: crypto_onetimeauth_verify,
  <span class="hljs-attr">crypto_verify_16</span>: crypto_verify_16,
  <span class="hljs-attr">crypto_verify_32</span>: crypto_verify_32,
  <span class="hljs-attr">crypto_secretbox</span>: crypto_secretbox,
  <span class="hljs-attr">crypto_secretbox_open</span>: crypto_secretbox_open,
  <span class="hljs-attr">crypto_scalarmult</span>: crypto_scalarmult,
  <span class="hljs-attr">crypto_scalarmult_base</span>: crypto_scalarmult_base,
  <span class="hljs-attr">crypto_box_beforenm</span>: crypto_box_beforenm,
  <span class="hljs-attr">crypto_box_afternm</span>: crypto_box_afternm,
  <span class="hljs-attr">crypto_box</span>: crypto_box,
  <span class="hljs-attr">crypto_box_open</span>: crypto_box_open,
  <span class="hljs-attr">crypto_box_keypair</span>: crypto_box_keypair,
  <span class="hljs-attr">crypto_hash</span>: crypto_hash,
  <span class="hljs-attr">crypto_sign</span>: crypto_sign,
  <span class="hljs-attr">crypto_sign_keypair</span>: crypto_sign_keypair,
  <span class="hljs-attr">crypto_sign_open</span>: crypto_sign_open,

  <span class="hljs-attr">crypto_secretbox_KEYBYTES</span>: crypto_secretbox_KEYBYTES,
  <span class="hljs-attr">crypto_secretbox_NONCEBYTES</span>: crypto_secretbox_NONCEBYTES,
  <span class="hljs-attr">crypto_secretbox_ZEROBYTES</span>: crypto_secretbox_ZEROBYTES,
  <span class="hljs-attr">crypto_secretbox_BOXZEROBYTES</span>: crypto_secretbox_BOXZEROBYTES,
  <span class="hljs-attr">crypto_scalarmult_BYTES</span>: crypto_scalarmult_BYTES,
  <span class="hljs-attr">crypto_scalarmult_SCALARBYTES</span>: crypto_scalarmult_SCALARBYTES,
  <span class="hljs-attr">crypto_box_PUBLICKEYBYTES</span>: crypto_box_PUBLICKEYBYTES,
  <span class="hljs-attr">crypto_box_SECRETKEYBYTES</span>: crypto_box_SECRETKEYBYTES,
  <span class="hljs-attr">crypto_box_BEFORENMBYTES</span>: crypto_box_BEFORENMBYTES,
  <span class="hljs-attr">crypto_box_NONCEBYTES</span>: crypto_box_NONCEBYTES,
  <span class="hljs-attr">crypto_box_ZEROBYTES</span>: crypto_box_ZEROBYTES,
  <span class="hljs-attr">crypto_box_BOXZEROBYTES</span>: crypto_box_BOXZEROBYTES,
  <span class="hljs-attr">crypto_sign_BYTES</span>: crypto_sign_BYTES,
  <span class="hljs-attr">crypto_sign_PUBLICKEYBYTES</span>: crypto_sign_PUBLICKEYBYTES,
  <span class="hljs-attr">crypto_sign_SECRETKEYBYTES</span>: crypto_sign_SECRETKEYBYTES,
  <span class="hljs-attr">crypto_sign_SEEDBYTES</span>: crypto_sign_SEEDBYTES,
  <span class="hljs-attr">crypto_hash_BYTES</span>: crypto_hash_BYTES
};

<span class="hljs-comment">/* High-level API */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkLengths</span>(<span class="hljs-params">k, n</span>) </span>{
  <span class="hljs-keyword">if</span> (k.length !== crypto_secretbox_KEYBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad key size'</span>);
  <span class="hljs-keyword">if</span> (n.length !== crypto_secretbox_NONCEBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad nonce size'</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkBoxLengths</span>(<span class="hljs-params">pk, sk</span>) </span>{
  <span class="hljs-keyword">if</span> (pk.length !== crypto_box_PUBLICKEYBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad public key size'</span>);
  <span class="hljs-keyword">if</span> (sk.length !== crypto_box_SECRETKEYBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad secret key size'</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkArrayTypes</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> t, i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">arguments</span>.length; i++) {
     <span class="hljs-keyword">if</span> ((t = <span class="hljs-built_in">Object</span>.prototype.toString.call(<span class="hljs-built_in">arguments</span>[i])) !== <span class="hljs-string">'[object Uint8Array]'</span>)
       <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'unexpected type '</span> + t + <span class="hljs-string">', use Uint8Array'</span>);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanup</span>(<span class="hljs-params">arr</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arr.length; i++) arr[i] = <span class="hljs-number">0</span>;
}

nacl.util = {};

nacl.util.decodeUTF8 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">s</span>) </span>{
  <span class="hljs-keyword">var</span> i, d = <span class="hljs-built_in">unescape</span>(<span class="hljs-built_in">encodeURIComponent</span>(s)), b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(d.length);
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; d.length; i++) b[i] = d.charCodeAt(i);
  <span class="hljs-keyword">return</span> b;
};

nacl.util.encodeUTF8 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arr</span>) </span>{
  <span class="hljs-keyword">var</span> i, s = [];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; arr.length; i++) s.push(<span class="hljs-built_in">String</span>.fromCharCode(arr[i]));
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-built_in">escape</span>(s.join(<span class="hljs-string">''</span>)));
};

nacl.util.encodeBase64 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arr</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> btoa === <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> Buffer(arr)).toString(<span class="hljs-string">'base64'</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> i, s = [], len = arr.length;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i++) s.push(<span class="hljs-built_in">String</span>.fromCharCode(arr[i]));
    <span class="hljs-keyword">return</span> btoa(s.join(<span class="hljs-string">''</span>));
  }
};

nacl.util.decodeBase64 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">s</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> atob === <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-keyword">new</span> Buffer(s, <span class="hljs-string">'base64'</span>), <span class="hljs-number">0</span>));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> i, d = atob(s), b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(d.length);
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; d.length; i++) b[i] = d.charCodeAt(i);
    <span class="hljs-keyword">return</span> b;
  }
};

nacl.randomBytes = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) </span>{
  <span class="hljs-keyword">var</span> b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(n);
  randombytes(b, n);
  <span class="hljs-keyword">return</span> b;
};

nacl.secretbox = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, nonce, key</span>) </span>{
  checkArrayTypes(msg, nonce, key);
  checkLengths(key, nonce);
  <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_secretbox_ZEROBYTES + msg.length);
  <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(m.length);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; msg.length; i++) m[i+crypto_secretbox_ZEROBYTES] = msg[i];
  crypto_secretbox(c, m, m.length, nonce, key);
  <span class="hljs-keyword">return</span> c.subarray(crypto_secretbox_BOXZEROBYTES);
};

nacl.secretbox.open = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">box, nonce, key</span>) </span>{
  checkArrayTypes(box, nonce, key);
  checkLengths(key, nonce);
  <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_secretbox_BOXZEROBYTES + box.length);
  <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(c.length);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; box.length; i++) c[i+crypto_secretbox_BOXZEROBYTES] = box[i];
  <span class="hljs-keyword">if</span> (c.length &lt; <span class="hljs-number">32</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (crypto_secretbox_open(m, c, c.length, nonce, key) !== <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">return</span> m.subarray(crypto_secretbox_ZEROBYTES);
};

nacl.secretbox.keyLength = crypto_secretbox_KEYBYTES;
nacl.secretbox.nonceLength = crypto_secretbox_NONCEBYTES;
nacl.secretbox.overheadLength = crypto_secretbox_BOXZEROBYTES;

nacl.scalarMult = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n, p</span>) </span>{
  checkArrayTypes(n, p);
  <span class="hljs-keyword">if</span> (n.length !== crypto_scalarmult_SCALARBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad n size'</span>);
  <span class="hljs-keyword">if</span> (p.length !== crypto_scalarmult_BYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad p size'</span>);
  <span class="hljs-keyword">var</span> q = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_scalarmult_BYTES);
  crypto_scalarmult(q, n, p);
  <span class="hljs-keyword">return</span> q;
};

nacl.scalarMult.base = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) </span>{
  checkArrayTypes(n);
  <span class="hljs-keyword">if</span> (n.length !== crypto_scalarmult_SCALARBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad n size'</span>);
  <span class="hljs-keyword">var</span> q = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_scalarmult_BYTES);
  crypto_scalarmult_base(q, n);
  <span class="hljs-keyword">return</span> q;
};

nacl.scalarMult.scalarLength = crypto_scalarmult_SCALARBYTES;
nacl.scalarMult.groupElementLength = crypto_scalarmult_BYTES;

nacl.box = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, nonce, publicKey, secretKey</span>) </span>{
  <span class="hljs-keyword">var</span> k = nacl.box.before(publicKey, secretKey);
  <span class="hljs-keyword">return</span> nacl.secretbox(msg, nonce, k);
};

nacl.box.before = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">publicKey, secretKey</span>) </span>{
  checkArrayTypes(publicKey, secretKey);
  checkBoxLengths(publicKey, secretKey);
  <span class="hljs-keyword">var</span> k = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_box_BEFORENMBYTES);
  crypto_box_beforenm(k, publicKey, secretKey);
  <span class="hljs-keyword">return</span> k;
};

nacl.box.after = nacl.secretbox;

nacl.box.open = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, nonce, publicKey, secretKey</span>) </span>{
  <span class="hljs-keyword">var</span> k = nacl.box.before(publicKey, secretKey);
  <span class="hljs-keyword">return</span> nacl.secretbox.open(msg, nonce, k);
};

nacl.box.open.after = nacl.secretbox.open;

nacl.box.keyPair = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> pk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_box_PUBLICKEYBYTES);
  <span class="hljs-keyword">var</span> sk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_box_SECRETKEYBYTES);
  crypto_box_keypair(pk, sk);
  <span class="hljs-keyword">return</span> {<span class="hljs-attr">publicKey</span>: pk, <span class="hljs-attr">secretKey</span>: sk};
};

nacl.box.keyPair.fromSecretKey = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">secretKey</span>) </span>{
  checkArrayTypes(secretKey);
  <span class="hljs-keyword">if</span> (secretKey.length !== crypto_box_SECRETKEYBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad secret key size'</span>);
  <span class="hljs-keyword">var</span> pk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_box_PUBLICKEYBYTES);
  crypto_scalarmult_base(pk, secretKey);
  <span class="hljs-keyword">return</span> {<span class="hljs-attr">publicKey</span>: pk, <span class="hljs-attr">secretKey</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(secretKey)};
};

nacl.box.publicKeyLength = crypto_box_PUBLICKEYBYTES;
nacl.box.secretKeyLength = crypto_box_SECRETKEYBYTES;
nacl.box.sharedKeyLength = crypto_box_BEFORENMBYTES;
nacl.box.nonceLength = crypto_box_NONCEBYTES;
nacl.box.overheadLength = nacl.secretbox.overheadLength;

nacl.sign = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, secretKey</span>) </span>{
  checkArrayTypes(msg, secretKey);
  <span class="hljs-keyword">if</span> (secretKey.length !== crypto_sign_SECRETKEYBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad secret key size'</span>);
  <span class="hljs-keyword">var</span> signedMsg = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_BYTES+msg.length);
  crypto_sign(signedMsg, msg, msg.length, secretKey);
  <span class="hljs-keyword">return</span> signedMsg;
};

nacl.sign.open = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">signedMsg, publicKey</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length !== <span class="hljs-number">2</span>)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'nacl.sign.open accepts 2 arguments; did you mean to use nacl.sign.detached.verify?'</span>);
  checkArrayTypes(signedMsg, publicKey);
  <span class="hljs-keyword">if</span> (publicKey.length !== crypto_sign_PUBLICKEYBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad public key size'</span>);
  <span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(signedMsg.length);
  <span class="hljs-keyword">var</span> mlen = crypto_sign_open(tmp, signedMsg, signedMsg.length, publicKey);
  <span class="hljs-keyword">if</span> (mlen &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(mlen);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; m.length; i++) m[i] = tmp[i];
  <span class="hljs-keyword">return</span> m;
};

nacl.sign.detached = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, secretKey</span>) </span>{
  <span class="hljs-keyword">var</span> signedMsg = nacl.sign(msg, secretKey);
  <span class="hljs-keyword">var</span> sig = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_BYTES);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; sig.length; i++) sig[i] = signedMsg[i];
  <span class="hljs-keyword">return</span> sig;
};

nacl.sign.detached.verify = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, sig, publicKey</span>) </span>{
  checkArrayTypes(msg, sig, publicKey);
  <span class="hljs-keyword">if</span> (sig.length !== crypto_sign_BYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad signature size'</span>);
  <span class="hljs-keyword">if</span> (publicKey.length !== crypto_sign_PUBLICKEYBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad public key size'</span>);
  <span class="hljs-keyword">var</span> sm = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_BYTES + msg.length);
  <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_BYTES + msg.length);
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; crypto_sign_BYTES; i++) sm[i] = sig[i];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; msg.length; i++) sm[i+crypto_sign_BYTES] = msg[i];
  <span class="hljs-keyword">return</span> (crypto_sign_open(m, sm, sm.length, publicKey) &gt;= <span class="hljs-number">0</span>);
};

nacl.sign.keyPair = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> pk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_PUBLICKEYBYTES);
  <span class="hljs-keyword">var</span> sk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_SECRETKEYBYTES);
  crypto_sign_keypair(pk, sk);
  <span class="hljs-keyword">return</span> {<span class="hljs-attr">publicKey</span>: pk, <span class="hljs-attr">secretKey</span>: sk};
};

nacl.sign.keyPair.fromSecretKey = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">secretKey</span>) </span>{
  checkArrayTypes(secretKey);
  <span class="hljs-keyword">if</span> (secretKey.length !== crypto_sign_SECRETKEYBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad secret key size'</span>);
  <span class="hljs-keyword">var</span> pk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_PUBLICKEYBYTES);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; pk.length; i++) pk[i] = secretKey[<span class="hljs-number">32</span>+i];
  <span class="hljs-keyword">return</span> {<span class="hljs-attr">publicKey</span>: pk, <span class="hljs-attr">secretKey</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(secretKey)};
};

nacl.sign.keyPair.fromSeed = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">seed</span>) </span>{
  checkArrayTypes(seed);
  <span class="hljs-keyword">if</span> (seed.length !== crypto_sign_SEEDBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad seed size'</span>);
  <span class="hljs-keyword">var</span> pk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_PUBLICKEYBYTES);
  <span class="hljs-keyword">var</span> sk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_SECRETKEYBYTES);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) sk[i] = seed[i];
  crypto_sign_keypair(pk, sk, <span class="hljs-literal">true</span>);
  <span class="hljs-keyword">return</span> {<span class="hljs-attr">publicKey</span>: pk, <span class="hljs-attr">secretKey</span>: sk};
};

nacl.sign.publicKeyLength = crypto_sign_PUBLICKEYBYTES;
nacl.sign.secretKeyLength = crypto_sign_SECRETKEYBYTES;
nacl.sign.seedLength = crypto_sign_SEEDBYTES;
nacl.sign.signatureLength = crypto_sign_BYTES;

nacl.hash = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
  checkArrayTypes(msg);
  <span class="hljs-keyword">var</span> h = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_hash_BYTES);
  crypto_hash(h, msg, msg.length);
  <span class="hljs-keyword">return</span> h;
};

nacl.hash.hashLength = crypto_hash_BYTES;

nacl.verify = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, y</span>) </span>{
  checkArrayTypes(x, y);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>Zero length arguments are considered not equal.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (x.length === <span class="hljs-number">0</span> || y.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (x.length !== y.length) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">return</span> (vn(x, <span class="hljs-number">0</span>, y, <span class="hljs-number">0</span>, x.length) === <span class="hljs-number">0</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
};

nacl.setPRNG = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
  randombytes = fn;
};

(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>Initialize PRNG if environment provides CSPRNG.
If not, methods calling randombytes will throw.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> crypto;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> !== <span class="hljs-string">'undefined'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>Browser.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.crypto &amp;&amp; <span class="hljs-built_in">window</span>.crypto.getRandomValues) {
      crypto = <span class="hljs-built_in">window</span>.crypto; <span class="hljs-comment">// Standard</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.msCrypto &amp;&amp; <span class="hljs-built_in">window</span>.msCrypto.getRandomValues) {
      crypto = <span class="hljs-built_in">window</span>.msCrypto; <span class="hljs-comment">// Internet Explorer 11+</span>
    }
    <span class="hljs-keyword">if</span> (crypto) {
      nacl.setPRNG(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, n</span>) </span>{
        <span class="hljs-keyword">var</span> i, v = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(n);
        crypto.getRandomValues(v);
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) x[i] = v[i];
        cleanup(v);
      });
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">require</span> !== <span class="hljs-string">'undefined'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>Node.js.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);
    <span class="hljs-keyword">if</span> (crypto) {
      nacl.setPRNG(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, n</span>) </span>{
        <span class="hljs-keyword">var</span> i, v = crypto.randomBytes(n);
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) x[i] = v[i];
        cleanup(v);
      });
    }
  }
})();

})(<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-built_in">module</span>.exports ? <span class="hljs-built_in">module</span>.exports : (<span class="hljs-built_in">window</span>.nacl = <span class="hljs-built_in">window</span>.nacl || {}));

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
