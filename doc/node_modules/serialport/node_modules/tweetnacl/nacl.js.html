<!DOCTYPE html>
<html>
<head>
  <title>nacl.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node_modules/serialport/node_modules/tweetnacl/nacl.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>nacl.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">nacl</span>) </span>{
<span class="hljs-meta">'use strict'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Ported in 2014 by Dmitry Chestnykh and Devi Mandiri.
Public domain.</p>
<p>Implementation derived from TweetNaCl version 20140427.
See for details: http://tweetnacl.cr.yp.to/</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> u64 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">h, l</span>) </span>{ <span class="hljs-keyword">this</span>.hi = h|<span class="hljs-number">0</span> &gt;&gt;&gt; <span class="hljs-number">0</span>; <span class="hljs-keyword">this</span>.lo = l|<span class="hljs-number">0</span> &gt;&gt;&gt; <span class="hljs-number">0</span>; };
<span class="hljs-keyword">var</span> gf = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">init</span>) </span>{
  <span class="hljs-keyword">var</span> i, r = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(<span class="hljs-number">16</span>);
  <span class="hljs-keyword">if</span> (init) <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; init.length; i++) r[i] = init[i];
  <span class="hljs-keyword">return</span> r;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Pluggable, initialized in high-level API below.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> randombytes = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-regexp">/* x, n */</span></span>) </span>{ <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'no PRNG'</span>); };

<span class="hljs-keyword">var</span> _0 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">16</span>);
<span class="hljs-keyword">var</span> _9 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>); _9[<span class="hljs-number">0</span>] = <span class="hljs-number">9</span>;

<span class="hljs-keyword">var</span> gf0 = gf(),
    gf1 = gf([<span class="hljs-number">1</span>]),
    _121665 = gf([<span class="hljs-number">0xdb41</span>, <span class="hljs-number">1</span>]),
    D = gf([<span class="hljs-number">0x78a3</span>, <span class="hljs-number">0x1359</span>, <span class="hljs-number">0x4dca</span>, <span class="hljs-number">0x75eb</span>, <span class="hljs-number">0xd8ab</span>, <span class="hljs-number">0x4141</span>, <span class="hljs-number">0x0a4d</span>, <span class="hljs-number">0x0070</span>, <span class="hljs-number">0xe898</span>, <span class="hljs-number">0x7779</span>, <span class="hljs-number">0x4079</span>, <span class="hljs-number">0x8cc7</span>, <span class="hljs-number">0xfe73</span>, <span class="hljs-number">0x2b6f</span>, <span class="hljs-number">0x6cee</span>, <span class="hljs-number">0x5203</span>]),
    D2 = gf([<span class="hljs-number">0xf159</span>, <span class="hljs-number">0x26b2</span>, <span class="hljs-number">0x9b94</span>, <span class="hljs-number">0xebd6</span>, <span class="hljs-number">0xb156</span>, <span class="hljs-number">0x8283</span>, <span class="hljs-number">0x149a</span>, <span class="hljs-number">0x00e0</span>, <span class="hljs-number">0xd130</span>, <span class="hljs-number">0xeef3</span>, <span class="hljs-number">0x80f2</span>, <span class="hljs-number">0x198e</span>, <span class="hljs-number">0xfce7</span>, <span class="hljs-number">0x56df</span>, <span class="hljs-number">0xd9dc</span>, <span class="hljs-number">0x2406</span>]),
    X = gf([<span class="hljs-number">0xd51a</span>, <span class="hljs-number">0x8f25</span>, <span class="hljs-number">0x2d60</span>, <span class="hljs-number">0xc956</span>, <span class="hljs-number">0xa7b2</span>, <span class="hljs-number">0x9525</span>, <span class="hljs-number">0xc760</span>, <span class="hljs-number">0x692c</span>, <span class="hljs-number">0xdc5c</span>, <span class="hljs-number">0xfdd6</span>, <span class="hljs-number">0xe231</span>, <span class="hljs-number">0xc0a4</span>, <span class="hljs-number">0x53fe</span>, <span class="hljs-number">0xcd6e</span>, <span class="hljs-number">0x36d3</span>, <span class="hljs-number">0x2169</span>]),
    Y = gf([<span class="hljs-number">0x6658</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>, <span class="hljs-number">0x6666</span>]),
    I = gf([<span class="hljs-number">0xa0b0</span>, <span class="hljs-number">0x4a0e</span>, <span class="hljs-number">0x1b27</span>, <span class="hljs-number">0xc4ee</span>, <span class="hljs-number">0xe478</span>, <span class="hljs-number">0xad2f</span>, <span class="hljs-number">0x1806</span>, <span class="hljs-number">0x2f43</span>, <span class="hljs-number">0xd7a7</span>, <span class="hljs-number">0x3dfb</span>, <span class="hljs-number">0x0099</span>, <span class="hljs-number">0x2b4d</span>, <span class="hljs-number">0xdf0b</span>, <span class="hljs-number">0x4fc1</span>, <span class="hljs-number">0x2480</span>, <span class="hljs-number">0x2b83</span>]);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">L32</span>(<span class="hljs-params">x, c</span>) </span>{ <span class="hljs-keyword">return</span> (x &lt;&lt; c) | (x &gt;&gt;&gt; (<span class="hljs-number">32</span> - c)); }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ld32</span>(<span class="hljs-params">x, i</span>) </span>{
  <span class="hljs-keyword">var</span> u = x[i+<span class="hljs-number">3</span>] &amp; <span class="hljs-number">0xff</span>;
  u = (u&lt;&lt;<span class="hljs-number">8</span>)|(x[i+<span class="hljs-number">2</span>] &amp; <span class="hljs-number">0xff</span>);
  u = (u&lt;&lt;<span class="hljs-number">8</span>)|(x[i+<span class="hljs-number">1</span>] &amp; <span class="hljs-number">0xff</span>);
  <span class="hljs-keyword">return</span> (u&lt;&lt;<span class="hljs-number">8</span>)|(x[i+<span class="hljs-number">0</span>] &amp; <span class="hljs-number">0xff</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dl64</span>(<span class="hljs-params">x, i</span>) </span>{
  <span class="hljs-keyword">var</span> h = (x[i] &lt;&lt; <span class="hljs-number">24</span>) | (x[i+<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">16</span>) | (x[i+<span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">8</span>) | x[i+<span class="hljs-number">3</span>];
  <span class="hljs-keyword">var</span> l = (x[i+<span class="hljs-number">4</span>] &lt;&lt; <span class="hljs-number">24</span>) | (x[i+<span class="hljs-number">5</span>] &lt;&lt; <span class="hljs-number">16</span>) | (x[i+<span class="hljs-number">6</span>] &lt;&lt; <span class="hljs-number">8</span>) | x[i+<span class="hljs-number">7</span>];
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> u64(h, l);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">st32</span>(<span class="hljs-params">x, j, u</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) { x[j+i] = u &amp; <span class="hljs-number">255</span>; u &gt;&gt;&gt;= <span class="hljs-number">8</span>; }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ts64</span>(<span class="hljs-params">x, i, u</span>) </span>{
  x[i]   = (u.hi &gt;&gt; <span class="hljs-number">24</span>) &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">1</span>] = (u.hi &gt;&gt; <span class="hljs-number">16</span>) &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">2</span>] = (u.hi &gt;&gt;  <span class="hljs-number">8</span>) &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">3</span>] = u.hi &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">4</span>] = (u.lo &gt;&gt; <span class="hljs-number">24</span>)  &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">5</span>] = (u.lo &gt;&gt; <span class="hljs-number">16</span>)  &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">6</span>] = (u.lo &gt;&gt;  <span class="hljs-number">8</span>)  &amp; <span class="hljs-number">0xff</span>;
  x[i+<span class="hljs-number">7</span>] = u.lo &amp; <span class="hljs-number">0xff</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vn</span>(<span class="hljs-params">x, xi, y, yi, n</span>) </span>{
  <span class="hljs-keyword">var</span> i,d = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) d |= x[xi+i]^y[yi+i];
  <span class="hljs-keyword">return</span> (<span class="hljs-number">1</span> &amp; ((d - <span class="hljs-number">1</span>) &gt;&gt;&gt; <span class="hljs-number">8</span>)) - <span class="hljs-number">1</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_verify_16</span>(<span class="hljs-params">x, xi, y, yi</span>) </span>{
  <span class="hljs-keyword">return</span> vn(x,xi,y,yi,<span class="hljs-number">16</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_verify_32</span>(<span class="hljs-params">x, xi, y, yi</span>) </span>{
  <span class="hljs-keyword">return</span> vn(x,xi,y,yi,<span class="hljs-number">32</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">core</span>(<span class="hljs-params">out,inp,k,c,h</span>) </span>{
  <span class="hljs-keyword">var</span> w = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">16</span>), x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">16</span>),
      y = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">16</span>), t = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">4</span>);
  <span class="hljs-keyword">var</span> i, j, m;

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
    x[<span class="hljs-number">5</span>*i] = ld32(c, <span class="hljs-number">4</span>*i);
    x[<span class="hljs-number">1</span>+i] = ld32(k, <span class="hljs-number">4</span>*i);
    x[<span class="hljs-number">6</span>+i] = ld32(inp, <span class="hljs-number">4</span>*i);
    x[<span class="hljs-number">11</span>+i] = ld32(k, <span class="hljs-number">16</span>+<span class="hljs-number">4</span>*i);
  }

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) y[i] = x[i];

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++) {
      <span class="hljs-keyword">for</span> (m = <span class="hljs-number">0</span>; m &lt; <span class="hljs-number">4</span>; m++) t[m] = x[(<span class="hljs-number">5</span>*j+<span class="hljs-number">4</span>*m)%<span class="hljs-number">16</span>];
      t[<span class="hljs-number">1</span>] ^= L32((t[<span class="hljs-number">0</span>]+t[<span class="hljs-number">3</span>])|<span class="hljs-number">0</span>, <span class="hljs-number">7</span>);
      t[<span class="hljs-number">2</span>] ^= L32((t[<span class="hljs-number">1</span>]+t[<span class="hljs-number">0</span>])|<span class="hljs-number">0</span>, <span class="hljs-number">9</span>);
      t[<span class="hljs-number">3</span>] ^= L32((t[<span class="hljs-number">2</span>]+t[<span class="hljs-number">1</span>])|<span class="hljs-number">0</span>,<span class="hljs-number">13</span>);
      t[<span class="hljs-number">0</span>] ^= L32((t[<span class="hljs-number">3</span>]+t[<span class="hljs-number">2</span>])|<span class="hljs-number">0</span>,<span class="hljs-number">18</span>);
      <span class="hljs-keyword">for</span> (m = <span class="hljs-number">0</span>; m &lt; <span class="hljs-number">4</span>; m++) w[<span class="hljs-number">4</span>*j+(j+m)%<span class="hljs-number">4</span>] = t[m];
    }
    <span class="hljs-keyword">for</span> (m = <span class="hljs-number">0</span>; m &lt; <span class="hljs-number">16</span>; m++) x[m] = w[m];
  }

  <span class="hljs-keyword">if</span> (h) {
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) x[i] = (x[i] + y[i]) | <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
      x[<span class="hljs-number">5</span>*i] = (x[<span class="hljs-number">5</span>*i] - ld32(c, <span class="hljs-number">4</span>*i)) | <span class="hljs-number">0</span>;
      x[<span class="hljs-number">6</span>+i] = (x[<span class="hljs-number">6</span>+i] - ld32(inp, <span class="hljs-number">4</span>*i)) | <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
      st32(out,<span class="hljs-number">4</span>*i,x[<span class="hljs-number">5</span>*i]);
      st32(out,<span class="hljs-number">16</span>+<span class="hljs-number">4</span>*i,x[<span class="hljs-number">6</span>+i]);
    }
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) st32(out, <span class="hljs-number">4</span> * i, (x[i] + y[i]) | <span class="hljs-number">0</span>);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_core_salsa20</span>(<span class="hljs-params">out,inp,k,c</span>) </span>{
  core(out,inp,k,c,<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_core_hsalsa20</span>(<span class="hljs-params">out,inp,k,c</span>) </span>{
  core(out,inp,k,c,<span class="hljs-literal">true</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-keyword">var</span> sigma = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([<span class="hljs-number">101</span>, <span class="hljs-number">120</span>, <span class="hljs-number">112</span>, <span class="hljs-number">97</span>, <span class="hljs-number">110</span>, <span class="hljs-number">100</span>, <span class="hljs-number">32</span>, <span class="hljs-number">51</span>, <span class="hljs-number">50</span>, <span class="hljs-number">45</span>, <span class="hljs-number">98</span>, <span class="hljs-number">121</span>, <span class="hljs-number">116</span>, <span class="hljs-number">101</span>, <span class="hljs-number">32</span>, <span class="hljs-number">107</span>]);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>&quot;expand 32-byte k&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_stream_salsa20_xor</span>(<span class="hljs-params">c,cpos,m,mpos,b,n,k</span>) </span>{
  <span class="hljs-keyword">var</span> z = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">16</span>), x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">var</span> u, i;
  <span class="hljs-keyword">if</span> (!b) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) z[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) z[i] = n[i];
  <span class="hljs-keyword">while</span> (b &gt;= <span class="hljs-number">64</span>) {
    crypto_core_salsa20(x,z,k,sigma);
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) c[cpos+i] = (m?m[mpos+i]:<span class="hljs-number">0</span>) ^ x[i];
    u = <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">8</span>; i &lt; <span class="hljs-number">16</span>; i++) {
      u = u + (z[i] &amp; <span class="hljs-number">0xff</span>) | <span class="hljs-number">0</span>;
      z[i] = u &amp; <span class="hljs-number">0xff</span>;
      u &gt;&gt;&gt;= <span class="hljs-number">8</span>;
    }
    b -= <span class="hljs-number">64</span>;
    cpos += <span class="hljs-number">64</span>;
    <span class="hljs-keyword">if</span> (m) mpos += <span class="hljs-number">64</span>;
  }
  <span class="hljs-keyword">if</span> (b &gt; <span class="hljs-number">0</span>) {
    crypto_core_salsa20(x,z,k,sigma);
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; b; i++) c[cpos+i] = (m?m[mpos+i]:<span class="hljs-number">0</span>) ^ x[i];
  }
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_stream_salsa20</span>(<span class="hljs-params">c,cpos,d,n,k</span>) </span>{
  <span class="hljs-keyword">return</span> crypto_stream_salsa20_xor(c,cpos,<span class="hljs-literal">null</span>,<span class="hljs-number">0</span>,d,n,k);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_stream</span>(<span class="hljs-params">c,cpos,d,n,k</span>) </span>{
  <span class="hljs-keyword">var</span> s = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  crypto_core_hsalsa20(s,n,k,sigma);
  <span class="hljs-keyword">return</span> crypto_stream_salsa20(c,cpos,d,n.subarray(<span class="hljs-number">16</span>),s);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_stream_xor</span>(<span class="hljs-params">c,cpos,m,mpos,d,n,k</span>) </span>{
  <span class="hljs-keyword">var</span> s = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  crypto_core_hsalsa20(s,n,k,sigma);
  <span class="hljs-keyword">return</span> crypto_stream_salsa20_xor(c,cpos,m,mpos,d,n.subarray(<span class="hljs-number">16</span>),s);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add1305</span>(<span class="hljs-params">h, c</span>) </span>{
  <span class="hljs-keyword">var</span> j, u = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">17</span>; j++) {
    u = (u + ((h[j] + c[j]) | <span class="hljs-number">0</span>)) | <span class="hljs-number">0</span>;
    h[j] = u &amp; <span class="hljs-number">255</span>;
    u &gt;&gt;&gt;= <span class="hljs-number">8</span>;
  }
}

<span class="hljs-keyword">var</span> minusp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>([
  <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">252</span>
]);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_onetimeauth</span>(<span class="hljs-params">out, outpos, m, mpos, n, k</span>) </span>{
  <span class="hljs-keyword">var</span> s, i, j, u;
  <span class="hljs-keyword">var</span> x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">17</span>), r = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">17</span>),
      h = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">17</span>), c = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">17</span>),
      g = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint32Array</span>(<span class="hljs-number">17</span>);
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">17</span>; j++) r[j]=h[j]=<span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++) r[j]=k[j];
  r[<span class="hljs-number">3</span>]&amp;=<span class="hljs-number">15</span>;
  r[<span class="hljs-number">4</span>]&amp;=<span class="hljs-number">252</span>;
  r[<span class="hljs-number">7</span>]&amp;=<span class="hljs-number">15</span>;
  r[<span class="hljs-number">8</span>]&amp;=<span class="hljs-number">252</span>;
  r[<span class="hljs-number">11</span>]&amp;=<span class="hljs-number">15</span>;
  r[<span class="hljs-number">12</span>]&amp;=<span class="hljs-number">252</span>;
  r[<span class="hljs-number">15</span>]&amp;=<span class="hljs-number">15</span>;

  <span class="hljs-keyword">while</span> (n &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">17</span>; j++) c[j] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; (j &lt; <span class="hljs-number">16</span>) &amp;&amp; (j &lt; n); ++j) c[j] = m[mpos+j];
    c[j] = <span class="hljs-number">1</span>;
    mpos += j; n -= j;
    add1305(h,c);
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">17</span>; i++) {
      x[i] = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">17</span>; j++) x[i] = (x[i] + (h[j] * ((j &lt;= i) ? r[i - j] : ((<span class="hljs-number">320</span> * r[i + <span class="hljs-number">17</span> - j])|<span class="hljs-number">0</span>))) | <span class="hljs-number">0</span>) | <span class="hljs-number">0</span>;
    }
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">17</span>; i++) h[i] = x[i];
    u = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++) {
      u = (u + h[j]) | <span class="hljs-number">0</span>;
      h[j] = u &amp; <span class="hljs-number">255</span>;
      u &gt;&gt;&gt;= <span class="hljs-number">8</span>;
    }
    u = (u + h[<span class="hljs-number">16</span>]) | <span class="hljs-number">0</span>; h[<span class="hljs-number">16</span>] = u &amp; <span class="hljs-number">3</span>;
    u = (<span class="hljs-number">5</span> * (u &gt;&gt;&gt; <span class="hljs-number">2</span>)) | <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++) {
      u = (u + h[j]) | <span class="hljs-number">0</span>;
      h[j] = u &amp; <span class="hljs-number">255</span>;
      u &gt;&gt;&gt;= <span class="hljs-number">8</span>;
    }
    u = (u + h[<span class="hljs-number">16</span>]) | <span class="hljs-number">0</span>; h[<span class="hljs-number">16</span>] = u;
  }

  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">17</span>; j++) g[j] = h[j];
  add1305(h,minusp);
  s = (-(h[<span class="hljs-number">16</span>] &gt;&gt;&gt; <span class="hljs-number">7</span>) | <span class="hljs-number">0</span>);
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">17</span>; j++) h[j] ^= s &amp; (g[j] ^ h[j]);

  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++) c[j] = k[j + <span class="hljs-number">16</span>];
  c[<span class="hljs-number">16</span>] = <span class="hljs-number">0</span>;
  add1305(h,c);
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++) out[outpos+j] = h[j];
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_onetimeauth_verify</span>(<span class="hljs-params">h, hpos, m, mpos, n, k</span>) </span>{
  <span class="hljs-keyword">var</span> x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">16</span>);
  crypto_onetimeauth(x,<span class="hljs-number">0</span>,m,mpos,n,k);
  <span class="hljs-keyword">return</span> crypto_verify_16(h,hpos,x,<span class="hljs-number">0</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_secretbox</span>(<span class="hljs-params">c,m,d,n,k</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">32</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  crypto_stream_xor(c,<span class="hljs-number">0</span>,m,<span class="hljs-number">0</span>,d,n,k);
  crypto_onetimeauth(c, <span class="hljs-number">16</span>, c, <span class="hljs-number">32</span>, d - <span class="hljs-number">32</span>, c);
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) c[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_secretbox_open</span>(<span class="hljs-params">m,c,d,n,k</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">var</span> x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  <span class="hljs-keyword">if</span> (d &lt; <span class="hljs-number">32</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  crypto_stream(x,<span class="hljs-number">0</span>,<span class="hljs-number">32</span>,n,k);
  <span class="hljs-keyword">if</span> (crypto_onetimeauth_verify(c, <span class="hljs-number">16</span>,c, <span class="hljs-number">32</span>,d - <span class="hljs-number">32</span>,x) !== <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  crypto_stream_xor(m,<span class="hljs-number">0</span>,c,<span class="hljs-number">0</span>,d,n,k);
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) m[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">set25519</span>(<span class="hljs-params">r, a</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) r[i] = a[i]|<span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">car25519</span>(<span class="hljs-params">o</span>) </span>{
  <span class="hljs-keyword">var</span> c;
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
      o[i] += <span class="hljs-number">65536</span>;
      c = <span class="hljs-built_in">Math</span>.floor(o[i] / <span class="hljs-number">65536</span>);
      o[(i+<span class="hljs-number">1</span>)*(i&lt;<span class="hljs-number">15</span>?<span class="hljs-number">1</span>:<span class="hljs-number">0</span>)] += c - <span class="hljs-number">1</span> + <span class="hljs-number">37</span> * (c<span class="hljs-number">-1</span>) * (i===<span class="hljs-number">15</span>?<span class="hljs-number">1</span>:<span class="hljs-number">0</span>);
      o[i] -= (c * <span class="hljs-number">65536</span>);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sel25519</span>(<span class="hljs-params">p, q, b</span>) </span>{
  <span class="hljs-keyword">var</span> t, c = ~(b<span class="hljs-number">-1</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
    t = c &amp; (p[i] ^ q[i]);
    p[i] ^= t;
    q[i] ^= t;
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pack25519</span>(<span class="hljs-params">o, n</span>) </span>{
  <span class="hljs-keyword">var</span> i, j, b;
  <span class="hljs-keyword">var</span> m = gf(), t = gf();
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) t[i] = n[i];
  car25519(t);
  car25519(t);
  car25519(t);
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">2</span>; j++) {
    m[<span class="hljs-number">0</span>] = t[<span class="hljs-number">0</span>] - <span class="hljs-number">0xffed</span>;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">15</span>; i++) {
      m[i] = t[i] - <span class="hljs-number">0xffff</span> - ((m[i<span class="hljs-number">-1</span>]&gt;&gt;<span class="hljs-number">16</span>) &amp; <span class="hljs-number">1</span>);
      m[i<span class="hljs-number">-1</span>] &amp;= <span class="hljs-number">0xffff</span>;
    }
    m[<span class="hljs-number">15</span>] = t[<span class="hljs-number">15</span>] - <span class="hljs-number">0x7fff</span> - ((m[<span class="hljs-number">14</span>]&gt;&gt;<span class="hljs-number">16</span>) &amp; <span class="hljs-number">1</span>);
    b = (m[<span class="hljs-number">15</span>]&gt;&gt;<span class="hljs-number">16</span>) &amp; <span class="hljs-number">1</span>;
    m[<span class="hljs-number">14</span>] &amp;= <span class="hljs-number">0xffff</span>;
    sel25519(t, m, <span class="hljs-number">1</span>-b);
  }
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
    o[<span class="hljs-number">2</span>*i] = t[i] &amp; <span class="hljs-number">0xff</span>;
    o[<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>] = t[i]&gt;&gt;<span class="hljs-number">8</span>;
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">neq25519</span>(<span class="hljs-params">a, b</span>) </span>{
  <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>), d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  pack25519(c, a);
  pack25519(d, b);
  <span class="hljs-keyword">return</span> crypto_verify_32(c, <span class="hljs-number">0</span>, d, <span class="hljs-number">0</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">par25519</span>(<span class="hljs-params">a</span>) </span>{
  <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  pack25519(d, a);
  <span class="hljs-keyword">return</span> d[<span class="hljs-number">0</span>] &amp; <span class="hljs-number">1</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unpack25519</span>(<span class="hljs-params">o, n</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) o[i] = n[<span class="hljs-number">2</span>*i] + (n[<span class="hljs-number">2</span>*i+<span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-number">8</span>);
  o[<span class="hljs-number">15</span>] &amp;= <span class="hljs-number">0x7fff</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">A</span>(<span class="hljs-params">o, a, b</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) o[i] = (a[i] + b[i])|<span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Z</span>(<span class="hljs-params">o, a, b</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) o[i] = (a[i] - b[i])|<span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">M</span>(<span class="hljs-params">o, a, b</span>) </span>{
  <span class="hljs-keyword">var</span> i, j, t = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(<span class="hljs-number">31</span>);
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">31</span>; i++) t[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++) {
      t[i+j] += a[i] * b[j];
    }
  }
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++) {
    t[i] += <span class="hljs-number">38</span> * t[i+<span class="hljs-number">16</span>];
  }
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) o[i] = t[i];
  car25519(o);
  car25519(o);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">S</span>(<span class="hljs-params">o, a</span>) </span>{
  M(o, a, a);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">inv25519</span>(<span class="hljs-params">o, i</span>) </span>{
  <span class="hljs-keyword">var</span> c = gf();
  <span class="hljs-keyword">var</span> a;
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">0</span>; a &lt; <span class="hljs-number">16</span>; a++) c[a] = i[a];
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">253</span>; a &gt;= <span class="hljs-number">0</span>; a--) {
    S(c, c);
    <span class="hljs-keyword">if</span>(a !== <span class="hljs-number">2</span> &amp;&amp; a !== <span class="hljs-number">4</span>) M(c, c, i);
  }
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">0</span>; a &lt; <span class="hljs-number">16</span>; a++) o[a] = c[a];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pow2523</span>(<span class="hljs-params">o, i</span>) </span>{
  <span class="hljs-keyword">var</span> c = gf();
  <span class="hljs-keyword">var</span> a;
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">0</span>; a &lt; <span class="hljs-number">16</span>; a++) c[a] = i[a];
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">250</span>; a &gt;= <span class="hljs-number">0</span>; a--) {
      S(c, c);
      <span class="hljs-keyword">if</span>(a !== <span class="hljs-number">1</span>) M(c, c, i);
  }
  <span class="hljs-keyword">for</span> (a = <span class="hljs-number">0</span>; a &lt; <span class="hljs-number">16</span>; a++) o[a] = c[a];
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_scalarmult</span>(<span class="hljs-params">q, n, p</span>) </span>{
  <span class="hljs-keyword">var</span> z = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  <span class="hljs-keyword">var</span> x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(<span class="hljs-number">80</span>), r, i;
  <span class="hljs-keyword">var</span> a = gf(), b = gf(), c = gf(),
      d = gf(), e = gf(), f = gf();
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">31</span>; i++) z[i] = n[i];
  z[<span class="hljs-number">31</span>]=(n[<span class="hljs-number">31</span>]&amp;<span class="hljs-number">127</span>)|<span class="hljs-number">64</span>;
  z[<span class="hljs-number">0</span>]&amp;=<span class="hljs-number">248</span>;
  unpack25519(x,p);
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
    b[i]=x[i];
    d[i]=a[i]=c[i]=<span class="hljs-number">0</span>;
  }
  a[<span class="hljs-number">0</span>]=d[<span class="hljs-number">0</span>]=<span class="hljs-number">1</span>;
  <span class="hljs-keyword">for</span> (i=<span class="hljs-number">254</span>; i&gt;=<span class="hljs-number">0</span>; --i) {
    r=(z[i&gt;&gt;&gt;<span class="hljs-number">3</span>]&gt;&gt;&gt;(i&amp;<span class="hljs-number">7</span>))&amp;<span class="hljs-number">1</span>;
    sel25519(a,b,r);
    sel25519(c,d,r);
    A(e,a,c);
    Z(a,a,c);
    A(c,b,d);
    Z(b,b,d);
    S(d,e);
    S(f,a);
    M(a,c,a);
    M(c,b,e);
    A(e,a,c);
    Z(a,a,c);
    S(b,a);
    Z(c,d,f);
    M(a,c,_121665);
    A(a,a,d);
    M(c,c,a);
    M(a,d,f);
    M(d,b,x);
    S(b,e);
    sel25519(a,b,r);
    sel25519(c,d,r);
  }
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
    x[i+<span class="hljs-number">16</span>]=a[i];
    x[i+<span class="hljs-number">32</span>]=c[i];
    x[i+<span class="hljs-number">48</span>]=b[i];
    x[i+<span class="hljs-number">64</span>]=d[i];
  }
  <span class="hljs-keyword">var</span> x32 = x.subarray(<span class="hljs-number">32</span>);
  <span class="hljs-keyword">var</span> x16 = x.subarray(<span class="hljs-number">16</span>);
  inv25519(x32,x32);
  M(x16,x16,x32);
  pack25519(q,x16);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_scalarmult_base</span>(<span class="hljs-params">q, n</span>) </span>{
  <span class="hljs-keyword">return</span> crypto_scalarmult(q, n, _9);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_box_keypair</span>(<span class="hljs-params">y, x</span>) </span>{
  randombytes(x, <span class="hljs-number">32</span>);
  <span class="hljs-keyword">return</span> crypto_scalarmult_base(y, x);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_box_beforenm</span>(<span class="hljs-params">k, y, x</span>) </span>{
  <span class="hljs-keyword">var</span> s = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  crypto_scalarmult(s, x, y);
  <span class="hljs-keyword">return</span> crypto_core_hsalsa20(k, _0, s, sigma);
}

<span class="hljs-keyword">var</span> crypto_box_afternm = crypto_secretbox;
<span class="hljs-keyword">var</span> crypto_box_open_afternm = crypto_secretbox_open;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_box</span>(<span class="hljs-params">c, m, d, n, y, x</span>) </span>{
  <span class="hljs-keyword">var</span> k = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  crypto_box_beforenm(k, y, x);
  <span class="hljs-keyword">return</span> crypto_box_afternm(c, m, d, n, k);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_box_open</span>(<span class="hljs-params">m, c, d, n, y, x</span>) </span>{
  <span class="hljs-keyword">var</span> k = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>);
  crypto_box_beforenm(k, y, x);
  <span class="hljs-keyword">return</span> crypto_box_open_afternm(m, c, d, n, k);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add64</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>, b = <span class="hljs-number">0</span>, c = <span class="hljs-number">0</span>, d = <span class="hljs-number">0</span>, m16 = <span class="hljs-number">65535</span>, l, h, i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">arguments</span>.length; i++) {
    l = <span class="hljs-built_in">arguments</span>[i].lo;
    h = <span class="hljs-built_in">arguments</span>[i].hi;
    a += (l &amp; m16); b += (l &gt;&gt;&gt; <span class="hljs-number">16</span>);
    c += (h &amp; m16); d += (h &gt;&gt;&gt; <span class="hljs-number">16</span>);
  }

  b += (a &gt;&gt;&gt; <span class="hljs-number">16</span>);
  c += (b &gt;&gt;&gt; <span class="hljs-number">16</span>);
  d += (c &gt;&gt;&gt; <span class="hljs-number">16</span>);

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> u64((c &amp; m16) | (d &lt;&lt; <span class="hljs-number">16</span>), (a &amp; m16) | (b &lt;&lt; <span class="hljs-number">16</span>));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shr64</span>(<span class="hljs-params">x, c</span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> u64((x.hi &gt;&gt;&gt; c), (x.lo &gt;&gt;&gt; c) | (x.hi &lt;&lt; (<span class="hljs-number">32</span> - c)));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">xor64</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> l = <span class="hljs-number">0</span>, h = <span class="hljs-number">0</span>, i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">arguments</span>.length; i++) {
    l ^= <span class="hljs-built_in">arguments</span>[i].lo;
    h ^= <span class="hljs-built_in">arguments</span>[i].hi;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> u64(h, l);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">R</span>(<span class="hljs-params">x, c</span>) </span>{
  <span class="hljs-keyword">var</span> h, l, c1 = <span class="hljs-number">32</span> - c;
  <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">32</span>) {
    h = (x.hi &gt;&gt;&gt; c) | (x.lo &lt;&lt; c1);
    l = (x.lo &gt;&gt;&gt; c) | (x.hi &lt;&lt; c1);
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (c &lt; <span class="hljs-number">64</span>) {
    h = (x.lo &gt;&gt;&gt; c) | (x.hi &lt;&lt; c1);
    l = (x.hi &gt;&gt;&gt; c) | (x.lo &lt;&lt; c1);
  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> u64(h, l);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Ch</span>(<span class="hljs-params">x, y, z</span>) </span>{
  <span class="hljs-keyword">var</span> h = (x.hi &amp; y.hi) ^ (~x.hi &amp; z.hi),
      l = (x.lo &amp; y.lo) ^ (~x.lo &amp; z.lo);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> u64(h, l);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Maj</span>(<span class="hljs-params">x, y, z</span>) </span>{
  <span class="hljs-keyword">var</span> h = (x.hi &amp; y.hi) ^ (x.hi &amp; z.hi) ^ (y.hi &amp; z.hi),
      l = (x.lo &amp; y.lo) ^ (x.lo &amp; z.lo) ^ (y.lo &amp; z.lo);
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> u64(h, l);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sigma0</span>(<span class="hljs-params">x</span>) </span>{ <span class="hljs-keyword">return</span> xor64(R(x,<span class="hljs-number">28</span>), R(x,<span class="hljs-number">34</span>), R(x,<span class="hljs-number">39</span>)); }
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Sigma1</span>(<span class="hljs-params">x</span>) </span>{ <span class="hljs-keyword">return</span> xor64(R(x,<span class="hljs-number">14</span>), R(x,<span class="hljs-number">18</span>), R(x,<span class="hljs-number">41</span>)); }
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sigma0</span>(<span class="hljs-params">x</span>) </span>{ <span class="hljs-keyword">return</span> xor64(R(x, <span class="hljs-number">1</span>), R(x, <span class="hljs-number">8</span>), shr64(x,<span class="hljs-number">7</span>)); }
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sigma1</span>(<span class="hljs-params">x</span>) </span>{ <span class="hljs-keyword">return</span> xor64(R(x,<span class="hljs-number">19</span>), R(x,<span class="hljs-number">61</span>), shr64(x,<span class="hljs-number">6</span>)); }

<span class="hljs-keyword">var</span> K = [
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x428a2f98</span>, <span class="hljs-number">0xd728ae22</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x71374491</span>, <span class="hljs-number">0x23ef65cd</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xb5c0fbcf</span>, <span class="hljs-number">0xec4d3b2f</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xe9b5dba5</span>, <span class="hljs-number">0x8189dbbc</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x3956c25b</span>, <span class="hljs-number">0xf348b538</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x59f111f1</span>, <span class="hljs-number">0xb605d019</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x923f82a4</span>, <span class="hljs-number">0xaf194f9b</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xab1c5ed5</span>, <span class="hljs-number">0xda6d8118</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xd807aa98</span>, <span class="hljs-number">0xa3030242</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x12835b01</span>, <span class="hljs-number">0x45706fbe</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x243185be</span>, <span class="hljs-number">0x4ee4b28c</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x550c7dc3</span>, <span class="hljs-number">0xd5ffb4e2</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x72be5d74</span>, <span class="hljs-number">0xf27b896f</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x80deb1fe</span>, <span class="hljs-number">0x3b1696b1</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x9bdc06a7</span>, <span class="hljs-number">0x25c71235</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xc19bf174</span>, <span class="hljs-number">0xcf692694</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xe49b69c1</span>, <span class="hljs-number">0x9ef14ad2</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xefbe4786</span>, <span class="hljs-number">0x384f25e3</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x0fc19dc6</span>, <span class="hljs-number">0x8b8cd5b5</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x240ca1cc</span>, <span class="hljs-number">0x77ac9c65</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x2de92c6f</span>, <span class="hljs-number">0x592b0275</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x4a7484aa</span>, <span class="hljs-number">0x6ea6e483</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x5cb0a9dc</span>, <span class="hljs-number">0xbd41fbd4</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x76f988da</span>, <span class="hljs-number">0x831153b5</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x983e5152</span>, <span class="hljs-number">0xee66dfab</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xa831c66d</span>, <span class="hljs-number">0x2db43210</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xb00327c8</span>, <span class="hljs-number">0x98fb213f</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xbf597fc7</span>, <span class="hljs-number">0xbeef0ee4</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xc6e00bf3</span>, <span class="hljs-number">0x3da88fc2</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xd5a79147</span>, <span class="hljs-number">0x930aa725</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x06ca6351</span>, <span class="hljs-number">0xe003826f</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x14292967</span>, <span class="hljs-number">0x0a0e6e70</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x27b70a85</span>, <span class="hljs-number">0x46d22ffc</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x2e1b2138</span>, <span class="hljs-number">0x5c26c926</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x4d2c6dfc</span>, <span class="hljs-number">0x5ac42aed</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x53380d13</span>, <span class="hljs-number">0x9d95b3df</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x650a7354</span>, <span class="hljs-number">0x8baf63de</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x766a0abb</span>, <span class="hljs-number">0x3c77b2a8</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x81c2c92e</span>, <span class="hljs-number">0x47edaee6</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x92722c85</span>, <span class="hljs-number">0x1482353b</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xa2bfe8a1</span>, <span class="hljs-number">0x4cf10364</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xa81a664b</span>, <span class="hljs-number">0xbc423001</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xc24b8b70</span>, <span class="hljs-number">0xd0f89791</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xc76c51a3</span>, <span class="hljs-number">0x0654be30</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xd192e819</span>, <span class="hljs-number">0xd6ef5218</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xd6990624</span>, <span class="hljs-number">0x5565a910</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xf40e3585</span>, <span class="hljs-number">0x5771202a</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x106aa070</span>, <span class="hljs-number">0x32bbd1b8</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x19a4c116</span>, <span class="hljs-number">0xb8d2d0c8</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x1e376c08</span>, <span class="hljs-number">0x5141ab53</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x2748774c</span>, <span class="hljs-number">0xdf8eeb99</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x34b0bcb5</span>, <span class="hljs-number">0xe19b48a8</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x391c0cb3</span>, <span class="hljs-number">0xc5c95a63</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x4ed8aa4a</span>, <span class="hljs-number">0xe3418acb</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x5b9cca4f</span>, <span class="hljs-number">0x7763e373</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x682e6ff3</span>, <span class="hljs-number">0xd6b2b8a3</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x748f82ee</span>, <span class="hljs-number">0x5defb2fc</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x78a5636f</span>, <span class="hljs-number">0x43172f60</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x84c87814</span>, <span class="hljs-number">0xa1f0ab72</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x8cc70208</span>, <span class="hljs-number">0x1a6439ec</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x90befffa</span>, <span class="hljs-number">0x23631e28</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xa4506ceb</span>, <span class="hljs-number">0xde82bde9</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xbef9a3f7</span>, <span class="hljs-number">0xb2c67915</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xc67178f2</span>, <span class="hljs-number">0xe372532b</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xca273ece</span>, <span class="hljs-number">0xea26619c</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xd186b8c7</span>, <span class="hljs-number">0x21c0c207</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xeada7dd6</span>, <span class="hljs-number">0xcde0eb1e</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0xf57d4f7f</span>, <span class="hljs-number">0xee6ed178</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x06f067aa</span>, <span class="hljs-number">0x72176fba</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x0a637dc5</span>, <span class="hljs-number">0xa2c898a6</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x113f9804</span>, <span class="hljs-number">0xbef90dae</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x1b710b35</span>, <span class="hljs-number">0x131c471b</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x28db77f5</span>, <span class="hljs-number">0x23047d84</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x32caab7b</span>, <span class="hljs-number">0x40c72493</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x3c9ebe0a</span>, <span class="hljs-number">0x15c9bebc</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x431d67c4</span>, <span class="hljs-number">0x9c100d4c</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x4cc5d4be</span>, <span class="hljs-number">0xcb3e42b6</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x597f299c</span>, <span class="hljs-number">0xfc657e2a</span>),
  <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x5fcb6fab</span>, <span class="hljs-number">0x3ad6faec</span>), <span class="hljs-keyword">new</span> u64(<span class="hljs-number">0x6c44198c</span>, <span class="hljs-number">0x4a475817</span>)
];

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_hashblocks</span>(<span class="hljs-params">x, m, n</span>) </span>{
  <span class="hljs-keyword">var</span> z = [], b = [], a = [], w = [], t, i, j;

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) z[i] = a[i] = dl64(x, <span class="hljs-number">8</span>*i);

  <span class="hljs-keyword">var</span> pos = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">while</span> (n &gt;= <span class="hljs-number">128</span>) {
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) w[i] = dl64(m, <span class="hljs-number">8</span>*i+pos);
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">80</span>; i++) {
      <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">8</span>; j++) b[j] = a[j];
      t = add64(a[<span class="hljs-number">7</span>], Sigma1(a[<span class="hljs-number">4</span>]), Ch(a[<span class="hljs-number">4</span>], a[<span class="hljs-number">5</span>], a[<span class="hljs-number">6</span>]), K[i], w[i%<span class="hljs-number">16</span>]);
      b[<span class="hljs-number">7</span>] = add64(t, Sigma0(a[<span class="hljs-number">0</span>]), Maj(a[<span class="hljs-number">0</span>], a[<span class="hljs-number">1</span>], a[<span class="hljs-number">2</span>]));
      b[<span class="hljs-number">3</span>] = add64(b[<span class="hljs-number">3</span>], t);
      <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">8</span>; j++) a[(j+<span class="hljs-number">1</span>)%<span class="hljs-number">8</span>] = b[j];
      <span class="hljs-keyword">if</span> (i%<span class="hljs-number">16</span> === <span class="hljs-number">15</span>) {
        <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">16</span>; j++) {
          w[j] = add64(w[j], w[(j+<span class="hljs-number">9</span>)%<span class="hljs-number">16</span>], sigma0(w[(j+<span class="hljs-number">1</span>)%<span class="hljs-number">16</span>]), sigma1(w[(j+<span class="hljs-number">14</span>)%<span class="hljs-number">16</span>]));
        }
      }
    }

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) {
      a[i] = add64(a[i], z[i]);
      z[i] = a[i];
    }

    pos += <span class="hljs-number">128</span>;
    n -= <span class="hljs-number">128</span>;
  }

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++) ts64(x, <span class="hljs-number">8</span>*i, z[i]);
  <span class="hljs-keyword">return</span> n;
}

<span class="hljs-keyword">var</span> iv = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>([
  <span class="hljs-number">0x6a</span>,<span class="hljs-number">0x09</span>,<span class="hljs-number">0xe6</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0xf3</span>,<span class="hljs-number">0xbc</span>,<span class="hljs-number">0xc9</span>,<span class="hljs-number">0x08</span>,
  <span class="hljs-number">0xbb</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0xae</span>,<span class="hljs-number">0x85</span>,<span class="hljs-number">0x84</span>,<span class="hljs-number">0xca</span>,<span class="hljs-number">0xa7</span>,<span class="hljs-number">0x3b</span>,
  <span class="hljs-number">0x3c</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0xf3</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0xfe</span>,<span class="hljs-number">0x94</span>,<span class="hljs-number">0xf8</span>,<span class="hljs-number">0x2b</span>,
  <span class="hljs-number">0xa5</span>,<span class="hljs-number">0x4f</span>,<span class="hljs-number">0xf5</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x1d</span>,<span class="hljs-number">0x36</span>,<span class="hljs-number">0xf1</span>,
  <span class="hljs-number">0x51</span>,<span class="hljs-number">0x0e</span>,<span class="hljs-number">0x52</span>,<span class="hljs-number">0x7f</span>,<span class="hljs-number">0xad</span>,<span class="hljs-number">0xe6</span>,<span class="hljs-number">0x82</span>,<span class="hljs-number">0xd1</span>,
  <span class="hljs-number">0x9b</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x8c</span>,<span class="hljs-number">0x2b</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x1f</span>,
  <span class="hljs-number">0x1f</span>,<span class="hljs-number">0x83</span>,<span class="hljs-number">0xd9</span>,<span class="hljs-number">0xab</span>,<span class="hljs-number">0xfb</span>,<span class="hljs-number">0x41</span>,<span class="hljs-number">0xbd</span>,<span class="hljs-number">0x6b</span>,
  <span class="hljs-number">0x5b</span>,<span class="hljs-number">0xe0</span>,<span class="hljs-number">0xcd</span>,<span class="hljs-number">0x19</span>,<span class="hljs-number">0x13</span>,<span class="hljs-number">0x7e</span>,<span class="hljs-number">0x21</span>,<span class="hljs-number">0x79</span>
]);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_hash</span>(<span class="hljs-params">out, m, n</span>) </span>{
  <span class="hljs-keyword">var</span> h = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>), x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">256</span>);
  <span class="hljs-keyword">var</span> i, b = n;

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) h[i] = iv[i];

  crypto_hashblocks(h, m, n);
  n %= <span class="hljs-number">128</span>;

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">256</span>; i++) x[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) x[i] = m[b-n+i];
  x[n] = <span class="hljs-number">128</span>;

  n = <span class="hljs-number">256</span><span class="hljs-number">-128</span>*(n&lt;<span class="hljs-number">112</span>?<span class="hljs-number">1</span>:<span class="hljs-number">0</span>);
  x[n<span class="hljs-number">-9</span>] = <span class="hljs-number">0</span>;
  ts64(x, n<span class="hljs-number">-8</span>, <span class="hljs-keyword">new</span> u64((b / <span class="hljs-number">0x20000000</span>) | <span class="hljs-number">0</span>, b &lt;&lt; <span class="hljs-number">3</span>));
  crypto_hashblocks(h, x, n);

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) out[i] = h[i];

  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">add</span>(<span class="hljs-params">p, q</span>) </span>{
  <span class="hljs-keyword">var</span> a = gf(), b = gf(), c = gf(),
      d = gf(), e = gf(), f = gf(),
      g = gf(), h = gf(), t = gf();

  Z(a, p[<span class="hljs-number">1</span>], p[<span class="hljs-number">0</span>]);
  Z(t, q[<span class="hljs-number">1</span>], q[<span class="hljs-number">0</span>]);
  M(a, a, t);
  A(b, p[<span class="hljs-number">0</span>], p[<span class="hljs-number">1</span>]);
  A(t, q[<span class="hljs-number">0</span>], q[<span class="hljs-number">1</span>]);
  M(b, b, t);
  M(c, p[<span class="hljs-number">3</span>], q[<span class="hljs-number">3</span>]);
  M(c, c, D2);
  M(d, p[<span class="hljs-number">2</span>], q[<span class="hljs-number">2</span>]);
  A(d, d, d);
  Z(e, b, a);
  Z(f, d, c);
  A(g, d, c);
  A(h, b, a);

  M(p[<span class="hljs-number">0</span>], e, f);
  M(p[<span class="hljs-number">1</span>], h, g);
  M(p[<span class="hljs-number">2</span>], g, f);
  M(p[<span class="hljs-number">3</span>], e, h);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cswap</span>(<span class="hljs-params">p, q, b</span>) </span>{
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
    sel25519(p[i], q[i], b);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">pack</span>(<span class="hljs-params">r, p</span>) </span>{
  <span class="hljs-keyword">var</span> tx = gf(), ty = gf(), zi = gf();
  inv25519(zi, p[<span class="hljs-number">2</span>]);
  M(tx, p[<span class="hljs-number">0</span>], zi);
  M(ty, p[<span class="hljs-number">1</span>], zi);
  pack25519(r, ty);
  r[<span class="hljs-number">31</span>] ^= par25519(tx) &lt;&lt; <span class="hljs-number">7</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scalarmult</span>(<span class="hljs-params">p, q, s</span>) </span>{
  <span class="hljs-keyword">var</span> b, i;
  set25519(p[<span class="hljs-number">0</span>], gf0);
  set25519(p[<span class="hljs-number">1</span>], gf1);
  set25519(p[<span class="hljs-number">2</span>], gf1);
  set25519(p[<span class="hljs-number">3</span>], gf0);
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">255</span>; i &gt;= <span class="hljs-number">0</span>; --i) {
    b = (s[(i/<span class="hljs-number">8</span>)|<span class="hljs-number">0</span>] &gt;&gt; (i&amp;<span class="hljs-number">7</span>)) &amp; <span class="hljs-number">1</span>;
    cswap(p, q, b);
    add(q, p);
    add(p, p);
    cswap(p, q, b);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">scalarbase</span>(<span class="hljs-params">p, s</span>) </span>{
  <span class="hljs-keyword">var</span> q = [gf(), gf(), gf(), gf()];
  set25519(q[<span class="hljs-number">0</span>], X);
  set25519(q[<span class="hljs-number">1</span>], Y);
  set25519(q[<span class="hljs-number">2</span>], gf1);
  M(q[<span class="hljs-number">3</span>], X, Y);
  scalarmult(p, q, s);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_sign_keypair</span>(<span class="hljs-params">pk, sk, seeded</span>) </span>{
  <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">var</span> p = [gf(), gf(), gf(), gf()];
  <span class="hljs-keyword">var</span> i;

  <span class="hljs-keyword">if</span> (!seeded) randombytes(sk, <span class="hljs-number">32</span>);
  crypto_hash(d, sk, <span class="hljs-number">32</span>);
  d[<span class="hljs-number">0</span>] &amp;= <span class="hljs-number">248</span>;
  d[<span class="hljs-number">31</span>] &amp;= <span class="hljs-number">127</span>;
  d[<span class="hljs-number">31</span>] |= <span class="hljs-number">64</span>;

  scalarbase(p, d);
  pack(pk, p);

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) sk[i+<span class="hljs-number">32</span>] = pk[i];
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-keyword">var</span> L = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>([<span class="hljs-number">0xed</span>, <span class="hljs-number">0xd3</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0x5c</span>, <span class="hljs-number">0x1a</span>, <span class="hljs-number">0x63</span>, <span class="hljs-number">0x12</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0xd6</span>, <span class="hljs-number">0x9c</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0xa2</span>, <span class="hljs-number">0xde</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0xde</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0x10</span>]);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">modL</span>(<span class="hljs-params">r, x</span>) </span>{
  <span class="hljs-keyword">var</span> carry, i, j, k;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">63</span>; i &gt;= <span class="hljs-number">32</span>; --i) {
    carry = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">for</span> (j = i - <span class="hljs-number">32</span>, k = i - <span class="hljs-number">12</span>; j &lt; k; ++j) {
      x[j] += carry - <span class="hljs-number">16</span> * x[i] * L[j - (i - <span class="hljs-number">32</span>)];
      carry = (x[j] + <span class="hljs-number">128</span>) &gt;&gt; <span class="hljs-number">8</span>;
      x[j] -= carry * <span class="hljs-number">256</span>;
    }
    x[j] += carry;
    x[i] = <span class="hljs-number">0</span>;
  }
  carry = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">32</span>; j++) {
    x[j] += carry - (x[<span class="hljs-number">31</span>] &gt;&gt; <span class="hljs-number">4</span>) * L[j];
    carry = x[j] &gt;&gt; <span class="hljs-number">8</span>;
    x[j] &amp;= <span class="hljs-number">255</span>;
  }
  <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">32</span>; j++) x[j] -= carry * L[j];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) {
    x[i+<span class="hljs-number">1</span>] += x[i] &gt;&gt; <span class="hljs-number">8</span>;
    r[i] = x[i] &amp; <span class="hljs-number">255</span>;
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reduce</span>(<span class="hljs-params">r</span>) </span>{
  <span class="hljs-keyword">var</span> x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(<span class="hljs-number">64</span>), i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) x[i] = r[i];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) r[i] = <span class="hljs-number">0</span>;
  modL(r, x);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Note: difference from C - smlen returned, not passed as argument.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_sign</span>(<span class="hljs-params">sm, m, n, sk</span>) </span>{
  <span class="hljs-keyword">var</span> d = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>), h = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>), r = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">var</span> i, j, x = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Float64Array</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">var</span> p = [gf(), gf(), gf(), gf()];

  crypto_hash(d, sk, <span class="hljs-number">32</span>);
  d[<span class="hljs-number">0</span>] &amp;= <span class="hljs-number">248</span>;
  d[<span class="hljs-number">31</span>] &amp;= <span class="hljs-number">127</span>;
  d[<span class="hljs-number">31</span>] |= <span class="hljs-number">64</span>;

  <span class="hljs-keyword">var</span> smlen = n + <span class="hljs-number">64</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) sm[<span class="hljs-number">64</span> + i] = m[i];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) sm[<span class="hljs-number">32</span> + i] = d[<span class="hljs-number">32</span> + i];

  crypto_hash(r, sm.subarray(<span class="hljs-number">32</span>), n+<span class="hljs-number">32</span>);
  reduce(r);
  scalarbase(p, r);
  pack(sm, p);

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">32</span>; i &lt; <span class="hljs-number">64</span>; i++) sm[i] = sk[i];
  crypto_hash(h, sm, n + <span class="hljs-number">64</span>);
  reduce(h);

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">64</span>; i++) x[i] = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) x[i] = r[i];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) {
    <span class="hljs-keyword">for</span> (j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">32</span>; j++) {
      x[i+j] += h[i] * d[j];
    }
  }

  modL(sm.subarray(<span class="hljs-number">32</span>), x);
  <span class="hljs-keyword">return</span> smlen;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unpackneg</span>(<span class="hljs-params">r, p</span>) </span>{
  <span class="hljs-keyword">var</span> t = gf(), chk = gf(), num = gf(),
      den = gf(), den2 = gf(), den4 = gf(),
      den6 = gf();

  set25519(r[<span class="hljs-number">2</span>], gf1);
  unpack25519(r[<span class="hljs-number">1</span>], p);
  S(num, r[<span class="hljs-number">1</span>]);
  M(den, num, D);
  Z(num, num, r[<span class="hljs-number">2</span>]);
  A(den, r[<span class="hljs-number">2</span>], den);

  S(den2, den);
  S(den4, den2);
  M(den6, den4, den2);
  M(t, den6, num);
  M(t, t, den);

  pow2523(t, t);
  M(t, t, num);
  M(t, t, den);
  M(t, t, den);
  M(r[<span class="hljs-number">0</span>], t, den);

  S(chk, r[<span class="hljs-number">0</span>]);
  M(chk, chk, den);
  <span class="hljs-keyword">if</span> (neq25519(chk, num)) M(r[<span class="hljs-number">0</span>], r[<span class="hljs-number">0</span>], I);

  S(chk, r[<span class="hljs-number">0</span>]);
  M(chk, chk, den);
  <span class="hljs-keyword">if</span> (neq25519(chk, num)) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;

  <span class="hljs-keyword">if</span> (par25519(r[<span class="hljs-number">0</span>]) === (p[<span class="hljs-number">31</span>]&gt;&gt;<span class="hljs-number">7</span>)) Z(r[<span class="hljs-number">0</span>], gf0, r[<span class="hljs-number">0</span>]);

  M(r[<span class="hljs-number">3</span>], r[<span class="hljs-number">0</span>], r[<span class="hljs-number">1</span>]);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crypto_sign_open</span>(<span class="hljs-params">m, sm, n, pk</span>) </span>{
  <span class="hljs-keyword">var</span> i, mlen;
  <span class="hljs-keyword">var</span> t = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">32</span>), h = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-number">64</span>);
  <span class="hljs-keyword">var</span> p = [gf(), gf(), gf(), gf()],
      q = [gf(), gf(), gf(), gf()];

  mlen = <span class="hljs-number">-1</span>;
  <span class="hljs-keyword">if</span> (n &lt; <span class="hljs-number">64</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;

  <span class="hljs-keyword">if</span> (unpackneg(q, pk)) <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) m[i] = sm[i];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) m[i+<span class="hljs-number">32</span>] = pk[i];
  crypto_hash(h, m, n);
  reduce(h);
  scalarmult(p, q, h);

  scalarbase(q, sm.subarray(<span class="hljs-number">32</span>));
  add(p, q);
  pack(t, p);

  n -= <span class="hljs-number">64</span>;
  <span class="hljs-keyword">if</span> (crypto_verify_32(sm, <span class="hljs-number">0</span>, t, <span class="hljs-number">0</span>)) {
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) m[i] = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;
  }

  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) m[i] = sm[i + <span class="hljs-number">64</span>];
  mlen = n;
  <span class="hljs-keyword">return</span> mlen;
}

<span class="hljs-keyword">var</span> crypto_secretbox_KEYBYTES = <span class="hljs-number">32</span>,
    crypto_secretbox_NONCEBYTES = <span class="hljs-number">24</span>,
    crypto_secretbox_ZEROBYTES = <span class="hljs-number">32</span>,
    crypto_secretbox_BOXZEROBYTES = <span class="hljs-number">16</span>,
    crypto_scalarmult_BYTES = <span class="hljs-number">32</span>,
    crypto_scalarmult_SCALARBYTES = <span class="hljs-number">32</span>,
    crypto_box_PUBLICKEYBYTES = <span class="hljs-number">32</span>,
    crypto_box_SECRETKEYBYTES = <span class="hljs-number">32</span>,
    crypto_box_BEFORENMBYTES = <span class="hljs-number">32</span>,
    crypto_box_NONCEBYTES = crypto_secretbox_NONCEBYTES,
    crypto_box_ZEROBYTES = crypto_secretbox_ZEROBYTES,
    crypto_box_BOXZEROBYTES = crypto_secretbox_BOXZEROBYTES,
    crypto_sign_BYTES = <span class="hljs-number">64</span>,
    crypto_sign_PUBLICKEYBYTES = <span class="hljs-number">32</span>,
    crypto_sign_SECRETKEYBYTES = <span class="hljs-number">64</span>,
    crypto_sign_SEEDBYTES = <span class="hljs-number">32</span>,
    crypto_hash_BYTES = <span class="hljs-number">64</span>;

nacl.lowlevel = {
  <span class="hljs-attr">crypto_core_hsalsa20</span>: crypto_core_hsalsa20,
  <span class="hljs-attr">crypto_stream_xor</span>: crypto_stream_xor,
  <span class="hljs-attr">crypto_stream</span>: crypto_stream,
  <span class="hljs-attr">crypto_stream_salsa20_xor</span>: crypto_stream_salsa20_xor,
  <span class="hljs-attr">crypto_stream_salsa20</span>: crypto_stream_salsa20,
  <span class="hljs-attr">crypto_onetimeauth</span>: crypto_onetimeauth,
  <span class="hljs-attr">crypto_onetimeauth_verify</span>: crypto_onetimeauth_verify,
  <span class="hljs-attr">crypto_verify_16</span>: crypto_verify_16,
  <span class="hljs-attr">crypto_verify_32</span>: crypto_verify_32,
  <span class="hljs-attr">crypto_secretbox</span>: crypto_secretbox,
  <span class="hljs-attr">crypto_secretbox_open</span>: crypto_secretbox_open,
  <span class="hljs-attr">crypto_scalarmult</span>: crypto_scalarmult,
  <span class="hljs-attr">crypto_scalarmult_base</span>: crypto_scalarmult_base,
  <span class="hljs-attr">crypto_box_beforenm</span>: crypto_box_beforenm,
  <span class="hljs-attr">crypto_box_afternm</span>: crypto_box_afternm,
  <span class="hljs-attr">crypto_box</span>: crypto_box,
  <span class="hljs-attr">crypto_box_open</span>: crypto_box_open,
  <span class="hljs-attr">crypto_box_keypair</span>: crypto_box_keypair,
  <span class="hljs-attr">crypto_hash</span>: crypto_hash,
  <span class="hljs-attr">crypto_sign</span>: crypto_sign,
  <span class="hljs-attr">crypto_sign_keypair</span>: crypto_sign_keypair,
  <span class="hljs-attr">crypto_sign_open</span>: crypto_sign_open,

  <span class="hljs-attr">crypto_secretbox_KEYBYTES</span>: crypto_secretbox_KEYBYTES,
  <span class="hljs-attr">crypto_secretbox_NONCEBYTES</span>: crypto_secretbox_NONCEBYTES,
  <span class="hljs-attr">crypto_secretbox_ZEROBYTES</span>: crypto_secretbox_ZEROBYTES,
  <span class="hljs-attr">crypto_secretbox_BOXZEROBYTES</span>: crypto_secretbox_BOXZEROBYTES,
  <span class="hljs-attr">crypto_scalarmult_BYTES</span>: crypto_scalarmult_BYTES,
  <span class="hljs-attr">crypto_scalarmult_SCALARBYTES</span>: crypto_scalarmult_SCALARBYTES,
  <span class="hljs-attr">crypto_box_PUBLICKEYBYTES</span>: crypto_box_PUBLICKEYBYTES,
  <span class="hljs-attr">crypto_box_SECRETKEYBYTES</span>: crypto_box_SECRETKEYBYTES,
  <span class="hljs-attr">crypto_box_BEFORENMBYTES</span>: crypto_box_BEFORENMBYTES,
  <span class="hljs-attr">crypto_box_NONCEBYTES</span>: crypto_box_NONCEBYTES,
  <span class="hljs-attr">crypto_box_ZEROBYTES</span>: crypto_box_ZEROBYTES,
  <span class="hljs-attr">crypto_box_BOXZEROBYTES</span>: crypto_box_BOXZEROBYTES,
  <span class="hljs-attr">crypto_sign_BYTES</span>: crypto_sign_BYTES,
  <span class="hljs-attr">crypto_sign_PUBLICKEYBYTES</span>: crypto_sign_PUBLICKEYBYTES,
  <span class="hljs-attr">crypto_sign_SECRETKEYBYTES</span>: crypto_sign_SECRETKEYBYTES,
  <span class="hljs-attr">crypto_sign_SEEDBYTES</span>: crypto_sign_SEEDBYTES,
  <span class="hljs-attr">crypto_hash_BYTES</span>: crypto_hash_BYTES
};

<span class="hljs-comment">/* High-level API */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkLengths</span>(<span class="hljs-params">k, n</span>) </span>{
  <span class="hljs-keyword">if</span> (k.length !== crypto_secretbox_KEYBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad key size'</span>);
  <span class="hljs-keyword">if</span> (n.length !== crypto_secretbox_NONCEBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad nonce size'</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkBoxLengths</span>(<span class="hljs-params">pk, sk</span>) </span>{
  <span class="hljs-keyword">if</span> (pk.length !== crypto_box_PUBLICKEYBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad public key size'</span>);
  <span class="hljs-keyword">if</span> (sk.length !== crypto_box_SECRETKEYBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad secret key size'</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkArrayTypes</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> t, i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">arguments</span>.length; i++) {
     <span class="hljs-keyword">if</span> ((t = <span class="hljs-built_in">Object</span>.prototype.toString.call(<span class="hljs-built_in">arguments</span>[i])) !== <span class="hljs-string">'[object Uint8Array]'</span>)
       <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'unexpected type '</span> + t + <span class="hljs-string">', use Uint8Array'</span>);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanup</span>(<span class="hljs-params">arr</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; arr.length; i++) arr[i] = <span class="hljs-number">0</span>;
}

nacl.util = {};

nacl.util.decodeUTF8 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">s</span>) </span>{
  <span class="hljs-keyword">var</span> i, d = <span class="hljs-built_in">unescape</span>(<span class="hljs-built_in">encodeURIComponent</span>(s)), b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(d.length);
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; d.length; i++) b[i] = d.charCodeAt(i);
  <span class="hljs-keyword">return</span> b;
};

nacl.util.encodeUTF8 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arr</span>) </span>{
  <span class="hljs-keyword">var</span> i, s = [];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; arr.length; i++) s.push(<span class="hljs-built_in">String</span>.fromCharCode(arr[i]));
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-built_in">escape</span>(s.join(<span class="hljs-string">''</span>)));
};

nacl.util.encodeBase64 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">arr</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> btoa === <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> Buffer(arr)).toString(<span class="hljs-string">'base64'</span>);
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> i, s = [], len = arr.length;
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i++) s.push(<span class="hljs-built_in">String</span>.fromCharCode(arr[i]));
    <span class="hljs-keyword">return</span> btoa(s.join(<span class="hljs-string">''</span>));
  }
};

nacl.util.decodeBase64 = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">s</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> atob === <span class="hljs-string">'undefined'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(<span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-keyword">new</span> Buffer(s, <span class="hljs-string">'base64'</span>), <span class="hljs-number">0</span>));
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> i, d = atob(s), b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(d.length);
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; d.length; i++) b[i] = d.charCodeAt(i);
    <span class="hljs-keyword">return</span> b;
  }
};

nacl.randomBytes = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) </span>{
  <span class="hljs-keyword">var</span> b = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(n);
  randombytes(b, n);
  <span class="hljs-keyword">return</span> b;
};

nacl.secretbox = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, nonce, key</span>) </span>{
  checkArrayTypes(msg, nonce, key);
  checkLengths(key, nonce);
  <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_secretbox_ZEROBYTES + msg.length);
  <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(m.length);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; msg.length; i++) m[i+crypto_secretbox_ZEROBYTES] = msg[i];
  crypto_secretbox(c, m, m.length, nonce, key);
  <span class="hljs-keyword">return</span> c.subarray(crypto_secretbox_BOXZEROBYTES);
};

nacl.secretbox.open = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">box, nonce, key</span>) </span>{
  checkArrayTypes(box, nonce, key);
  checkLengths(key, nonce);
  <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_secretbox_BOXZEROBYTES + box.length);
  <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(c.length);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; box.length; i++) c[i+crypto_secretbox_BOXZEROBYTES] = box[i];
  <span class="hljs-keyword">if</span> (c.length &lt; <span class="hljs-number">32</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (crypto_secretbox_open(m, c, c.length, nonce, key) !== <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">return</span> m.subarray(crypto_secretbox_ZEROBYTES);
};

nacl.secretbox.keyLength = crypto_secretbox_KEYBYTES;
nacl.secretbox.nonceLength = crypto_secretbox_NONCEBYTES;
nacl.secretbox.overheadLength = crypto_secretbox_BOXZEROBYTES;

nacl.scalarMult = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n, p</span>) </span>{
  checkArrayTypes(n, p);
  <span class="hljs-keyword">if</span> (n.length !== crypto_scalarmult_SCALARBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad n size'</span>);
  <span class="hljs-keyword">if</span> (p.length !== crypto_scalarmult_BYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad p size'</span>);
  <span class="hljs-keyword">var</span> q = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_scalarmult_BYTES);
  crypto_scalarmult(q, n, p);
  <span class="hljs-keyword">return</span> q;
};

nacl.scalarMult.base = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) </span>{
  checkArrayTypes(n);
  <span class="hljs-keyword">if</span> (n.length !== crypto_scalarmult_SCALARBYTES) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad n size'</span>);
  <span class="hljs-keyword">var</span> q = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_scalarmult_BYTES);
  crypto_scalarmult_base(q, n);
  <span class="hljs-keyword">return</span> q;
};

nacl.scalarMult.scalarLength = crypto_scalarmult_SCALARBYTES;
nacl.scalarMult.groupElementLength = crypto_scalarmult_BYTES;

nacl.box = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, nonce, publicKey, secretKey</span>) </span>{
  <span class="hljs-keyword">var</span> k = nacl.box.before(publicKey, secretKey);
  <span class="hljs-keyword">return</span> nacl.secretbox(msg, nonce, k);
};

nacl.box.before = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">publicKey, secretKey</span>) </span>{
  checkArrayTypes(publicKey, secretKey);
  checkBoxLengths(publicKey, secretKey);
  <span class="hljs-keyword">var</span> k = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_box_BEFORENMBYTES);
  crypto_box_beforenm(k, publicKey, secretKey);
  <span class="hljs-keyword">return</span> k;
};

nacl.box.after = nacl.secretbox;

nacl.box.open = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, nonce, publicKey, secretKey</span>) </span>{
  <span class="hljs-keyword">var</span> k = nacl.box.before(publicKey, secretKey);
  <span class="hljs-keyword">return</span> nacl.secretbox.open(msg, nonce, k);
};

nacl.box.open.after = nacl.secretbox.open;

nacl.box.keyPair = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> pk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_box_PUBLICKEYBYTES);
  <span class="hljs-keyword">var</span> sk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_box_SECRETKEYBYTES);
  crypto_box_keypair(pk, sk);
  <span class="hljs-keyword">return</span> {<span class="hljs-attr">publicKey</span>: pk, <span class="hljs-attr">secretKey</span>: sk};
};

nacl.box.keyPair.fromSecretKey = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">secretKey</span>) </span>{
  checkArrayTypes(secretKey);
  <span class="hljs-keyword">if</span> (secretKey.length !== crypto_box_SECRETKEYBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad secret key size'</span>);
  <span class="hljs-keyword">var</span> pk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_box_PUBLICKEYBYTES);
  crypto_scalarmult_base(pk, secretKey);
  <span class="hljs-keyword">return</span> {<span class="hljs-attr">publicKey</span>: pk, <span class="hljs-attr">secretKey</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(secretKey)};
};

nacl.box.publicKeyLength = crypto_box_PUBLICKEYBYTES;
nacl.box.secretKeyLength = crypto_box_SECRETKEYBYTES;
nacl.box.sharedKeyLength = crypto_box_BEFORENMBYTES;
nacl.box.nonceLength = crypto_box_NONCEBYTES;
nacl.box.overheadLength = nacl.secretbox.overheadLength;

nacl.sign = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, secretKey</span>) </span>{
  checkArrayTypes(msg, secretKey);
  <span class="hljs-keyword">if</span> (secretKey.length !== crypto_sign_SECRETKEYBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad secret key size'</span>);
  <span class="hljs-keyword">var</span> signedMsg = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_BYTES+msg.length);
  crypto_sign(signedMsg, msg, msg.length, secretKey);
  <span class="hljs-keyword">return</span> signedMsg;
};

nacl.sign.open = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">signedMsg, publicKey</span>) </span>{
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length !== <span class="hljs-number">2</span>)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'nacl.sign.open accepts 2 arguments; did you mean to use nacl.sign.detached.verify?'</span>);
  checkArrayTypes(signedMsg, publicKey);
  <span class="hljs-keyword">if</span> (publicKey.length !== crypto_sign_PUBLICKEYBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad public key size'</span>);
  <span class="hljs-keyword">var</span> tmp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(signedMsg.length);
  <span class="hljs-keyword">var</span> mlen = crypto_sign_open(tmp, signedMsg, signedMsg.length, publicKey);
  <span class="hljs-keyword">if</span> (mlen &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(mlen);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; m.length; i++) m[i] = tmp[i];
  <span class="hljs-keyword">return</span> m;
};

nacl.sign.detached = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, secretKey</span>) </span>{
  <span class="hljs-keyword">var</span> signedMsg = nacl.sign(msg, secretKey);
  <span class="hljs-keyword">var</span> sig = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_BYTES);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; sig.length; i++) sig[i] = signedMsg[i];
  <span class="hljs-keyword">return</span> sig;
};

nacl.sign.detached.verify = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, sig, publicKey</span>) </span>{
  checkArrayTypes(msg, sig, publicKey);
  <span class="hljs-keyword">if</span> (sig.length !== crypto_sign_BYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad signature size'</span>);
  <span class="hljs-keyword">if</span> (publicKey.length !== crypto_sign_PUBLICKEYBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad public key size'</span>);
  <span class="hljs-keyword">var</span> sm = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_BYTES + msg.length);
  <span class="hljs-keyword">var</span> m = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_BYTES + msg.length);
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; crypto_sign_BYTES; i++) sm[i] = sig[i];
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; msg.length; i++) sm[i+crypto_sign_BYTES] = msg[i];
  <span class="hljs-keyword">return</span> (crypto_sign_open(m, sm, sm.length, publicKey) &gt;= <span class="hljs-number">0</span>);
};

nacl.sign.keyPair = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> pk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_PUBLICKEYBYTES);
  <span class="hljs-keyword">var</span> sk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_SECRETKEYBYTES);
  crypto_sign_keypair(pk, sk);
  <span class="hljs-keyword">return</span> {<span class="hljs-attr">publicKey</span>: pk, <span class="hljs-attr">secretKey</span>: sk};
};

nacl.sign.keyPair.fromSecretKey = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">secretKey</span>) </span>{
  checkArrayTypes(secretKey);
  <span class="hljs-keyword">if</span> (secretKey.length !== crypto_sign_SECRETKEYBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad secret key size'</span>);
  <span class="hljs-keyword">var</span> pk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_PUBLICKEYBYTES);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; pk.length; i++) pk[i] = secretKey[<span class="hljs-number">32</span>+i];
  <span class="hljs-keyword">return</span> {<span class="hljs-attr">publicKey</span>: pk, <span class="hljs-attr">secretKey</span>: <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(secretKey)};
};

nacl.sign.keyPair.fromSeed = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">seed</span>) </span>{
  checkArrayTypes(seed);
  <span class="hljs-keyword">if</span> (seed.length !== crypto_sign_SEEDBYTES)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'bad seed size'</span>);
  <span class="hljs-keyword">var</span> pk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_PUBLICKEYBYTES);
  <span class="hljs-keyword">var</span> sk = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_sign_SECRETKEYBYTES);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++) sk[i] = seed[i];
  crypto_sign_keypair(pk, sk, <span class="hljs-literal">true</span>);
  <span class="hljs-keyword">return</span> {<span class="hljs-attr">publicKey</span>: pk, <span class="hljs-attr">secretKey</span>: sk};
};

nacl.sign.publicKeyLength = crypto_sign_PUBLICKEYBYTES;
nacl.sign.secretKeyLength = crypto_sign_SECRETKEYBYTES;
nacl.sign.seedLength = crypto_sign_SEEDBYTES;
nacl.sign.signatureLength = crypto_sign_BYTES;

nacl.hash = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg</span>) </span>{
  checkArrayTypes(msg);
  <span class="hljs-keyword">var</span> h = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(crypto_hash_BYTES);
  crypto_hash(h, msg, msg.length);
  <span class="hljs-keyword">return</span> h;
};

nacl.hash.hashLength = crypto_hash_BYTES;

nacl.verify = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, y</span>) </span>{
  checkArrayTypes(x, y);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Zero length arguments are considered not equal.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (x.length === <span class="hljs-number">0</span> || y.length === <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (x.length !== y.length) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">return</span> (vn(x, <span class="hljs-number">0</span>, y, <span class="hljs-number">0</span>, x.length) === <span class="hljs-number">0</span>) ? <span class="hljs-literal">true</span> : <span class="hljs-literal">false</span>;
};

nacl.setPRNG = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) </span>{
  randombytes = fn;
};

(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Initialize PRNG if environment provides CSPRNG.
If not, methods calling randombytes will throw.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> crypto;
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">window</span> !== <span class="hljs-string">'undefined'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Browser.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.crypto &amp;&amp; <span class="hljs-built_in">window</span>.crypto.getRandomValues) {
      crypto = <span class="hljs-built_in">window</span>.crypto; <span class="hljs-comment">// Standard</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.msCrypto &amp;&amp; <span class="hljs-built_in">window</span>.msCrypto.getRandomValues) {
      crypto = <span class="hljs-built_in">window</span>.msCrypto; <span class="hljs-comment">// Internet Explorer 11+</span>
    }
    <span class="hljs-keyword">if</span> (crypto) {
      nacl.setPRNG(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, n</span>) </span>{
        <span class="hljs-keyword">var</span> i, v = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(n);
        crypto.getRandomValues(v);
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) x[i] = v[i];
        cleanup(v);
      });
    }
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">require</span> !== <span class="hljs-string">'undefined'</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Node.js.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);
    <span class="hljs-keyword">if</span> (crypto) {
      nacl.setPRNG(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">x, n</span>) </span>{
        <span class="hljs-keyword">var</span> i, v = crypto.randomBytes(n);
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; n; i++) x[i] = v[i];
        cleanup(v);
      });
    }
  }
})();

})(<span class="hljs-keyword">typeof</span> <span class="hljs-built_in">module</span> !== <span class="hljs-string">'undefined'</span> &amp;&amp; <span class="hljs-built_in">module</span>.exports ? <span class="hljs-built_in">module</span>.exports : (<span class="hljs-built_in">window</span>.nacl = <span class="hljs-built_in">window</span>.nacl || {}));

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
