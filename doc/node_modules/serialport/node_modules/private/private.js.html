<!DOCTYPE html>
<html>
<head>
  <title>private.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node_modules/serialport/node_modules/private/private.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>private.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;

<span class="hljs-keyword">var</span> originalObject = <span class="hljs-built_in">Object</span>;
<span class="hljs-keyword">var</span> originalDefProp = <span class="hljs-built_in">Object</span>.defineProperty;
<span class="hljs-keyword">var</span> originalCreate = <span class="hljs-built_in">Object</span>.create;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">defProp</span>(<span class="hljs-params">obj, name, value</span>) </span>{
  <span class="hljs-keyword">if</span> (originalDefProp) <span class="hljs-keyword">try</span> {
    originalDefProp.call(originalObject, obj, name, { <span class="hljs-attr">value</span>: value });
  } <span class="hljs-keyword">catch</span> (definePropertyIsBrokenInIE8) {
    obj[name] = value;
  } <span class="hljs-keyword">else</span> {
    obj[name] = value;
  }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>For functions that will be invoked using .call or .apply, we need to
define those methods on the function objects themselves, rather than
inheriting them from Function.prototype, so that a malicious or clumsy
third party cannot interfere with the functionality of this module by
redefining Function.prototype.call or .apply.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeSafeToCall</span>(<span class="hljs-params">fun</span>) </span>{
  <span class="hljs-keyword">if</span> (fun) {
    defProp(fun, <span class="hljs-string">"call"</span>, fun.call);
    defProp(fun, <span class="hljs-string">"apply"</span>, fun.apply);
  }
  <span class="hljs-keyword">return</span> fun;
}

makeSafeToCall(originalDefProp);
makeSafeToCall(originalCreate);

<span class="hljs-keyword">var</span> hasOwn = makeSafeToCall(<span class="hljs-built_in">Object</span>.prototype.hasOwnProperty);
<span class="hljs-keyword">var</span> numToStr = makeSafeToCall(<span class="hljs-built_in">Number</span>.prototype.toString);
<span class="hljs-keyword">var</span> strSlice = makeSafeToCall(<span class="hljs-built_in">String</span>.prototype.slice);

<span class="hljs-keyword">var</span> cloner = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{};
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">create</span>(<span class="hljs-params">prototype</span>) </span>{
  <span class="hljs-keyword">if</span> (originalCreate) {
    <span class="hljs-keyword">return</span> originalCreate.call(originalObject, prototype);
  }
  cloner.prototype = prototype || <span class="hljs-literal">null</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> cloner;
}

<span class="hljs-keyword">var</span> rand = <span class="hljs-built_in">Math</span>.random;
<span class="hljs-keyword">var</span> uniqueKeys = create(<span class="hljs-literal">null</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeUniqueKey</span>(<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Collisions are highly unlikely, but this module is in the business of
making guarantees rather than safe bets.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">do</span> <span class="hljs-keyword">var</span> uniqueKey = internString(strSlice.call(numToStr.call(rand(), <span class="hljs-number">36</span>), <span class="hljs-number">2</span>));
  <span class="hljs-keyword">while</span> (hasOwn.call(uniqueKeys, uniqueKey));
  <span class="hljs-keyword">return</span> uniqueKeys[uniqueKey] = uniqueKey;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">internString</span>(<span class="hljs-params">str</span>) </span>{
  <span class="hljs-keyword">var</span> obj = {};
  obj[str] = <span class="hljs-literal">true</span>;
  <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.keys(obj)[<span class="hljs-number">0</span>];
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>External users might find this function useful, but it is not necessary
for the typical use of this module.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">defProp(exports, <span class="hljs-string">"makeUniqueKey"</span>, makeUniqueKey);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Object.getOwnPropertyNames is the only way to enumerate non-enumerable
properties, so if we wrap it to ignore our secret keys, there should be
no way (except guessing) to access those properties.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> originalGetOPNs = <span class="hljs-built_in">Object</span>.getOwnPropertyNames;
<span class="hljs-built_in">Object</span>.getOwnPropertyNames = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getOwnPropertyNames</span>(<span class="hljs-params">object</span>) </span>{
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> names = originalGetOPNs(object),
           src = <span class="hljs-number">0</span>,
           dst = <span class="hljs-number">0</span>,
           len = names.length;
       src &lt; len;
       ++src) {
    <span class="hljs-keyword">if</span> (!hasOwn.call(uniqueKeys, names[src])) {
      <span class="hljs-keyword">if</span> (src &gt; dst) {
        names[dst] = names[src];
      }
      ++dst;
    }
  }
  names.length = dst;
  <span class="hljs-keyword">return</span> names;
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">defaultCreatorFn</span>(<span class="hljs-params">object</span>) </span>{
  <span class="hljs-keyword">return</span> create(<span class="hljs-literal">null</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeAccessor</span>(<span class="hljs-params">secretCreatorFn</span>) </span>{
  <span class="hljs-keyword">var</span> brand = makeUniqueKey();
  <span class="hljs-keyword">var</span> passkey = create(<span class="hljs-literal">null</span>);

  secretCreatorFn = secretCreatorFn || defaultCreatorFn;

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">register</span>(<span class="hljs-params">object</span>) </span>{
    <span class="hljs-keyword">var</span> secret; <span class="hljs-comment">// Created lazily.</span>

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">vault</span>(<span class="hljs-params">key, forget</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Only code that has access to the passkey can retrieve (or forget)
the secret object.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (key === passkey) {
        <span class="hljs-keyword">return</span> forget
          ? secret = <span class="hljs-literal">null</span>
          : secret || (secret = secretCreatorFn(object));
      }
    }

    defProp(object, brand, vault);
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">accessor</span>(<span class="hljs-params">object</span>) </span>{
    <span class="hljs-keyword">if</span> (!hasOwn.call(object, brand))
      register(object);
    <span class="hljs-keyword">return</span> object[brand](passkey);
  }

  accessor.forget = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">object</span>) </span>{
    <span class="hljs-keyword">if</span> (hasOwn.call(object, brand))
      object[brand](passkey, <span class="hljs-literal">true</span>);
  };

  <span class="hljs-keyword">return</span> accessor;
}

defProp(exports, <span class="hljs-string">"makeAccessor"</span>, makeAccessor);

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
