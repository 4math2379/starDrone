<!DOCTYPE html>
<html>
<head>
  <title>source-node.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/source-map/lib/source-node.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>source-node.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-comment">/* -*- Mode: js; js-indent-level: 2; -*- */</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Copyright 2011 Mozilla Foundation and contributors
Licensed under the New BSD license. See LICENSE or:
http://opensource.org/licenses/BSD-3-Clause</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">{
  <span class="hljs-keyword">var</span> SourceMapGenerator = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./source-map-generator'</span>).SourceMapGenerator;
  <span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./util'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Matches a Windows-style <code>\r\n</code> newline or a <code>\n</code> newline used by all other
operating systems these days (capturing the result).</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> REGEX_NEWLINE = <span class="hljs-regexp">/(\r?\n)/</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Newline character code for charCodeAt() comparisons</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> NEWLINE_CODE = <span class="hljs-number">10</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Private symbol for identifying <code>SourceNode</code>s when multiple versions of
the source-map library are loaded. This MUST NOT CHANGE across
versions!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> isSourceNode = <span class="hljs-string">"$$$isSourceNode$$$"</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>SourceNodes provide a way to abstract over interpolating/concatenating
snippets of generated JavaScript source code while maintaining the line and
column information associated with the original source code.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aLine</span>
<span>The original line number.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aColumn</span>
<span>The original column number.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aSource</span>
<span>The original source's filename.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aChunks</span>
<span>Optional. An array of strings which are snippets of        generated JS, or other SourceNodes.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aName</span>
<span>The original identifier.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SourceNode</span>(<span class="hljs-params">aLine, aColumn, aSource, aChunks, aName</span>) </span>{
    <span class="hljs-keyword">this</span>.children = [];
    <span class="hljs-keyword">this</span>.sourceContents = {};
    <span class="hljs-keyword">this</span>.line = aLine == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : aLine;
    <span class="hljs-keyword">this</span>.column = aColumn == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : aColumn;
    <span class="hljs-keyword">this</span>.source = aSource == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : aSource;
    <span class="hljs-keyword">this</span>.name = aName == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span> : aName;
    <span class="hljs-keyword">this</span>[isSourceNode] = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">if</span> (aChunks != <span class="hljs-literal">null</span>) <span class="hljs-keyword">this</span>.add(aChunks);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>Creates a SourceNode from generated code and a SourceMapConsumer.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aGeneratedCode</span>
<span>The generated code
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aSourceMapConsumer</span>
<span>The SourceMap for the generated code
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aRelativePath</span>
<span>Optional. The path that relative sources in the        SourceMapConsumer should be relative to.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  SourceNode.fromStringWithSourceMap =
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SourceNode_fromStringWithSourceMap</span>(<span class="hljs-params">aGeneratedCode, aSourceMapConsumer, aRelativePath</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>The SourceNode we want to fill with the generated code
and the SourceMap</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> node = <span class="hljs-keyword">new</span> SourceNode();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>All even indices of this array are one line of the generated code,
while all odd indices are the newlines between two adjacent lines
(since <code>REGEX_NEWLINE</code> captures its match).
Processed fragments are removed from this array, by calling <code>shiftNextLine</code>.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> remainingLines = aGeneratedCode.split(REGEX_NEWLINE);
      <span class="hljs-keyword">var</span> shiftNextLine = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> lineContents = remainingLines.shift();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>The last line of a file might not have a newline.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">var</span> newLine = remainingLines.shift() || <span class="hljs-string">""</span>;
        <span class="hljs-keyword">return</span> lineContents + newLine;
      };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>We need to remember the position of &quot;remainingLines&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> lastGeneratedLine = <span class="hljs-number">1</span>, lastGeneratedColumn = <span class="hljs-number">0</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>The generate SourceNodes we need a code range.
To extract it current and last mapping is used.
Here we store the last mapping.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> lastMapping = <span class="hljs-literal">null</span>;

      aSourceMapConsumer.eachMapping(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">mapping</span>) </span>{
        <span class="hljs-keyword">if</span> (lastMapping !== <span class="hljs-literal">null</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>We add the code from &quot;lastMapping&quot; to &quot;mapping&quot;:
First check if there is a new line in between.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          <span class="hljs-keyword">if</span> (lastGeneratedLine &lt; mapping.generatedLine) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Associate first line with &quot;lastMapping&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            addMappingWithCode(lastMapping, shiftNextLine());
            lastGeneratedLine++;
            lastGeneratedColumn = <span class="hljs-number">0</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>The remaining code is added without mapping</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>There is no new line in between.
Associate the code between &quot;lastGeneratedColumn&quot; and
&quot;mapping.generatedColumn&quot; with &quot;lastMapping&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">var</span> nextLine = remainingLines[<span class="hljs-number">0</span>];
            <span class="hljs-keyword">var</span> code = nextLine.substr(<span class="hljs-number">0</span>, mapping.generatedColumn -
                                          lastGeneratedColumn);
            remainingLines[<span class="hljs-number">0</span>] = nextLine.substr(mapping.generatedColumn -
                                                lastGeneratedColumn);
            lastGeneratedColumn = mapping.generatedColumn;
            addMappingWithCode(lastMapping, code);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>No more remaining code, continue</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            lastMapping = mapping;
            <span class="hljs-keyword">return</span>;
          }
        }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>We add the generated code until the first mapping
to the SourceNode without any mapping.
Each line is added as separate string.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">while</span> (lastGeneratedLine &lt; mapping.generatedLine) {
          node.add(shiftNextLine());
          lastGeneratedLine++;
        }
        <span class="hljs-keyword">if</span> (lastGeneratedColumn &lt; mapping.generatedColumn) {
          <span class="hljs-keyword">var</span> nextLine = remainingLines[<span class="hljs-number">0</span>];
          node.add(nextLine.substr(<span class="hljs-number">0</span>, mapping.generatedColumn));
          remainingLines[<span class="hljs-number">0</span>] = nextLine.substr(mapping.generatedColumn);
          lastGeneratedColumn = mapping.generatedColumn;
        }
        lastMapping = mapping;
      }, <span class="hljs-keyword">this</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>We have processed all mappings.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (remainingLines.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span> (lastMapping) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>Associate the remaining code in the current line with &quot;lastMapping&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          addMappingWithCode(lastMapping, shiftNextLine());
        }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>and add the remaining lines without any mapping</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        node.add(remainingLines.join(<span class="hljs-string">""</span>));
      }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Copy sourcesContent into SourceNode</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      aSourceMapConsumer.sources.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">sourceFile</span>) </span>{
        <span class="hljs-keyword">var</span> content = aSourceMapConsumer.sourceContentFor(sourceFile);
        <span class="hljs-keyword">if</span> (content != <span class="hljs-literal">null</span>) {
          <span class="hljs-keyword">if</span> (aRelativePath != <span class="hljs-literal">null</span>) {
            sourceFile = util.join(aRelativePath, sourceFile);
          }
          node.setSourceContent(sourceFile, content);
        }
      });

      <span class="hljs-keyword">return</span> node;

      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addMappingWithCode</span>(<span class="hljs-params">mapping, code</span>) </span>{
        <span class="hljs-keyword">if</span> (mapping === <span class="hljs-literal">null</span> || mapping.source === <span class="hljs-literal">undefined</span>) {
          node.add(code);
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">var</span> source = aRelativePath
            ? util.join(aRelativePath, mapping.source)
            : mapping.source;
          node.add(<span class="hljs-keyword">new</span> SourceNode(mapping.originalLine,
                                  mapping.originalColumn,
                                  source,
                                  code,
                                  mapping.name));
        }
      }
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<div class="dox">
<div class="summary">
<p>Add a chunk of generated JS to this source node.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aChunk</span>
<span>A string snippet of generated JS code, another instance of        SourceNode, or an array where each member is one of those things.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  SourceNode.prototype.add = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SourceNode_add</span>(<span class="hljs-params">aChunk</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(aChunk)) {
      aChunk.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk</span>) </span>{
        <span class="hljs-keyword">this</span>.add(chunk);
      }, <span class="hljs-keyword">this</span>);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (aChunk[isSourceNode] || <span class="hljs-keyword">typeof</span> aChunk === <span class="hljs-string">"string"</span>) {
      <span class="hljs-keyword">if</span> (aChunk) {
        <span class="hljs-keyword">this</span>.children.push(aChunk);
      }
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(
        <span class="hljs-string">"Expected a SourceNode, string, or an array of SourceNodes and strings. Got "</span> + aChunk
      );
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<div class="dox">
<div class="summary">
<p>Add a chunk of generated JS to the beginning of this source node.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aChunk</span>
<span>A string snippet of generated JS code, another instance of        SourceNode, or an array where each member is one of those things.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  SourceNode.prototype.prepend = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SourceNode_prepend</span>(<span class="hljs-params">aChunk</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(aChunk)) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = aChunk.length<span class="hljs-number">-1</span>; i &gt;= <span class="hljs-number">0</span>; i--) {
        <span class="hljs-keyword">this</span>.prepend(aChunk[i]);
      }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (aChunk[isSourceNode] || <span class="hljs-keyword">typeof</span> aChunk === <span class="hljs-string">"string"</span>) {
      <span class="hljs-keyword">this</span>.children.unshift(aChunk);
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(
        <span class="hljs-string">"Expected a SourceNode, string, or an array of SourceNodes and strings. Got "</span> + aChunk
      );
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<div class="dox">
<div class="summary">
<p>Walk over the tree of JS snippets in this node and its children. The
walking function is called once for each snippet of JS and is passed that
snippet and the its original associated source's line/column location.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aFn</span>
<span>The traversal function.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  SourceNode.prototype.walk = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SourceNode_walk</span>(<span class="hljs-params">aFn</span>) </span>{
    <span class="hljs-keyword">var</span> chunk;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = <span class="hljs-keyword">this</span>.children.length; i &lt; len; i++) {
      chunk = <span class="hljs-keyword">this</span>.children[i];
      <span class="hljs-keyword">if</span> (chunk[isSourceNode]) {
        chunk.walk(aFn);
      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (chunk !== <span class="hljs-string">''</span>) {
          aFn(chunk, { <span class="hljs-attr">source</span>: <span class="hljs-keyword">this</span>.source,
                       <span class="hljs-attr">line</span>: <span class="hljs-keyword">this</span>.line,
                       <span class="hljs-attr">column</span>: <span class="hljs-keyword">this</span>.column,
                       <span class="hljs-attr">name</span>: <span class="hljs-keyword">this</span>.name });
        }
      }
    }
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<div class="dox">
<div class="summary">
<p>Like <code>String.prototype.join</code> except for SourceNodes. Inserts <code>aStr</code> between
each of <code>this.children</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aSep</span>
<span>The separator.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  SourceNode.prototype.join = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SourceNode_join</span>(<span class="hljs-params">aSep</span>) </span>{
    <span class="hljs-keyword">var</span> newChildren;
    <span class="hljs-keyword">var</span> i;
    <span class="hljs-keyword">var</span> len = <span class="hljs-keyword">this</span>.children.length;
    <span class="hljs-keyword">if</span> (len &gt; <span class="hljs-number">0</span>) {
      newChildren = [];
      <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len<span class="hljs-number">-1</span>; i++) {
        newChildren.push(<span class="hljs-keyword">this</span>.children[i]);
        newChildren.push(aSep);
      }
      newChildren.push(<span class="hljs-keyword">this</span>.children[i]);
      <span class="hljs-keyword">this</span>.children = newChildren;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<div class="dox">
<div class="summary">
<p>Call String.prototype.replace on the very right-most source snippet. Useful
for trimming whitespace from the end of a source node, etc.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aPattern</span>
<span>The pattern to replace.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aReplacement</span>
<span>The thing to replace the pattern with.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  SourceNode.prototype.replaceRight = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SourceNode_replaceRight</span>(<span class="hljs-params">aPattern, aReplacement</span>) </span>{
    <span class="hljs-keyword">var</span> lastChild = <span class="hljs-keyword">this</span>.children[<span class="hljs-keyword">this</span>.children.length - <span class="hljs-number">1</span>];
    <span class="hljs-keyword">if</span> (lastChild[isSourceNode]) {
      lastChild.replaceRight(aPattern, aReplacement);
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> lastChild === <span class="hljs-string">'string'</span>) {
      <span class="hljs-keyword">this</span>.children[<span class="hljs-keyword">this</span>.children.length - <span class="hljs-number">1</span>] = lastChild.replace(aPattern, aReplacement);
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">this</span>.children.push(<span class="hljs-string">''</span>.replace(aPattern, aReplacement));
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<div class="dox">
<div class="summary">
<p>Set the source content for a source file. This will be added to the SourceMapGenerator
in the sourcesContent field.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aSourceFile</span>
<span>The filename of the source file
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aSourceContent</span>
<span>The content of the source file
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  SourceNode.prototype.setSourceContent =
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SourceNode_setSourceContent</span>(<span class="hljs-params">aSourceFile, aSourceContent</span>) </span>{
      <span class="hljs-keyword">this</span>.sourceContents[util.toSetString(aSourceFile)] = aSourceContent;
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<div class="dox">
<div class="summary">
<p>Walk over the tree of SourceNodes. The walking function is called for each
source file content and is passed the filename and source content.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">aFn</span>
<span>The traversal function.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  SourceNode.prototype.walkSourceContents =
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SourceNode_walkSourceContents</span>(<span class="hljs-params">aFn</span>) </span>{
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = <span class="hljs-keyword">this</span>.children.length; i &lt; len; i++) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.children[i][isSourceNode]) {
          <span class="hljs-keyword">this</span>.children[i].walkSourceContents(aFn);
        }
      }

      <span class="hljs-keyword">var</span> sources = <span class="hljs-built_in">Object</span>.keys(<span class="hljs-keyword">this</span>.sourceContents);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, len = sources.length; i &lt; len; i++) {
        aFn(util.fromSetString(sources[i]), <span class="hljs-keyword">this</span>.sourceContents[sources[i]]);
      }
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<div class="dox">
<div class="summary">
<p>Return the string representation of this source node. Walks over the tree
and concatenates all the various snippets together to one string.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  SourceNode.prototype.toString = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SourceNode_toString</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> str = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">this</span>.walk(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk</span>) </span>{
      str += chunk;
    });
    <span class="hljs-keyword">return</span> str;
  };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<div class="dox">
<div class="summary">
<p>Returns the string representation of this source node along with a source
map.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  SourceNode.prototype.toStringWithSourceMap = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">SourceNode_toStringWithSourceMap</span>(<span class="hljs-params">aArgs</span>) </span>{
    <span class="hljs-keyword">var</span> generated = {
      <span class="hljs-attr">code</span>: <span class="hljs-string">""</span>,
      <span class="hljs-attr">line</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">column</span>: <span class="hljs-number">0</span>
    };
    <span class="hljs-keyword">var</span> map = <span class="hljs-keyword">new</span> SourceMapGenerator(aArgs);
    <span class="hljs-keyword">var</span> sourceMappingActive = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> lastOriginalSource = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> lastOriginalLine = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> lastOriginalColumn = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> lastOriginalName = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">this</span>.walk(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">chunk, original</span>) </span>{
      generated.code += chunk;
      <span class="hljs-keyword">if</span> (original.source !== <span class="hljs-literal">null</span>
          &amp;&amp; original.line !== <span class="hljs-literal">null</span>
          &amp;&amp; original.column !== <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span>(lastOriginalSource !== original.source
           || lastOriginalLine !== original.line
           || lastOriginalColumn !== original.column
           || lastOriginalName !== original.name) {
          map.addMapping({
            <span class="hljs-attr">source</span>: original.source,
            <span class="hljs-attr">original</span>: {
              <span class="hljs-attr">line</span>: original.line,
              <span class="hljs-attr">column</span>: original.column
            },
            <span class="hljs-attr">generated</span>: {
              <span class="hljs-attr">line</span>: generated.line,
              <span class="hljs-attr">column</span>: generated.column
            },
            <span class="hljs-attr">name</span>: original.name
          });
        }
        lastOriginalSource = original.source;
        lastOriginalLine = original.line;
        lastOriginalColumn = original.column;
        lastOriginalName = original.name;
        sourceMappingActive = <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sourceMappingActive) {
        map.addMapping({
          <span class="hljs-attr">generated</span>: {
            <span class="hljs-attr">line</span>: generated.line,
            <span class="hljs-attr">column</span>: generated.column
          }
        });
        lastOriginalSource = <span class="hljs-literal">null</span>;
        sourceMappingActive = <span class="hljs-literal">false</span>;
      }
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> idx = <span class="hljs-number">0</span>, length = chunk.length; idx &lt; length; idx++) {
        <span class="hljs-keyword">if</span> (chunk.charCodeAt(idx) === NEWLINE_CODE) {
          generated.line++;
          generated.column = <span class="hljs-number">0</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>Mappings end at eol</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          <span class="hljs-keyword">if</span> (idx + <span class="hljs-number">1</span> === length) {
            lastOriginalSource = <span class="hljs-literal">null</span>;
            sourceMappingActive = <span class="hljs-literal">false</span>;
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (sourceMappingActive) {
            map.addMapping({
              <span class="hljs-attr">source</span>: original.source,
              <span class="hljs-attr">original</span>: {
                <span class="hljs-attr">line</span>: original.line,
                <span class="hljs-attr">column</span>: original.column
              },
              <span class="hljs-attr">generated</span>: {
                <span class="hljs-attr">line</span>: generated.line,
                <span class="hljs-attr">column</span>: generated.column
              },
              <span class="hljs-attr">name</span>: original.name
            });
          }
        } <span class="hljs-keyword">else</span> {
          generated.column++;
        }
      }
    });
    <span class="hljs-keyword">this</span>.walkSourceContents(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">sourceFile, sourceContent</span>) </span>{
      map.setSourceContent(sourceFile, sourceContent);
    });

    <span class="hljs-keyword">return</span> { <span class="hljs-attr">code</span>: generated.code, <span class="hljs-attr">map</span>: map };
  };

  exports.SourceNode = SourceNode;
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
