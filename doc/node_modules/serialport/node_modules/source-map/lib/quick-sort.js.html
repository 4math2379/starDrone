<!DOCTYPE html>
<html>
<head>
  <title>quick-sort.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/source-map/lib/quick-sort.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>quick-sort.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-comment">/* -*- Mode: js; js-indent-level: 2; -*- */</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Copyright 2011 Mozilla Foundation and contributors
Licensed under the New BSD license. See LICENSE or:
http://opensource.org/licenses/BSD-3-Clause</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>It turns out that some (most?) JavaScript engines don't self-host
<code>Array.prototype.sort</code>. This makes sense because C++ will likely remain
faster than JS when doing raw CPU-intensive sorting. However, when using a
custom comparator function, calling back and forth between the VM's C++ and
JIT'd JS is rather slow <em>and</em> loses JIT type information, resulting in
worse generated code for the comparator function than would be optimal. In
fact, when sorting with a comparator, these costs outweigh the benefits of
sorting in C++. By using our own JS-implemented Quick Sort (below), we get
a ~3500ms mean speed-up in <code>bench/bench.html</code>.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Swap the elements indexed by <code>x</code> and <code>y</code> in the array <code>ary</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">ary</span>
<span class="dox_type">Array</span>
<span>The array.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">x</span>
<span class="dox_type">Number</span>
<span>The index of the first item.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">y</span>
<span class="dox_type">Number</span>
<span>The index of the second item.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">swap</span>(<span class="hljs-params">ary, x, y</span>) </span>{
    <span class="hljs-keyword">var</span> temp = ary[x];
    ary[x] = ary[y];
    ary[y] = temp;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Returns a random integer within the range <code>low .. high</code> inclusive.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">low</span>
<span class="dox_type">Number</span>
<span>The lower bound on the range.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">high</span>
<span class="dox_type">Number</span>
<span>The upper bound on the range.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">randomIntInRange</span>(<span class="hljs-params">low, high</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.round(low + (<span class="hljs-built_in">Math</span>.random() * (high - low)));
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>The Quick Sort algorithm.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">ary</span>
<span class="dox_type">Array</span>
<span>An array to sort.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">comparator</span>
<span class="dox_type">function</span>
<span>Function to use to compare two items.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">p</span>
<span class="dox_type">Number</span>
<span>Start index of the array
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">r</span>
<span class="dox_type">Number</span>
<span>End index of the array
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doQuickSort</span>(<span class="hljs-params">ary, comparator, p, r</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>If our lower bound is less than our upper bound, we (1) partition the
array into two pieces and (2) recurse on each half. If it is not, this is
the empty array and our base case.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
    <span class="hljs-keyword">if</span> (p &lt; r) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>(1) Partitioning.</p>
<p>The partitioning chooses a pivot between <code>p</code> and <code>r</code> and moves all
elements that are less than or equal to the pivot to the before it, and
all the elements that are greater than it after it. The effect is that
once partition is done, the pivot is in the exact place it will be when
the array is put in sorted order, and it will not need to be moved
again. This runs in O(n) time.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Always choose a random pivot so that an input array which is reverse
sorted does not cause O(n^2) running time.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> pivotIndex = randomIntInRange(p, r);
      <span class="hljs-keyword">var</span> i = p - <span class="hljs-number">1</span>;

      swap(ary, pivotIndex, r);
      <span class="hljs-keyword">var</span> pivot = ary[r];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Immediately after <code>j</code> is incremented in this loop, the following hold
true:</p>
<ul>
<li>
<p>Every element in <code>ary[p .. i]</code> is less than or equal to the pivot.</p>
</li>
<li>
<p>Every element in <code>ary[i+1 .. j-1]</code> is greater than the pivot.</p>
</li>
</ul>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = p; j &lt; r; j++) {
        <span class="hljs-keyword">if</span> (comparator(ary[j], pivot) &lt;= <span class="hljs-number">0</span>) {
          i += <span class="hljs-number">1</span>;
          swap(ary, i, j);
        }
      }

      swap(ary, i + <span class="hljs-number">1</span>, j);
      <span class="hljs-keyword">var</span> q = i + <span class="hljs-number">1</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>(2) Recurse on each half.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
      doQuickSort(ary, comparator, p, q - <span class="hljs-number">1</span>);
      doQuickSort(ary, comparator, q + <span class="hljs-number">1</span>, r);
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<div class="dox">
<div class="summary">
<p>Sort the given array in-place with the given comparator function.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">ary</span>
<span class="dox_type">Array</span>
<span>An array to sort.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">comparator</span>
<span class="dox_type">function</span>
<span>Function to use to compare two items.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">  exports.quickSort = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">ary, comparator</span>) </span>{
    doQuickSort(ary, comparator, <span class="hljs-number">0</span>, ary.length - <span class="hljs-number">1</span>);
  };
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
