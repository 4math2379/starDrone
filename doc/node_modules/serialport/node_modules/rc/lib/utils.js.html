<!DOCTYPE html>
<html>
<head>
  <title>utils.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/rc/lib/utils.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>utils.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">'use strict'</span>;
<span class="hljs-keyword">var</span> fs   = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>)
<span class="hljs-keyword">var</span> ini  = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ini'</span>)
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>)
<span class="hljs-keyword">var</span> stripJsonComments = <span class="hljs-built_in">require</span>(<span class="hljs-string">'strip-json-comments'</span>)

<span class="hljs-keyword">var</span> parse = exports.parse = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">content</span>) </span>{

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>if it ends in .json or starts with { then it must be json.
must be done this way, because ini accepts everything.
can't just try and parse it and let it throw if it's not ini.
everything is ini. even json with a syntax error.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
  <span class="hljs-keyword">if</span>(<span class="hljs-regexp">/^\s*{/</span>.test(content))
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.parse(stripJsonComments(content))
  <span class="hljs-keyword">return</span> ini.parse(content)

}

<span class="hljs-keyword">var</span> file = exports.file = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> args = [].slice.call(<span class="hljs-built_in">arguments</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{ <span class="hljs-keyword">return</span> arg != <span class="hljs-literal">null</span> })

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>path.join breaks if it's a not a string, so just skip this.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> args)
    <span class="hljs-keyword">if</span>(<span class="hljs-string">'string'</span> !== <span class="hljs-keyword">typeof</span> args[i])
      <span class="hljs-keyword">return</span>

  <span class="hljs-keyword">var</span> file = path.join.apply(<span class="hljs-literal">null</span>, args)
  <span class="hljs-keyword">var</span> content
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">return</span> fs.readFileSync(file,<span class="hljs-string">'utf-8'</span>)
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-keyword">return</span>
  }
}

<span class="hljs-keyword">var</span> json = exports.json = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> content = file.apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>)
  <span class="hljs-keyword">return</span> content ? parse(content) : <span class="hljs-literal">null</span>
}

<span class="hljs-keyword">var</span> env = exports.env = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">prefix, env</span>) </span>{
  env = env || process.env
  <span class="hljs-keyword">var</span> obj = {}
  <span class="hljs-keyword">var</span> l = prefix.length
  <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> k <span class="hljs-keyword">in</span> env) {
    <span class="hljs-keyword">if</span>((k.indexOf(prefix)) === <span class="hljs-number">0</span>) {

      <span class="hljs-keyword">var</span> keypath = k.substring(l).split(<span class="hljs-string">'__'</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Trim empty strings from keypath array</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> _emptyStringIndex
      <span class="hljs-keyword">while</span> ((_emptyStringIndex=keypath.indexOf(<span class="hljs-string">''</span>)) &gt; <span class="hljs-number">-1</span>) {
        keypath.splice(_emptyStringIndex, <span class="hljs-number">1</span>)
      }

      <span class="hljs-keyword">var</span> cursor = obj
      keypath.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">_buildSubObj</span>(<span class="hljs-params">_subkey,i</span>)</span>{

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>(check for _subkey first so we ignore empty strings)
(check for cursor to avoid assignment to primitive objects)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (!_subkey || <span class="hljs-keyword">typeof</span> cursor !== <span class="hljs-string">'object'</span>)
          <span class="hljs-keyword">return</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>If this is the last key, just stuff the value in there
Assigns actual value from env variable to final key
(unless it's just an empty string- in that case use the last valid key)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (i === keypath.length<span class="hljs-number">-1</span>)
          cursor[_subkey] = env[k]


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Build sub-object if nothing already exists at the keypath</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (cursor[_subkey] === <span class="hljs-literal">undefined</span>)
          cursor[_subkey] = {}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Increment cursor used to track the object at the current depth</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        cursor = cursor[_subkey]

      })

    }

  }

  <span class="hljs-keyword">return</span> obj
}

<span class="hljs-keyword">var</span> find = exports.find = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> rel = path.join.apply(<span class="hljs-literal">null</span>, [].slice.call(<span class="hljs-built_in">arguments</span>))

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">find</span>(<span class="hljs-params">start, rel</span>) </span>{
    <span class="hljs-keyword">var</span> file = path.join(start, rel)
    <span class="hljs-keyword">try</span> {
      fs.statSync(file)
      <span class="hljs-keyword">return</span> file
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-keyword">if</span>(path.dirname(start) !== start) <span class="hljs-comment">// root</span>
        <span class="hljs-keyword">return</span> find(path.dirname(start), rel)
    }
  }
  <span class="hljs-keyword">return</span> find(process.cwd(), rel)
}


</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
