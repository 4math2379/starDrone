<!DOCTYPE html>
<html>
<head>
  <title>misc.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/is-my-json-valid/test/misc.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>misc.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> tape = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tape'</span>)
<span class="hljs-keyword">var</span> cosmic = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./fixtures/cosmic'</span>)
<span class="hljs-keyword">var</span> validator = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../'</span>)
<span class="hljs-keyword">var</span> validatorRequire = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../require'</span>)

tape(<span class="hljs-string">'simple'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> schema = {
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">hello</span>: {<span class="hljs-attr">type</span>:<span class="hljs-string">'string'</span>, <span class="hljs-attr">required</span>:<span class="hljs-literal">true</span>}
    }
  }

  <span class="hljs-keyword">var</span> validate = validator(schema)

  t.ok(validate({<span class="hljs-attr">hello</span>: <span class="hljs-string">'world'</span>}), <span class="hljs-string">'should be valid'</span>)
  t.notOk(validate(), <span class="hljs-string">'should be invalid'</span>)
  t.notOk(validate({}), <span class="hljs-string">'should be invalid'</span>)
  t.end()
})

tape(<span class="hljs-string">'advanced'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> validate = validator(cosmic.schema)

  t.ok(validate(cosmic.valid), <span class="hljs-string">'should be valid'</span>)
  t.notOk(validate(cosmic.invalid), <span class="hljs-string">'should be invalid'</span>)
  t.end()
})

tape(<span class="hljs-string">'greedy/false'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> validate = validator({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">x</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'number'</span>
      }
    },
    <span class="hljs-attr">required</span>: [<span class="hljs-string">'x'</span>, <span class="hljs-string">'y'</span>]
  });
  t.notOk(validate({}), <span class="hljs-string">'should be invalid'</span>)
  t.strictEqual(validate.errors.length, <span class="hljs-number">2</span>);
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].field, <span class="hljs-string">'data.x'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].message, <span class="hljs-string">'is required'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">1</span>].field, <span class="hljs-string">'data.y'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">1</span>].message, <span class="hljs-string">'is required'</span>)
  t.notOk(validate({<span class="hljs-attr">x</span>: <span class="hljs-string">'string'</span>}), <span class="hljs-string">'should be invalid'</span>)
  t.strictEqual(validate.errors.length, <span class="hljs-number">1</span>);
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].field, <span class="hljs-string">'data.y'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].message, <span class="hljs-string">'is required'</span>)
  t.notOk(validate({<span class="hljs-attr">x</span>: <span class="hljs-string">'string'</span>, <span class="hljs-attr">y</span>: <span class="hljs-string">'value'</span>}), <span class="hljs-string">'should be invalid'</span>)
  t.strictEqual(validate.errors.length, <span class="hljs-number">1</span>);
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].field, <span class="hljs-string">'data.x'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].message, <span class="hljs-string">'is the wrong type'</span>)
  t.end();
});

tape(<span class="hljs-string">'greedy/true'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> validate = validator({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">x</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'number'</span>
      }
    },
    <span class="hljs-attr">required</span>: [<span class="hljs-string">'x'</span>, <span class="hljs-string">'y'</span>]
  }, {
    <span class="hljs-attr">greedy</span>: <span class="hljs-literal">true</span>
  });
  t.notOk(validate({}), <span class="hljs-string">'should be invalid'</span>)
  t.strictEqual(validate.errors.length, <span class="hljs-number">2</span>);
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].field, <span class="hljs-string">'data.x'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].message, <span class="hljs-string">'is required'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">1</span>].field, <span class="hljs-string">'data.y'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">1</span>].message, <span class="hljs-string">'is required'</span>)
  t.notOk(validate({<span class="hljs-attr">x</span>: <span class="hljs-string">'string'</span>}), <span class="hljs-string">'should be invalid'</span>)
  t.strictEqual(validate.errors.length, <span class="hljs-number">2</span>);
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].field, <span class="hljs-string">'data.y'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].message, <span class="hljs-string">'is required'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">1</span>].field, <span class="hljs-string">'data.x'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">1</span>].message, <span class="hljs-string">'is the wrong type'</span>)
  t.notOk(validate({<span class="hljs-attr">x</span>: <span class="hljs-string">'string'</span>, <span class="hljs-attr">y</span>: <span class="hljs-string">'value'</span>}), <span class="hljs-string">'should be invalid'</span>)
  t.strictEqual(validate.errors.length, <span class="hljs-number">1</span>);
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].field, <span class="hljs-string">'data.x'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].message, <span class="hljs-string">'is the wrong type'</span>)
  t.ok(validate({<span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-string">'value'</span>}), <span class="hljs-string">'should be invalid'</span>)
  t.end();
});

tape(<span class="hljs-string">'additional props'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> validate = validator({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">additionalProperties</span>: <span class="hljs-literal">false</span>
  }, {
    <span class="hljs-attr">verbose</span>: <span class="hljs-literal">true</span>
  })

  t.ok(validate({}))
  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-string">'bar'</span>}))
  t.ok(validate.errors[<span class="hljs-number">0</span>].value === <span class="hljs-string">'data.foo'</span>, <span class="hljs-string">'should output the property not allowed in verbose mode'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].type, <span class="hljs-string">'object'</span>, <span class="hljs-string">'error object should contain the type'</span>)
  t.end()
})

tape(<span class="hljs-string">'array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> validate = validator({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'array'</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">items</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
    }
  })

  t.notOk(validate({}), <span class="hljs-string">'wrong type'</span>)
  t.notOk(validate(), <span class="hljs-string">'is required'</span>)
  t.ok(validate([<span class="hljs-string">'test'</span>]))
  t.end()
})

tape(<span class="hljs-string">'nested array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> validate = validator({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">list</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'array'</span>,
        <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">items</span>: {
          <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
        }
      }
    }
  })

  t.notOk(validate({}), <span class="hljs-string">'is required'</span>)
  t.ok(validate({<span class="hljs-attr">list</span>:[<span class="hljs-string">'test'</span>]}))
  t.notOk(validate({<span class="hljs-attr">list</span>:[<span class="hljs-number">1</span>]}))
  t.end()
})

tape(<span class="hljs-string">'enum'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> validate = validator({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">foo</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'number'</span>,
        <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">enum</span>: [<span class="hljs-number">42</span>]
      }
    }
  })

  t.notOk(validate({}), <span class="hljs-string">'is required'</span>)
  t.ok(validate({<span class="hljs-attr">foo</span>:<span class="hljs-number">42</span>}))
  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-number">43</span>}))
  t.end()
})

tape(<span class="hljs-string">'minimum/maximum'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> validate = validator({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">foo</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'number'</span>,
        <span class="hljs-attr">minimum</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">maximum</span>: <span class="hljs-number">0</span>
      }
    }
  })

  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-number">-42</span>}))
  t.ok(validate({<span class="hljs-attr">foo</span>:<span class="hljs-number">0</span>}))
  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-number">42</span>}))
  t.end()
})

tape(<span class="hljs-string">'exclusiveMinimum/exclusiveMaximum'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> validate = validator({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">foo</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'number'</span>,
        <span class="hljs-attr">minimum</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">maximum</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">exclusiveMinimum</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">exclusiveMaximum</span>: <span class="hljs-literal">true</span>
      }
    }
  })

  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-number">10</span>}))
  t.ok(validate({<span class="hljs-attr">foo</span>:<span class="hljs-number">11</span>}))
  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-number">20</span>}))
  t.ok(validate({<span class="hljs-attr">foo</span>:<span class="hljs-number">19</span>}))
  t.end()
})

tape(<span class="hljs-string">'custom format'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> validate = validator({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">foo</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
        <span class="hljs-attr">format</span>: <span class="hljs-string">'as'</span>
      }
    }
  }, {<span class="hljs-attr">formats</span>: {<span class="hljs-attr">as</span>:<span class="hljs-regexp">/^a+$/</span>}})

  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-string">''</span>}), <span class="hljs-string">'not as'</span>)
  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-string">'b'</span>}), <span class="hljs-string">'not as'</span>)
  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-string">'aaab'</span>}), <span class="hljs-string">'not as'</span>)
  t.ok(validate({<span class="hljs-attr">foo</span>:<span class="hljs-string">'a'</span>}), <span class="hljs-string">'as'</span>)
  t.ok(validate({<span class="hljs-attr">foo</span>:<span class="hljs-string">'aaaaaa'</span>}), <span class="hljs-string">'as'</span>)
  t.end()
})

tape(<span class="hljs-string">'custom format function'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> validate = validator({
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">foo</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
        <span class="hljs-attr">format</span>: <span class="hljs-string">'as'</span>
      }
    }
  }, {<span class="hljs-attr">formats</span>: {<span class="hljs-attr">as</span>:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">s</span>) </span>{ <span class="hljs-keyword">return</span> <span class="hljs-regexp">/^a+$/</span>.test(s) } }})

  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-string">''</span>}), <span class="hljs-string">'not as'</span>)
  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-string">'b'</span>}), <span class="hljs-string">'not as'</span>)
  t.notOk(validate({<span class="hljs-attr">foo</span>:<span class="hljs-string">'aaab'</span>}), <span class="hljs-string">'not as'</span>)
  t.ok(validate({<span class="hljs-attr">foo</span>:<span class="hljs-string">'a'</span>}), <span class="hljs-string">'as'</span>)
  t.ok(validate({<span class="hljs-attr">foo</span>:<span class="hljs-string">'aaaaaa'</span>}), <span class="hljs-string">'as'</span>)
  t.end()
})

tape(<span class="hljs-string">'do not mutate schema'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> sch = {
    <span class="hljs-attr">items</span>: [
      {}
    ],
    <span class="hljs-attr">additionalItems</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'integer'</span>
    }
  }

  <span class="hljs-keyword">var</span> copy = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">JSON</span>.stringify(sch))

  validator(sch)

  t.same(sch, copy, <span class="hljs-string">'did not mutate'</span>)
  t.end()
})

tape(<span class="hljs-string">'#toJSON()'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> schema = {
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">hello</span>: {<span class="hljs-attr">type</span>:<span class="hljs-string">'string'</span>, <span class="hljs-attr">required</span>:<span class="hljs-literal">true</span>}
    }
  }

  <span class="hljs-keyword">var</span> validate = validator(schema)

  t.deepEqual(validate.toJSON(), schema, <span class="hljs-string">'should return original schema'</span>)
  t.end()
})

tape(<span class="hljs-string">'external schemas'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> ext = {<span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>}
  <span class="hljs-keyword">var</span> schema = {
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">$ref</span>: <span class="hljs-string">'#ext'</span>
  }

  <span class="hljs-keyword">var</span> validate = validator(schema, {<span class="hljs-attr">schemas</span>: {<span class="hljs-attr">ext</span>:ext}})

  t.ok(validate(<span class="hljs-string">'hello string'</span>), <span class="hljs-string">'is a string'</span>)
  t.notOk(validate(<span class="hljs-number">42</span>), <span class="hljs-string">'not a string'</span>)
  t.end()
})

tape(<span class="hljs-string">'external schema URIs'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> ext = {<span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>}
  <span class="hljs-keyword">var</span> schema = {
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">$ref</span>: <span class="hljs-string">'http://example.com/schemas/schemaURIs'</span>
  }

  <span class="hljs-keyword">var</span> opts = {<span class="hljs-attr">schemas</span>:{}};
  opts.schemas[<span class="hljs-string">'http://example.com/schemas/schemaURIs'</span>] = ext;
  <span class="hljs-keyword">var</span> validate = validator(schema, opts)

  t.ok(validate(<span class="hljs-string">'hello string'</span>), <span class="hljs-string">'is a string'</span>)
  t.notOk(validate(<span class="hljs-number">42</span>), <span class="hljs-string">'not a string'</span>)
  t.end()
})

tape(<span class="hljs-string">'top-level external schema'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> defs = {
    <span class="hljs-string">"string"</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span>
    },
    <span class="hljs-string">"sex"</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span>,
      <span class="hljs-attr">enum</span>: [<span class="hljs-string">"male"</span>, <span class="hljs-string">"female"</span>, <span class="hljs-string">"other"</span>]
    }
  }
  <span class="hljs-keyword">var</span> schema = {
    <span class="hljs-attr">type</span>: <span class="hljs-string">"object"</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-string">"name"</span>: { <span class="hljs-attr">$ref</span>: <span class="hljs-string">"definitions.json#/string"</span> },
      <span class="hljs-string">"sex"</span>: { <span class="hljs-attr">$ref</span>: <span class="hljs-string">"definitions.json#/sex"</span> }
    },
    <span class="hljs-attr">required</span>: [<span class="hljs-string">"name"</span>, <span class="hljs-string">"sex"</span>]
  }

  <span class="hljs-keyword">var</span> validate = validator(schema, {
    <span class="hljs-attr">schemas</span>: {
      <span class="hljs-string">"definitions.json"</span>: defs
    }
  })
  t.ok(validate({<span class="hljs-attr">name</span>:<span class="hljs-string">"alice"</span>, <span class="hljs-attr">sex</span>:<span class="hljs-string">"female"</span>}), <span class="hljs-string">'is an object'</span>)
  t.notOk(validate({<span class="hljs-attr">name</span>:<span class="hljs-string">"alice"</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">"bob"</span>}), <span class="hljs-string">'recognizes external schema'</span>)
  t.notOk(validate({<span class="hljs-attr">name</span>:<span class="hljs-number">2</span>, <span class="hljs-attr">sex</span>: <span class="hljs-string">"female"</span>}), <span class="hljs-string">'recognizes external schema'</span>)
  t.end()
})

tape(<span class="hljs-string">'nested required array decl'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> schema = {
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">x</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
        <span class="hljs-attr">properties</span>: {
          <span class="hljs-attr">y</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
            <span class="hljs-attr">properties</span>: {
              <span class="hljs-attr">z</span>: {
                <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
              }
            },
            <span class="hljs-attr">required</span>: [<span class="hljs-string">'z'</span>]
          }
        }
      }
    },
    <span class="hljs-attr">required</span>: [<span class="hljs-string">'x'</span>]
  }

  <span class="hljs-keyword">var</span> validate = validator(schema)

  t.ok(validate({<span class="hljs-attr">x</span>: {}}), <span class="hljs-string">'should be valid'</span>)
  t.notOk(validate({}), <span class="hljs-string">'should not be valid'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].field, <span class="hljs-string">'data.x'</span>, <span class="hljs-string">'should output the missing field'</span>)
  t.end()
})

tape(<span class="hljs-string">'verbose mode'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> schema = {
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">hello</span>: {
        <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
      }
    }
  };

  <span class="hljs-keyword">var</span> validate = validator(schema, {<span class="hljs-attr">verbose</span>: <span class="hljs-literal">true</span>})

  t.ok(validate({<span class="hljs-attr">hello</span>: <span class="hljs-string">'string'</span>}), <span class="hljs-string">'should be valid'</span>)
  t.notOk(validate({<span class="hljs-attr">hello</span>: <span class="hljs-number">100</span>}), <span class="hljs-string">'should not be valid'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].value, <span class="hljs-number">100</span>, <span class="hljs-string">'error object should contain the invalid value'</span>)
  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].type, <span class="hljs-string">'string'</span>, <span class="hljs-string">'error object should contain the type'</span>)
  t.end()
})

tape(<span class="hljs-string">'additional props in verbose mode'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> schema = {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
    <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">additionalProperties</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">properties</span>: {
      <span class="hljs-attr">foo</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
      },
      <span class="hljs-string">'hello world'</span>: {
        <span class="hljs-attr">type</span>: <span class="hljs-string">'object'</span>,
        <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">additionalProperties</span>: <span class="hljs-literal">false</span>,
        <span class="hljs-attr">properties</span>: {
          <span class="hljs-attr">foo</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>
          }
        }
      }
    }
  };

  <span class="hljs-keyword">var</span> validate = validator(schema, {<span class="hljs-attr">verbose</span>: <span class="hljs-literal">true</span>})

  validate({<span class="hljs-string">'hello world'</span>: {<span class="hljs-attr">bar</span>: <span class="hljs-string">'string'</span>}});

  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].value, <span class="hljs-string">'data["hello world"].bar'</span>, <span class="hljs-string">'should output the path to the additional prop in the error'</span>)
  t.end()
})

tape(<span class="hljs-string">'Date.now() is an integer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> schema = {<span class="hljs-attr">type</span>: <span class="hljs-string">'integer'</span>}
  <span class="hljs-keyword">var</span> validate = validator(schema)

  t.ok(validate(<span class="hljs-built_in">Date</span>.now()), <span class="hljs-string">'is integer'</span>)
  t.end()
})

tape(<span class="hljs-string">'field shows item index in arrays'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> schema = {
    <span class="hljs-attr">type</span>: <span class="hljs-string">'array'</span>,
    <span class="hljs-attr">items</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">'array'</span>,
      <span class="hljs-attr">items</span>: {
        <span class="hljs-attr">properties</span>: {
          <span class="hljs-attr">foo</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">'string'</span>,
            <span class="hljs-attr">required</span>: <span class="hljs-literal">true</span>
          }
        }
      }
    }
  }

  <span class="hljs-keyword">var</span> validate = validator(schema)

  validate([
    [
      { <span class="hljs-attr">foo</span>: <span class="hljs-string">'test'</span> },
      { <span class="hljs-attr">foo</span>: <span class="hljs-string">'test'</span> }
    ],
    [
      { <span class="hljs-attr">foo</span>: <span class="hljs-string">'test'</span> },
      { <span class="hljs-attr">baz</span>: <span class="hljs-string">'test'</span> }
    ]
  ])

  t.strictEqual(validate.errors[<span class="hljs-number">0</span>].field, <span class="hljs-string">'data.1.1.foo'</span>, <span class="hljs-string">'should output the field with specific index of failing item in the error'</span>)
  t.end()
})

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
