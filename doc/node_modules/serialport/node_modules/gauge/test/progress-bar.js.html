<!DOCTYPE html>
<html>
<head>
  <title>progress-bar.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/gauge/test/progress-bar.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>progress-bar.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>
<span class="hljs-keyword">var</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">"tap"</span>).test
<span class="hljs-keyword">var</span> ProgressBar = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../progress-bar.js"</span>)

<span class="hljs-keyword">var</span> cursor = []
<span class="hljs-keyword">var</span> C
<span class="hljs-keyword">var</span> bar = <span class="hljs-keyword">new</span> ProgressBar({<span class="hljs-attr">theme</span>: ProgressBar.ascii, <span class="hljs-attr">maxUpdateFrequency</span>: <span class="hljs-number">0</span>}, C = {
  <span class="hljs-attr">show</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    cursor.push([<span class="hljs-string">"show"</span>])
    <span class="hljs-keyword">return</span> C
  },
  <span class="hljs-attr">hide</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    cursor.push([<span class="hljs-string">"hide"</span>])
    <span class="hljs-keyword">return</span> C
  },
  <span class="hljs-attr">up</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">lines</span>) </span>{
    cursor.push([<span class="hljs-string">"up"</span>,lines])
    <span class="hljs-keyword">return</span> C
  },
  <span class="hljs-attr">horizontalAbsolute</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">col</span>) </span>{
    cursor.push([<span class="hljs-string">"horizontalAbsolute"</span>, col])
    <span class="hljs-keyword">return</span> C
  },
  <span class="hljs-attr">eraseLine</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    cursor.push([<span class="hljs-string">"eraseLine"</span>])
    <span class="hljs-keyword">return</span> C
  },
  <span class="hljs-attr">write</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">line</span>) </span>{
    cursor.push([<span class="hljs-string">"write"</span>, line])
    <span class="hljs-keyword">return</span> C
  }
})


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isOutput</span>(<span class="hljs-params">t, msg, output</span>) </span>{
  <span class="hljs-keyword">var</span> tests = []
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> ii = <span class="hljs-number">0</span>; ii&lt;output.length; ++ii) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> jj = <span class="hljs-number">0</span>; jj&lt;output[ii].length; ++jj) {
      tests.push({<span class="hljs-attr">cmd</span>: ii, <span class="hljs-attr">arg</span>: jj})
    }
  }
  tests.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">test</span>) </span>{
    t.is(cursor[test.cmd] ? cursor[test.cmd][test.arg] : <span class="hljs-literal">null</span>,
         output[test.cmd][test.arg],
         msg + <span class="hljs-string">": "</span> + output[test.cmd] + (test.arg ? <span class="hljs-string">" arg #"</span>+test.arg : <span class="hljs-string">""</span>))
  })
}

test(<span class="hljs-string">"hide"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  t.plan(<span class="hljs-number">11</span>)
  process.stderr.isTTY = <span class="hljs-literal">false</span>
  bar.hide()
  t.is(cursor.length, <span class="hljs-number">0</span>, <span class="hljs-string">"We don't progress bar without a tty"</span>)
  cursor = []
  process.stderr.isTTY = <span class="hljs-literal">true</span>
  bar.hide()
  isOutput(t, <span class="hljs-string">"hide while not showing"</span>,[
    [<span class="hljs-string">"show"</span>], <span class="hljs-comment">// cursor</span>
    [<span class="hljs-string">"horizontalAbsolute"</span>,<span class="hljs-number">0</span>],
    [<span class="hljs-string">"eraseLine"</span>]])
  cursor = []
  bar.showing = <span class="hljs-literal">true</span>
  bar.hide()
  isOutput(t, <span class="hljs-string">"hide while showing"</span>,[
    [<span class="hljs-string">"show"</span>], <span class="hljs-comment">// cursor</span>
    [<span class="hljs-string">"up"</span>, <span class="hljs-number">1</span>],
    [<span class="hljs-string">"horizontalAbsolute"</span>,<span class="hljs-number">0</span>],
    [<span class="hljs-string">"eraseLine"</span>]])
})

test(<span class="hljs-string">"renderTemplate"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  t.plan(<span class="hljs-number">16</span>)
  process.stdout.columns = <span class="hljs-number">11</span>
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii,[{<span class="hljs-attr">type</span>: <span class="hljs-string">"name"</span>}],{<span class="hljs-attr">name</span>: <span class="hljs-string">"NAME"</span>})
  t.is(result, <span class="hljs-string">"NAME"</span>, <span class="hljs-string">"name substitution"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii,[{<span class="hljs-attr">type</span>: <span class="hljs-string">"completionbar"</span>}],{<span class="hljs-attr">completed</span>: <span class="hljs-number">0</span>})
  t.is(result, <span class="hljs-string">"----------"</span>, <span class="hljs-string">"0% bar"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii,[{<span class="hljs-attr">type</span>: <span class="hljs-string">"completionbar"</span>}],{<span class="hljs-attr">completed</span>: <span class="hljs-number">0.5</span>})
  t.is(result, <span class="hljs-string">"#####-----"</span>, <span class="hljs-string">"50% bar"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii,[{<span class="hljs-attr">type</span>: <span class="hljs-string">"completionbar"</span>}],{<span class="hljs-attr">completed</span>: <span class="hljs-number">1</span>})
  t.is(result, <span class="hljs-string">"##########"</span>, <span class="hljs-string">"100% bar"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii,[{<span class="hljs-attr">type</span>: <span class="hljs-string">"completionbar"</span>}],{<span class="hljs-attr">completed</span>: <span class="hljs-number">-100</span>})
  t.is(result, <span class="hljs-string">"----------"</span>, <span class="hljs-string">"0% underflow bar"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii,[{<span class="hljs-attr">type</span>: <span class="hljs-string">"completionbar"</span>}],{<span class="hljs-attr">completed</span>: <span class="hljs-number">100</span>})
  t.is(result, <span class="hljs-string">"##########"</span>, <span class="hljs-string">"100% overflow bar"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii,[{<span class="hljs-attr">type</span>: <span class="hljs-string">"name"</span>},{<span class="hljs-attr">type</span>: <span class="hljs-string">"completionbar"</span>}],{<span class="hljs-attr">name</span>: <span class="hljs-string">"NAME"</span>, <span class="hljs-attr">completed</span>: <span class="hljs-number">0.5</span>})
  t.is(result, <span class="hljs-string">"NAME###---"</span>, <span class="hljs-string">"name + 50%"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii, [<span class="hljs-string">"static"</span>], {})
  t.is(result, <span class="hljs-string">"static"</span>, <span class="hljs-string">"static text"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii, [<span class="hljs-string">"static"</span>,{<span class="hljs-attr">type</span>: <span class="hljs-string">"name"</span>}], {<span class="hljs-attr">name</span>: <span class="hljs-string">"NAME"</span>})
  t.is(result, <span class="hljs-string">"staticNAME"</span>, <span class="hljs-string">"static text + var"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii, [<span class="hljs-string">"static"</span>,{<span class="hljs-attr">type</span>: <span class="hljs-string">"name"</span>, <span class="hljs-attr">separated</span>: <span class="hljs-literal">true</span>}], {<span class="hljs-attr">name</span>: <span class="hljs-string">"NAME"</span>})
  t.is(result, <span class="hljs-string">"static NAME "</span>, <span class="hljs-string">"pre-separated"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii, [{<span class="hljs-attr">type</span>: <span class="hljs-string">"name"</span>, <span class="hljs-attr">separated</span>: <span class="hljs-literal">true</span>}, <span class="hljs-string">"static"</span>], {<span class="hljs-attr">name</span>: <span class="hljs-string">"NAME"</span>})
  t.is(result, <span class="hljs-string">"NAME static"</span>, <span class="hljs-string">"post-separated"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii, [<span class="hljs-string">"1"</span>,{<span class="hljs-attr">type</span>: <span class="hljs-string">"name"</span>, <span class="hljs-attr">separated</span>: <span class="hljs-literal">true</span>}, <span class="hljs-string">"2"</span>], {<span class="hljs-attr">name</span>: <span class="hljs-string">""</span>})
  t.is(result, <span class="hljs-string">"12"</span>, <span class="hljs-string">"separated no value"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii, [<span class="hljs-string">"1"</span>,{<span class="hljs-attr">type</span>: <span class="hljs-string">"name"</span>, <span class="hljs-attr">separated</span>: <span class="hljs-literal">true</span>}, <span class="hljs-string">"2"</span>], {<span class="hljs-attr">name</span>: <span class="hljs-string">"NAME"</span>})
  t.is(result, <span class="hljs-string">"1 NAME 2"</span>, <span class="hljs-string">"separated value"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii, [{<span class="hljs-attr">type</span>: <span class="hljs-string">"spinner"</span>}], {<span class="hljs-attr">spinner</span>: <span class="hljs-number">0</span>})
  t.is(result, <span class="hljs-string">""</span>, <span class="hljs-string">"No spinner"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii, [{<span class="hljs-attr">type</span>: <span class="hljs-string">"spinner"</span>}], {<span class="hljs-attr">spinner</span>: <span class="hljs-number">1</span>})
  t.is(result, <span class="hljs-string">"\\"</span>, <span class="hljs-string">"Spinner 1"</span>)
  <span class="hljs-keyword">var</span> result = bar.renderTemplate(ProgressBar.ascii, [{<span class="hljs-attr">type</span>: <span class="hljs-string">"spinner"</span>}], {<span class="hljs-attr">spinner</span>: <span class="hljs-number">10</span>})
  t.is(result, <span class="hljs-string">"|"</span>, <span class="hljs-string">"Spinner 10"</span>)
})

test(<span class="hljs-string">"show &amp; pulse"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  t.plan(<span class="hljs-number">23</span>)

  process.stdout.columns = <span class="hljs-number">16</span>
  cursor = []
  process.stderr.isTTY = <span class="hljs-literal">false</span>
  bar.template[<span class="hljs-number">0</span>].length = <span class="hljs-number">6</span>
  bar.last = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">0</span>)
  bar.show(<span class="hljs-string">"NAME"</span>, <span class="hljs-number">0</span>)
  t.is(cursor.length, <span class="hljs-number">0</span>, <span class="hljs-string">"no tty, no progressbar"</span>)

  cursor = []
  process.stderr.isTTY = <span class="hljs-literal">true</span>
  bar.last = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">0</span>)
  bar.show(<span class="hljs-string">"NAME"</span>, <span class="hljs-number">0.1</span>)
  isOutput(t, <span class="hljs-string">"tty, name, completion"</span>,
    [ [ <span class="hljs-string">'hide'</span> ],
      [ <span class="hljs-string">'horizontalAbsolute'</span>, <span class="hljs-number">0</span> ],
      [ <span class="hljs-string">'write'</span>, <span class="hljs-string">'NAME   |#-----|\n'</span> ],
      [ <span class="hljs-string">'show'</span> ] ])

  bar.show(<span class="hljs-string">"S"</span>)
  cursor = []
  bar.last = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">0</span>)
  bar.pulse()
  isOutput(t, <span class="hljs-string">"pulsed spinner"</span>,
    [ [ <span class="hljs-string">'up'</span>, <span class="hljs-number">1</span> ],
      [ <span class="hljs-string">'hide'</span> ],
      [ <span class="hljs-string">'horizontalAbsolute'</span>, <span class="hljs-number">0</span> ],
      [ <span class="hljs-string">'write'</span>, <span class="hljs-string">'S      \\ |----|\n'</span> ],
      [ <span class="hljs-string">'show'</span> ] ])
  cursor = []
  bar.last = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">0</span>)
  bar.pulse(<span class="hljs-string">"P"</span>)
  isOutput(t, <span class="hljs-string">"pulsed spinner with subsection"</span>,
    [ [ <span class="hljs-string">'up'</span>, <span class="hljs-number">1</span> ],
      [ <span class="hljs-string">'hide'</span> ],
      [ <span class="hljs-string">'horizontalAbsolute'</span>, <span class="hljs-number">0</span> ],
      [ <span class="hljs-string">'write'</span>, <span class="hljs-string">'S -&gt; P | |----|\n'</span> ],
      [ <span class="hljs-string">'show'</span> ] ])
})

test(<span class="hljs-string">"window resizing"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  t.plan(<span class="hljs-number">16</span>)
  process.stderr.isTTY = <span class="hljs-literal">true</span>
  process.stdout.columns = <span class="hljs-number">32</span>
  bar.show(<span class="hljs-string">"NAME"</span>, <span class="hljs-number">0.1</span>)
  cursor = []
  bar.last = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">0</span>)
  bar.pulse()
  isOutput(t, <span class="hljs-string">"32 columns"</span>,
    [ [ <span class="hljs-string">'up'</span>, <span class="hljs-number">1</span> ],
      [ <span class="hljs-string">'hide'</span> ],
      [ <span class="hljs-string">'horizontalAbsolute'</span>, <span class="hljs-number">0</span> ],
      [ <span class="hljs-string">'write'</span>, <span class="hljs-string">'NAME   / |##------------------|\n'</span> ],
      [ <span class="hljs-string">'show'</span> ] ])

  process.stdout.columns = <span class="hljs-number">16</span>
  bar.show(<span class="hljs-string">"NAME"</span>, <span class="hljs-number">0.5</span>)
  cursor = []
  bar.last = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(<span class="hljs-number">0</span>)
  bar.pulse()
  isOutput(t, <span class="hljs-string">"16 columns"</span>,
    [ [ <span class="hljs-string">'up'</span>, <span class="hljs-number">1</span> ],
      [ <span class="hljs-string">'hide'</span> ],
      [ <span class="hljs-string">'horizontalAbsolute'</span>, <span class="hljs-number">0</span> ],
      [ <span class="hljs-string">'write'</span>, <span class="hljs-string">'NAME   - |##--|\n'</span> ],
      [ <span class="hljs-string">'show'</span> ] ]);
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
