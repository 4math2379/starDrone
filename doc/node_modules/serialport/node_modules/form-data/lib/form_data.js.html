<!DOCTYPE html>
<html>
<head>
  <title>form_data.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/form-data/lib/form_data.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>form_data.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> CombinedStream = <span class="hljs-built_in">require</span>(<span class="hljs-string">'combined-stream'</span>);
<span class="hljs-keyword">var</span> util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">var</span> http = <span class="hljs-built_in">require</span>(<span class="hljs-string">'http'</span>);
<span class="hljs-keyword">var</span> https = <span class="hljs-built_in">require</span>(<span class="hljs-string">'https'</span>);
<span class="hljs-keyword">var</span> parseUrl = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>).parse;
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);
<span class="hljs-keyword">var</span> mime = <span class="hljs-built_in">require</span>(<span class="hljs-string">'mime-types'</span>);
<span class="hljs-keyword">var</span> <span class="hljs-keyword">async</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'async'</span>);
<span class="hljs-keyword">var</span> populate = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./populate.js'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Public API</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-built_in">module</span>.exports = FormData;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>make it a Stream</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">util.inherits(FormData, CombinedStream);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Create readable &quot;multipart/form-data&quot; streams.
Can be used to submit forms
and file uploads to other web applications.</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">FormData</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> FormData)) {
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(<span class="hljs-string">'Failed to construct FormData: Please use the _new_ operator, this object constructor cannot be called as a function.'</span>);
  }

  <span class="hljs-keyword">this</span>._overheadLength = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">this</span>._valueLength = <span class="hljs-number">0</span>;
  <span class="hljs-keyword">this</span>._lengthRetrievers = [];

  CombinedStream.call(<span class="hljs-keyword">this</span>);
}

FormData.LINE_BREAK = <span class="hljs-string">'\r\n'</span>;
FormData.DEFAULT_CONTENT_TYPE = <span class="hljs-string">'application/octet-stream'</span>;

FormData.prototype.append = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">field, value, options</span>) </span>{

  options = options || {};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>allow filename as single option</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> options == <span class="hljs-string">'string'</span>) {
    options = {<span class="hljs-attr">filename</span>: options};
  }

  <span class="hljs-keyword">var</span> append = CombinedStream.prototype.append.bind(<span class="hljs-keyword">this</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>all that streamy business can't handle numbers</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value == <span class="hljs-string">'number'</span>) {
    value = <span class="hljs-string">''</span> + value;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>https://github.com/felixge/node-form-data/issues/38</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (util.isArray(value)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Please convert your array into string
the way web server expects it</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>._error(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Arrays are not supported.'</span>));
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">var</span> header = <span class="hljs-keyword">this</span>._multiPartHeader(field, value, options);
  <span class="hljs-keyword">var</span> footer = <span class="hljs-keyword">this</span>._multiPartFooter();

  append(header);
  append(value);
  append(footer);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>pass along options.knownLength</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>._trackLength(header, value, options);
};

FormData.prototype._trackLength = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">header, value, options</span>) </span>{
  <span class="hljs-keyword">var</span> valueLength = <span class="hljs-number">0</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>used w/ getLengthSync(), when length is known.
e.g. for streaming directly from a remote server,
w/ a known file a size, and not wanting to wait for
incoming file to finish to get its size.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (options.knownLength != <span class="hljs-literal">null</span>) {
    valueLength += +options.knownLength;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Buffer.isBuffer(value)) {
    valueLength = value.length;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'string'</span>) {
    valueLength = Buffer.byteLength(value);
  }

  <span class="hljs-keyword">this</span>._valueLength += valueLength;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>@check why add CRLF? does this account for custom/multiple CRLFs?</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>._overheadLength +=
    Buffer.byteLength(header) +
    FormData.LINE_BREAK.length;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>empty or either doesn't have path or not an http response</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!value || ( !value.path &amp;&amp; !(value.readable &amp;&amp; value.hasOwnProperty(<span class="hljs-string">'httpVersion'</span>)) )) {
    <span class="hljs-keyword">return</span>;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>no need to bother with the length</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!options.knownLength) {
    <span class="hljs-keyword">this</span>._lengthRetrievers.push(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{

      <span class="hljs-keyword">if</span> (value.hasOwnProperty(<span class="hljs-string">'fd'</span>)) {

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>take read range into a account
<code>end</code> = Infinity â€“&gt; read file till the end</p>
<p>TODO: Looks like there is bug in Node fs.createReadStream
it doesn't respect <code>end</code> options without <code>start</code> options
Fix it when node fixes it.
https://github.com/joyent/node/issues/7819</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (value.end != <span class="hljs-literal">undefined</span> &amp;&amp; value.end != <span class="hljs-literal">Infinity</span> &amp;&amp; value.start != <span class="hljs-literal">undefined</span>) {

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>when end specified
no need to calculate range
inclusive, starts with 0</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          next(<span class="hljs-literal">null</span>, value.end + <span class="hljs-number">1</span> - (value.start ? value.start : <span class="hljs-number">0</span>));

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>not that fast snoopy</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>still need to fetch file size from fs</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">          fs.stat(value.path, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, stat</span>) </span>{

            <span class="hljs-keyword">var</span> fileSize;

            <span class="hljs-keyword">if</span> (err) {
              next(err);
              <span class="hljs-keyword">return</span>;
            }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>update final size based on the range options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            fileSize = stat.size - (value.start ? value.start : <span class="hljs-number">0</span>);
            next(<span class="hljs-literal">null</span>, fileSize);
          });
        }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>or http response</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value.hasOwnProperty(<span class="hljs-string">'httpVersion'</span>)) {
        next(<span class="hljs-literal">null</span>, +value.headers[<span class="hljs-string">'content-length'</span>]);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>or request stream http://github.com/mikeal/request</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (value.hasOwnProperty(<span class="hljs-string">'httpModule'</span>)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>wait till response come back</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        value.on(<span class="hljs-string">'response'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) </span>{
          value.pause();
          next(<span class="hljs-literal">null</span>, +response.headers[<span class="hljs-string">'content-length'</span>]);
        });
        value.resume();

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>something else</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      } <span class="hljs-keyword">else</span> {
        next(<span class="hljs-string">'Unknown stream'</span>);
      }
    });
  }
};

FormData.prototype._multiPartHeader = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">field, value, options</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>custom header specified (as string)?
it becomes responsible for boundary
(e.g. to handle extra CRLFs on .NET servers)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (options.header) {
    <span class="hljs-keyword">return</span> options.header;
  }

  <span class="hljs-keyword">var</span> contentDisposition = <span class="hljs-keyword">this</span>._getContentDisposition(value, options);
  <span class="hljs-keyword">var</span> contentType = <span class="hljs-keyword">this</span>._getContentType(value, options);

  <span class="hljs-keyword">var</span> contents = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">var</span> headers  = {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>add custom disposition as third element or keep it two elements if not</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-string">'Content-Disposition'</span>: [<span class="hljs-string">'form-data'</span>, <span class="hljs-string">'name="'</span> + field + <span class="hljs-string">'"'</span>].concat(contentDisposition || []),
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>if no content type. allow it to be empty array</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-string">'Content-Type'</span>: [].concat(contentType || [])
  };

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> prop <span class="hljs-keyword">in</span> headers) {
    <span class="hljs-keyword">if</span> (headers[prop].length) {
      contents += prop + <span class="hljs-string">': '</span> + headers[prop].join(<span class="hljs-string">'; '</span>) + FormData.LINE_BREAK;
    }
  }

  <span class="hljs-keyword">return</span> <span class="hljs-string">'--'</span> + <span class="hljs-keyword">this</span>.getBoundary() + FormData.LINE_BREAK + contents + FormData.LINE_BREAK;
};

FormData.prototype._getContentDisposition = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, options</span>) </span>{

  <span class="hljs-keyword">var</span> contentDisposition;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>custom filename takes precedence
fs- and request- streams have path property</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> filename = options.filename || value.path;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>or try http response</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!filename &amp;&amp; value.readable &amp;&amp; value.hasOwnProperty(<span class="hljs-string">'httpVersion'</span>)) {
    filename = value.client._httpMessage.path;
  }

  <span class="hljs-keyword">if</span> (filename) {
    contentDisposition = <span class="hljs-string">'filename="'</span> + path.basename(filename) + <span class="hljs-string">'"'</span>;
  }

  <span class="hljs-keyword">return</span> contentDisposition;
};

FormData.prototype._getContentType = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">value, options</span>) </span>{

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>use custom content-type above all</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> contentType = options.contentType;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>or try <code>path</code> from fs-, request- streams</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!contentType &amp;&amp; value.path) {
    contentType = mime.lookup(value.path);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>or if it's http-reponse</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!contentType &amp;&amp; value.readable &amp;&amp; value.hasOwnProperty(<span class="hljs-string">'httpVersion'</span>)) {
    contentType = value.headers[<span class="hljs-string">'content-type'</span>];
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>or guess it from the filename</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!contentType &amp;&amp; options.filename) {
    contentType = mime.lookup(options.filename);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>fallback to the default content type if <code>value</code> is not simple value</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (!contentType &amp;&amp; <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">'object'</span>) {
    contentType = FormData.DEFAULT_CONTENT_TYPE;
  }

  <span class="hljs-keyword">return</span> contentType;
};

FormData.prototype._multiPartFooter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
    <span class="hljs-keyword">var</span> footer = FormData.LINE_BREAK;

    <span class="hljs-keyword">var</span> lastPart = (<span class="hljs-keyword">this</span>._streams.length === <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (lastPart) {
      footer += <span class="hljs-keyword">this</span>._lastBoundary();
    }

    next(footer);
  }.bind(<span class="hljs-keyword">this</span>);
};

FormData.prototype._lastBoundary = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">return</span> <span class="hljs-string">'--'</span> + <span class="hljs-keyword">this</span>.getBoundary() + <span class="hljs-string">'--'</span> + FormData.LINE_BREAK;
};

FormData.prototype.getHeaders = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">userHeaders</span>) </span>{
  <span class="hljs-keyword">var</span> header;
  <span class="hljs-keyword">var</span> formHeaders = {
    <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'multipart/form-data; boundary='</span> + <span class="hljs-keyword">this</span>.getBoundary()
  };

  <span class="hljs-keyword">for</span> (header <span class="hljs-keyword">in</span> userHeaders) {
    <span class="hljs-keyword">if</span> (userHeaders.hasOwnProperty(header)) {
      formHeaders[header.toLowerCase()] = userHeaders[header];
    }
  }

  <span class="hljs-keyword">return</span> formHeaders;
};

FormData.prototype.getCustomHeaders = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">contentType</span>) </span>{
  contentType = contentType ? contentType : <span class="hljs-string">'multipart/form-data'</span>;

  <span class="hljs-keyword">var</span> formHeaders = {
    <span class="hljs-string">'content-type'</span>: contentType + <span class="hljs-string">'; boundary='</span> + <span class="hljs-keyword">this</span>.getBoundary(),
    <span class="hljs-string">'content-length'</span>: <span class="hljs-keyword">this</span>.getLengthSync()
  };

  <span class="hljs-keyword">return</span> formHeaders;
};

FormData.prototype.getBoundary = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._boundary) {
    <span class="hljs-keyword">this</span>._generateBoundary();
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._boundary;
};

FormData.prototype._generateBoundary = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>This generates a 50 character boundary similar to those used by Firefox.
They are optimized for boyer-moore parsing.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> boundary = <span class="hljs-string">'--------------------------'</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">24</span>; i++) {
    boundary += <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * <span class="hljs-number">10</span>).toString(<span class="hljs-number">16</span>);
  }

  <span class="hljs-keyword">this</span>._boundary = boundary;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>Note: getLengthSync DOESN'T calculate streams length
As workaround one can calculate file size manually
and add it as knownLength option</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">FormData.prototype.getLengthSync = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> knownLength = <span class="hljs-keyword">this</span>._overheadLength + <span class="hljs-keyword">this</span>._valueLength;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>Don't get confused, there are 3 &quot;internal&quot; streams for each keyval pair
so it basically checks if there is any value added to the form</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._streams.length) {
    knownLength += <span class="hljs-keyword">this</span>._lastBoundary().length;
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>https://github.com/form-data/form-data/issues/40</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._lengthRetrievers.length) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>Some async length retrievers are present
therefore synchronous length calculation is false.
Please use getLength(callback) to get proper length</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>._error(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Cannot calculate proper length in synchronous way.'</span>));
  }

  <span class="hljs-keyword">return</span> knownLength;
};

FormData.prototype.getLength = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">cb</span>) </span>{
  <span class="hljs-keyword">var</span> knownLength = <span class="hljs-keyword">this</span>._overheadLength + <span class="hljs-keyword">this</span>._valueLength;

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._streams.length) {
    knownLength += <span class="hljs-keyword">this</span>._lastBoundary().length;
  }

  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._lengthRetrievers.length) {
    process.nextTick(cb.bind(<span class="hljs-keyword">this</span>, <span class="hljs-literal">null</span>, knownLength));
    <span class="hljs-keyword">return</span>;
  }

  <span class="hljs-keyword">async</span>.parallel(<span class="hljs-keyword">this</span>._lengthRetrievers, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, values</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
      cb(err);
      <span class="hljs-keyword">return</span>;
    }

    values.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">length</span>) </span>{
      knownLength += length;
    });

    cb(<span class="hljs-literal">null</span>, knownLength);
  });
};

FormData.prototype.submit = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">params, cb</span>) </span>{
  <span class="hljs-keyword">var</span> request
    , options
    , defaults = {<span class="hljs-attr">method</span>: <span class="hljs-string">'post'</span>}
    ;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>parse provided url if it's string
or treat it as options object</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> params == <span class="hljs-string">'string'</span>) {

    params = parseUrl(params);
    options = populate({
      <span class="hljs-attr">port</span>: params.port,
      <span class="hljs-attr">path</span>: params.pathname,
      <span class="hljs-attr">host</span>: params.hostname
    }, defaults);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>use custom params</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  } <span class="hljs-keyword">else</span> {

    options = populate(params, defaults);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>if no port provided use default one</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (!options.port) {
      options.port = options.protocol == <span class="hljs-string">'https:'</span> ? <span class="hljs-number">443</span> : <span class="hljs-number">80</span>;
    }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>put that good code in getHeaders to some use</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  options.headers = <span class="hljs-keyword">this</span>.getHeaders(params.headers);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>https if specified, fallback to http in any other case</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (options.protocol == <span class="hljs-string">'https:'</span>) {
    request = https.request(options);
  } <span class="hljs-keyword">else</span> {
    request = http.request(options);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>get content length and fire away</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">this</span>.getLength(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, length</span>) </span>{
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-keyword">this</span>._error(err);
      <span class="hljs-keyword">return</span>;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>add content length</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    request.setHeader(<span class="hljs-string">'Content-Length'</span>, length);

    <span class="hljs-keyword">this</span>.pipe(request);
    <span class="hljs-keyword">if</span> (cb) {
      request.on(<span class="hljs-string">'error'</span>, cb);
      request.on(<span class="hljs-string">'response'</span>, cb.bind(<span class="hljs-keyword">this</span>, <span class="hljs-literal">null</span>));
    }
  }.bind(<span class="hljs-keyword">this</span>));

  <span class="hljs-keyword">return</span> request;
};

FormData.prototype._error = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.error) {
    <span class="hljs-keyword">this</span>.error = err;
    <span class="hljs-keyword">this</span>.pause();
    <span class="hljs-keyword">this</span>.emit(<span class="hljs-string">'error'</span>, err);
  }
};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
