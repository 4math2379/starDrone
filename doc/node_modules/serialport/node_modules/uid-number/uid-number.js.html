<!DOCTYPE html>
<html>
<head>
  <title>uid-number.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node_modules/serialport/node_modules/uid-number/uid-number.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>uid-number.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-built_in">module</span>.exports = uidNumber

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>This module calls into get-uid-gid.js, which sets the
uid and gid to the supplied argument, in order to find out their
numeric value.  This can't be done in the main node process,
because otherwise node would be running as that user from this
point on.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> child_process = <span class="hljs-built_in">require</span>(<span class="hljs-string">"child_process"</span>)
  , path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>)
  , uidSupport = process.getuid &amp;&amp; process.setuid
  , uidCache = {}
  , gidCache = {}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">uidNumber</span> (<span class="hljs-params">uid, gid, cb</span>) </span>{
  <span class="hljs-keyword">if</span> (!uidSupport) <span class="hljs-keyword">return</span> cb()
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> cb !== <span class="hljs-string">"function"</span>) cb = gid, gid = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> cb !== <span class="hljs-string">"function"</span>) cb = uid, uid = <span class="hljs-literal">null</span>
  <span class="hljs-keyword">if</span> (gid == <span class="hljs-literal">null</span>) gid = process.getgid()
  <span class="hljs-keyword">if</span> (uid == <span class="hljs-literal">null</span>) uid = process.getuid()
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isNaN</span>(gid)) gid = gidCache[gid] = +gid
  <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isNaN</span>(uid)) uid = uidCache[uid] = +uid

  <span class="hljs-keyword">if</span> (uidCache.hasOwnProperty(uid)) uid = uidCache[uid]
  <span class="hljs-keyword">if</span> (gidCache.hasOwnProperty(gid)) gid = gidCache[gid]

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> gid === <span class="hljs-string">"number"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> uid === <span class="hljs-string">"number"</span>) {
    <span class="hljs-keyword">return</span> process.nextTick(cb.bind(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, uid, gid))
  }

  <span class="hljs-keyword">var</span> getter = <span class="hljs-built_in">require</span>.resolve(<span class="hljs-string">"./get-uid-gid.js"</span>)

  child_process.execFile( process.execPath
                        , [getter, uid, gid]
                        , <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code, out, stderr</span>) </span>{
    <span class="hljs-keyword">if</span> (code) {
      <span class="hljs-keyword">var</span> er = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"could not get uid/gid\n"</span> + stderr)
      er.code = code
      <span class="hljs-keyword">return</span> cb(er)
    }

    <span class="hljs-keyword">try</span> {
      out = <span class="hljs-built_in">JSON</span>.parse(out+<span class="hljs-string">""</span>)
    } <span class="hljs-keyword">catch</span> (ex) {
      <span class="hljs-keyword">return</span> cb(ex)
    }

    <span class="hljs-keyword">if</span> (out.error) {
      <span class="hljs-keyword">var</span> er = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(out.error)
      er.errno = out.errno
      <span class="hljs-keyword">return</span> cb(er)
    }

    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(out.uid) || <span class="hljs-built_in">isNaN</span>(out.gid)) <span class="hljs-keyword">return</span> cb(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
      <span class="hljs-string">"Could not get uid/gid: "</span>+<span class="hljs-built_in">JSON</span>.stringify(out)))

    cb(<span class="hljs-literal">null</span>, uidCache[uid] = +out.uid, gidCache[gid] = +out.gid)
  })
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
