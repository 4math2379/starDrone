<!DOCTYPE html>
<html>
<head>
  <title>writer.test.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../doc-style.css" />
  <script src="../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../";
    var thisFile = "node_modules/serialport/node_modules/asn1/tst/ber/writer.test.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>writer.test.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>Copyright 2011 Mark Cavage <a href="mailto:mcavage@gmail.com.html">mcavage@gmail.com</a> All rights reserved.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> test = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tap'</span>).test;
<span class="hljs-keyword">var</span> sys = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sys'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>/--- Globals</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> BerWriter;

<span class="hljs-keyword">var</span> BerReader;


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>/--- Tests</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
test(<span class="hljs-string">'load library'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  BerWriter = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../../lib/index'</span>).BerWriter;
  t.ok(BerWriter);
  t.ok(<span class="hljs-keyword">new</span> BerWriter());
  t.end();
});


test(<span class="hljs-string">'write byte'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();

  writer.writeByte(<span class="hljs-number">0xC2</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, <span class="hljs-number">1</span>, <span class="hljs-string">'Wrong length'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0xC2</span>, <span class="hljs-string">'value wrong'</span>);

  t.end();
});


test(<span class="hljs-string">'write 1 byte int'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();

  writer.writeInt(<span class="hljs-number">0x7f</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, <span class="hljs-number">3</span>, <span class="hljs-string">'Wrong length for an int: '</span> + ber.length);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'ASN.1 tag wrong (2) -&gt; '</span> + ber[<span class="hljs-number">0</span>]);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">0x01</span>, <span class="hljs-string">'length wrong(1) -&gt; '</span> + ber[<span class="hljs-number">1</span>]);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0x7f</span>, <span class="hljs-string">'value wrong(3) -&gt; '</span> + ber[<span class="hljs-number">2</span>]);

  t.end();
});


test(<span class="hljs-string">'write 2 byte int'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();

  writer.writeInt(<span class="hljs-number">0x7ffe</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, <span class="hljs-number">4</span>, <span class="hljs-string">'Wrong length for an int'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'ASN.1 tag wrong'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'length wrong'</span>);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0x7f</span>, <span class="hljs-string">'value wrong (byte 1)'</span>);
  t.equal(ber[<span class="hljs-number">3</span>], <span class="hljs-number">0xfe</span>, <span class="hljs-string">'value wrong (byte 2)'</span>);

  t.end();
});


test(<span class="hljs-string">'write 3 byte int'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();

  writer.writeInt(<span class="hljs-number">0x7ffffe</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, <span class="hljs-number">5</span>, <span class="hljs-string">'Wrong length for an int'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'ASN.1 tag wrong'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">0x03</span>, <span class="hljs-string">'length wrong'</span>);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0x7f</span>, <span class="hljs-string">'value wrong (byte 1)'</span>);
  t.equal(ber[<span class="hljs-number">3</span>], <span class="hljs-number">0xff</span>, <span class="hljs-string">'value wrong (byte 2)'</span>);
  t.equal(ber[<span class="hljs-number">4</span>], <span class="hljs-number">0xfe</span>, <span class="hljs-string">'value wrong (byte 3)'</span>);

  t.end();
});


test(<span class="hljs-string">'write 4 byte int'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();

  writer.writeInt(<span class="hljs-number">0x7ffffffe</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, <span class="hljs-number">6</span>, <span class="hljs-string">'Wrong length for an int'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'ASN.1 tag wrong'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">0x04</span>, <span class="hljs-string">'length wrong'</span>);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0x7f</span>, <span class="hljs-string">'value wrong (byte 1)'</span>);
  t.equal(ber[<span class="hljs-number">3</span>], <span class="hljs-number">0xff</span>, <span class="hljs-string">'value wrong (byte 2)'</span>);
  t.equal(ber[<span class="hljs-number">4</span>], <span class="hljs-number">0xff</span>, <span class="hljs-string">'value wrong (byte 3)'</span>);
  t.equal(ber[<span class="hljs-number">5</span>], <span class="hljs-number">0xfe</span>, <span class="hljs-string">'value wrong (byte 4)'</span>);

  t.end();
});


test(<span class="hljs-string">'write 1 byte negative int'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();

  writer.writeInt(<span class="hljs-number">-128</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, <span class="hljs-number">3</span>, <span class="hljs-string">'Wrong length for an int'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'ASN.1 tag wrong'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">0x01</span>, <span class="hljs-string">'length wrong'</span>);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0x80</span>, <span class="hljs-string">'value wrong (byte 1)'</span>);

  t.end();
});


test(<span class="hljs-string">'write 2 byte negative int'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();

  writer.writeInt(<span class="hljs-number">-22400</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, <span class="hljs-number">4</span>, <span class="hljs-string">'Wrong length for an int'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'ASN.1 tag wrong'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'length wrong'</span>);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0xa8</span>, <span class="hljs-string">'value wrong (byte 1)'</span>);
  t.equal(ber[<span class="hljs-number">3</span>], <span class="hljs-number">0x80</span>, <span class="hljs-string">'value wrong (byte 2)'</span>);

  t.end();
});


test(<span class="hljs-string">'write 3 byte negative int'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();

  writer.writeInt(<span class="hljs-number">-481653</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, <span class="hljs-number">5</span>, <span class="hljs-string">'Wrong length for an int'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'ASN.1 tag wrong'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">0x03</span>, <span class="hljs-string">'length wrong'</span>);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0xf8</span>, <span class="hljs-string">'value wrong (byte 1)'</span>);
  t.equal(ber[<span class="hljs-number">3</span>], <span class="hljs-number">0xa6</span>, <span class="hljs-string">'value wrong (byte 2)'</span>);
  t.equal(ber[<span class="hljs-number">4</span>], <span class="hljs-number">0x8b</span>, <span class="hljs-string">'value wrong (byte 3)'</span>);

  t.end();
});


test(<span class="hljs-string">'write 4 byte negative int'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();

  writer.writeInt(<span class="hljs-number">-1522904131</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, <span class="hljs-number">6</span>, <span class="hljs-string">'Wrong length for an int'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'ASN.1 tag wrong'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">0x04</span>, <span class="hljs-string">'length wrong'</span>);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0xa5</span>, <span class="hljs-string">'value wrong (byte 1)'</span>);
  t.equal(ber[<span class="hljs-number">3</span>], <span class="hljs-number">0x3a</span>, <span class="hljs-string">'value wrong (byte 2)'</span>);
  t.equal(ber[<span class="hljs-number">4</span>], <span class="hljs-number">0x53</span>, <span class="hljs-string">'value wrong (byte 3)'</span>);
  t.equal(ber[<span class="hljs-number">5</span>], <span class="hljs-number">0xbd</span>, <span class="hljs-string">'value wrong (byte 4)'</span>);

  t.end();
});


test(<span class="hljs-string">'write boolean'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();

  writer.writeBoolean(<span class="hljs-literal">true</span>);
  writer.writeBoolean(<span class="hljs-literal">false</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, <span class="hljs-number">6</span>, <span class="hljs-string">'Wrong length'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x01</span>, <span class="hljs-string">'tag wrong'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">0x01</span>, <span class="hljs-string">'length wrong'</span>);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0xff</span>, <span class="hljs-string">'value wrong'</span>);
  t.equal(ber[<span class="hljs-number">3</span>], <span class="hljs-number">0x01</span>, <span class="hljs-string">'tag wrong'</span>);
  t.equal(ber[<span class="hljs-number">4</span>], <span class="hljs-number">0x01</span>, <span class="hljs-string">'length wrong'</span>);
  t.equal(ber[<span class="hljs-number">5</span>], <span class="hljs-number">0x00</span>, <span class="hljs-string">'value wrong'</span>);

  t.end();
});


test(<span class="hljs-string">'write string'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();
  writer.writeString(<span class="hljs-string">'hello world'</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, <span class="hljs-number">13</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x04</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">11</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber.slice(<span class="hljs-number">2</span>).toString(<span class="hljs-string">'utf8'</span>), <span class="hljs-string">'hello world'</span>, <span class="hljs-string">'wrong value'</span>);

  t.end();
});

test(<span class="hljs-string">'write buffer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>write some stuff to start with</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  writer.writeString(<span class="hljs-string">'hello world'</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;
  <span class="hljs-keyword">var</span> buf = <span class="hljs-keyword">new</span> Buffer([<span class="hljs-number">0x04</span>, <span class="hljs-number">0x0b</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x0f</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x01</span>,
     <span class="hljs-number">0xff</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xff</span>]);
  writer.writeBuffer(buf.slice(<span class="hljs-number">2</span>, buf.length), <span class="hljs-number">0x04</span>);
  ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, <span class="hljs-number">26</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x04</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">11</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber.slice(<span class="hljs-number">2</span>, <span class="hljs-number">13</span>).toString(<span class="hljs-string">'utf8'</span>), <span class="hljs-string">'hello world'</span>, <span class="hljs-string">'wrong value'</span>);
  t.equal(ber[<span class="hljs-number">13</span>], buf[<span class="hljs-number">0</span>], <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">14</span>], buf[<span class="hljs-number">1</span>], <span class="hljs-string">'wrong length'</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">13</span>, j = <span class="hljs-number">0</span>; i &lt; ber.length &amp;&amp; j &lt; buf.length; i++, j++) {
    t.equal(ber[i], buf[j], <span class="hljs-string">'buffer contents not identical'</span>);
  }
  t.end();
});

test(<span class="hljs-string">'write string array'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();
  writer.writeStringArray([<span class="hljs-string">'hello world'</span>, <span class="hljs-string">'fubar!'</span>]);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);

  t.equal(ber.length, <span class="hljs-number">21</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x04</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">11</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber.slice(<span class="hljs-number">2</span>, <span class="hljs-number">13</span>).toString(<span class="hljs-string">'utf8'</span>), <span class="hljs-string">'hello world'</span>, <span class="hljs-string">'wrong value'</span>);

  t.equal(ber[<span class="hljs-number">13</span>], <span class="hljs-number">0x04</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">14</span>], <span class="hljs-number">6</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber.slice(<span class="hljs-number">15</span>).toString(<span class="hljs-string">'utf8'</span>), <span class="hljs-string">'fubar!'</span>, <span class="hljs-string">'wrong value'</span>);

  t.end();
});


test(<span class="hljs-string">'resize internal buffer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter({<span class="hljs-attr">size</span>: <span class="hljs-number">2</span>});
  writer.writeString(<span class="hljs-string">'hello world'</span>);
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, <span class="hljs-number">13</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x04</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">11</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber.slice(<span class="hljs-number">2</span>).toString(<span class="hljs-string">'utf8'</span>), <span class="hljs-string">'hello world'</span>, <span class="hljs-string">'wrong value'</span>);

  t.end();
});


test(<span class="hljs-string">'sequence'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter({<span class="hljs-attr">size</span>: <span class="hljs-number">25</span>});
  writer.startSequence();
  writer.writeString(<span class="hljs-string">'hello world'</span>);
  writer.endSequence();
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);
  <span class="hljs-built_in">console</span>.log(ber);
  t.equal(ber.length, <span class="hljs-number">15</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x30</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">13</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0x04</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">3</span>], <span class="hljs-number">11</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber.slice(<span class="hljs-number">4</span>).toString(<span class="hljs-string">'utf8'</span>), <span class="hljs-string">'hello world'</span>, <span class="hljs-string">'wrong value'</span>);

  t.end();
});


test(<span class="hljs-string">'nested sequence'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter({<span class="hljs-attr">size</span>: <span class="hljs-number">25</span>});
  writer.startSequence();
  writer.writeString(<span class="hljs-string">'hello world'</span>);
  writer.startSequence();
  writer.writeString(<span class="hljs-string">'hello world'</span>);
  writer.endSequence();
  writer.endSequence();
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, <span class="hljs-number">30</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x30</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">28</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0x04</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">3</span>], <span class="hljs-number">11</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber.slice(<span class="hljs-number">4</span>, <span class="hljs-number">15</span>).toString(<span class="hljs-string">'utf8'</span>), <span class="hljs-string">'hello world'</span>, <span class="hljs-string">'wrong value'</span>);
  t.equal(ber[<span class="hljs-number">15</span>], <span class="hljs-number">0x30</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">16</span>], <span class="hljs-number">13</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">17</span>], <span class="hljs-number">0x04</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">18</span>], <span class="hljs-number">11</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber.slice(<span class="hljs-number">19</span>, <span class="hljs-number">30</span>).toString(<span class="hljs-string">'utf8'</span>), <span class="hljs-string">'hello world'</span>, <span class="hljs-string">'wrong value'</span>);

  t.end();
});


test(<span class="hljs-string">'LDAP bind message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> dn = <span class="hljs-string">'cn=foo,ou=unit,o=test'</span>;
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();
  writer.startSequence();
  writer.writeInt(<span class="hljs-number">3</span>);             <span class="hljs-comment">// msgid = 3</span>
  writer.startSequence(<span class="hljs-number">0x60</span>);     <span class="hljs-comment">// ldap bind</span>
  writer.writeInt(<span class="hljs-number">3</span>);             <span class="hljs-comment">// ldap v3</span>
  writer.writeString(dn);
  writer.writeByte(<span class="hljs-number">0x80</span>);
  writer.writeByte(<span class="hljs-number">0x00</span>);
  writer.endSequence();
  writer.endSequence();
  <span class="hljs-keyword">var</span> ber = writer.buffer;

  t.ok(ber);
  t.equal(ber.length, <span class="hljs-number">35</span>, <span class="hljs-string">'wrong length (buffer)'</span>);
  t.equal(ber[<span class="hljs-number">0</span>], <span class="hljs-number">0x30</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">1</span>], <span class="hljs-number">33</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">2</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">3</span>], <span class="hljs-number">1</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">4</span>], <span class="hljs-number">0x03</span>, <span class="hljs-string">'wrong value'</span>);
  t.equal(ber[<span class="hljs-number">5</span>], <span class="hljs-number">0x60</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">6</span>], <span class="hljs-number">28</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">7</span>], <span class="hljs-number">0x02</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">8</span>], <span class="hljs-number">1</span>, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber[<span class="hljs-number">9</span>], <span class="hljs-number">0x03</span>, <span class="hljs-string">'wrong value'</span>);
  t.equal(ber[<span class="hljs-number">10</span>], <span class="hljs-number">0x04</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">11</span>], dn.length, <span class="hljs-string">'wrong length'</span>);
  t.equal(ber.slice(<span class="hljs-number">12</span>, <span class="hljs-number">33</span>).toString(<span class="hljs-string">'utf8'</span>), dn, <span class="hljs-string">'wrong value'</span>);
  t.equal(ber[<span class="hljs-number">33</span>], <span class="hljs-number">0x80</span>, <span class="hljs-string">'wrong tag'</span>);
  t.equal(ber[<span class="hljs-number">34</span>], <span class="hljs-number">0x00</span>, <span class="hljs-string">'wrong len'</span>);

  t.end();
});


test(<span class="hljs-string">'Write OID'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> oid = <span class="hljs-string">'1.2.840.113549.1.1.1'</span>;
  <span class="hljs-keyword">var</span> writer = <span class="hljs-keyword">new</span> BerWriter();
  writer.writeOID(oid);

  <span class="hljs-keyword">var</span> ber = writer.buffer;
  t.ok(ber);
  <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>).inspect(ber));
  <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>).inspect(<span class="hljs-keyword">new</span> Buffer([<span class="hljs-number">0x06</span>, <span class="hljs-number">0x09</span>, <span class="hljs-number">0x2a</span>, <span class="hljs-number">0x86</span>,
                                                  <span class="hljs-number">0x48</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0x0d</span>,
                                                  <span class="hljs-number">0x01</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x01</span>])));

  t.end();
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
