<!DOCTYPE html>
<html>
<head>
  <title>node-pre-gyp.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/node-pre-gyp/lib/node-pre-gyp.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>node-pre-gyp.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module exports.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-built_in">module</span>.exports = exports;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Module dependencies.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">var</span> nopt = <span class="hljs-built_in">require</span>(<span class="hljs-string">'nopt'</span>);
<span class="hljs-keyword">var</span> log = <span class="hljs-built_in">require</span>(<span class="hljs-string">'npmlog'</span>);
<span class="hljs-keyword">var</span> EE = <span class="hljs-built_in">require</span>(<span class="hljs-string">'events'</span>).EventEmitter;
<span class="hljs-keyword">var</span> inherits = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>).inherits;
<span class="hljs-keyword">var</span> commands = [
      <span class="hljs-string">'clean'</span>,
      <span class="hljs-string">'install'</span>,
      <span class="hljs-string">'reinstall'</span>,
      <span class="hljs-string">'build'</span>,
      <span class="hljs-string">'rebuild'</span>,
      <span class="hljs-string">'package'</span>,
      <span class="hljs-string">'testpackage'</span>,
      <span class="hljs-string">'publish'</span>,
      <span class="hljs-string">'unpublish'</span>,
      <span class="hljs-string">'info'</span>,
      <span class="hljs-string">'testbinary'</span>,
      <span class="hljs-string">'reveal'</span>,
      <span class="hljs-string">'configure'</span>
    ];
<span class="hljs-keyword">var</span> aliases = {};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>differentiate node-pre-gyp's logs from npm's</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">log.heading = <span class="hljs-string">'node-pre-gyp'</span>;

exports.find = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./pre-binding'</span>).find;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Run</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;

  <span class="hljs-keyword">this</span>.commands = {};

  commands.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">command</span>) </span>{
    self.commands[command] = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">argv, callback</span>) </span>{
      log.verbose(<span class="hljs-string">'command'</span>, command, argv);
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">'./'</span> + command)(self, argv, callback);
    };
  });
}
inherits(Run, EE);
exports.Run = Run;
<span class="hljs-keyword">var</span> proto = Run.prototype;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<div class="dox">
<div class="summary">
<p>Export the contents of the package.json.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
proto.package = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../package'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<div class="dox">
<div class="summary">
<p>nopt configuration definitions</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
proto.configDefs = {
    <span class="hljs-attr">help</span>: <span class="hljs-built_in">Boolean</span>,     <span class="hljs-comment">// everywhere</span>
    arch: <span class="hljs-built_in">String</span>,      <span class="hljs-comment">// 'configure'</span>
    debug: <span class="hljs-built_in">Boolean</span>,    <span class="hljs-comment">// 'build'</span>
    directory: <span class="hljs-built_in">String</span>, <span class="hljs-comment">// bin</span>
    proxy: <span class="hljs-built_in">String</span>,     <span class="hljs-comment">// 'install'</span>
    loglevel: <span class="hljs-built_in">String</span>,  <span class="hljs-comment">// everywhere</span>
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<div class="dox">
<div class="summary">
<p>nopt shorthands</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
proto.shorthands = {
    <span class="hljs-attr">release</span>: <span class="hljs-string">'--no-debug'</span>,
    <span class="hljs-attr">C</span>: <span class="hljs-string">'--directory'</span>,
    <span class="hljs-attr">debug</span>: <span class="hljs-string">'--debug'</span>,
    <span class="hljs-attr">j</span>: <span class="hljs-string">'--jobs'</span>,
    <span class="hljs-attr">silent</span>: <span class="hljs-string">'--loglevel=silent'</span>,
    <span class="hljs-attr">silly</span>: <span class="hljs-string">'--loglevel=silly'</span>,
    <span class="hljs-attr">verbose</span>: <span class="hljs-string">'--loglevel=verbose'</span>,
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<div class="dox">
<div class="summary">
<p>expose the command aliases for the bin file to use.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
proto.aliases = aliases;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<div class="dox">
<div class="summary">
<p>Parses the given argv array and sets the 'opts',
'argv' and 'command' properties.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
proto.parseArgv = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseOpts</span> (<span class="hljs-params">argv</span>) </span>{
  <span class="hljs-keyword">this</span>.opts = nopt(<span class="hljs-keyword">this</span>.configDefs, <span class="hljs-keyword">this</span>.shorthands, argv);
  <span class="hljs-keyword">this</span>.argv = <span class="hljs-keyword">this</span>.opts.argv.remain.slice();
  <span class="hljs-keyword">var</span> commands = <span class="hljs-keyword">this</span>.todo = [];

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>create a copy of the argv array with aliases mapped</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  argv = <span class="hljs-keyword">this</span>.argv.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>is this an alias?</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (arg <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.aliases) {
      arg = <span class="hljs-keyword">this</span>.aliases[arg];
    }
    <span class="hljs-keyword">return</span> arg;
  }, <span class="hljs-keyword">this</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>process the mapped args into &quot;command&quot; objects (&quot;name&quot; and &quot;args&quot; props)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  argv.slice().forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">arg</span>) </span>{
    <span class="hljs-keyword">if</span> (arg <span class="hljs-keyword">in</span> <span class="hljs-keyword">this</span>.commands) {
      <span class="hljs-keyword">var</span> args = argv.splice(<span class="hljs-number">0</span>, argv.indexOf(arg));
      argv.shift();
      <span class="hljs-keyword">if</span> (commands.length &gt; <span class="hljs-number">0</span>) {
        commands[commands.length - <span class="hljs-number">1</span>].args = args;
      }
      commands.push({ <span class="hljs-attr">name</span>: arg, <span class="hljs-attr">args</span>: [] });
    }
  }, <span class="hljs-keyword">this</span>);
  <span class="hljs-keyword">if</span> (commands.length &gt; <span class="hljs-number">0</span>) {
    commands[commands.length - <span class="hljs-number">1</span>].args = argv.splice(<span class="hljs-number">0</span>);
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>support for inheriting config env variables from npm</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> npm_config_prefix = <span class="hljs-string">'npm_config_'</span>;
  <span class="hljs-built_in">Object</span>.keys(process.env).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">name</span>) </span>{
    <span class="hljs-keyword">if</span> (name.indexOf(npm_config_prefix) !== <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">var</span> val = process.env[name];
    <span class="hljs-keyword">if</span> (name === npm_config_prefix + <span class="hljs-string">'loglevel'</span>) {
      log.level = val;
    } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>add the user-defined options to the config</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      name = name.substring(npm_config_prefix.length);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>avoid npm argv clobber already present args
which avoids problem of 'npm test' calling
script that runs unique npm install commands</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'argv'</span>) {
         <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.opts.argv &amp;&amp;
             <span class="hljs-keyword">this</span>.opts.argv.remain &amp;&amp;
             <span class="hljs-keyword">this</span>.opts.argv.remain.length) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>do nothing</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">         } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">this</span>.opts[name] = val;
         }
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.opts[name] = val;
      }
    }
  }, <span class="hljs-keyword">this</span>);

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.opts.loglevel) {
    log.level = <span class="hljs-keyword">this</span>.opts.loglevel;
  }
  log.resume();
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<div class="dox">
<div class="summary">
<p>Returns the usage instructions for node-pre-gyp.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
proto.usage = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">usage</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> str = [
      <span class="hljs-string">''</span>,
      <span class="hljs-string">'  Usage: node-pre-gyp &lt;command&gt; [options]'</span>,
      <span class="hljs-string">''</span>,
      <span class="hljs-string">'  where &lt;command&gt; is one of:'</span>,
      commands.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">c</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-string">'    - '</span> + c + <span class="hljs-string">' - '</span> + <span class="hljs-built_in">require</span>(<span class="hljs-string">'./'</span> + c).usage;
      }).join(<span class="hljs-string">'\n'</span>),
      <span class="hljs-string">''</span>,
      <span class="hljs-string">'node-pre-gyp@'</span> + <span class="hljs-keyword">this</span>.version + <span class="hljs-string">'  '</span> + path.resolve(__dirname, <span class="hljs-string">'..'</span>),
      <span class="hljs-string">'node@'</span> + process.versions.node
  ].join(<span class="hljs-string">'\n'</span>);
  <span class="hljs-keyword">return</span> str;
};

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<div class="dox">
<div class="summary">
<p>Version number getter.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-built_in">Object</span>.defineProperty(proto, <span class="hljs-string">'version'</span>, {
    <span class="hljs-attr">get</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.package.version;
    },
    <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">true</span>
});


</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
