<!DOCTYPE html>
<html>
<head>
  <title>validate.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/json-schema/lib/validate.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>validate.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>JSONSchema Validator - Validates JavaScript objects using JSON Schemas
	(http://www.json.com/json-schema-proposal/)</p>
<p>Copyright (c) 2007 Kris Zyp SitePen (www.sitepen.com)
Licensed under the MIT (MIT-LICENSE.txt) license.
To use the validator call the validate function with an instance object and an optional schema object.
If a schema is provided, it will be used to validate. If the instance object refers to a schema (self-validating),
that schema will be used to validate and the schema parameter is not necessary (if both exist,
both validations will occur).
The validate method will return an array of validation errors. If there are no errors, then an
empty list will be returned. A validation error will have two properties:
&quot;property&quot; which indicates which property had the error
&quot;message&quot; which indicates what the error was</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">({<span class="hljs-attr">define</span>:<span class="hljs-keyword">typeof</span> define!=<span class="hljs-string">"undefined"</span>?define:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">deps, factory</span>)</span>{<span class="hljs-built_in">module</span>.exports = factory();}}).
define([], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
<span class="hljs-keyword">var</span> exports = validate;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>setup primitive classes to be JSON Schema types</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.Integer = {<span class="hljs-attr">type</span>:<span class="hljs-string">"integer"</span>};
<span class="hljs-keyword">var</span> primitiveConstructors = {
	<span class="hljs-attr">String</span>: <span class="hljs-built_in">String</span>,
	<span class="hljs-attr">Boolean</span>: <span class="hljs-built_in">Boolean</span>,
	<span class="hljs-attr">Number</span>: <span class="hljs-built_in">Number</span>,
	<span class="hljs-attr">Object</span>: <span class="hljs-built_in">Object</span>,
	<span class="hljs-attr">Array</span>: <span class="hljs-built_in">Array</span>,
	<span class="hljs-attr">Date</span>: <span class="hljs-built_in">Date</span>
}
exports.validate = validate;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span>(<span class="hljs-params"><span class="hljs-regexp">/*Any*/i</span>nstance,<span class="hljs-regexp">/*Object*/</span>schema</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Summary:
	To use the validator call JSONSchema.validate with an instance object and an optional schema object.
		If a schema is provided, it will be used to validate. If the instance object refers to a schema (self-validating),
		that schema will be used to validate and the schema parameter is not necessary (if both exist,
		both validations will occur).
		The validate method will return an object with two properties:
			valid: A boolean indicating if the instance is valid by the schema
			errors: An array of validation errors. If there are no errors, then an
					empty list will be returned. A validation error will have two properties:
						property: which indicates which property had the error
						message: which indicates what the error was</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		<span class="hljs-keyword">return</span> validate(instance, schema, {<span class="hljs-attr">changing</span>: <span class="hljs-literal">false</span>});<span class="hljs-comment">//, coerce: false, existingOnly: false});</span>
	};
exports.checkPropertyChange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-regexp">/*Any*/</span>value,<span class="hljs-regexp">/*Object*/</span>schema, <span class="hljs-regexp">/*String*/</span>property</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Summary:
		The checkPropertyChange method will check to see if an value can legally be in property with the given schema
		This is slightly different than the validate method in that it will fail if the schema is readonly and it will
		not check for self-validation, it is assumed that the passed in value is already internally valid.
		The checkPropertyChange method will return the same object type as validate, see JSONSchema.validate for
		information.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		<span class="hljs-keyword">return</span> validate(value, schema, {<span class="hljs-attr">changing</span>: property || <span class="hljs-string">"property"</span>});
	};
<span class="hljs-keyword">var</span> validate = exports._validate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"><span class="hljs-regexp">/*Any*/i</span>nstance,<span class="hljs-regexp">/*Object*/</span>schema,<span class="hljs-regexp">/*Object*/</span>options</span>) </span>{

	<span class="hljs-keyword">if</span> (!options) options = {};
	<span class="hljs-keyword">var</span> _changing = options.changing;

	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getType</span>(<span class="hljs-params">schema</span>)</span>{
		<span class="hljs-keyword">return</span> schema.type || (primitiveConstructors[schema.name] == schema &amp;&amp; schema.name.toLowerCase());
	}
	<span class="hljs-keyword">var</span> errors = [];
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>validate a value against a property definition</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkProp</span>(<span class="hljs-params">value, schema, path,i</span>)</span>{

		<span class="hljs-keyword">var</span> l;
		path += path ? <span class="hljs-keyword">typeof</span> i == <span class="hljs-string">'number'</span> ? <span class="hljs-string">'['</span> + i + <span class="hljs-string">']'</span> : <span class="hljs-keyword">typeof</span> i == <span class="hljs-string">'undefined'</span> ? <span class="hljs-string">''</span> : <span class="hljs-string">'.'</span> + i : i;
		<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addError</span>(<span class="hljs-params">message</span>)</span>{
			errors.push({<span class="hljs-attr">property</span>:path,<span class="hljs-attr">message</span>:message});
		}

		<span class="hljs-keyword">if</span>((<span class="hljs-keyword">typeof</span> schema != <span class="hljs-string">'object'</span> || schema <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) &amp;&amp; (path || <span class="hljs-keyword">typeof</span> schema != <span class="hljs-string">'function'</span>) &amp;&amp; !(schema &amp;&amp; getType(schema))){
			<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> schema == <span class="hljs-string">'function'</span>){
				<span class="hljs-keyword">if</span>(!(value <span class="hljs-keyword">instanceof</span> schema)){
					addError(<span class="hljs-string">"is not an instance of the class/constructor "</span> + schema.name);
				}
			}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(schema){
				addError(<span class="hljs-string">"Invalid schema/property definition "</span> + schema);
			}
			<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
		}
		<span class="hljs-keyword">if</span>(_changing &amp;&amp; schema.readonly){
			addError(<span class="hljs-string">"is a readonly field, it can not be changed"</span>);
		}
		<span class="hljs-keyword">if</span>(schema[<span class="hljs-string">'extends'</span>]){ <span class="hljs-comment">// if it extends another schema, it must pass that schema as well</span>
			checkProp(value,schema[<span class="hljs-string">'extends'</span>],path,i);
		}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>validate a value against a type definition</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">		<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkType</span>(<span class="hljs-params">type,value</span>)</span>{
			<span class="hljs-keyword">if</span>(type){
				<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> type == <span class="hljs-string">'string'</span> &amp;&amp; type != <span class="hljs-string">'any'</span> &amp;&amp;
						(type == <span class="hljs-string">'null'</span> ? value !== <span class="hljs-literal">null</span> : <span class="hljs-keyword">typeof</span> value != type) &amp;&amp;
						!(value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span> &amp;&amp; type == <span class="hljs-string">'array'</span>) &amp;&amp;
						!(value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Date</span> &amp;&amp; type == <span class="hljs-string">'date'</span>) &amp;&amp;
						!(type == <span class="hljs-string">'integer'</span> &amp;&amp; value%<span class="hljs-number">1</span>===<span class="hljs-number">0</span>)){
					<span class="hljs-keyword">return</span> [{<span class="hljs-attr">property</span>:path,<span class="hljs-attr">message</span>:(<span class="hljs-keyword">typeof</span> value) + <span class="hljs-string">" value found, but a "</span> + type + <span class="hljs-string">" is required"</span>}];
				}
				<span class="hljs-keyword">if</span>(type <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>){
					<span class="hljs-keyword">var</span> unionErrors=[];
					<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; type.length; j++){ <span class="hljs-comment">// a union type</span>
						<span class="hljs-keyword">if</span>(!(unionErrors=checkType(type[j],value)).length){
							<span class="hljs-keyword">break</span>;
						}
					}
					<span class="hljs-keyword">if</span>(unionErrors.length){
						<span class="hljs-keyword">return</span> unionErrors;
					}
				}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> type == <span class="hljs-string">'object'</span>){
					<span class="hljs-keyword">var</span> priorErrors = errors;
					errors = [];
					checkProp(value,type,path);
					<span class="hljs-keyword">var</span> theseErrors = errors;
					errors = priorErrors;
					<span class="hljs-keyword">return</span> theseErrors;
				}
			}
			<span class="hljs-keyword">return</span> [];
		}
		<span class="hljs-keyword">if</span>(value === <span class="hljs-literal">undefined</span>){
			<span class="hljs-keyword">if</span>(schema.required){
				addError(<span class="hljs-string">"is missing and it is required"</span>);
			}
		}<span class="hljs-keyword">else</span>{
			errors = errors.concat(checkType(getType(schema),value));
			<span class="hljs-keyword">if</span>(schema.disallow &amp;&amp; !checkType(schema.disallow,value).length){
				addError(<span class="hljs-string">" disallowed value was matched"</span>);
			}
			<span class="hljs-keyword">if</span>(value !== <span class="hljs-literal">null</span>){
				<span class="hljs-keyword">if</span>(value <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>){
					<span class="hljs-keyword">if</span>(schema.items){
						<span class="hljs-keyword">var</span> itemsIsArray = schema.items <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>;
						<span class="hljs-keyword">var</span> propDef = schema.items;
						<span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>, l = value.length; i &lt; l; i += <span class="hljs-number">1</span>) {
							<span class="hljs-keyword">if</span> (itemsIsArray)
								propDef = schema.items[i];
							<span class="hljs-keyword">if</span> (options.coerce)
								value[i] = options.coerce(value[i], propDef);
							errors.concat(checkProp(value[i],propDef,path,i));
						}
					}
					<span class="hljs-keyword">if</span>(schema.minItems &amp;&amp; value.length &lt; schema.minItems){
						addError(<span class="hljs-string">"There must be a minimum of "</span> + schema.minItems + <span class="hljs-string">" in the array"</span>);
					}
					<span class="hljs-keyword">if</span>(schema.maxItems &amp;&amp; value.length &gt; schema.maxItems){
						addError(<span class="hljs-string">"There must be a maximum of "</span> + schema.maxItems + <span class="hljs-string">" in the array"</span>);
					}
				}<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(schema.properties || schema.additionalProperties){
					errors.concat(checkObj(value, schema.properties, path, schema.additionalProperties));
				}
				<span class="hljs-keyword">if</span>(schema.pattern &amp;&amp; <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">'string'</span> &amp;&amp; !value.match(schema.pattern)){
					addError(<span class="hljs-string">"does not match the regex pattern "</span> + schema.pattern);
				}
				<span class="hljs-keyword">if</span>(schema.maxLength &amp;&amp; <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">'string'</span> &amp;&amp; value.length &gt; schema.maxLength){
					addError(<span class="hljs-string">"may only be "</span> + schema.maxLength + <span class="hljs-string">" characters long"</span>);
				}
				<span class="hljs-keyword">if</span>(schema.minLength &amp;&amp; <span class="hljs-keyword">typeof</span> value == <span class="hljs-string">'string'</span> &amp;&amp; value.length &lt; schema.minLength){
					addError(<span class="hljs-string">"must be at least "</span> + schema.minLength + <span class="hljs-string">" characters long"</span>);
				}
				<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> schema.minimum !== <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-keyword">typeof</span> value == <span class="hljs-keyword">typeof</span> schema.minimum &amp;&amp;
						schema.minimum &gt; value){
					addError(<span class="hljs-string">"must have a minimum value of "</span> + schema.minimum);
				}
				<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> schema.maximum !== <span class="hljs-literal">undefined</span> &amp;&amp; <span class="hljs-keyword">typeof</span> value == <span class="hljs-keyword">typeof</span> schema.maximum &amp;&amp;
						schema.maximum &lt; value){
					addError(<span class="hljs-string">"must have a maximum value of "</span> + schema.maximum);
				}
				<span class="hljs-keyword">if</span>(schema[<span class="hljs-string">'enum'</span>]){
					<span class="hljs-keyword">var</span> enumer = schema[<span class="hljs-string">'enum'</span>];
					l = enumer.length;
					<span class="hljs-keyword">var</span> found;
					<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; l; j++){
						<span class="hljs-keyword">if</span>(enumer[j]===value){
							found=<span class="hljs-number">1</span>;
							<span class="hljs-keyword">break</span>;
						}
					}
					<span class="hljs-keyword">if</span>(!found){
						addError(<span class="hljs-string">"does not have a value in the enumeration "</span> + enumer.join(<span class="hljs-string">", "</span>));
					}
				}
				<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> schema.maxDecimal == <span class="hljs-string">'number'</span> &amp;&amp;
					(value.toString().match(<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">"\\.[0-9]{"</span> + (schema.maxDecimal + <span class="hljs-number">1</span>) + <span class="hljs-string">",}"</span>)))){
					addError(<span class="hljs-string">"may only have "</span> + schema.maxDecimal + <span class="hljs-string">" digits of decimal places"</span>);
				}
			}
		}
		<span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
	}
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>validate an object against a schema</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkObj</span>(<span class="hljs-params">instance,objTypeDef,path,additionalProp</span>)</span>{

		<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> objTypeDef ==<span class="hljs-string">'object'</span>){
			<span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> instance != <span class="hljs-string">'object'</span> || instance <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>){
				errors.push({<span class="hljs-attr">property</span>:path,<span class="hljs-attr">message</span>:<span class="hljs-string">"an object is required"</span>});
			}
			
			<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> objTypeDef){ 
				<span class="hljs-keyword">if</span>(objTypeDef.hasOwnProperty(i)){
					<span class="hljs-keyword">var</span> value = instance[i];
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>skip <em>not</em> specified properties</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">					<span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span> &amp;&amp; options.existingOnly) <span class="hljs-keyword">continue</span>;
					<span class="hljs-keyword">var</span> propDef = objTypeDef[i];
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>set default</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">					<span class="hljs-keyword">if</span>(value === <span class="hljs-literal">undefined</span> &amp;&amp; propDef[<span class="hljs-string">"default"</span>]){
						value = instance[i] = propDef[<span class="hljs-string">"default"</span>];
					}
					<span class="hljs-keyword">if</span>(options.coerce &amp;&amp; i <span class="hljs-keyword">in</span> instance){
						value = instance[i] = options.coerce(value, propDef);
					}
					checkProp(value,propDef,path,i);
				}
			}
		}
		<span class="hljs-keyword">for</span>(i <span class="hljs-keyword">in</span> instance){
			<span class="hljs-keyword">if</span>(instance.hasOwnProperty(i) &amp;&amp; !(i.charAt(<span class="hljs-number">0</span>) == <span class="hljs-string">'_'</span> &amp;&amp; i.charAt(<span class="hljs-number">1</span>) == <span class="hljs-string">'_'</span>) &amp;&amp; objTypeDef &amp;&amp; !objTypeDef[i] &amp;&amp; additionalProp===<span class="hljs-literal">false</span>){
				<span class="hljs-keyword">if</span> (options.filter) {
					<span class="hljs-keyword">delete</span> instance[i];
					<span class="hljs-keyword">continue</span>;
				} <span class="hljs-keyword">else</span> {
					errors.push({<span class="hljs-attr">property</span>:path,<span class="hljs-attr">message</span>:(<span class="hljs-keyword">typeof</span> value) + <span class="hljs-string">"The property "</span> + i +
						<span class="hljs-string">" is not defined in the schema and the schema does not allow additional properties"</span>});
				}
			}
			<span class="hljs-keyword">var</span> requires = objTypeDef &amp;&amp; objTypeDef[i] &amp;&amp; objTypeDef[i].requires;
			<span class="hljs-keyword">if</span>(requires &amp;&amp; !(requires <span class="hljs-keyword">in</span> instance)){
				errors.push({<span class="hljs-attr">property</span>:path,<span class="hljs-attr">message</span>:<span class="hljs-string">"the presence of the property "</span> + i + <span class="hljs-string">" requires that "</span> + requires + <span class="hljs-string">" also be present"</span>});
			}
			value = instance[i];
			<span class="hljs-keyword">if</span>(additionalProp &amp;&amp; (!(objTypeDef &amp;&amp; <span class="hljs-keyword">typeof</span> objTypeDef == <span class="hljs-string">'object'</span>) || !(i <span class="hljs-keyword">in</span> objTypeDef))){
				<span class="hljs-keyword">if</span>(options.coerce){
					value = instance[i] = options.coerce(value, additionalProp);
				}
				checkProp(value,additionalProp,path,i);
			}
			<span class="hljs-keyword">if</span>(!_changing &amp;&amp; value &amp;&amp; value.$schema){
				errors = errors.concat(checkProp(value,value.$schema,path,i));
			}
		}
		<span class="hljs-keyword">return</span> errors;
	}
	<span class="hljs-keyword">if</span>(schema){
		checkProp(instance,schema,<span class="hljs-string">''</span>,_changing || <span class="hljs-string">''</span>);
	}
	<span class="hljs-keyword">if</span>(!_changing &amp;&amp; instance &amp;&amp; instance.$schema){
		checkProp(instance,instance.$schema,<span class="hljs-string">''</span>,<span class="hljs-string">''</span>);
	}
	<span class="hljs-keyword">return</span> {<span class="hljs-attr">valid</span>:!errors.length,<span class="hljs-attr">errors</span>:errors};
};
exports.mustBeValid = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>)</span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>summary:
	This checks to ensure that the result is valid and will throw an appropriate error message if it is not
result: the result returned from checkPropertyChange or validate</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">	<span class="hljs-keyword">if</span>(!result.valid){
		<span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TypeError</span>(result.errors.map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>)</span>{<span class="hljs-keyword">return</span> <span class="hljs-string">"for property "</span> + error.property + <span class="hljs-string">': '</span> + error.message;}).join(<span class="hljs-string">", \n"</span>));
	}
}

<span class="hljs-keyword">return</span> exports;
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
