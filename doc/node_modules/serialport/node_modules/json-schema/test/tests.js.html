<!DOCTYPE html>
<html>
<head>
  <title>tests.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/json-schema/test/tests.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>tests.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'assert'</span>);
<span class="hljs-keyword">var</span> vows = <span class="hljs-built_in">require</span>(<span class="hljs-string">'vows'</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">'path'</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-keyword">var</span> validate = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/validate'</span>).validate;


<span class="hljs-keyword">var</span> revision = <span class="hljs-string">'draft-03'</span>;
<span class="hljs-keyword">var</span> schemaRoot = path.join(__dirname, <span class="hljs-string">'..'</span>, revision);
<span class="hljs-keyword">var</span> schemaNames = [<span class="hljs-string">'schema'</span>, <span class="hljs-string">'hyper-schema'</span>, <span class="hljs-string">'links'</span>, <span class="hljs-string">'json-ref'</span> ];
<span class="hljs-keyword">var</span> schemas = {};

schemaNames.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
    <span class="hljs-keyword">var</span> file = path.join(schemaRoot, name);
    schemas[name] = loadSchema(file);
});

schemaNames.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name</span>) </span>{
    <span class="hljs-keyword">var</span> s, n = name+<span class="hljs-string">'-nsd'</span>, f = path.join(schemaRoot, name);
    schemas[n] = loadSchema(f);
    s = schemas[n];
    <span class="hljs-keyword">delete</span> s[<span class="hljs-string">'$schema'</span>];
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadSchema</span>(<span class="hljs-params">path</span>) </span>{
    <span class="hljs-keyword">var</span> data = fs.readFileSync(path, <span class="hljs-string">'utf-8'</span>);
    <span class="hljs-keyword">var</span> schema = <span class="hljs-built_in">JSON</span>.parse(data);
    <span class="hljs-keyword">return</span> schema;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resultIsValid</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
        assert.isObject(result);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>assert.isBoolean(result.valid);</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        assert.equal(<span class="hljs-keyword">typeof</span>(result.valid), <span class="hljs-string">'boolean'</span>);
        assert.isArray(result.errors);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; result.errors.length; i++) {
            assert.notEqual(result.errors[i], <span class="hljs-literal">null</span>, <span class="hljs-string">'errors['</span>+i+<span class="hljs-string">'] is null'</span>);
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertValidates</span>(<span class="hljs-params">doc, schema</span>) </span>{
    <span class="hljs-keyword">var</span> context = {};

    context[<span class="hljs-string">': validate('</span>+doc+<span class="hljs-string">', '</span>+schema+<span class="hljs-string">')'</span>] = {
        <span class="hljs-attr">topic</span>: validate(schemas[doc], schemas[schema]),
        <span class="hljs-string">'returns valid result'</span>: resultIsValid(),
        <span class="hljs-string">'with valid=true'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{ assert.equal(result.valid, <span class="hljs-literal">true</span>); },
        <span class="hljs-string">'and no errors'</span>:   <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>XXX work-around for bug in vows: [null] chokes it</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (result.errors[<span class="hljs-number">0</span>] == <span class="hljs-literal">null</span>) assert.fail(<span class="hljs-string">'(errors contains null)'</span>);
            assert.length(result.errors, <span class="hljs-number">0</span>);
        }
    };

    <span class="hljs-keyword">return</span> context;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">assertSelfValidates</span>(<span class="hljs-params">doc</span>) </span>{
    <span class="hljs-keyword">var</span> context = {};

    context[<span class="hljs-string">': validate('</span>+doc+<span class="hljs-string">')'</span>] = {
        <span class="hljs-attr">topic</span>: validate(schemas[doc]),
        <span class="hljs-string">'returns valid result'</span>: resultIsValid(),
        <span class="hljs-string">'with valid=true'</span>: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{ assert.equal(result.valid, <span class="hljs-literal">true</span>); },
        <span class="hljs-string">'and no errors'</span>:   <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">result</span>) </span>{ assert.length(result.errors, <span class="hljs-number">0</span>); }
    };

    <span class="hljs-keyword">return</span> context;
}

<span class="hljs-keyword">var</span> suite = vows.describe(<span class="hljs-string">'JSON Schema'</span>).addBatch({
    <span class="hljs-string">'Core-NSD self-validates'</span>: assertSelfValidates(<span class="hljs-string">'schema-nsd'</span>),
    <span class="hljs-string">'Core-NSD/Core-NSD'</span>: assertValidates(<span class="hljs-string">'schema-nsd'</span>, <span class="hljs-string">'schema-nsd'</span>),
    <span class="hljs-string">'Core-NSD/Core'</span>: assertValidates(<span class="hljs-string">'schema-nsd'</span>, <span class="hljs-string">'schema'</span>),

    <span class="hljs-string">'Core self-validates'</span>: assertSelfValidates(<span class="hljs-string">'schema'</span>),
    <span class="hljs-string">'Core/Core'</span>: assertValidates(<span class="hljs-string">'schema'</span>, <span class="hljs-string">'schema'</span>),

    <span class="hljs-string">'Hyper-NSD self-validates'</span>: assertSelfValidates(<span class="hljs-string">'hyper-schema-nsd'</span>),
    <span class="hljs-string">'Hyper self-validates'</span>: assertSelfValidates(<span class="hljs-string">'hyper-schema'</span>),
    <span class="hljs-string">'Hyper/Hyper'</span>: assertValidates(<span class="hljs-string">'hyper-schema'</span>, <span class="hljs-string">'hyper-schema'</span>),
    <span class="hljs-string">'Hyper/Core'</span>: assertValidates(<span class="hljs-string">'hyper-schema'</span>, <span class="hljs-string">'schema'</span>),

    <span class="hljs-string">'Links-NSD self-validates'</span>: assertSelfValidates(<span class="hljs-string">'links-nsd'</span>),
    <span class="hljs-string">'Links self-validates'</span>: assertSelfValidates(<span class="hljs-string">'links'</span>),
    <span class="hljs-string">'Links/Hyper'</span>: assertValidates(<span class="hljs-string">'links'</span>, <span class="hljs-string">'hyper-schema'</span>),
    <span class="hljs-string">'Links/Core'</span>: assertValidates(<span class="hljs-string">'links'</span>, <span class="hljs-string">'schema'</span>),

    <span class="hljs-string">'Json-Ref self-validates'</span>: assertSelfValidates(<span class="hljs-string">'json-ref'</span>),
    <span class="hljs-string">'Json-Ref/Hyper'</span>: assertValidates(<span class="hljs-string">'json-ref'</span>, <span class="hljs-string">'hyper-schema'</span>),
    <span class="hljs-string">'Json-Ref/Core'</span>: assertValidates(<span class="hljs-string">'json-ref'</span>, <span class="hljs-string">'schema'</span>)
}).export(<span class="hljs-built_in">module</span>);

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
