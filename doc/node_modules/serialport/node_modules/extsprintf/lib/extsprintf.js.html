<!DOCTYPE html>
<html>
<head>
  <title>extsprintf.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/extsprintf/lib/extsprintf.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>extsprintf.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>extsprintf.js: extended POSIX-style sprintf</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> mod_assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'assert'</span>);
<span class="hljs-keyword">var</span> mod_util = <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Public interface</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">exports.sprintf = jsSprintf;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Stripped down version of s[n]printf(3c).  We make a best effort to throw an
exception when given a format string we don't understand, rather than
ignoring it, so that we won't break existing programs if/when we go implement
the rest of this.</p>
</div>
<div class="body">
<p>This implementation currently supports specifying
	- field alignment ('-' flag),
	- zero-pad ('0' flag)
	- always show numeric sign ('+' flag),
	- field width
	- conversions for strings, decimal integers, and floats (numbers).
	- argument size specifiers.  These are all accepted but ignored, since
	  Javascript has no notion of the physical size of an argument.</p>
<p>Everything else is currently unsupported, most notably precision, unsigned
numbers, non-decimal numbers, and characters.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">jsSprintf</span>(<span class="hljs-params">fmt</span>)
</span>{
	<span class="hljs-keyword">var</span> regex = [
	    <span class="hljs-string">'([^%]*)'</span>,				<span class="hljs-comment">/* normal text */</span>
	    <span class="hljs-string">'%'</span>,				<span class="hljs-comment">/* start of format */</span>
	    <span class="hljs-string">'([\'\\-+ #0]*?)'</span>,			<span class="hljs-comment">/* flags (optional) */</span>
	    <span class="hljs-string">'([1-9]\\d*)?'</span>,			<span class="hljs-comment">/* width (optional) */</span>
	    <span class="hljs-string">'(\\.([1-9]\\d*))?'</span>,		<span class="hljs-comment">/* precision (optional) */</span>
	    <span class="hljs-string">'[lhjztL]*?'</span>,			<span class="hljs-comment">/* length mods (ignored) */</span>
	    <span class="hljs-string">'([diouxXfFeEgGaAcCsSp%jr])'</span>	<span class="hljs-comment">/* conversion */</span>
	].join(<span class="hljs-string">''</span>);

	<span class="hljs-keyword">var</span> re = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(regex);
	<span class="hljs-keyword">var</span> args = <span class="hljs-built_in">Array</span>.prototype.slice.call(<span class="hljs-built_in">arguments</span>, <span class="hljs-number">1</span>);
	<span class="hljs-keyword">var</span> flags, width, precision, conversion;
	<span class="hljs-keyword">var</span> left, pad, sign, arg, match;
	<span class="hljs-keyword">var</span> ret = <span class="hljs-string">''</span>;
	<span class="hljs-keyword">var</span> argn = <span class="hljs-number">1</span>;

	mod_assert.equal(<span class="hljs-string">'string'</span>, <span class="hljs-keyword">typeof</span> (fmt));

	<span class="hljs-keyword">while</span> ((match = re.exec(fmt)) !== <span class="hljs-literal">null</span>) {
		ret += match[<span class="hljs-number">1</span>];
		fmt = fmt.substring(match[<span class="hljs-number">0</span>].length);

		flags = match[<span class="hljs-number">2</span>] || <span class="hljs-string">''</span>;
		width = match[<span class="hljs-number">3</span>] || <span class="hljs-number">0</span>;
		precision = match[<span class="hljs-number">4</span>] || <span class="hljs-string">''</span>;
		conversion = match[<span class="hljs-number">6</span>];
		left = <span class="hljs-literal">false</span>;
		sign = <span class="hljs-literal">false</span>;
		pad = <span class="hljs-string">' '</span>;

		<span class="hljs-keyword">if</span> (conversion == <span class="hljs-string">'%'</span>) {
			ret += <span class="hljs-string">'%'</span>;
			<span class="hljs-keyword">continue</span>;
		}

		<span class="hljs-keyword">if</span> (args.length === <span class="hljs-number">0</span>)
			<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'too few args to sprintf'</span>));

		arg = args.shift();
		argn++;

		<span class="hljs-keyword">if</span> (flags.match(<span class="hljs-regexp">/[\' #]/</span>))
			<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
			    <span class="hljs-string">'unsupported flags: '</span> + flags));

		<span class="hljs-keyword">if</span> (precision.length &gt; <span class="hljs-number">0</span>)
			<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(
			    <span class="hljs-string">'non-zero precision not supported'</span>));

		<span class="hljs-keyword">if</span> (flags.match(<span class="hljs-regexp">/-/</span>))
			left = <span class="hljs-literal">true</span>;

		<span class="hljs-keyword">if</span> (flags.match(<span class="hljs-regexp">/0/</span>))
			pad = <span class="hljs-string">'0'</span>;

		<span class="hljs-keyword">if</span> (flags.match(<span class="hljs-regexp">/\+/</span>))
			sign = <span class="hljs-literal">true</span>;

		<span class="hljs-keyword">switch</span> (conversion) {
		<span class="hljs-keyword">case</span> <span class="hljs-string">'s'</span>:
			<span class="hljs-keyword">if</span> (arg === <span class="hljs-literal">undefined</span> || arg === <span class="hljs-literal">null</span>)
				<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'argument '</span> + argn +
				    <span class="hljs-string">': attempted to print undefined or null '</span> +
				    <span class="hljs-string">'as a string'</span>));
			ret += doPad(pad, width, left, arg.toString());
			<span class="hljs-keyword">break</span>;

		<span class="hljs-keyword">case</span> <span class="hljs-string">'d'</span>:
			arg = <span class="hljs-built_in">Math</span>.floor(arg);
			<span class="hljs-comment">/*jsl:fallthru*/</span>
		<span class="hljs-keyword">case</span> <span class="hljs-string">'f'</span>:
			sign = sign &amp;&amp; arg &gt; <span class="hljs-number">0</span> ? <span class="hljs-string">'+'</span> : <span class="hljs-string">''</span>;
			ret += sign + doPad(pad, width, left,
			    arg.toString());
			<span class="hljs-keyword">break</span>;

		<span class="hljs-keyword">case</span> <span class="hljs-string">'j'</span>: <span class="hljs-comment">/* non-standard */</span>
			<span class="hljs-keyword">if</span> (width === <span class="hljs-number">0</span>)
				width = <span class="hljs-number">10</span>;
			ret += mod_util.inspect(arg, <span class="hljs-literal">false</span>, width);
			<span class="hljs-keyword">break</span>;

		<span class="hljs-keyword">case</span> <span class="hljs-string">'r'</span>: <span class="hljs-comment">/* non-standard */</span>
			ret += dumpException(arg);
			<span class="hljs-keyword">break</span>;

		<span class="hljs-keyword">default</span>:
			<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'unsupported conversion: '</span> +
			    conversion));
		}
	}

	ret += fmt;
	<span class="hljs-keyword">return</span> (ret);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doPad</span>(<span class="hljs-params">chr, width, left, str</span>)
</span>{
	<span class="hljs-keyword">var</span> ret = str;

	<span class="hljs-keyword">while</span> (ret.length &lt; width) {
		<span class="hljs-keyword">if</span> (left)
			ret += chr;
		<span class="hljs-keyword">else</span>
			ret = chr + ret;
	}

	<span class="hljs-keyword">return</span> (ret);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>This function dumps long stack traces for exceptions having a cause() method.
See node-verror for an example.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dumpException</span>(<span class="hljs-params">ex</span>)
</span>{
	<span class="hljs-keyword">var</span> ret;

	<span class="hljs-keyword">if</span> (!(ex <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>))
		<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(jsSprintf(<span class="hljs-string">'invalid type for %%r: %j'</span>, ex)));

	<span class="hljs-comment">/* Note that V8 prepends "ex.stack" with ex.toString(). */</span>
	ret = <span class="hljs-string">'EXCEPTION: '</span> + ex.constructor.name + <span class="hljs-string">': '</span> + ex.stack;

	<span class="hljs-keyword">if</span> (ex.cause &amp;&amp; <span class="hljs-keyword">typeof</span> (ex.cause) === <span class="hljs-string">'function'</span>) {
		<span class="hljs-keyword">var</span> cex = ex.cause();
		<span class="hljs-keyword">if</span> (cex) {
			ret += <span class="hljs-string">'\nCaused by: '</span> + dumpException(cex);
		}
	}

	<span class="hljs-keyword">return</span> (ret);
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
