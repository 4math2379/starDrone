<!DOCTYPE html>
<html>
<head>
  <title>tst.werror.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/verror/tests/tst.werror.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>tst.werror.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>tst.werror.js: tests basic functionality of the WError class.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> mod_assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'assert'</span>);
<span class="hljs-keyword">var</span> mod_verror = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib/verror'</span>);

<span class="hljs-keyword">var</span> VError = mod_verror.VError;
<span class="hljs-keyword">var</span> WError = mod_verror.WError;

<span class="hljs-keyword">var</span> err, suberr, stack, substack;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<div class="dox">
<div class="summary">
<p>Remove full paths and relative line numbers from stack traces so that we can
compare against &quot;known-good&quot; output.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanStack</span>(<span class="hljs-params">stacktxt</span>)
</span>{
	<span class="hljs-keyword">var</span> re = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(__filename + <span class="hljs-string">':\\d+:\\d+'</span>, <span class="hljs-string">'gm'</span>);
	stacktxt = stacktxt.replace(re, <span class="hljs-string">'tst.werror.js'</span>);
	<span class="hljs-keyword">return</span> (stacktxt);
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<div class="dox">
<div class="summary">
<p>Save the generic parts of all stack traces so we can avoid hardcoding
Node-specific implementation details in our testing of stack traces.</p>
</div>
<div class="body">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> nodestack = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>().stack.split(<span class="hljs-string">'\n'</span>).slice(<span class="hljs-number">2</span>).join(<span class="hljs-string">'\n'</span>);

<span class="hljs-comment">/* no arguments */</span>
err = <span class="hljs-keyword">new</span> WError();
mod_assert.equal(err.name, <span class="hljs-string">'WError'</span>);
mod_assert.ok(err <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>);
mod_assert.ok(err <span class="hljs-keyword">instanceof</span> WError);
mod_assert.equal(err.message, <span class="hljs-string">''</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError'</span>);
mod_assert.ok(err.cause() === <span class="hljs-literal">undefined</span>);
stack = cleanStack(err.stack);
mod_assert.equal(stack, [
    <span class="hljs-string">'WError'</span>,
    <span class="hljs-string">'    at Object.&lt;anonymous&gt; (tst.werror.js)'</span>
].join(<span class="hljs-string">'\n'</span>) + <span class="hljs-string">'\n'</span> + nodestack);

<span class="hljs-comment">/* options-argument form */</span>
err = <span class="hljs-keyword">new</span> WError({});
mod_assert.equal(err.message, <span class="hljs-string">''</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError'</span>);
mod_assert.ok(err.cause() === <span class="hljs-literal">undefined</span>);

<span class="hljs-comment">/* simple message */</span>
err = <span class="hljs-keyword">new</span> WError(<span class="hljs-string">'my error'</span>);
mod_assert.equal(err.message, <span class="hljs-string">'my error'</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: my error'</span>);
mod_assert.ok(err.cause() === <span class="hljs-literal">undefined</span>);
stack = cleanStack(err.stack);
mod_assert.equal(stack, [
    <span class="hljs-string">'WError: my error'</span>,
    <span class="hljs-string">'    at Object.&lt;anonymous&gt; (tst.werror.js)'</span>
].join(<span class="hljs-string">'\n'</span>) + <span class="hljs-string">'\n'</span> + nodestack);

err = <span class="hljs-keyword">new</span> WError({}, <span class="hljs-string">'my error'</span>);
mod_assert.equal(err.message, <span class="hljs-string">'my error'</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: my error'</span>);
mod_assert.ok(err.cause() === <span class="hljs-literal">undefined</span>);

<span class="hljs-comment">/* printf-style message */</span>
err = <span class="hljs-keyword">new</span> WError(<span class="hljs-string">'%s error: %3d problems'</span>, <span class="hljs-string">'very bad'</span>, <span class="hljs-number">15</span>);
mod_assert.equal(err.message, <span class="hljs-string">'very bad error:  15 problems'</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: very bad error:  15 problems'</span>);
mod_assert.ok(err.cause() === <span class="hljs-literal">undefined</span>);

err = <span class="hljs-keyword">new</span> WError({}, <span class="hljs-string">'%s error: %3d problems'</span>, <span class="hljs-string">'very bad'</span>, <span class="hljs-number">15</span>);
mod_assert.equal(err.message, <span class="hljs-string">'very bad error:  15 problems'</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: very bad error:  15 problems'</span>);
mod_assert.ok(err.cause() === <span class="hljs-literal">undefined</span>);

<span class="hljs-comment">/* caused by another error, with no additional message */</span>
suberr = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'root cause'</span>);
err = <span class="hljs-keyword">new</span> WError(suberr);
mod_assert.equal(err.message, <span class="hljs-string">''</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError; caused by Error: root cause'</span>);
mod_assert.ok(err.cause() === suberr);

err = <span class="hljs-keyword">new</span> WError({ <span class="hljs-string">'cause'</span>: suberr });
mod_assert.equal(err.message, <span class="hljs-string">''</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError; caused by Error: root cause'</span>);
mod_assert.ok(err.cause() === suberr);

<span class="hljs-comment">/* caused by another error, with annotation */</span>
err = <span class="hljs-keyword">new</span> WError(suberr, <span class="hljs-string">'proximate cause: %d issues'</span>, <span class="hljs-number">3</span>);
mod_assert.equal(err.message, <span class="hljs-string">'proximate cause: 3 issues'</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: proximate cause: 3 issues; '</span> +
    <span class="hljs-string">'caused by Error: root cause'</span>);
mod_assert.ok(err.cause() === suberr);
stack = cleanStack(err.stack);
mod_assert.equal(stack, [
    <span class="hljs-string">'WError: proximate cause: 3 issues; caused by Error: root cause'</span>,
    <span class="hljs-string">'    at Object.&lt;anonymous&gt; (tst.werror.js)'</span>
].join(<span class="hljs-string">'\n'</span>) + <span class="hljs-string">'\n'</span> + nodestack);

err = <span class="hljs-keyword">new</span> WError({ <span class="hljs-string">'cause'</span>: suberr }, <span class="hljs-string">'proximate cause: %d issues'</span>, <span class="hljs-number">3</span>);
mod_assert.equal(err.message, <span class="hljs-string">'proximate cause: 3 issues'</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: proximate cause: 3 issues; '</span> +
    <span class="hljs-string">'caused by Error: root cause'</span>);
mod_assert.ok(err.cause() === suberr);
stack = cleanStack(err.stack);
mod_assert.equal(stack, [
    <span class="hljs-string">'WError: proximate cause: 3 issues; caused by Error: root cause'</span>,
    <span class="hljs-string">'    at Object.&lt;anonymous&gt; (tst.werror.js)'</span>
].join(<span class="hljs-string">'\n'</span>) + <span class="hljs-string">'\n'</span> + nodestack);

<span class="hljs-comment">/* caused by another WError, with annotation. */</span>
suberr = err;
err = <span class="hljs-keyword">new</span> WError(suberr, <span class="hljs-string">'top'</span>);
mod_assert.equal(err.message, <span class="hljs-string">'top'</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: top; caused by WError: '</span> +
    <span class="hljs-string">'proximate cause: 3 issues; caused by Error: root cause'</span>);
mod_assert.ok(err.cause() === suberr);

err = <span class="hljs-keyword">new</span> WError({ <span class="hljs-string">'cause'</span>: suberr }, <span class="hljs-string">'top'</span>);
mod_assert.equal(err.message, <span class="hljs-string">'top'</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: top; caused by WError: '</span> +
    <span class="hljs-string">'proximate cause: 3 issues; caused by Error: root cause'</span>);
mod_assert.ok(err.cause() === suberr);

<span class="hljs-comment">/* caused by a VError */</span>
suberr = <span class="hljs-keyword">new</span> VError(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'root cause'</span>), <span class="hljs-string">'mid'</span>);
err = <span class="hljs-keyword">new</span> WError(suberr, <span class="hljs-string">'top'</span>);
mod_assert.equal(err.message, <span class="hljs-string">'top'</span>);
mod_assert.equal(err.toString(),
    <span class="hljs-string">'WError: top; caused by VError: mid: root cause'</span>);
mod_assert.ok(err.cause() === suberr);

<span class="hljs-comment">/* null cause (for backwards compatibility with older versions) */</span>
err = <span class="hljs-keyword">new</span> WError(<span class="hljs-literal">null</span>, <span class="hljs-string">'my error'</span>);
mod_assert.equal(err.message, <span class="hljs-string">'my error'</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: my error'</span>);
mod_assert.ok(err.cause() === <span class="hljs-literal">undefined</span>);
stack = cleanStack(err.stack);
mod_assert.equal(stack, [
    <span class="hljs-string">'WError: my error'</span>,
    <span class="hljs-string">'    at Object.&lt;anonymous&gt; (tst.werror.js)'</span>
].join(<span class="hljs-string">'\n'</span>) + <span class="hljs-string">'\n'</span> + nodestack);

err = <span class="hljs-keyword">new</span> WError({ <span class="hljs-string">'cause'</span>: <span class="hljs-literal">null</span> }, <span class="hljs-string">'my error'</span>);
mod_assert.equal(err.message, <span class="hljs-string">'my error'</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: my error'</span>);
mod_assert.ok(err.cause() === <span class="hljs-literal">undefined</span>);

err = <span class="hljs-keyword">new</span> WError(<span class="hljs-literal">null</span>);
mod_assert.equal(err.message, <span class="hljs-string">''</span>);
mod_assert.equal(err.toString(), <span class="hljs-string">'WError'</span>);
mod_assert.ok(err.cause() === <span class="hljs-literal">undefined</span>);
stack = cleanStack(err.stack);
mod_assert.equal(stack, [
    <span class="hljs-string">'WError'</span>,
    <span class="hljs-string">'    at Object.&lt;anonymous&gt; (tst.werror.js)'</span>
].join(<span class="hljs-string">'\n'</span>) + <span class="hljs-string">'\n'</span> + nodestack);

<span class="hljs-comment">/* constructorOpt */</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeErr</span>(<span class="hljs-params">options</span>) </span>{
	<span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> WError(options, <span class="hljs-string">'test error'</span>));
}
err = makeErr({});
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: test error'</span>);
stack = cleanStack(err.stack);
mod_assert.equal(stack, [
    <span class="hljs-string">'WError: test error'</span>,
    <span class="hljs-string">'    at makeErr (tst.werror.js)'</span>,
    <span class="hljs-string">'    at Object.&lt;anonymous&gt; (tst.werror.js)'</span>
].join(<span class="hljs-string">'\n'</span>) + <span class="hljs-string">'\n'</span> + nodestack);

err = makeErr({ <span class="hljs-string">'constructorOpt'</span>: makeErr });
mod_assert.equal(err.toString(), <span class="hljs-string">'WError: test error'</span>);
stack = cleanStack(err.stack);
mod_assert.equal(stack, [
    <span class="hljs-string">'WError: test error'</span>,
    <span class="hljs-string">'    at Object.&lt;anonymous&gt; (tst.werror.js)'</span>
].join(<span class="hljs-string">'\n'</span>) + <span class="hljs-string">'\n'</span> + nodestack);

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
