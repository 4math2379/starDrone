<!DOCTYPE html>
<html>
<head>
  <title>nopt.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/nopt/lib/nopt.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>nopt.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>info about each config option.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> debug = process.env.DEBUG_NOPT || process.env.NOPT_DEBUG
  ? <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-built_in">console</span>.error.apply(<span class="hljs-built_in">console</span>, <span class="hljs-built_in">arguments</span>) }
  : <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{}

<span class="hljs-keyword">var</span> url = <span class="hljs-built_in">require</span>(<span class="hljs-string">"url"</span>)
  , path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>)
  , Stream = <span class="hljs-built_in">require</span>(<span class="hljs-string">"stream"</span>).Stream
  , abbrev = <span class="hljs-built_in">require</span>(<span class="hljs-string">"abbrev"</span>)

<span class="hljs-built_in">module</span>.exports = exports = nopt
exports.clean = clean

exports.typeDefs =
  { <span class="hljs-attr">String</span>  : { <span class="hljs-attr">type</span>: <span class="hljs-built_in">String</span>,  <span class="hljs-attr">validate</span>: validateString  }
  , <span class="hljs-attr">Boolean</span> : { <span class="hljs-attr">type</span>: <span class="hljs-built_in">Boolean</span>, <span class="hljs-attr">validate</span>: validateBoolean }
  , <span class="hljs-attr">url</span>     : { <span class="hljs-attr">type</span>: url,     <span class="hljs-attr">validate</span>: validateUrl     }
  , <span class="hljs-attr">Number</span>  : { <span class="hljs-attr">type</span>: <span class="hljs-built_in">Number</span>,  <span class="hljs-attr">validate</span>: validateNumber  }
  , <span class="hljs-attr">path</span>    : { <span class="hljs-attr">type</span>: path,    <span class="hljs-attr">validate</span>: validatePath    }
  , <span class="hljs-attr">Stream</span>  : { <span class="hljs-attr">type</span>: Stream,  <span class="hljs-attr">validate</span>: validateStream  }
  , <span class="hljs-attr">Date</span>    : { <span class="hljs-attr">type</span>: <span class="hljs-built_in">Date</span>,    <span class="hljs-attr">validate</span>: validateDate    }
  }

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nopt</span> (<span class="hljs-params">types, shorthands, args, slice</span>) </span>{
  args = args || process.argv
  types = types || {}
  shorthands = shorthands || {}
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> slice !== <span class="hljs-string">"number"</span>) slice = <span class="hljs-number">2</span>

  debug(types, shorthands, args, slice)

  args = args.slice(slice)
  <span class="hljs-keyword">var</span> data = {}
    , key
    , remain = []
    , cooked = args
    , original = args.slice(<span class="hljs-number">0</span>)

  parse(args, data, remain, types, shorthands)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>now data is full</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  clean(data, types, exports.typeDefs)
  data.argv = {<span class="hljs-attr">remain</span>:remain,<span class="hljs-attr">cooked</span>:cooked,<span class="hljs-attr">original</span>:original}
  <span class="hljs-built_in">Object</span>.defineProperty(data.argv, <span class="hljs-string">'toString'</span>, { <span class="hljs-attr">value</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.original.map(<span class="hljs-built_in">JSON</span>.stringify).join(<span class="hljs-string">" "</span>)
  }, <span class="hljs-attr">enumerable</span>: <span class="hljs-literal">false</span> })
  <span class="hljs-keyword">return</span> data
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">clean</span> (<span class="hljs-params">data, types, typeDefs</span>) </span>{
  typeDefs = typeDefs || exports.typeDefs
  <span class="hljs-keyword">var</span> remove = {}
    , typeDefault = [<span class="hljs-literal">false</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">null</span>, <span class="hljs-built_in">String</span>, <span class="hljs-built_in">Array</span>]

  <span class="hljs-built_in">Object</span>.keys(data).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">k</span>) </span>{
    <span class="hljs-keyword">if</span> (k === <span class="hljs-string">"argv"</span>) <span class="hljs-keyword">return</span>
    <span class="hljs-keyword">var</span> val = data[k]
      , isArray = <span class="hljs-built_in">Array</span>.isArray(val)
      , type = types[k]
    <span class="hljs-keyword">if</span> (!isArray) val = [val]
    <span class="hljs-keyword">if</span> (!type) type = typeDefault
    <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Array</span>) type = typeDefault.concat(<span class="hljs-built_in">Array</span>)
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(type)) type = [type]

    debug(<span class="hljs-string">"val=%j"</span>, val)
    debug(<span class="hljs-string">"types="</span>, type)
    val = val.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>if it's an unknown value, then parse false/true/null/numbers/dates</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val === <span class="hljs-string">"string"</span>) {
        debug(<span class="hljs-string">"string %j"</span>, val)
        val = val.trim()
        <span class="hljs-keyword">if</span> ((val === <span class="hljs-string">"null"</span> &amp;&amp; ~type.indexOf(<span class="hljs-literal">null</span>))
            || (val === <span class="hljs-string">"true"</span> &amp;&amp;
               (~type.indexOf(<span class="hljs-literal">true</span>) || ~type.indexOf(<span class="hljs-built_in">Boolean</span>)))
            || (val === <span class="hljs-string">"false"</span> &amp;&amp;
               (~type.indexOf(<span class="hljs-literal">false</span>) || ~type.indexOf(<span class="hljs-built_in">Boolean</span>)))) {
          val = <span class="hljs-built_in">JSON</span>.parse(val)
          debug(<span class="hljs-string">"jsonable %j"</span>, val)
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (~type.indexOf(<span class="hljs-built_in">Number</span>) &amp;&amp; !<span class="hljs-built_in">isNaN</span>(val)) {
          debug(<span class="hljs-string">"convert to number"</span>, val)
          val = +val
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (~type.indexOf(<span class="hljs-built_in">Date</span>) &amp;&amp; !<span class="hljs-built_in">isNaN</span>(<span class="hljs-built_in">Date</span>.parse(val))) {
          debug(<span class="hljs-string">"convert to date"</span>, val)
          val = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(val)
        }
      }

      <span class="hljs-keyword">if</span> (!types.hasOwnProperty(k)) {
        <span class="hljs-keyword">return</span> val
      }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>allow <code>--no-blah</code> to set 'blah' to null if null is allowed</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (val === <span class="hljs-literal">false</span> &amp;&amp; ~type.indexOf(<span class="hljs-literal">null</span>) &amp;&amp;
          !(~type.indexOf(<span class="hljs-literal">false</span>) || ~type.indexOf(<span class="hljs-built_in">Boolean</span>))) {
        val = <span class="hljs-literal">null</span>
      }

      <span class="hljs-keyword">var</span> d = {}
      d[k] = val
      debug(<span class="hljs-string">"prevalidated val"</span>, d, val, types[k])
      <span class="hljs-keyword">if</span> (!validate(d, k, val, types[k], typeDefs)) {
        <span class="hljs-keyword">if</span> (exports.invalidHandler) {
          exports.invalidHandler(k, val, types[k], data)
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (exports.invalidHandler !== <span class="hljs-literal">false</span>) {
          debug(<span class="hljs-string">"invalid: "</span>+k+<span class="hljs-string">"="</span>+val, types[k])
        }
        <span class="hljs-keyword">return</span> remove
      }
      debug(<span class="hljs-string">"validated val"</span>, d, val, types[k])
      <span class="hljs-keyword">return</span> d[k]
    }).filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">val</span>) </span>{ <span class="hljs-keyword">return</span> val !== remove })

    <span class="hljs-keyword">if</span> (!val.length) <span class="hljs-keyword">delete</span> data[k]
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isArray) {
      debug(isArray, data[k], val)
      data[k] = val
    } <span class="hljs-keyword">else</span> data[k] = val[<span class="hljs-number">0</span>]

    debug(<span class="hljs-string">"k=%s val=%j"</span>, k, val, data[k])
  })
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateString</span> (<span class="hljs-params">data, k, val</span>) </span>{
  data[k] = <span class="hljs-built_in">String</span>(val)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validatePath</span> (<span class="hljs-params">data, k, val</span>) </span>{
  <span class="hljs-keyword">if</span> (val === <span class="hljs-literal">true</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  <span class="hljs-keyword">if</span> (val === <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>

  val = <span class="hljs-built_in">String</span>(val)
  <span class="hljs-keyword">var</span> homePattern = process.platform === <span class="hljs-string">'win32'</span> ? <span class="hljs-regexp">/^~(\/|\\)/</span> : <span class="hljs-regexp">/^~\//</span>
  <span class="hljs-keyword">if</span> (val.match(homePattern) &amp;&amp; process.env.HOME) {
    val = path.resolve(process.env.HOME, val.substr(<span class="hljs-number">2</span>))
  }
  data[k] = path.resolve(<span class="hljs-built_in">String</span>(val))
  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateNumber</span> (<span class="hljs-params">data, k, val</span>) </span>{
  debug(<span class="hljs-string">"validate Number %j %j %j"</span>, k, val, <span class="hljs-built_in">isNaN</span>(val))
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(val)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  data[k] = +val
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateDate</span> (<span class="hljs-params">data, k, val</span>) </span>{
  debug(<span class="hljs-string">"validate Date %j %j %j"</span>, k, val, <span class="hljs-built_in">Date</span>.parse(val))
  <span class="hljs-keyword">var</span> s = <span class="hljs-built_in">Date</span>.parse(val)
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(s)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  data[k] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(val)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateBoolean</span> (<span class="hljs-params">data, k, val</span>) </span>{
  <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Boolean</span>) val = val.valueOf()
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> val === <span class="hljs-string">"string"</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">isNaN</span>(val)) val = !!(+val)
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val === <span class="hljs-string">"null"</span> || val === <span class="hljs-string">"false"</span>) val = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">else</span> val = <span class="hljs-literal">true</span>
  } <span class="hljs-keyword">else</span> val = !!val
  data[k] = val
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateUrl</span> (<span class="hljs-params">data, k, val</span>) </span>{
  val = url.parse(<span class="hljs-built_in">String</span>(val))
  <span class="hljs-keyword">if</span> (!val.host) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  data[k] = val.href
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validateStream</span> (<span class="hljs-params">data, k, val</span>) </span>{
  <span class="hljs-keyword">if</span> (!(val <span class="hljs-keyword">instanceof</span> Stream)) <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  data[k] = val
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">validate</span> (<span class="hljs-params">data, k, val, type, typeDefs</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>arrays are lists of types.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(type)) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = type.length; i &lt; l; i ++) {
      <span class="hljs-keyword">if</span> (type[i] === <span class="hljs-built_in">Array</span>) <span class="hljs-keyword">continue</span>
      <span class="hljs-keyword">if</span> (validate(data, k, val, type[i], typeDefs)) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
    }
    <span class="hljs-keyword">delete</span> data[k]
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>an array of anything?</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (type === <span class="hljs-built_in">Array</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>NaN is poisonous.  Means that something is not allowed.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (type !== type) {
    debug(<span class="hljs-string">"Poison NaN"</span>, k, val, type)
    <span class="hljs-keyword">delete</span> data[k]
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>explicit list of values</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (val === type) {
    debug(<span class="hljs-string">"Explicitly allowed %j"</span>, val)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>if (isArray) (data[k] = data[k] || []).push(val)
else data[k] = val</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    data[k] = val
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>now go through the list of typeDefs, validate against each one.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> ok = <span class="hljs-literal">false</span>
    , types = <span class="hljs-built_in">Object</span>.keys(typeDefs)
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = types.length; i &lt; l; i ++) {
    debug(<span class="hljs-string">"test type %j %j %j"</span>, k, val, types[i])
    <span class="hljs-keyword">var</span> t = typeDefs[types[i]]
    <span class="hljs-keyword">if</span> (t &amp;&amp;
      ((type &amp;&amp; type.name &amp;&amp; t.type &amp;&amp; t.type.name) ? (type.name === t.type.name) : (type === t.type))) {
      <span class="hljs-keyword">var</span> d = {}
      ok = <span class="hljs-literal">false</span> !== t.validate(d, k, val)
      val = d[k]
      <span class="hljs-keyword">if</span> (ok) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>if (isArray) (data[k] = data[k] || []).push(val)
else data[k] = val</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        data[k] = val
        <span class="hljs-keyword">break</span>
      }
    }
  }
  debug(<span class="hljs-string">"OK? %j (%j %j %j)"</span>, ok, k, val, types[i])

  <span class="hljs-keyword">if</span> (!ok) <span class="hljs-keyword">delete</span> data[k]
  <span class="hljs-keyword">return</span> ok
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parse</span> (<span class="hljs-params">args, data, remain, types, shorthands</span>) </span>{
  debug(<span class="hljs-string">"parse"</span>, args, data, remain)

  <span class="hljs-keyword">var</span> key = <span class="hljs-literal">null</span>
    , abbrevs = abbrev(<span class="hljs-built_in">Object</span>.keys(types))
    , shortAbbr = abbrev(<span class="hljs-built_in">Object</span>.keys(shorthands))

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; args.length; i ++) {
    <span class="hljs-keyword">var</span> arg = args[i]
    debug(<span class="hljs-string">"arg"</span>, arg)

    <span class="hljs-keyword">if</span> (arg.match(<span class="hljs-regexp">/^-{2,}$/</span>)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>done with keys.
the rest are args.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      remain.push.apply(remain, args.slice(i + <span class="hljs-number">1</span>))
      args[i] = <span class="hljs-string">"--"</span>
      <span class="hljs-keyword">break</span>
    }
    <span class="hljs-keyword">var</span> hadEq = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">if</span> (arg.charAt(<span class="hljs-number">0</span>) === <span class="hljs-string">"-"</span> &amp;&amp; arg.length &gt; <span class="hljs-number">1</span>) {
      <span class="hljs-keyword">if</span> (arg.indexOf(<span class="hljs-string">"="</span>) !== <span class="hljs-number">-1</span>) {
        hadEq = <span class="hljs-literal">true</span>
        <span class="hljs-keyword">var</span> v = arg.split(<span class="hljs-string">"="</span>)
        arg = v.shift()
        v = v.join(<span class="hljs-string">"="</span>)
        args.splice.apply(args, [i, <span class="hljs-number">1</span>].concat([arg, v]))
      }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>see if it's a shorthand
if so, splice and back up to re-parse it.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">var</span> shRes = resolveShort(arg, shorthands, shortAbbr, abbrevs)
      debug(<span class="hljs-string">"arg=%j shRes=%j"</span>, arg, shRes)
      <span class="hljs-keyword">if</span> (shRes) {
        debug(arg, shRes)
        args.splice.apply(args, [i, <span class="hljs-number">1</span>].concat(shRes))
        <span class="hljs-keyword">if</span> (arg !== shRes[<span class="hljs-number">0</span>]) {
          i --
          <span class="hljs-keyword">continue</span>
        }
      }
      arg = arg.replace(<span class="hljs-regexp">/^-+/</span>, <span class="hljs-string">""</span>)
      <span class="hljs-keyword">var</span> no = <span class="hljs-literal">null</span>
      <span class="hljs-keyword">while</span> (arg.toLowerCase().indexOf(<span class="hljs-string">"no-"</span>) === <span class="hljs-number">0</span>) {
        no = !no
        arg = arg.substr(<span class="hljs-number">3</span>)
      }

      <span class="hljs-keyword">if</span> (abbrevs[arg]) arg = abbrevs[arg]

      <span class="hljs-keyword">var</span> isArray = types[arg] === <span class="hljs-built_in">Array</span> ||
        <span class="hljs-built_in">Array</span>.isArray(types[arg]) &amp;&amp; types[arg].indexOf(<span class="hljs-built_in">Array</span>) !== <span class="hljs-number">-1</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>allow unknown things to be arrays if specified multiple times.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">      <span class="hljs-keyword">if</span> (!types.hasOwnProperty(arg) &amp;&amp; data.hasOwnProperty(arg)) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">Array</span>.isArray(data[arg]))
          data[arg] = [data[arg]]
        isArray = <span class="hljs-literal">true</span>
      }

      <span class="hljs-keyword">var</span> val
        , la = args[i + <span class="hljs-number">1</span>]

      <span class="hljs-keyword">var</span> isBool = <span class="hljs-keyword">typeof</span> no === <span class="hljs-string">'boolean'</span> ||
        types[arg] === <span class="hljs-built_in">Boolean</span> ||
        <span class="hljs-built_in">Array</span>.isArray(types[arg]) &amp;&amp; types[arg].indexOf(<span class="hljs-built_in">Boolean</span>) !== <span class="hljs-number">-1</span> ||
        (<span class="hljs-keyword">typeof</span> types[arg] === <span class="hljs-string">'undefined'</span> &amp;&amp; !hadEq) ||
        (la === <span class="hljs-string">"false"</span> &amp;&amp;
         (types[arg] === <span class="hljs-literal">null</span> ||
          <span class="hljs-built_in">Array</span>.isArray(types[arg]) &amp;&amp; ~types[arg].indexOf(<span class="hljs-literal">null</span>)))

      <span class="hljs-keyword">if</span> (isBool) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>just set and move along</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        val = !no
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>however, also support --bool true or --bool false</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (la === <span class="hljs-string">"true"</span> || la === <span class="hljs-string">"false"</span>) {
          val = <span class="hljs-built_in">JSON</span>.parse(la)
          la = <span class="hljs-literal">null</span>
          <span class="hljs-keyword">if</span> (no) val = !val
          i ++
        }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>also support &quot;foo&quot;:[Boolean, &quot;bar&quot;] and &quot;--foo bar&quot;</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Array</span>.isArray(types[arg]) &amp;&amp; la) {
          <span class="hljs-keyword">if</span> (~types[arg].indexOf(la)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>an explicit type</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            val = la
            i ++
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( la === <span class="hljs-string">"null"</span> &amp;&amp; ~types[arg].indexOf(<span class="hljs-literal">null</span>) ) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>null allowed</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            val = <span class="hljs-literal">null</span>
            i ++
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( !la.match(<span class="hljs-regexp">/^-{2,}[^-]/</span>) &amp;&amp;
                      !<span class="hljs-built_in">isNaN</span>(la) &amp;&amp;
                      ~types[arg].indexOf(<span class="hljs-built_in">Number</span>) ) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>number</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            val = +la
            i ++
          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( !la.match(<span class="hljs-regexp">/^-[^-]/</span>) &amp;&amp; ~types[arg].indexOf(<span class="hljs-built_in">String</span>) ) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>string</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            val = la
            i ++
          }
        }

        <span class="hljs-keyword">if</span> (isArray) (data[arg] = data[arg] || []).push(val)
        <span class="hljs-keyword">else</span> data[arg] = val

        <span class="hljs-keyword">continue</span>
      }

      <span class="hljs-keyword">if</span> (types[arg] === <span class="hljs-built_in">String</span> &amp;&amp; la === <span class="hljs-literal">undefined</span>)
        la = <span class="hljs-string">""</span>

      <span class="hljs-keyword">if</span> (la &amp;&amp; la.match(<span class="hljs-regexp">/^-{2,}$/</span>)) {
        la = <span class="hljs-literal">undefined</span>
        i --
      }

      val = la === <span class="hljs-literal">undefined</span> ? <span class="hljs-literal">true</span> : la
      <span class="hljs-keyword">if</span> (isArray) (data[arg] = data[arg] || []).push(val)
      <span class="hljs-keyword">else</span> data[arg] = val

      i ++
      <span class="hljs-keyword">continue</span>
    }
    remain.push(arg)
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resolveShort</span> (<span class="hljs-params">arg, shorthands, shortAbbr, abbrevs</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>handle single-char shorthands glommed together, like
npm ls -glp, but only if there is one dash, and only if
all of the chars are single-char shorthands, and it's
not a match to some other abbrev.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  arg = arg.replace(<span class="hljs-regexp">/^-+/</span>, <span class="hljs-string">''</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>if it's an exact known option, then don't go any further</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (abbrevs[arg] === arg)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>if it's an exact known shortopt, same deal</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (shorthands[arg]) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>make it an array, if it's a list of words</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (shorthands[arg] &amp;&amp; !<span class="hljs-built_in">Array</span>.isArray(shorthands[arg]))
      shorthands[arg] = shorthands[arg].split(<span class="hljs-regexp">/\s+/</span>)

    <span class="hljs-keyword">return</span> shorthands[arg]
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>first check to see if this arg is a set of single-char shorthands</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">var</span> singles = shorthands.___singles
  <span class="hljs-keyword">if</span> (!singles) {
    singles = <span class="hljs-built_in">Object</span>.keys(shorthands).filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">s</span>) </span>{
      <span class="hljs-keyword">return</span> s.length === <span class="hljs-number">1</span>
    }).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">l,r</span>) </span>{
      l[r] = <span class="hljs-literal">true</span>
      <span class="hljs-keyword">return</span> l
    }, {})
    shorthands.___singles = singles
    debug(<span class="hljs-string">'shorthand singles'</span>, singles)
  }

  <span class="hljs-keyword">var</span> chrs = arg.split(<span class="hljs-string">""</span>).filter(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">c</span>) </span>{
    <span class="hljs-keyword">return</span> singles[c]
  })

  <span class="hljs-keyword">if</span> (chrs.join(<span class="hljs-string">""</span>) === arg) <span class="hljs-keyword">return</span> chrs.map(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">c</span>) </span>{
    <span class="hljs-keyword">return</span> shorthands[c]
  }).reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">l, r</span>) </span>{
    <span class="hljs-keyword">return</span> l.concat(r)
  }, [])


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>if it's an arg abbrev, and not a literal shorthand, then prefer the arg</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (abbrevs[arg] &amp;&amp; !shorthands[arg])
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>if it's an abbr for a shorthand, then use that</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (shortAbbr[arg])
    arg = shortAbbr[arg]

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>make it an array, if it's a list of words</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (shorthands[arg] &amp;&amp; !<span class="hljs-built_in">Array</span>.isArray(shorthands[arg]))
    shorthands[arg] = shorthands[arg].split(<span class="hljs-regexp">/\s+/</span>)

  <span class="hljs-keyword">return</span> shorthands[arg]
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
