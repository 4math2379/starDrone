<!DOCTYPE html>
<html>
<head>
  <title>client.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/hawk/test/client.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>client.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>Load modules</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> Url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);
<span class="hljs-keyword">var</span> Code = <span class="hljs-built_in">require</span>(<span class="hljs-string">'code'</span>);
<span class="hljs-keyword">var</span> Hawk = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib'</span>);
<span class="hljs-keyword">var</span> Lab = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lab'</span>);


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Declare internals</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> internals = {};


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Test shortcuts</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> lab = exports.lab = Lab.script();
<span class="hljs-keyword">var</span> describe = lab.experiment;
<span class="hljs-keyword">var</span> it = lab.test;
<span class="hljs-keyword">var</span> expect = Code.expect;


describe(<span class="hljs-string">'Client'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    describe(<span class="hljs-string">'header()'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        it(<span class="hljs-string">'returns a valid authorization header (sha1)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha1'</span>
            };

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'http://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">'POST'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">ext</span>: <span class="hljs-string">'Bazinga!'</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'Ygvqdz'</span>, <span class="hljs-attr">payload</span>: <span class="hljs-string">'something to write about'</span> }).field;
            expect(header).to.equal(<span class="hljs-string">'Hawk id="123456", ts="1353809207", nonce="Ygvqdz", hash="bsvY3IfUllw6V5rvk4tStEvpBhE=", ext="Bazinga!", mac="qbf1ZPG/r/e06F4ht+T77LXi5vw="'</span>);
            done();
        });

        it(<span class="hljs-string">'returns a valid authorization header (sha256)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha256'</span>
            };

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">'POST'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">ext</span>: <span class="hljs-string">'Bazinga!'</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'Ygvqdz'</span>, <span class="hljs-attr">payload</span>: <span class="hljs-string">'something to write about'</span>, <span class="hljs-attr">contentType</span>: <span class="hljs-string">'text/plain'</span> }).field;
            expect(header).to.equal(<span class="hljs-string">'Hawk id="123456", ts="1353809207", nonce="Ygvqdz", hash="2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=", ext="Bazinga!", mac="q1CwFoSHzPZSkbIvl0oYlD+91rBUEvFk763nMjMndj8="'</span>);
            done();
        });

        it(<span class="hljs-string">'returns a valid authorization header (no ext)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha256'</span>
            };

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">'POST'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'Ygvqdz'</span>, <span class="hljs-attr">payload</span>: <span class="hljs-string">'something to write about'</span>, <span class="hljs-attr">contentType</span>: <span class="hljs-string">'text/plain'</span> }).field;
            expect(header).to.equal(<span class="hljs-string">'Hawk id="123456", ts="1353809207", nonce="Ygvqdz", hash="2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=", mac="HTgtd0jPI6E4izx8e4OHdO36q00xFCU0FolNq3RiCYs="'</span>);
            done();
        });

        it(<span class="hljs-string">'returns a valid authorization header (null ext)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha256'</span>
            };

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">'POST'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'Ygvqdz'</span>, <span class="hljs-attr">payload</span>: <span class="hljs-string">'something to write about'</span>, <span class="hljs-attr">contentType</span>: <span class="hljs-string">'text/plain'</span>, <span class="hljs-attr">ext</span>: <span class="hljs-literal">null</span> }).field;
            expect(header).to.equal(<span class="hljs-string">'Hawk id="123456", ts="1353809207", nonce="Ygvqdz", hash="2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=", mac="HTgtd0jPI6E4izx8e4OHdO36q00xFCU0FolNq3RiCYs="'</span>);
            done();
        });

        it(<span class="hljs-string">'returns a valid authorization header (empty payload)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha256'</span>
            };

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">'POST'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'Ygvqdz'</span>, <span class="hljs-attr">payload</span>: <span class="hljs-string">''</span>, <span class="hljs-attr">contentType</span>: <span class="hljs-string">'text/plain'</span> }).field;
            expect(header).to.equal(<span class="hljs-string">'Hawk id=\"123456\", ts=\"1353809207\", nonce=\"Ygvqdz\", hash=\"q/t+NNAkQZNlq/aAD6PlexImwQTxwgT2MahfTa9XRLA=\", mac=\"U5k16YEzn3UnBHKeBzsDXn067Gu3R4YaY6xOt9PYRZM=\"'</span>);
            done();
        });

        it(<span class="hljs-string">'returns a valid authorization header (pre hashed payload)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha256'</span>
            };

            <span class="hljs-keyword">var</span> options = { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'Ygvqdz'</span>, <span class="hljs-attr">payload</span>: <span class="hljs-string">'something to write about'</span>, <span class="hljs-attr">contentType</span>: <span class="hljs-string">'text/plain'</span> };
            options.hash = Hawk.crypto.calculatePayloadHash(options.payload, credentials.algorithm, options.contentType);
            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">'POST'</span>, options).field;
            expect(header).to.equal(<span class="hljs-string">'Hawk id="123456", ts="1353809207", nonce="Ygvqdz", hash="2QfCt3GuY9HQnHWyWD3wX68ZOKbynqlfYmuO2ZBRqtY=", mac="HTgtd0jPI6E4izx8e4OHdO36q00xFCU0FolNq3RiCYs="'</span>);
            done();
        });

        it(<span class="hljs-string">'errors on missing uri'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">''</span>, <span class="hljs-string">'POST'</span>);
            expect(header.field).to.equal(<span class="hljs-string">''</span>);
            expect(header.err).to.equal(<span class="hljs-string">'Invalid argument type'</span>);
            done();
        });

        it(<span class="hljs-string">'errors on invalid uri'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-number">4</span>, <span class="hljs-string">'POST'</span>);
            expect(header.field).to.equal(<span class="hljs-string">''</span>);
            expect(header.err).to.equal(<span class="hljs-string">'Invalid argument type'</span>);
            done();
        });

        it(<span class="hljs-string">'errors on missing method'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">''</span>);
            expect(header.field).to.equal(<span class="hljs-string">''</span>);
            expect(header.err).to.equal(<span class="hljs-string">'Invalid argument type'</span>);
            done();
        });

        it(<span class="hljs-string">'errors on invalid method'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-number">5</span>);
            expect(header.field).to.equal(<span class="hljs-string">''</span>);
            expect(header.err).to.equal(<span class="hljs-string">'Invalid argument type'</span>);
            done();
        });

        it(<span class="hljs-string">'errors on missing options'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">'POST'</span>);
            expect(header.field).to.equal(<span class="hljs-string">''</span>);
            expect(header.err).to.equal(<span class="hljs-string">'Invalid argument type'</span>);
            done();
        });

        it(<span class="hljs-string">'errors on invalid credentials (id)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha256'</span>
            };

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">'POST'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">ext</span>: <span class="hljs-string">'Bazinga!'</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span> });
            expect(header.field).to.equal(<span class="hljs-string">''</span>);
            expect(header.err).to.equal(<span class="hljs-string">'Invalid credential object'</span>);
            done();
        });

        it(<span class="hljs-string">'errors on missing credentials'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">'POST'</span>, { <span class="hljs-attr">ext</span>: <span class="hljs-string">'Bazinga!'</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span> });
            expect(header.field).to.equal(<span class="hljs-string">''</span>);
            expect(header.err).to.equal(<span class="hljs-string">'Invalid credential object'</span>);
            done();
        });

        it(<span class="hljs-string">'errors on invalid credentials'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha256'</span>
            };

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">'POST'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">ext</span>: <span class="hljs-string">'Bazinga!'</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span> });
            expect(header.field).to.equal(<span class="hljs-string">''</span>);
            expect(header.err).to.equal(<span class="hljs-string">'Invalid credential object'</span>);
            done();
        });

        it(<span class="hljs-string">'errors on invalid algorithm'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'hmac-sha-0'</span>
            };

            <span class="hljs-keyword">var</span> header = Hawk.client.header(<span class="hljs-string">'https://example.net/somewhere/over/the/rainbow'</span>, <span class="hljs-string">'POST'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">payload</span>: <span class="hljs-string">'something, anything!'</span>, <span class="hljs-attr">ext</span>: <span class="hljs-string">'Bazinga!'</span>, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span> });
            expect(header.field).to.equal(<span class="hljs-string">''</span>);
            expect(header.err).to.equal(<span class="hljs-string">'Unknown algorithm'</span>);
            done();
        });
    });

    describe(<span class="hljs-string">'authenticate()'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        it(<span class="hljs-string">'returns false on invalid header'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> res = {
                <span class="hljs-attr">headers</span>: {
                    <span class="hljs-string">'server-authorization'</span>: <span class="hljs-string">'Hawk mac="abc", bad="xyz"'</span>
                }
            };

            expect(Hawk.client.authenticate(res, {})).to.equal(<span class="hljs-literal">false</span>);
            done();
        });

        it(<span class="hljs-string">'returns false on invalid mac'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> res = {
                <span class="hljs-attr">headers</span>: {
                    <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain'</span>,
                    <span class="hljs-string">'server-authorization'</span>: <span class="hljs-string">'Hawk mac="_IJRsMl/4oL+nn+vKoeVZPdCHXB4yJkNnBbTbHFZUYE=", hash="f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=", ext="response-specific"'</span>
                }
            };

            <span class="hljs-keyword">var</span> artifacts = {
                <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
                <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com'</span>,
                <span class="hljs-attr">port</span>: <span class="hljs-string">'8080'</span>,
                <span class="hljs-attr">resource</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
                <span class="hljs-attr">ts</span>: <span class="hljs-string">'1362336900'</span>,
                <span class="hljs-attr">nonce</span>: <span class="hljs-string">'eb5S_L'</span>,
                <span class="hljs-attr">hash</span>: <span class="hljs-string">'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk='</span>,
                <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span>,
                <span class="hljs-attr">app</span>: <span class="hljs-literal">undefined</span>,
                <span class="hljs-attr">dlg</span>: <span class="hljs-literal">undefined</span>,
                <span class="hljs-attr">mac</span>: <span class="hljs-string">'BlmSe8K+pbKIb6YsZCnt4E1GrYvY1AaYayNR82dGpIk='</span>,
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>
            };

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha256'</span>,
                <span class="hljs-attr">user</span>: <span class="hljs-string">'steve'</span>
            };

            expect(Hawk.client.authenticate(res, credentials, artifacts)).to.equal(<span class="hljs-literal">false</span>);
            done();
        });

        it(<span class="hljs-string">'returns true on ignoring hash'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> res = {
                <span class="hljs-attr">headers</span>: {
                    <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain'</span>,
                    <span class="hljs-string">'server-authorization'</span>: <span class="hljs-string">'Hawk mac="XIJRsMl/4oL+nn+vKoeVZPdCHXB4yJkNnBbTbHFZUYE=", hash="f9cDF/TDm7TkYRLnGwRMfeDzT6LixQVLvrIKhh0vgmM=", ext="response-specific"'</span>
                }
            };

            <span class="hljs-keyword">var</span> artifacts = {
                <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
                <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com'</span>,
                <span class="hljs-attr">port</span>: <span class="hljs-string">'8080'</span>,
                <span class="hljs-attr">resource</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
                <span class="hljs-attr">ts</span>: <span class="hljs-string">'1362336900'</span>,
                <span class="hljs-attr">nonce</span>: <span class="hljs-string">'eb5S_L'</span>,
                <span class="hljs-attr">hash</span>: <span class="hljs-string">'nJjkVtBE5Y/Bk38Aiokwn0jiJxt/0S2WRSUwWLCf5xk='</span>,
                <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span>,
                <span class="hljs-attr">app</span>: <span class="hljs-literal">undefined</span>,
                <span class="hljs-attr">dlg</span>: <span class="hljs-literal">undefined</span>,
                <span class="hljs-attr">mac</span>: <span class="hljs-string">'BlmSe8K+pbKIb6YsZCnt4E1GrYvY1AaYayNR82dGpIk='</span>,
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>
            };

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha256'</span>,
                <span class="hljs-attr">user</span>: <span class="hljs-string">'steve'</span>
            };

            expect(Hawk.client.authenticate(res, credentials, artifacts)).to.equal(<span class="hljs-literal">true</span>);
            done();
        });

        it(<span class="hljs-string">'fails on invalid WWW-Authenticate header format'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> header = <span class="hljs-string">'Hawk ts="1362346425875", tsm="PhwayS28vtnn3qbv0mqRBYSXebN/zggEtucfeZ620Zo=", x="Stale timestamp"'</span>;
            expect(Hawk.client.authenticate({ <span class="hljs-attr">headers</span>: { <span class="hljs-string">'www-authenticate'</span>: header } }, {})).to.equal(<span class="hljs-literal">false</span>);
            done();
        });

        it(<span class="hljs-string">'fails on invalid WWW-Authenticate header format'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha256'</span>,
                <span class="hljs-attr">user</span>: <span class="hljs-string">'steve'</span>
            };

            <span class="hljs-keyword">var</span> header = <span class="hljs-string">'Hawk ts="1362346425875", tsm="hwayS28vtnn3qbv0mqRBYSXebN/zggEtucfeZ620Zo=", error="Stale timestamp"'</span>;
            expect(Hawk.client.authenticate({ <span class="hljs-attr">headers</span>: { <span class="hljs-string">'www-authenticate'</span>: header } }, credentials)).to.equal(<span class="hljs-literal">false</span>);
            done();
        });

        it(<span class="hljs-string">'skips tsm validation when missing ts'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> header = <span class="hljs-string">'Hawk error="Stale timestamp"'</span>;
            expect(Hawk.client.authenticate({ <span class="hljs-attr">headers</span>: { <span class="hljs-string">'www-authenticate'</span>: header } }, {})).to.equal(<span class="hljs-literal">true</span>);
            done();
        });
    });

    describe(<span class="hljs-string">'message()'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

        it(<span class="hljs-string">'generates authorization'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha1'</span>
            };

            <span class="hljs-keyword">var</span> auth = Hawk.client.message(<span class="hljs-string">'example.com'</span>, <span class="hljs-number">80</span>, <span class="hljs-string">'I am the boodyman'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'abc123'</span> });
            expect(auth).to.exist();
            expect(auth.ts).to.equal(<span class="hljs-number">1353809207</span>);
            expect(auth.nonce).to.equal(<span class="hljs-string">'abc123'</span>);
            done();
        });

        it(<span class="hljs-string">'errors on invalid host'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha1'</span>
            };

            <span class="hljs-keyword">var</span> auth = Hawk.client.message(<span class="hljs-number">5</span>, <span class="hljs-number">80</span>, <span class="hljs-string">'I am the boodyman'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'abc123'</span> });
            expect(auth).to.not.exist();
            done();
        });

        it(<span class="hljs-string">'errors on invalid port'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha1'</span>
            };

            <span class="hljs-keyword">var</span> auth = Hawk.client.message(<span class="hljs-string">'example.com'</span>, <span class="hljs-string">'80'</span>, <span class="hljs-string">'I am the boodyman'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'abc123'</span> });
            expect(auth).to.not.exist();
            done();
        });

        it(<span class="hljs-string">'errors on missing host'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha1'</span>
            };

            <span class="hljs-keyword">var</span> auth = Hawk.client.message(<span class="hljs-string">'example.com'</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'I am the boodyman'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'abc123'</span> });
            expect(auth).to.not.exist();
            done();
        });

        it(<span class="hljs-string">'errors on null message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha1'</span>
            };

            <span class="hljs-keyword">var</span> auth = Hawk.client.message(<span class="hljs-string">'example.com'</span>, <span class="hljs-number">80</span>, <span class="hljs-literal">null</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'abc123'</span> });
            expect(auth).to.not.exist();
            done();
        });

        it(<span class="hljs-string">'errors on missing message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha1'</span>
            };

            <span class="hljs-keyword">var</span> auth = Hawk.client.message(<span class="hljs-string">'example.com'</span>, <span class="hljs-number">80</span>, <span class="hljs-literal">undefined</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'abc123'</span> });
            expect(auth).to.not.exist();
            done();
        });

        it(<span class="hljs-string">'errors on invalid message'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha1'</span>
            };

            <span class="hljs-keyword">var</span> auth = Hawk.client.message(<span class="hljs-string">'example.com'</span>, <span class="hljs-number">80</span>, <span class="hljs-number">5</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'abc123'</span> });
            expect(auth).to.not.exist();
            done();
        });

        it(<span class="hljs-string">'errors on missing options'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha1'</span>
            };

            <span class="hljs-keyword">var</span> auth = Hawk.client.message(<span class="hljs-string">'example.com'</span>, <span class="hljs-number">80</span>, <span class="hljs-string">'I am the boodyman'</span>);
            expect(auth).to.not.exist();
            done();
        });

        it(<span class="hljs-string">'errors on invalid credentials (id)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">key</span>: <span class="hljs-string">'2983d45yun89q'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha1'</span>
            };

            <span class="hljs-keyword">var</span> auth = Hawk.client.message(<span class="hljs-string">'example.com'</span>, <span class="hljs-number">80</span>, <span class="hljs-string">'I am the boodyman'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'abc123'</span> });
            expect(auth).to.not.exist();
            done();
        });

        it(<span class="hljs-string">'errors on invalid credentials (key)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

            <span class="hljs-keyword">var</span> credentials = {
                <span class="hljs-attr">id</span>: <span class="hljs-string">'123456'</span>,
                <span class="hljs-attr">algorithm</span>: <span class="hljs-string">'sha1'</span>
            };

            <span class="hljs-keyword">var</span> auth = Hawk.client.message(<span class="hljs-string">'example.com'</span>, <span class="hljs-number">80</span>, <span class="hljs-string">'I am the boodyman'</span>, { <span class="hljs-attr">credentials</span>: credentials, <span class="hljs-attr">timestamp</span>: <span class="hljs-number">1353809207</span>, <span class="hljs-attr">nonce</span>: <span class="hljs-string">'abc123'</span> });
            expect(auth).to.not.exist();
            done();
        });
    });
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
