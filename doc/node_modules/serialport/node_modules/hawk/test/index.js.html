<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/hawk/test/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>Load modules</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> Url = <span class="hljs-built_in">require</span>(<span class="hljs-string">'url'</span>);
<span class="hljs-keyword">var</span> Code = <span class="hljs-built_in">require</span>(<span class="hljs-string">'code'</span>);
<span class="hljs-keyword">var</span> Hawk = <span class="hljs-built_in">require</span>(<span class="hljs-string">'../lib'</span>);
<span class="hljs-keyword">var</span> Lab = <span class="hljs-built_in">require</span>(<span class="hljs-string">'lab'</span>);


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Declare internals</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> internals = {};


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Test shortcuts</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> lab = exports.lab = Lab.script();
<span class="hljs-keyword">var</span> describe = lab.experiment;
<span class="hljs-keyword">var</span> it = lab.test;
<span class="hljs-keyword">var</span> expect = Code.expect;


describe(<span class="hljs-string">'Hawk'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">var</span> credentialsFunc = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">id, callback</span>) </span>{

        <span class="hljs-keyword">var</span> credentials = {
            <span class="hljs-attr">id</span>: id,
            <span class="hljs-attr">key</span>: <span class="hljs-string">'werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn'</span>,
            <span class="hljs-attr">algorithm</span>: (id === <span class="hljs-string">'1'</span> ? <span class="hljs-string">'sha1'</span> : <span class="hljs-string">'sha256'</span>),
            <span class="hljs-attr">user</span>: <span class="hljs-string">'steve'</span>
        };

        <span class="hljs-keyword">return</span> callback(<span class="hljs-literal">null</span>, credentials);
    };

    it(<span class="hljs-string">'generates a header then successfully parse it (configuration)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
            <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com'</span>,
            <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>
        };

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            req.authorization = Hawk.client.header(Url.parse(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>), req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span> }).field;
            expect(req.authorization).to.exist();

            Hawk.server.authenticate(req, credentialsFunc, {}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.not.exist();
                expect(credentials2.user).to.equal(<span class="hljs-string">'steve'</span>);
                expect(artifacts.ext).to.equal(<span class="hljs-string">'some-app-data'</span>);
                done();
            });
        });
    });

    it(<span class="hljs-string">'generates a header then successfully parse it (node request)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
            <span class="hljs-attr">headers</span>: {
                <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com:8080'</span>,
                <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain;x=y'</span>
            }
        };

        <span class="hljs-keyword">var</span> payload = <span class="hljs-string">'some not so random text'</span>;

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            <span class="hljs-keyword">var</span> reqHeader = Hawk.client.header(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>, req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span>, <span class="hljs-attr">payload</span>: payload, <span class="hljs-attr">contentType</span>: req.headers[<span class="hljs-string">'content-type'</span>] });
            req.headers.authorization = reqHeader.field;

            Hawk.server.authenticate(req, credentialsFunc, {}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.not.exist();
                expect(credentials2.user).to.equal(<span class="hljs-string">'steve'</span>);
                expect(artifacts.ext).to.equal(<span class="hljs-string">'some-app-data'</span>);
                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers[<span class="hljs-string">'content-type'</span>])).to.equal(<span class="hljs-literal">true</span>);

                <span class="hljs-keyword">var</span> res = {
                    <span class="hljs-attr">headers</span>: {
                        <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain'</span>
                    }
                };

                res.headers[<span class="hljs-string">'server-authorization'</span>] = Hawk.server.header(credentials2, artifacts, { <span class="hljs-attr">payload</span>: <span class="hljs-string">'some reply'</span>, <span class="hljs-attr">contentType</span>: <span class="hljs-string">'text/plain'</span>, <span class="hljs-attr">ext</span>: <span class="hljs-string">'response-specific'</span> });
                expect(res.headers[<span class="hljs-string">'server-authorization'</span>]).to.exist();

                expect(Hawk.client.authenticate(res, credentials2, artifacts, { <span class="hljs-attr">payload</span>: <span class="hljs-string">'some reply'</span> })).to.equal(<span class="hljs-literal">true</span>);
                done();
            });
        });
    });

    it(<span class="hljs-string">'generates a header then successfully parse it (absolute request uri)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>,
            <span class="hljs-attr">headers</span>: {
                <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com:8080'</span>,
                <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain;x=y'</span>
            }
        };

        <span class="hljs-keyword">var</span> payload = <span class="hljs-string">'some not so random text'</span>;

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            <span class="hljs-keyword">var</span> reqHeader = Hawk.client.header(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>, req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span>, <span class="hljs-attr">payload</span>: payload, <span class="hljs-attr">contentType</span>: req.headers[<span class="hljs-string">'content-type'</span>] });
            req.headers.authorization = reqHeader.field;

            Hawk.server.authenticate(req, credentialsFunc, {}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.not.exist();
                expect(credentials2.user).to.equal(<span class="hljs-string">'steve'</span>);
                expect(artifacts.ext).to.equal(<span class="hljs-string">'some-app-data'</span>);
                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers[<span class="hljs-string">'content-type'</span>])).to.equal(<span class="hljs-literal">true</span>);

                <span class="hljs-keyword">var</span> res = {
                    <span class="hljs-attr">headers</span>: {
                        <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain'</span>
                    }
                };

                res.headers[<span class="hljs-string">'server-authorization'</span>] = Hawk.server.header(credentials2, artifacts, { <span class="hljs-attr">payload</span>: <span class="hljs-string">'some reply'</span>, <span class="hljs-attr">contentType</span>: <span class="hljs-string">'text/plain'</span>, <span class="hljs-attr">ext</span>: <span class="hljs-string">'response-specific'</span> });
                expect(res.headers[<span class="hljs-string">'server-authorization'</span>]).to.exist();

                expect(Hawk.client.authenticate(res, credentials2, artifacts, { <span class="hljs-attr">payload</span>: <span class="hljs-string">'some reply'</span> })).to.equal(<span class="hljs-literal">true</span>);
                done();
            });
        });
    });

    it(<span class="hljs-string">'generates a header then successfully parse it (no server header options)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
            <span class="hljs-attr">headers</span>: {
                <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com:8080'</span>,
                <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain;x=y'</span>
            }
        };

        <span class="hljs-keyword">var</span> payload = <span class="hljs-string">'some not so random text'</span>;

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            <span class="hljs-keyword">var</span> reqHeader = Hawk.client.header(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>, req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span>, <span class="hljs-attr">payload</span>: payload, <span class="hljs-attr">contentType</span>: req.headers[<span class="hljs-string">'content-type'</span>] });
            req.headers.authorization = reqHeader.field;

            Hawk.server.authenticate(req, credentialsFunc, {}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.not.exist();
                expect(credentials2.user).to.equal(<span class="hljs-string">'steve'</span>);
                expect(artifacts.ext).to.equal(<span class="hljs-string">'some-app-data'</span>);
                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers[<span class="hljs-string">'content-type'</span>])).to.equal(<span class="hljs-literal">true</span>);

                <span class="hljs-keyword">var</span> res = {
                    <span class="hljs-attr">headers</span>: {
                        <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain'</span>
                    }
                };

                res.headers[<span class="hljs-string">'server-authorization'</span>] = Hawk.server.header(credentials2, artifacts);
                expect(res.headers[<span class="hljs-string">'server-authorization'</span>]).to.exist();

                expect(Hawk.client.authenticate(res, credentials2, artifacts)).to.equal(<span class="hljs-literal">true</span>);
                done();
            });
        });
    });

    it(<span class="hljs-string">'generates a header then fails to parse it (missing server header hash)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'POST'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
            <span class="hljs-attr">headers</span>: {
                <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com:8080'</span>,
                <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain;x=y'</span>
            }
        };

        <span class="hljs-keyword">var</span> payload = <span class="hljs-string">'some not so random text'</span>;

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            <span class="hljs-keyword">var</span> reqHeader = Hawk.client.header(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>, req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span>, <span class="hljs-attr">payload</span>: payload, <span class="hljs-attr">contentType</span>: req.headers[<span class="hljs-string">'content-type'</span>] });
            req.headers.authorization = reqHeader.field;

            Hawk.server.authenticate(req, credentialsFunc, {}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.not.exist();
                expect(credentials2.user).to.equal(<span class="hljs-string">'steve'</span>);
                expect(artifacts.ext).to.equal(<span class="hljs-string">'some-app-data'</span>);
                expect(Hawk.server.authenticatePayload(payload, credentials2, artifacts, req.headers[<span class="hljs-string">'content-type'</span>])).to.equal(<span class="hljs-literal">true</span>);

                <span class="hljs-keyword">var</span> res = {
                    <span class="hljs-attr">headers</span>: {
                        <span class="hljs-string">'content-type'</span>: <span class="hljs-string">'text/plain'</span>
                    }
                };

                res.headers[<span class="hljs-string">'server-authorization'</span>] = Hawk.server.header(credentials2, artifacts);
                expect(res.headers[<span class="hljs-string">'server-authorization'</span>]).to.exist();

                expect(Hawk.client.authenticate(res, credentials2, artifacts, { <span class="hljs-attr">payload</span>: <span class="hljs-string">'some reply'</span> })).to.equal(<span class="hljs-literal">false</span>);
                done();
            });
        });
    });

    it(<span class="hljs-string">'generates a header then successfully parse it (with hash)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
            <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com'</span>,
            <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>
        };

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            req.authorization = Hawk.client.header(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>, req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">payload</span>: <span class="hljs-string">'hola!'</span>, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span> }).field;
            Hawk.server.authenticate(req, credentialsFunc, {}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.not.exist();
                expect(credentials2.user).to.equal(<span class="hljs-string">'steve'</span>);
                expect(artifacts.ext).to.equal(<span class="hljs-string">'some-app-data'</span>);
                done();
            });
        });
    });

    it(<span class="hljs-string">'generates a header then successfully parse it then validate payload'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
            <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com'</span>,
            <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>
        };

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            req.authorization = Hawk.client.header(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>, req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">payload</span>: <span class="hljs-string">'hola!'</span>, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span> }).field;
            Hawk.server.authenticate(req, credentialsFunc, {}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.not.exist();
                expect(credentials2.user).to.equal(<span class="hljs-string">'steve'</span>);
                expect(artifacts.ext).to.equal(<span class="hljs-string">'some-app-data'</span>);
                expect(Hawk.server.authenticatePayload(<span class="hljs-string">'hola!'</span>, credentials2, artifacts)).to.be.true();
                expect(Hawk.server.authenticatePayload(<span class="hljs-string">'hello!'</span>, credentials2, artifacts)).to.be.false();
                done();
            });
        });
    });

    it(<span class="hljs-string">'generates a header then successfully parses and validates payload'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
            <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com'</span>,
            <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>
        };

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            req.authorization = Hawk.client.header(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>, req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">payload</span>: <span class="hljs-string">'hola!'</span>, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span> }).field;
            Hawk.server.authenticate(req, credentialsFunc, { <span class="hljs-attr">payload</span>: <span class="hljs-string">'hola!'</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.not.exist();
                expect(credentials2.user).to.equal(<span class="hljs-string">'steve'</span>);
                expect(artifacts.ext).to.equal(<span class="hljs-string">'some-app-data'</span>);
                done();
            });
        });
    });

    it(<span class="hljs-string">'generates a header then successfully parse it (app)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
            <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com'</span>,
            <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>
        };

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            req.authorization = Hawk.client.header(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>, req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span>, <span class="hljs-attr">app</span>: <span class="hljs-string">'asd23ased'</span> }).field;
            Hawk.server.authenticate(req, credentialsFunc, {}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.not.exist();
                expect(credentials2.user).to.equal(<span class="hljs-string">'steve'</span>);
                expect(artifacts.ext).to.equal(<span class="hljs-string">'some-app-data'</span>);
                expect(artifacts.app).to.equal(<span class="hljs-string">'asd23ased'</span>);
                done();
            });
        });
    });

    it(<span class="hljs-string">'generates a header then successfully parse it (app, dlg)'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
            <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com'</span>,
            <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>
        };

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            req.authorization = Hawk.client.header(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>, req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span>, <span class="hljs-attr">app</span>: <span class="hljs-string">'asd23ased'</span>, <span class="hljs-attr">dlg</span>: <span class="hljs-string">'23434szr3q4d'</span> }).field;
            Hawk.server.authenticate(req, credentialsFunc, {}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.not.exist();
                expect(credentials2.user).to.equal(<span class="hljs-string">'steve'</span>);
                expect(artifacts.ext).to.equal(<span class="hljs-string">'some-app-data'</span>);
                expect(artifacts.app).to.equal(<span class="hljs-string">'asd23ased'</span>);
                expect(artifacts.dlg).to.equal(<span class="hljs-string">'23434szr3q4d'</span>);
                done();
            });
        });
    });

    it(<span class="hljs-string">'generates a header then fail authentication due to bad hash'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
            <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com'</span>,
            <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>
        };

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            req.authorization = Hawk.client.header(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>, req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">payload</span>: <span class="hljs-string">'hola!'</span>, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span> }).field;
            Hawk.server.authenticate(req, credentialsFunc, { <span class="hljs-attr">payload</span>: <span class="hljs-string">'byebye!'</span> }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.exist();
                expect(err.output.payload.message).to.equal(<span class="hljs-string">'Bad payload hash'</span>);
                done();
            });
        });
    });

    it(<span class="hljs-string">'generates a header for one resource then fail to authenticate another'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">done</span>) </span>{

        <span class="hljs-keyword">var</span> req = {
            <span class="hljs-attr">method</span>: <span class="hljs-string">'GET'</span>,
            <span class="hljs-attr">url</span>: <span class="hljs-string">'/resource/4?filter=a'</span>,
            <span class="hljs-attr">host</span>: <span class="hljs-string">'example.com'</span>,
            <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span>
        };

        credentialsFunc(<span class="hljs-string">'123456'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials1</span>) </span>{

            req.authorization = Hawk.client.header(<span class="hljs-string">'http://example.com:8080/resource/4?filter=a'</span>, req.method, { <span class="hljs-attr">credentials</span>: credentials1, <span class="hljs-attr">ext</span>: <span class="hljs-string">'some-app-data'</span> }).field;
            req.url = <span class="hljs-string">'/something/else'</span>;

            Hawk.server.authenticate(req, credentialsFunc, {}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, credentials2, artifacts</span>) </span>{

                expect(err).to.exist();
                expect(credentials2).to.exist();
                done();
            });
        });
    });
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
