<!DOCTYPE html>
<html>
<head>
  <title>dhe.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/sshpk/lib/dhe.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>dhe.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>Copyright 2015 Joyent, Inc.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-built_in">module</span>.exports = DiffieHellman;

<span class="hljs-keyword">var</span> assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">'assert-plus'</span>);
<span class="hljs-keyword">var</span> crypto = <span class="hljs-built_in">require</span>(<span class="hljs-string">'crypto'</span>);
<span class="hljs-keyword">var</span> algs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./algs'</span>);
<span class="hljs-keyword">var</span> utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./utils'</span>);
<span class="hljs-keyword">var</span> ed;

<span class="hljs-keyword">var</span> Key = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./key'</span>);
<span class="hljs-keyword">var</span> PrivateKey = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./private-key'</span>);

<span class="hljs-keyword">var</span> CRYPTO_HAVE_ECDH = (crypto.createECDH !== <span class="hljs-literal">undefined</span>);

<span class="hljs-keyword">var</span> ecdh, ec, jsbn;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">DiffieHellman</span>(<span class="hljs-params">key</span>) </span>{
	utils.assertCompatible(key, Key, [<span class="hljs-number">1</span>, <span class="hljs-number">4</span>], <span class="hljs-string">'key'</span>);
	<span class="hljs-keyword">this</span>._isPriv = PrivateKey.isPrivateKey(key, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>]);
	<span class="hljs-keyword">this</span>._algo = key.type;
	<span class="hljs-keyword">this</span>._curve = key.curve;
	<span class="hljs-keyword">this</span>._key = key;
	<span class="hljs-keyword">if</span> (key.type === <span class="hljs-string">'dsa'</span>) {
		<span class="hljs-keyword">if</span> (!CRYPTO_HAVE_ECDH) {
			<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Due to bugs in the node 0.10 '</span> +
			    <span class="hljs-string">'crypto API, node 0.12.x or later is required '</span> +
			    <span class="hljs-string">'to use DH'</span>));
		}
		<span class="hljs-keyword">this</span>._dh = crypto.createDiffieHellman(
		    key.part.p.data, <span class="hljs-literal">undefined</span>,
		    key.part.g.data, <span class="hljs-literal">undefined</span>);
		<span class="hljs-keyword">this</span>._p = key.part.p;
		<span class="hljs-keyword">this</span>._g = key.part.g;
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isPriv)
			<span class="hljs-keyword">this</span>._dh.setPrivateKey(key.part.x.data);
		<span class="hljs-keyword">this</span>._dh.setPublicKey(key.part.y.data);

	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.type === <span class="hljs-string">'ecdsa'</span>) {
		<span class="hljs-keyword">if</span> (!CRYPTO_HAVE_ECDH) {
			<span class="hljs-keyword">if</span> (ecdh === <span class="hljs-literal">undefined</span>)
				ecdh = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ecc-jsbn'</span>);
			<span class="hljs-keyword">if</span> (ec === <span class="hljs-literal">undefined</span>)
				ec = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ecc-jsbn/lib/ec'</span>);
			<span class="hljs-keyword">if</span> (jsbn === <span class="hljs-literal">undefined</span>)
				jsbn = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsbn'</span>).BigInteger;

			<span class="hljs-keyword">this</span>._ecParams = <span class="hljs-keyword">new</span> X9ECParameters(<span class="hljs-keyword">this</span>._curve);

			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isPriv) {
				<span class="hljs-keyword">this</span>._priv = <span class="hljs-keyword">new</span> ECPrivate(
				    <span class="hljs-keyword">this</span>._ecParams, key.part.d.data);
			}
			<span class="hljs-keyword">return</span>;
		}

		<span class="hljs-keyword">var</span> curve = {
			<span class="hljs-string">'nistp256'</span>: <span class="hljs-string">'prime256v1'</span>,
			<span class="hljs-string">'nistp384'</span>: <span class="hljs-string">'secp384r1'</span>,
			<span class="hljs-string">'nistp521'</span>: <span class="hljs-string">'secp521r1'</span>
		}[key.curve];
		<span class="hljs-keyword">this</span>._dh = crypto.createECDH(curve);
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> (<span class="hljs-keyword">this</span>._dh) !== <span class="hljs-string">'object'</span> ||
		    <span class="hljs-keyword">typeof</span> (<span class="hljs-keyword">this</span>._dh.setPrivateKey) !== <span class="hljs-string">'function'</span>) {
			CRYPTO_HAVE_ECDH = <span class="hljs-literal">false</span>;
			DiffieHellman.call(<span class="hljs-keyword">this</span>, key);
			<span class="hljs-keyword">return</span>;
		}
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isPriv)
			<span class="hljs-keyword">this</span>._dh.setPrivateKey(key.part.d.data);
		<span class="hljs-keyword">this</span>._dh.setPublicKey(key.part.Q.data);

	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (key.type === <span class="hljs-string">'curve25519'</span>) {
		<span class="hljs-keyword">if</span> (ed === <span class="hljs-literal">undefined</span>)
			ed = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jodid25519'</span>);

		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isPriv) {
			<span class="hljs-keyword">this</span>._priv = key.part.r.data;
			<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._priv[<span class="hljs-number">0</span>] === <span class="hljs-number">0x00</span>)
				<span class="hljs-keyword">this</span>._priv = <span class="hljs-keyword">this</span>._priv.slice(<span class="hljs-number">1</span>);
			<span class="hljs-keyword">this</span>._priv = <span class="hljs-keyword">this</span>._priv.slice(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>);
		}

	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'DH not supported for '</span> + key.type + <span class="hljs-string">' keys'</span>));
	}
}

DiffieHellman.prototype.getPublicKey = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isPriv)
		<span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._key.toPublic());
	<span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._key);
};

DiffieHellman.prototype.getPrivateKey = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._isPriv)
		<span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._key);
	<span class="hljs-keyword">else</span>
		<span class="hljs-keyword">return</span> (<span class="hljs-literal">undefined</span>);
};
DiffieHellman.prototype.getKey = DiffieHellman.prototype.getPrivateKey;

DiffieHellman.prototype._keyCheck = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pk, isPub</span>) </span>{
	assert.object(pk, <span class="hljs-string">'key'</span>);
	<span class="hljs-keyword">if</span> (!isPub)
		utils.assertCompatible(pk, PrivateKey, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>], <span class="hljs-string">'key'</span>);
	utils.assertCompatible(pk, Key, [<span class="hljs-number">1</span>, <span class="hljs-number">4</span>], <span class="hljs-string">'key'</span>);

	<span class="hljs-keyword">if</span> (pk.type !== <span class="hljs-keyword">this</span>._algo) {
		<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'A '</span> + pk.type + <span class="hljs-string">' key cannot be used in '</span> +
		    <span class="hljs-keyword">this</span>._algo + <span class="hljs-string">' Diffie-Hellman'</span>));
	}

	<span class="hljs-keyword">if</span> (pk.curve !== <span class="hljs-keyword">this</span>._curve) {
		<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'A key from the '</span> + pk.curve + <span class="hljs-string">' curve '</span> +
		    <span class="hljs-string">'cannot be used with a '</span> + <span class="hljs-keyword">this</span>._curve +
		    <span class="hljs-string">' Diffie-Hellman'</span>));
	}

	<span class="hljs-keyword">if</span> (pk.type === <span class="hljs-string">'dsa'</span>) {
		assert.deepEqual(pk.part.p, <span class="hljs-keyword">this</span>._p,
		    <span class="hljs-string">'DSA key prime does not match'</span>);
		assert.deepEqual(pk.part.g, <span class="hljs-keyword">this</span>._g,
		    <span class="hljs-string">'DSA key generator does not match'</span>);
	}
};

DiffieHellman.prototype.setKey = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pk</span>) </span>{
	<span class="hljs-keyword">this</span>._keyCheck(pk);

	<span class="hljs-keyword">if</span> (pk.type === <span class="hljs-string">'dsa'</span>) {
		<span class="hljs-keyword">this</span>._dh.setPrivateKey(pk.part.x.data);
		<span class="hljs-keyword">this</span>._dh.setPublicKey(pk.part.y.data);

	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pk.type === <span class="hljs-string">'ecdsa'</span>) {
		<span class="hljs-keyword">if</span> (CRYPTO_HAVE_ECDH) {
			<span class="hljs-keyword">this</span>._dh.setPrivateKey(pk.part.d.data);
			<span class="hljs-keyword">this</span>._dh.setPublicKey(pk.part.Q.data);
		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">this</span>._priv = <span class="hljs-keyword">new</span> ECPrivate(
			    <span class="hljs-keyword">this</span>._ecParams, pk.part.d.data);
		}

	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (pk.type === <span class="hljs-string">'curve25519'</span>) {
		<span class="hljs-keyword">this</span>._priv = pk.part.r.data;
		<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._priv[<span class="hljs-number">0</span>] === <span class="hljs-number">0x00</span>)
			<span class="hljs-keyword">this</span>._priv = <span class="hljs-keyword">this</span>._priv.slice(<span class="hljs-number">1</span>);
		<span class="hljs-keyword">this</span>._priv = <span class="hljs-keyword">this</span>._priv.slice(<span class="hljs-number">0</span>, <span class="hljs-number">32</span>);
	}
	<span class="hljs-keyword">this</span>._key = pk;
	<span class="hljs-keyword">this</span>._isPriv = <span class="hljs-literal">true</span>;
};
DiffieHellman.prototype.setPrivateKey = DiffieHellman.prototype.setKey;

DiffieHellman.prototype.computeSecret = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">otherpk</span>) </span>{
	<span class="hljs-keyword">this</span>._keyCheck(otherpk, <span class="hljs-literal">true</span>);
	<span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._isPriv)
		<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'DH exchange has not been initialized with '</span> +
		    <span class="hljs-string">'a private key yet'</span>));

	<span class="hljs-keyword">var</span> pub;
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._algo === <span class="hljs-string">'dsa'</span>) {
		<span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._dh.computeSecret(
		    otherpk.part.y.data));

	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._algo === <span class="hljs-string">'ecdsa'</span>) {
		<span class="hljs-keyword">if</span> (CRYPTO_HAVE_ECDH) {
			<span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._dh.computeSecret(
			    otherpk.part.Q.data));
		} <span class="hljs-keyword">else</span> {
			pub = <span class="hljs-keyword">new</span> ECPublic(
			    <span class="hljs-keyword">this</span>._ecParams, otherpk.part.Q.data);
			<span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._priv.deriveSharedSecret(pub));
		}

	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._algo === <span class="hljs-string">'curve25519'</span>) {
		pub = otherpk.part.R.data;
		<span class="hljs-keyword">if</span> (pub[<span class="hljs-number">0</span>] === <span class="hljs-number">0x00</span>)
			pub = pub.slice(<span class="hljs-number">1</span>);

		<span class="hljs-keyword">var</span> secret = ed.dh.computeKey(
		    <span class="hljs-keyword">this</span>._priv.toString(<span class="hljs-string">'binary'</span>),
		    pub.toString(<span class="hljs-string">'binary'</span>));

		<span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> Buffer(secret, <span class="hljs-string">'binary'</span>));
	}

	<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid algorithm: '</span> + <span class="hljs-keyword">this</span>._algo));
};

DiffieHellman.prototype.generateKey = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
	<span class="hljs-keyword">var</span> parts = [];
	<span class="hljs-keyword">var</span> priv, pub;
	<span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._algo === <span class="hljs-string">'dsa'</span>) {
		<span class="hljs-keyword">this</span>._dh.generateKeys();

		parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'p'</span>, <span class="hljs-attr">data</span>: <span class="hljs-keyword">this</span>._p.data});
		parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'q'</span>, <span class="hljs-attr">data</span>: <span class="hljs-keyword">this</span>._key.part.q.data});
		parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'g'</span>, <span class="hljs-attr">data</span>: <span class="hljs-keyword">this</span>._g.data});
		parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'y'</span>, <span class="hljs-attr">data</span>: <span class="hljs-keyword">this</span>._dh.getPublicKey()});
		parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'x'</span>, <span class="hljs-attr">data</span>: <span class="hljs-keyword">this</span>._dh.getPrivateKey()});
		<span class="hljs-keyword">this</span>._key = <span class="hljs-keyword">new</span> PrivateKey({
			<span class="hljs-attr">type</span>: <span class="hljs-string">'dsa'</span>,
			<span class="hljs-attr">parts</span>: parts
		});
		<span class="hljs-keyword">this</span>._isPriv = <span class="hljs-literal">true</span>;
		<span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._key);

	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._algo === <span class="hljs-string">'ecdsa'</span>) {
		<span class="hljs-keyword">if</span> (CRYPTO_HAVE_ECDH) {
			<span class="hljs-keyword">this</span>._dh.generateKeys();

			parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'curve'</span>,
			    <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> Buffer(<span class="hljs-keyword">this</span>._curve)});
			parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'Q'</span>, <span class="hljs-attr">data</span>: <span class="hljs-keyword">this</span>._dh.getPublicKey()});
			parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'d'</span>, <span class="hljs-attr">data</span>: <span class="hljs-keyword">this</span>._dh.getPrivateKey()});
			<span class="hljs-keyword">this</span>._key = <span class="hljs-keyword">new</span> PrivateKey({
				<span class="hljs-attr">type</span>: <span class="hljs-string">'ecdsa'</span>,
				<span class="hljs-attr">curve</span>: <span class="hljs-keyword">this</span>._curve,
				<span class="hljs-attr">parts</span>: parts
			});
			<span class="hljs-keyword">this</span>._isPriv = <span class="hljs-literal">true</span>;
			<span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._key);

		} <span class="hljs-keyword">else</span> {
			<span class="hljs-keyword">var</span> n = <span class="hljs-keyword">this</span>._ecParams.getN();
			<span class="hljs-keyword">var</span> r = <span class="hljs-keyword">new</span> jsbn(crypto.randomBytes(n.bitLength()));
			<span class="hljs-keyword">var</span> n1 = n.subtract(jsbn.ONE);
			priv = r.mod(n1).add(jsbn.ONE);
			pub = <span class="hljs-keyword">this</span>._ecParams.getG().multiply(priv);

			priv = <span class="hljs-keyword">new</span> Buffer(priv.toByteArray());
			pub = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-keyword">this</span>._ecParams.getCurve().
			    encodePointHex(pub), <span class="hljs-string">'hex'</span>);

			<span class="hljs-keyword">this</span>._priv = <span class="hljs-keyword">new</span> ECPrivate(<span class="hljs-keyword">this</span>._ecParams, priv);

			parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'curve'</span>,
			    <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> Buffer(<span class="hljs-keyword">this</span>._curve)});
			parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'Q'</span>, <span class="hljs-attr">data</span>: pub});
			parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'d'</span>, <span class="hljs-attr">data</span>: priv});

			<span class="hljs-keyword">this</span>._key = <span class="hljs-keyword">new</span> PrivateKey({
				<span class="hljs-attr">type</span>: <span class="hljs-string">'ecdsa'</span>,
				<span class="hljs-attr">curve</span>: <span class="hljs-keyword">this</span>._curve,
				<span class="hljs-attr">parts</span>: parts
			});
			<span class="hljs-keyword">this</span>._isPriv = <span class="hljs-literal">true</span>;
			<span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._key);
		}

	} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._algo === <span class="hljs-string">'curve25519'</span>) {
		priv = ed.dh.generateKey();
		pub = ed.dh.publicKey(priv);
		<span class="hljs-keyword">this</span>._priv = priv = <span class="hljs-keyword">new</span> Buffer(priv, <span class="hljs-string">'binary'</span>);
		pub = <span class="hljs-keyword">new</span> Buffer(pub, <span class="hljs-string">'binary'</span>);

		parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'R'</span>, <span class="hljs-attr">data</span>: pub});
		parts.push({<span class="hljs-attr">name</span>: <span class="hljs-string">'r'</span>, <span class="hljs-attr">data</span>: Buffer.concat([priv, pub])});
		<span class="hljs-keyword">this</span>._key = <span class="hljs-keyword">new</span> PrivateKey({
			<span class="hljs-attr">type</span>: <span class="hljs-string">'curve25519'</span>,
			<span class="hljs-attr">parts</span>: parts
		});
		<span class="hljs-keyword">this</span>._isPriv = <span class="hljs-literal">true</span>;
		<span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>._key);
	}

	<span class="hljs-keyword">throw</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Invalid algorithm: '</span> + <span class="hljs-keyword">this</span>._algo));
};
DiffieHellman.prototype.generateKeys = DiffieHellman.prototype.generateKey;

<span class="hljs-comment">/* These are helpers for using ecc-jsbn (for node 0.10 compatibility). */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">X9ECParameters</span>(<span class="hljs-params">name</span>) </span>{
	<span class="hljs-keyword">var</span> params = algs.curves[name];
	assert.object(params);

	<span class="hljs-keyword">var</span> p = <span class="hljs-keyword">new</span> jsbn(params.p);
	<span class="hljs-keyword">var</span> a = <span class="hljs-keyword">new</span> jsbn(params.a);
	<span class="hljs-keyword">var</span> b = <span class="hljs-keyword">new</span> jsbn(params.b);
	<span class="hljs-keyword">var</span> n = <span class="hljs-keyword">new</span> jsbn(params.n);
	<span class="hljs-keyword">var</span> h = jsbn.ONE;
	<span class="hljs-keyword">var</span> curve = <span class="hljs-keyword">new</span> ec.ECCurveFp(p, a, b);
	<span class="hljs-keyword">var</span> G = curve.decodePointHex(params.G.toString(<span class="hljs-string">'hex'</span>));

	<span class="hljs-keyword">this</span>.curve = curve;
	<span class="hljs-keyword">this</span>.g = G;
	<span class="hljs-keyword">this</span>.n = n;
	<span class="hljs-keyword">this</span>.h = h;
}
X9ECParameters.prototype.getCurve = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.curve); };
X9ECParameters.prototype.getG = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.g); };
X9ECParameters.prototype.getN = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.n); };
X9ECParameters.prototype.getH = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{ <span class="hljs-keyword">return</span> (<span class="hljs-keyword">this</span>.h); };

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ECPublic</span>(<span class="hljs-params">params, buffer</span>) </span>{
	<span class="hljs-keyword">this</span>._params = params;
	<span class="hljs-keyword">if</span> (buffer[<span class="hljs-number">0</span>] === <span class="hljs-number">0x00</span>)
		buffer = buffer.slice(<span class="hljs-number">1</span>);
	<span class="hljs-keyword">this</span>._pub = params.getCurve().decodePointHex(buffer.toString(<span class="hljs-string">'hex'</span>));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ECPrivate</span>(<span class="hljs-params">params, buffer</span>) </span>{
	<span class="hljs-keyword">this</span>._params = params;
	<span class="hljs-keyword">this</span>._priv = <span class="hljs-keyword">new</span> jsbn(utils.mpNormalize(buffer));
}
ECPrivate.prototype.deriveSharedSecret = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pubKey</span>) </span>{
	assert.ok(pubKey <span class="hljs-keyword">instanceof</span> ECPublic);
	<span class="hljs-keyword">var</span> S = pubKey._pub.multiply(<span class="hljs-keyword">this</span>._priv);
	<span class="hljs-keyword">return</span> (<span class="hljs-keyword">new</span> Buffer(S.getX().toBigInteger().toByteArray()));
};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
