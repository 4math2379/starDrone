<!DOCTYPE html>
<html>
<head>
  <title>00-setup-fixtures.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/tar/test/00-setup-fixtures.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>00-setup-fixtures.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>the fixtures have some weird stuff that is painful
to include directly in the repo for various reasons.</p>
<p>So, unpack the fixtures with the system tar first.</p>
<p>This means, of course, that it'll only work if you
already have a tar implementation, and some of them
will not properly unpack the fixtures anyway.</p>
<p>But, since usually those tests will fail on Windows
and other systems with less capable filesystems anyway,
at least this way we don't cause inconveniences by
merely cloning the repo or installing the package.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-keyword">var</span> tap = <span class="hljs-built_in">require</span>(<span class="hljs-string">"tap"</span>)
, child_process = <span class="hljs-built_in">require</span>(<span class="hljs-string">"child_process"</span>)
, rimraf = <span class="hljs-built_in">require</span>(<span class="hljs-string">"rimraf"</span>)
, test = tap.test
, path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>)

test(<span class="hljs-string">"clean fixtures"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  rimraf(path.resolve(__dirname, <span class="hljs-string">"fixtures"</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">er</span>) </span>{
    t.ifError(er, <span class="hljs-string">"rimraf ./fixtures/"</span>)
    t.end()
  })
})

test(<span class="hljs-string">"clean tmp"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  rimraf(path.resolve(__dirname, <span class="hljs-string">"tmp"</span>), <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">er</span>) </span>{
    t.ifError(er, <span class="hljs-string">"rimraf ./tmp/"</span>)
    t.end()
  })
})

test(<span class="hljs-string">"extract fixtures"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> c = child_process.spawn(<span class="hljs-string">"tar"</span>
                             ,[<span class="hljs-string">"xzvf"</span>, <span class="hljs-string">"fixtures.tgz"</span>]
                             ,{ <span class="hljs-attr">cwd</span>: __dirname })

  c.stdout.on(<span class="hljs-string">"data"</span>, errwrite)
  c.stderr.on(<span class="hljs-string">"data"</span>, errwrite)
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">errwrite</span> (<span class="hljs-params">chunk</span>) </span>{
    process.stderr.write(chunk)
  }

  c.on(<span class="hljs-string">"exit"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">code</span>) </span>{
    t.equal(code, <span class="hljs-number">0</span>, <span class="hljs-string">"extract fixtures should exit with 0"</span>)
    <span class="hljs-keyword">if</span> (code) {
      t.comment(<span class="hljs-string">"Note, all tests from here on out will fail because of this."</span>)
    }
    t.end()
  })
})

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
