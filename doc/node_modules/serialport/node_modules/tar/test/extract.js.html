<!DOCTYPE html>
<html>
<head>
  <title>extract.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/tar/test/extract.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>extract.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>Set the umask, so that it works the same everywhere.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">process.umask(<span class="hljs-built_in">parseInt</span>(<span class="hljs-string">'22'</span>, <span class="hljs-number">8</span>))

<span class="hljs-keyword">var</span> tap = <span class="hljs-built_in">require</span>(<span class="hljs-string">"tap"</span>)
  , tar = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../tar.js"</span>)
  , fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>)
  , path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>)
  , file = path.resolve(__dirname, <span class="hljs-string">"fixtures/c.tar"</span>)
  , target = path.resolve(__dirname, <span class="hljs-string">"tmp/extract-test"</span>)
  , index = <span class="hljs-number">0</span>
  , fstream = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fstream"</span>)

  , ee = <span class="hljs-number">0</span>
  , expectEntries =
[ { <span class="hljs-attr">path</span>: <span class="hljs-string">'c.txt'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'0'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">513</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">dev</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">ino</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'cc.txt'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'0'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">513</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">dev</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">ino</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'r/e/a/l/l/y/-/d/e/e/p/-/f/o/l/d/e/r/-/p/a/t/h/cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'0'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">dev</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">ino</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'Ω.txt'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'0'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">dev</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">ino</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'Ω.txt'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'0'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">dev</span>: <span class="hljs-number">234881026</span>,
    <span class="hljs-attr">ino</span>: <span class="hljs-number">51693379</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'200ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'0'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">dev</span>: <span class="hljs-number">234881026</span>,
    <span class="hljs-attr">ino</span>: <span class="hljs-number">51681874</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'200ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'0'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">201</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">dev</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">ino</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'200LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'777'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'2'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-string">'200ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc'</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">dev</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">ino</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'200-hard'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'0'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">dev</span>: <span class="hljs-number">234881026</span>,
    <span class="hljs-attr">ino</span>: <span class="hljs-number">51681874</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'200ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'1'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">linkpath</span>: path.resolve(target, <span class="hljs-string">'200-hard'</span>),
    <span class="hljs-attr">nlink</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">dev</span>: <span class="hljs-number">234881026</span>,
    <span class="hljs-attr">ino</span>: <span class="hljs-number">51681874</span> } ]

  , ef = <span class="hljs-number">0</span>
  , expectFiles =
[ { <span class="hljs-attr">path</span>: <span class="hljs-string">''</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/200-hard'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'100644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'File'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-number">2</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/200LLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLL'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'120777'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'SymbolicLink'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-string">'200ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc'</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-number">1</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/200ccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'100644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Link'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">200</span>,
    <span class="hljs-attr">linkpath</span>: path.join(target, <span class="hljs-string">'200-hard'</span>),
    <span class="hljs-attr">nlink</span>: <span class="hljs-number">2</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/c.txt'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'100644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'File'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">513</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-number">1</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/cc.txt'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'100644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'File'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">513</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-number">1</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">4</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">6</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">7</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">8</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">9</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">10</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">11</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">12</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">13</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f/o'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">14</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f/o/l'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">15</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f/o/l/d'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">16</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f/o/l/d/e'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">17</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f/o/l/d/e/r'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">18</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f/o/l/d/e/r/-'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">19</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f/o/l/d/e/r/-/p'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f/o/l/d/e/r/-/p/a'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">21</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f/o/l/d/e/r/-/p/a/t'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">22</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f/o/l/d/e/r/-/p/a/t/h'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'40755'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'Directory'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">23</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/r/e/a/l/l/y/-/d/e/e/p/-/f/o/l/d/e/r/-/p/a/t/h/cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'100644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'File'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">24</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">100</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-number">1</span> },
  { <span class="hljs-attr">path</span>: <span class="hljs-string">'/Ω.txt'</span>,
    <span class="hljs-attr">mode</span>: <span class="hljs-string">'100644'</span>,
    <span class="hljs-attr">type</span>: <span class="hljs-string">'File'</span>,
    <span class="hljs-attr">depth</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">size</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">linkpath</span>: <span class="hljs-literal">undefined</span>,
    <span class="hljs-attr">nlink</span>: <span class="hljs-number">1</span> } ]



</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>The extract class basically just pipes the input
to a Reader, and then to a fstream.DirWriter</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>So, this is as much a test of fstream.Reader and fstream.Writer
as it is of tar.Extract, but it sort of makes sense.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
tap.test(<span class="hljs-string">"preclean"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  <span class="hljs-built_in">require</span>(<span class="hljs-string">"rimraf"</span>).sync(__dirname + <span class="hljs-string">"/tmp/extract-test"</span>)
  t.pass(<span class="hljs-string">"cleaned!"</span>)
  t.end()
})

tap.test(<span class="hljs-string">"extract test"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">t</span>) </span>{
  <span class="hljs-keyword">var</span> extract = tar.Extract(target)
  <span class="hljs-keyword">var</span> inp = fs.createReadStream(file)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>give it a weird buffer size to try to break in odd places</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  inp.bufferSize = <span class="hljs-number">1234</span>

  inp.pipe(extract)

  extract.on(<span class="hljs-string">"end"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    t.equal(ee, expectEntries.length, <span class="hljs-string">"should see "</span>+ee+<span class="hljs-string">" entries"</span>)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>should get no more entries after end</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    extract.removeAllListeners(<span class="hljs-string">"entry"</span>)
    extract.on(<span class="hljs-string">"entry"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
      t.fail(<span class="hljs-string">"Should not get entries after end!"</span>)
    })

    next()
  })

  extract.on(<span class="hljs-string">"entry"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
    <span class="hljs-keyword">var</span> found =
      { <span class="hljs-attr">path</span>: entry.path
      , <span class="hljs-attr">mode</span>: entry.props.mode.toString(<span class="hljs-number">8</span>)
      , <span class="hljs-attr">type</span>: entry.props.type
      , <span class="hljs-attr">depth</span>: entry.props.depth
      , <span class="hljs-attr">size</span>: entry.props.size
      , <span class="hljs-attr">linkpath</span>: entry.props.linkpath
      , <span class="hljs-attr">nlink</span>: entry.props.nlink
      , <span class="hljs-attr">dev</span>: entry.props.dev
      , <span class="hljs-attr">ino</span>: entry.props.ino
      }

    <span class="hljs-keyword">var</span> wanted = expectEntries[ee ++]

    t.equivalent(found, wanted, <span class="hljs-string">"tar entry "</span> + ee + <span class="hljs-string">" "</span> + wanted.path)
  })

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">next</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> r = fstream.Reader({ <span class="hljs-attr">path</span>: target
                           , <span class="hljs-attr">type</span>: <span class="hljs-string">"Directory"</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>this is just to encourage consistency</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                           , <span class="hljs-attr">sort</span>: <span class="hljs-string">"alpha"</span> })

    r.on(<span class="hljs-string">"ready"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
      foundEntry(r)
    })

    r.on(<span class="hljs-string">"end"</span>, finish)

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">foundEntry</span> (<span class="hljs-params">entry</span>) </span>{
      <span class="hljs-keyword">var</span> p = entry.path.substr(target.length)
      <span class="hljs-keyword">var</span> found =
        { <span class="hljs-attr">path</span>: p
        , <span class="hljs-attr">mode</span>: entry.props.mode.toString(<span class="hljs-number">8</span>)
        , <span class="hljs-attr">type</span>: entry.props.type
        , <span class="hljs-attr">depth</span>: entry.props.depth
        , <span class="hljs-attr">size</span>: entry.props.size
        , <span class="hljs-attr">linkpath</span>: entry.props.linkpath
        , <span class="hljs-attr">nlink</span>: entry.props.nlink
        }

      <span class="hljs-keyword">var</span> wanted = expectFiles[ef ++]

      t.has(found, wanted, <span class="hljs-string">"unpacked file "</span> + ef + <span class="hljs-string">" "</span> + wanted.path)

      entry.on(<span class="hljs-string">"entry"</span>, foundEntry)
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">finish</span> (<span class="hljs-params"></span>) </span>{
      t.equal(ef, expectFiles.length, <span class="hljs-string">"should have "</span>+ef+<span class="hljs-string">" items"</span>)
      t.end()
    }
  }
})

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
