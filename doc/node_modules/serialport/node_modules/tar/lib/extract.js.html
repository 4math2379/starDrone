<!DOCTYPE html>
<html>
<head>
  <title>extract.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../doc-style.css" />
  <script src="../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../";
    var thisFile = "node_modules/serialport/node_modules/tar/lib/extract.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>extract.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>give it a tarball and a path, and it'll dump the contents</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
<span class="hljs-built_in">module</span>.exports = Extract

<span class="hljs-keyword">var</span> tar = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../tar.js"</span>)
  , fstream = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fstream"</span>)
  , inherits = <span class="hljs-built_in">require</span>(<span class="hljs-string">"inherits"</span>)
  , path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>)

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Extract</span> (<span class="hljs-params">opts</span>) </span>{
  <span class="hljs-keyword">if</span> (!(<span class="hljs-keyword">this</span> <span class="hljs-keyword">instanceof</span> Extract)) <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> Extract(opts)
  tar.Parse.apply(<span class="hljs-keyword">this</span>)

  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts !== <span class="hljs-string">"object"</span>) {
    opts = { <span class="hljs-attr">path</span>: opts }
  }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>better to drop in cwd? seems more standard.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  opts.path = opts.path || path.resolve(<span class="hljs-string">"node-tar-extract"</span>)
  opts.type = <span class="hljs-string">"Directory"</span>
  opts.Directory = <span class="hljs-literal">true</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>similar to --strip or --strip-components</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  opts.strip = +opts.strip
  <span class="hljs-keyword">if</span> (!opts.strip || opts.strip &lt;= <span class="hljs-number">0</span>) opts.strip = <span class="hljs-number">0</span>

  <span class="hljs-keyword">this</span>._fst = fstream.Writer(opts)

  <span class="hljs-keyword">this</span>.pause()
  <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Hardlinks in tarballs are relative to the root
of the tarball.  So, they need to be resolved against
the target directory in order to be created properly.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  me.on(<span class="hljs-string">"entry"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>if there's a &quot;strip&quot; argument, then strip off that many
path components.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (opts.strip) {
      <span class="hljs-keyword">var</span> p = entry.path.split(<span class="hljs-string">"/"</span>).slice(opts.strip).join(<span class="hljs-string">"/"</span>)
      entry.path = entry.props.path = p
      <span class="hljs-keyword">if</span> (entry.linkpath) {
        <span class="hljs-keyword">var</span> lp = entry.linkpath.split(<span class="hljs-string">"/"</span>).slice(opts.strip).join(<span class="hljs-string">"/"</span>)
        entry.linkpath = entry.props.linkpath = lp
      }
    }
    <span class="hljs-keyword">if</span> (entry.type === <span class="hljs-string">"Link"</span>) {
      entry.linkpath = entry.props.linkpath =
        path.join(opts.path, path.join(<span class="hljs-string">"/"</span>, entry.props.linkpath))
    }

    <span class="hljs-keyword">if</span> (entry.type === <span class="hljs-string">"SymbolicLink"</span>) {
      <span class="hljs-keyword">var</span> dn = path.dirname(entry.path) || <span class="hljs-string">""</span>
      <span class="hljs-keyword">var</span> linkpath = entry.props.linkpath
      <span class="hljs-keyword">var</span> target = path.resolve(opts.path, dn, linkpath)
      <span class="hljs-keyword">if</span> (target.indexOf(opts.path) !== <span class="hljs-number">0</span>) {
        linkpath = path.join(opts.path, path.join(<span class="hljs-string">"/"</span>, linkpath))
      }
      entry.linkpath = entry.props.linkpath = linkpath
    }
  })

  <span class="hljs-keyword">this</span>._fst.on(<span class="hljs-string">"ready"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    me.pipe(me._fst, { <span class="hljs-attr">end</span>: <span class="hljs-literal">false</span> })
    me.resume()
  })

  <span class="hljs-keyword">this</span>._fst.on(<span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
    me.emit(<span class="hljs-string">'error'</span>, err)
  })

  <span class="hljs-keyword">this</span>._fst.on(<span class="hljs-string">'drain'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    me.emit(<span class="hljs-string">'drain'</span>)
  })

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>this._fst.on(&quot;end&quot;, function () {
console.error(&quot;\nEEEE Extract End&quot;, me._fst.path)
})</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">
  <span class="hljs-keyword">this</span>._fst.on(<span class="hljs-string">"close"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>console.error(&quot;\nEEEE Extract End&quot;, me._fst.path)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    me.emit(<span class="hljs-string">"finish"</span>)
    me.emit(<span class="hljs-string">"end"</span>)
    me.emit(<span class="hljs-string">"close"</span>)
  })
}

inherits(Extract, tar.Parse)

Extract.prototype._streamEnd = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> me = <span class="hljs-keyword">this</span>
  <span class="hljs-keyword">if</span> (!me._ended || me._entry) me.error(<span class="hljs-string">"unexpected eof"</span>)
  me._fst.end()
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>my .end() is coming later.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
