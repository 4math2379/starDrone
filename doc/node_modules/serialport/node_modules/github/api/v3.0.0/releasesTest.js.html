<!DOCTYPE html>
<html>
<head>
  <title>releasesTest.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../doc-style.css" />
  <script src="../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../";
    var thisFile = "node_modules/serialport/node_modules/github/api/v3.0.0/releasesTest.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>releasesTest.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<div class="dox">
<div class="summary">
<p>Copyright 2012 Cloud9 IDE, Inc.</p>
</div>
<div class="body">
<p>This product includes software developed by
Cloud9 IDE, Inc (http://c9.io).</p>
<p>Author: Mike de Boer <a href="mailto:info@mikedeboer.nl.html">info@mikedeboer.nl</a></p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">
"use strict"</span>;

<span class="hljs-keyword">var</span> Assert = <span class="hljs-built_in">require</span>(<span class="hljs-string">"assert"</span>);
<span class="hljs-keyword">var</span> Client = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./../../index"</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">var</span> mime = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mime"</span>);

describe(<span class="hljs-string">"[releases]"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> client;
    <span class="hljs-keyword">var</span> token = <span class="hljs-string">"c286e38330e15246a640c2cf32a45ea45d93b2ba"</span>;

    <span class="hljs-keyword">var</span> owner = <span class="hljs-string">"greggman"</span>;
    <span class="hljs-keyword">var</span> repo  = <span class="hljs-string">"test"</span>;
    <span class="hljs-keyword">var</span> haveWriteAccess = <span class="hljs-literal">true</span>;       <span class="hljs-comment">// set to false if the authenticated person below does not have write access to the repo above</span>
    <span class="hljs-keyword">var</span> releaseIdWithAsset = <span class="hljs-number">393621</span>;  <span class="hljs-comment">// Some release id from the repo above that has at least 1 asset.</span>
    <span class="hljs-keyword">var</span> filePathToUpload = __filename;
    <span class="hljs-keyword">var</span> fileSizeToUpload = fs.statSync(filePathToUpload).size;

    <span class="hljs-keyword">var</span> releaseId;      <span class="hljs-comment">// release id found when listing releases. Used for get release</span>
    <span class="hljs-keyword">var</span> newReleaseId;   <span class="hljs-comment">// release id created when creating release, used for edit and delete release</span>
    <span class="hljs-keyword">var</span> assetId;        <span class="hljs-comment">// asset id found when listing assets. Used for get asset</span>
    <span class="hljs-keyword">var</span> newAssetId;     <span class="hljs-comment">// asset id used when creating asset. Used for edit and delete asset</span>

    beforeEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        client = <span class="hljs-keyword">new</span> Client({
            <span class="hljs-attr">version</span>: <span class="hljs-string">"3.0.0"</span>
        });
        client.authenticate({
            <span class="hljs-attr">type</span>: <span class="hljs-string">"oauth"</span>,
            <span class="hljs-attr">token</span>: token
        });
    });

    it(<span class="hljs-string">"should successfully execute GET /repos/:owner/:repo/releases (listReleases)"</span>,  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        client.releases.listReleases(
            {
              <span class="hljs-attr">owner</span>: owner,
              <span class="hljs-attr">repo</span>: repo,
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>{
                Assert.equal(err, <span class="hljs-literal">null</span>);
                Assert.ok(res <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>);
                <span class="hljs-keyword">if</span> (res <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span> &amp;&amp; res.length &gt; <span class="hljs-number">0</span>) {
                  releaseId = res[<span class="hljs-number">0</span>].id;
                }
                next();
            }
        );
    });

    it(<span class="hljs-string">"should successfully execute GET /repos/:owner/:repo/releases/:id (getRelease)"</span>,  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        <span class="hljs-keyword">if</span> (!releaseId) {
            next();
            <span class="hljs-keyword">return</span>;
        }
        client.releases.getRelease(
            {
                <span class="hljs-attr">owner</span>: owner,
                <span class="hljs-attr">id</span>: releaseId,
                <span class="hljs-attr">repo</span>: repo
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>{
                Assert.equal(err, <span class="hljs-literal">null</span>);
                Assert.equal(res.id, releaseId);
                next();
            }
        );
    });

    it(<span class="hljs-string">"should successfully execute POST /repos/:owner/:repo/releases (createRelease)"</span>,  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        <span class="hljs-keyword">if</span> (!haveWriteAccess) {
          next();
          <span class="hljs-keyword">return</span>;
        }
        client.releases.createRelease(
            {
                <span class="hljs-attr">owner</span>: owner,
                <span class="hljs-attr">repo</span>: repo,
                <span class="hljs-attr">tag_name</span>: <span class="hljs-string">"node-github-tag"</span>,
                <span class="hljs-attr">target_commitish</span>: <span class="hljs-string">"master"</span>,
                <span class="hljs-attr">name</span>: <span class="hljs-string">"node-github-name"</span>,
                <span class="hljs-attr">body</span>: <span class="hljs-string">"node-github-body"</span>,
                <span class="hljs-attr">draft</span>: <span class="hljs-literal">false</span>,
                <span class="hljs-attr">prerelease</span>: <span class="hljs-literal">true</span>,
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>{
                Assert.equal(err, <span class="hljs-literal">null</span>);
                Assert.equal(res.tag_name, <span class="hljs-string">"node-github-tag"</span>);
                Assert.equal(res.target_commitish, <span class="hljs-string">"master"</span>);
                Assert.equal(res.name, <span class="hljs-string">"node-github-name"</span>);
                Assert.equal(res.body, <span class="hljs-string">"node-github-body"</span>);
                Assert.equal(res.assets.length, <span class="hljs-number">0</span>);
                Assert.ok(res.prerelease);
                Assert.ok(!res.draft);
                newReleaseId = res.id;
                next();
            }
        );
    });

    it(<span class="hljs-string">"should successfully execute PATCH /repos/:owner/:repo/releases/:id (editRelease)"</span>,  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        <span class="hljs-keyword">if</span> (!haveWriteAccess) {
          next();
          <span class="hljs-keyword">return</span>;
        }
        client.releases.editRelease(
            {
                <span class="hljs-attr">owner</span>: owner,
                <span class="hljs-attr">id</span>: newReleaseId,
                <span class="hljs-attr">repo</span>: repo,
                <span class="hljs-attr">tag_name</span>: <span class="hljs-string">"node-github-new-tag"</span>,
                <span class="hljs-attr">target_commitish</span>: <span class="hljs-string">"master"</span>,
                <span class="hljs-attr">name</span>: <span class="hljs-string">"node-github-new-name"</span>,
                <span class="hljs-attr">body</span>: <span class="hljs-string">"node-github-new-body"</span>,
                <span class="hljs-attr">draft</span>: <span class="hljs-literal">true</span>,
                <span class="hljs-attr">prerelease</span>: <span class="hljs-literal">true</span>,
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>{
                Assert.equal(err, <span class="hljs-literal">null</span>);
                Assert.equal(res.id, newReleaseId);
                Assert.equal(res.tag_name, <span class="hljs-string">"node-github-new-tag"</span>);
                Assert.equal(res.target_commitish, <span class="hljs-string">"master"</span>);
                Assert.equal(res.name, <span class="hljs-string">"node-github-new-name"</span>);
                Assert.equal(res.body, <span class="hljs-string">"node-github-new-body"</span>);
                Assert.equal(res.assets.length, <span class="hljs-number">0</span>);
                Assert.ok(res.prerelease);
                Assert.ok(res.draft);
                next();
            }
        );
    });

    it(<span class="hljs-string">"should successfully execute DELETE /repos/:owner/:repo/releases/:id (deleteRelease)"</span>,  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        <span class="hljs-keyword">if</span> (!haveWriteAccess) {
          next();
          <span class="hljs-keyword">return</span>;
        }
        client.releases.deleteRelease(
            {
                <span class="hljs-attr">owner</span>: owner,
                <span class="hljs-attr">repo</span>: repo,
                <span class="hljs-attr">id</span>: newReleaseId,
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>{
                Assert.equal(err, <span class="hljs-literal">null</span>);
                next();
            }
        );
    });

    it(<span class="hljs-string">"should successfully execute GET /repos/:owner/:repo/releases/:id/assets (listAssets)"</span>,  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        client.releases.listAssets(
            {
                <span class="hljs-attr">owner</span>: owner,
                <span class="hljs-attr">id</span>: releaseIdWithAsset,
                <span class="hljs-attr">repo</span>: repo
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>{
                Assert.equal(err, <span class="hljs-literal">null</span>);
                Assert.ok(res <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>);
                <span class="hljs-keyword">if</span> (res <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span> &amp;&amp; res.length &gt; <span class="hljs-number">0</span>) {
                    assetId = res[<span class="hljs-number">0</span>].id;
                }
                next();
            }
        );
    });

    it(<span class="hljs-string">"should successfully execute GET /repos/:owner/:repo/releases/assets/:id (getAsset)"</span>,  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        <span class="hljs-keyword">if</span> (!assetId) {
            next();
            <span class="hljs-keyword">return</span>;
        }
        client.releases.getAsset(
            {
                <span class="hljs-attr">owner</span>: owner,
                <span class="hljs-attr">id</span>: assetId,
                <span class="hljs-attr">repo</span>: repo
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>{
                Assert.equal(err, <span class="hljs-literal">null</span>);
                Assert.equal(res.id, assetId);
                next();
            }
        );
    });

    it(<span class="hljs-string">"should successfully execute POST /repos/:owner/:repo/releases/:id/assets (uploadAsset)"</span>,  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        <span class="hljs-keyword">var</span> name = <span class="hljs-string">"somenameornot.zip"</span>;
        client.releases.uploadAsset(
            {
                <span class="hljs-attr">owner</span>: owner,
                <span class="hljs-attr">id</span>: releaseIdWithAsset,
                <span class="hljs-attr">repo</span>: repo,
                <span class="hljs-attr">name</span>: name,
                <span class="hljs-attr">filePath</span>: filePathToUpload
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>{
                Assert.equal(err, <span class="hljs-literal">null</span>);
                Assert.equal(res.content_type, mime.lookup(name));  <span class="hljs-comment">// matches extension of name, not filePath</span>
                Assert.equal(res.state, <span class="hljs-string">"uploaded"</span>);
                Assert.equal(res.size, fileSizeToUpload);
                Assert.equal(res.name, name);
                newAssetId = res.id;
                next();
            }
        );
    });

    it(<span class="hljs-string">"should successfully execute PATCH /repos/:owner/:repo/releases/assets/:id (editAsset)"</span>,  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        <span class="hljs-keyword">if</span> (!newAssetId) {
            next();
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">var</span> newName = <span class="hljs-string">"somenewname.zip"</span>;
        client.releases.editAsset(
            {
                <span class="hljs-attr">owner</span>: owner,
                <span class="hljs-attr">id</span>: newAssetId,
                <span class="hljs-attr">repo</span>: repo,
                <span class="hljs-attr">name</span>: newName,
                <span class="hljs-attr">label</span>: <span class="hljs-string">"foo"</span>
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>{
                Assert.equal(err, <span class="hljs-literal">null</span>);
                Assert.equal(res.state, <span class="hljs-string">"uploaded"</span>);
                Assert.equal(res.size, fileSizeToUpload);
                Assert.equal(res.name, newName);
                Assert.equal(res.label, <span class="hljs-string">"foo"</span>);
                next();
            }
        );
    });

    it(<span class="hljs-string">"should successfully execute DELETE /repos/:owner/:repo/releases/assets/:id (deleteAsset)"</span>,  <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">next</span>) </span>{
        <span class="hljs-keyword">if</span> (!newAssetId) {
            next();
            <span class="hljs-keyword">return</span>;
        }
        client.releases.deleteAsset(
            {
                <span class="hljs-attr">owner</span>: owner,
                <span class="hljs-attr">id</span>: newAssetId,
                <span class="hljs-attr">repo</span>: repo
            },
            <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>{
                Assert.equal(err, <span class="hljs-literal">null</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>other assertions go here</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                next();
            }
        );
    });
});

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
