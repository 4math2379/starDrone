<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../";
    var thisFile = "node_modules/serialport/node_modules/github/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h5">
        <a href="#example">Example</a>
      </div>

      <div class="heading h5">
        <a href="#example-1">Example</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>;

<span class="hljs-keyword">var</span> error = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./error"</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">var</span> mime = <span class="hljs-built_in">require</span>(<span class="hljs-string">"mime"</span>);
<span class="hljs-keyword">var</span> Util = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">var</span> Url = <span class="hljs-built_in">require</span>(<span class="hljs-string">"url"</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<p>section: github
class Client</p>
</div>
<div class="body">
<p>Copyright 2012 Cloud9 IDE, Inc.</p>
<p>This product includes software developed by
Cloud9 IDE, Inc (http://c9.io).</p>
<p>Author: Mike de Boer <a href="mailto:mike@c9.io.html">mike@c9.io</a></p>
<p>[[Client]] can load any version of the [[github]] client API, with the
requirement that a valid routes.json definition file is present in the
<code>api/[VERSION]</code> directory and that the routes found in this file are
implemented as well.</p>
<p>Upon instantiation of the [[Client]] class, the routes.json file is loaded
from the API version specified in the configuration and, parsed and from it
the routes for HTTP requests are extracted. For each HTTP endpoint to the
HTTP server, a method is generated which accepts a Javascript Object
with parameters and an optional callback to be invoked when the API request
returns from the server or when the parameters could not be validated.</p>
<p>When an HTTP endpoint is processed and a method is generated as described
above, [[Client]] also sets up parameter validation with the rules as
defined in the routes.json. A full example that illustrates how this works
is shown below:</p>
<div class="pilwrap" id="example">
  <h5>
    <a href="#example" name="example" class="pilcrow"></a>
Example
  </h5>
</div>
<p>First, we look at a listing of a sample routes.json routes definition file:</p>
<pre><code> {
     &quot;defines&quot;: {
         &quot;constants&quot;: {
             &quot;name&quot;: &quot;Github&quot;,
             &quot;description&quot;: &quot;A Node.JS module, which provides an object oriented wrapper for the GitHub v3 API.&quot;,
             &quot;protocol&quot;: &quot;https&quot;,
             &quot;host&quot;: &quot;api.github.com&quot;,
             &quot;port&quot;: 443,
             &quot;dateFormat&quot;: &quot;YYYY-MM-DDTHH:MM:SSZ&quot;,
             &quot;requestFormat&quot;: &quot;json&quot;
         },
         &quot;response-headers&quot;: [
             &quot;X-RateLimit-Limit&quot;,
             &quot;X-RateLimit-Remaining&quot;,
             &quot;Link&quot;
         ],
         &quot;params&quot;: {
             &quot;files&quot;: {
                 &quot;type&quot;: &quot;Json&quot;,
                 &quot;required&quot;: true,
                 &quot;validation&quot;: &quot;&quot;,
                 &quot;invalidmsg&quot;: &quot;&quot;,
                 &quot;description&quot;: &quot;Files that make up this gist. The key of which should be a required string filename and the value another required hash with parameters: 'content'&quot;
             },
             &quot;user&quot;: {
                 &quot;type&quot;: &quot;String&quot;,
                 &quot;required&quot;: true,
                 &quot;validation&quot;: &quot;&quot;,
                 &quot;invalidmsg&quot;: &quot;&quot;,
                 &quot;description&quot;: &quot;&quot;
             },
             &quot;description&quot;: {
                 &quot;type&quot;: &quot;String&quot;,
                 &quot;required&quot;: false,
                 &quot;validation&quot;: &quot;&quot;,
                 &quot;invalidmsg&quot;: &quot;&quot;,
                 &quot;description&quot;: &quot;&quot;
             },
             &quot;page&quot;: {
                 &quot;type&quot;: &quot;Number&quot;,
                 &quot;required&quot;: false,
                 &quot;validation&quot;: &quot;^[0-9]+$&quot;,
                 &quot;invalidmsg&quot;: &quot;&quot;,
                 &quot;description&quot;: &quot;Page number of the results to fetch.&quot;
             },
             &quot;per_page&quot;: {
                 &quot;type&quot;: &quot;Number&quot;,
                 &quot;required&quot;: false,
                 &quot;validation&quot;: &quot;^[0-9]+$&quot;,
                 &quot;invalidmsg&quot;: &quot;&quot;,
                 &quot;description&quot;: &quot;A custom page size up to 100. Default is 30.&quot;
             }
         }
     },
<pre><code> &amp;quot;gists&amp;quot;: {
     &amp;quot;get-from-user&amp;quot;: {
         &amp;quot;url&amp;quot;: &amp;quot;:user/gists&amp;quot;,
         &amp;quot;method&amp;quot;: &amp;quot;GET&amp;quot;,
         &amp;quot;params&amp;quot;: {
             &amp;quot;$user&amp;quot;: null,
             &amp;quot;$page&amp;quot;: null,
             &amp;quot;$per_page&amp;quot;: null
         }
     },

     &amp;quot;create&amp;quot;: {
         &amp;quot;url&amp;quot;: &amp;quot;/gists&amp;quot;,
         &amp;quot;method&amp;quot;: &amp;quot;POST&amp;quot;,
         &amp;quot;params&amp;quot;: {
             &amp;quot;$description&amp;quot;: null,
             &amp;quot;public&amp;quot;: {
                 &amp;quot;type&amp;quot;: &amp;quot;Boolean&amp;quot;,
                 &amp;quot;required&amp;quot;: true,
                 &amp;quot;validation&amp;quot;: &amp;quot;&amp;quot;,
                 &amp;quot;invalidmsg&amp;quot;: &amp;quot;&amp;quot;,
                 &amp;quot;description&amp;quot;: &amp;quot;&amp;quot;
             },
             &amp;quot;$files&amp;quot;: null
         }
     }
 }
</code></pre>
<p>}
</code></pre></p>
<p>You probably noticed that the definition is quite verbose and the decision
for its design was made to be verbose whilst still allowing for basic variable
definitions and substitions for request parameters.</p>
<p>There are two sections; 'defines' and 'gists' in this example.</p>
<p>The <code>defines</code> section contains a list of <code>constants</code> that will be used by the
[[Client]] to make requests to the right URL that hosts the API.
The <code>gists</code> section defines the endpoints for calls to the API server, for
gists specifically in this example, but the other API sections are defined in
the exact same way.
These definitions are parsed and methods are created that the client can call
to make an HTTP request to the server.
there is one endpoint defined: .
In this example, the endpoint <code>gists/get-from-user</code> will be exposed as a member
on the [[Client]] object and may be invoked with</p>
<pre><code> client.getFromUser({
     &quot;user&quot;: &quot;bob&quot;
 }, function(err, ret) {
     // do something with the result here.
 });
<p>// or to fetch a specfic page:
client.getFromUser({
&quot;user&quot;: &quot;bob&quot;,
&quot;page&quot;: 2,
&quot;per_page&quot;: 100
}, function(err, ret) {
// do something with the result here.
});
</code></pre></p>
<p>All the parameters as specified in the Object that is passed to the function
as first argument, will be validated according to the rules in the <code>params</code>
block of the route definition.
Thus, in the case of the <code>user</code> parameter, according to the definition in
the <code>params</code> block, it's a variable that first needs to be looked up in the
<code>params</code> block of the <code>defines</code> section (at the top of the JSON file). Params
that start with a <code>$</code> sign will be substituted with the param with the same
name from the <code>defines/params</code> section.
There we see that it is a required parameter (needs to hold a value). In other
words, if the validation requirements are not met, an HTTP error is passed as
first argument of the callback.</p>
<p>Implementation Notes: the <code>method</code> is NOT case sensitive, whereas <code>url</code> is.
The <code>url</code> parameter also supports denoting parameters inside it as follows:</p>
<pre><code> &quot;get-from-user&quot;: {
     &quot;url&quot;: &quot;:user/gists&quot;,
     &quot;method&quot;: &quot;GET&quot;
     ...
 }</code></pre>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> Client = <span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">config</span>) </span>{
    config.headers = config.headers || {};
    <span class="hljs-keyword">this</span>.config = config;
    <span class="hljs-keyword">this</span>.debug = Util.isTrue(config.debug);

    <span class="hljs-keyword">this</span>.version = config.version;
    <span class="hljs-keyword">var</span> cls = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./api/v"</span> + <span class="hljs-keyword">this</span>.version);
    <span class="hljs-keyword">this</span>[<span class="hljs-keyword">this</span>.version] = <span class="hljs-keyword">new</span> cls(<span class="hljs-keyword">this</span>);

    <span class="hljs-keyword">var</span> pathPrefix = <span class="hljs-string">""</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Check if a prefix is passed in the config and strip any leading or trailing slashes from it.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> config.pathPrefix == <span class="hljs-string">"string"</span>) {
        pathPrefix = <span class="hljs-string">"/"</span> + config.pathPrefix.replace(<span class="hljs-regexp">/(^[\/]+|[\/]+$)/g</span>, <span class="hljs-string">""</span>);
        <span class="hljs-keyword">this</span>.config.pathPrefix = pathPrefix;
    }

    <span class="hljs-keyword">this</span>.setupRoutes();
};

(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<div class="dox">
<div class="summary">
<p>Client#setupRoutes() -&gt; null</p>
</div>
<div class="body">
<p>Configures the routes as defined in a routes.json file of an API version</p>
<p>[[Client#setupRoutes]] is invoked by the constructor, takes the
contents of the JSON document that contains the definitions of all the
available API routes and iterates over them.</p>
<p>It first recurses through each definition block until it reaches an API
endpoint. It knows that an endpoint is found when the <code>url</code> and <code>param</code>
definitions are found as a direct member of a definition block.
Then the availability of an implementation by the API is checked; if it's
not present, this means that a portion of the API as defined in the routes.json
file is not implemented properly, thus an exception is thrown.
After this check, a method is attached to the [[Client]] instance
and becomes available for use. Inside this method, the parameter validation
and typecasting is done, according to the definition of the parameters in
the <code>params</code> block, upon invocation.</p>
<p>This mechanism ensures that the handlers ALWAYS receive normalized data
that is of the correct format and type. JSON parameters are parsed, Strings
are trimmed, Numbers and Floats are casted and checked for NaN after that.</p>
<p>Note: Query escaping for usage with SQL products is something that can be
implemented additionally by adding an additional parameter type.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.setupRoutes = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">var</span> api = <span class="hljs-keyword">this</span>[<span class="hljs-keyword">this</span>.version];
        <span class="hljs-keyword">var</span> routes = api.routes;
        <span class="hljs-keyword">var</span> defines = routes.defines;
        <span class="hljs-keyword">this</span>.constants = defines.constants;
        <span class="hljs-keyword">this</span>.requestHeaders = defines[<span class="hljs-string">"request-headers"</span>].map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">header</span>) </span>{
            <span class="hljs-keyword">return</span> header.toLowerCase();
        });
        <span class="hljs-keyword">delete</span> routes.defines;

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">trim</span>(<span class="hljs-params">s</span>) </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> s != <span class="hljs-string">"string"</span>)
                <span class="hljs-keyword">return</span> s;
            <span class="hljs-keyword">return</span> s.replace(<span class="hljs-regexp">/^[\s\t\r\n]+/</span>, <span class="hljs-string">""</span>).replace(<span class="hljs-regexp">/[\s\t\r\n]+$/</span>, <span class="hljs-string">""</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseParams</span>(<span class="hljs-params">msg, paramsStruct</span>) </span>{
            <span class="hljs-keyword">var</span> params = <span class="hljs-built_in">Object</span>.keys(paramsStruct);
            <span class="hljs-keyword">var</span> paramName, def, value, type;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = params.length; i &lt; l; ++i) {
                paramName = params[i];
                <span class="hljs-keyword">if</span> (paramName.charAt(<span class="hljs-number">0</span>) == <span class="hljs-string">"$"</span>) {
                    paramName = paramName.substr(<span class="hljs-number">1</span>);
                    <span class="hljs-keyword">if</span> (!defines.params[paramName]) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> error.BadRequest(<span class="hljs-string">"Invalid variable parameter name substitution; param '"</span> +
                            paramName + <span class="hljs-string">"' not found in defines block"</span>, <span class="hljs-string">"fatal"</span>);
                    }
                    <span class="hljs-keyword">else</span> {
                        def = paramsStruct[paramName] = defines.params[paramName];
                        <span class="hljs-keyword">delete</span> paramsStruct[<span class="hljs-string">"$"</span> + paramName];
                    }
                }
                <span class="hljs-keyword">else</span>
                    def = paramsStruct[paramName];

                value = trim(msg[paramName]);
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value != <span class="hljs-string">"boolean"</span> &amp;&amp; !value) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>we don't need to validation for undefined parameter values
that are not required.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    <span class="hljs-keyword">if</span> (!def.required || (def[<span class="hljs-string">"allow-empty"</span>] &amp;&amp; value === <span class="hljs-string">""</span>))
                        <span class="hljs-keyword">continue</span>;
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> error.BadRequest(<span class="hljs-string">"Empty value for parameter '"</span> +
                        paramName + <span class="hljs-string">"': "</span> + value);
                }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>validate the value and type of parameter:</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">if</span> (def.validation) {
                    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(def.validation).test(value)) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> error.BadRequest(<span class="hljs-string">"Invalid value for parameter '"</span> +
                            paramName + <span class="hljs-string">"': "</span> + value);
                    }
                }

                <span class="hljs-keyword">if</span> (def.type) {
                    type = def.type.toLowerCase();
                    <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"number"</span>) {
                        value = <span class="hljs-built_in">parseInt</span>(value, <span class="hljs-number">10</span>);
                        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(value)) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> error.BadRequest(<span class="hljs-string">"Invalid value for parameter '"</span> +
                                paramName + <span class="hljs-string">"': "</span> + msg[paramName] + <span class="hljs-string">" is NaN"</span>);
                        }
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"float"</span>) {
                        value = <span class="hljs-built_in">parseFloat</span>(value);
                        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">isNaN</span>(value)) {
                            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> error.BadRequest(<span class="hljs-string">"Invalid value for parameter '"</span> +
                                paramName + <span class="hljs-string">"': "</span> + msg[paramName] + <span class="hljs-string">" is NaN"</span>);
                        }
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"json"</span>) {
                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value == <span class="hljs-string">"string"</span>) {
                            <span class="hljs-keyword">try</span> {
                                value = <span class="hljs-built_in">JSON</span>.parse(value);
                            }
                            <span class="hljs-keyword">catch</span>(ex) {
                                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> error.BadRequest(<span class="hljs-string">"JSON parse error of value for parameter '"</span> +
                                    paramName + <span class="hljs-string">"': "</span> + value);
                            }
                        }
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type == <span class="hljs-string">"date"</span>) {
                        value = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(value);
                    }
                }
                msg[paramName] = value;
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prepareApi</span>(<span class="hljs-params">struct, baseType</span>) </span>{
            <span class="hljs-keyword">if</span> (!baseType)
                baseType = <span class="hljs-string">""</span>;
            <span class="hljs-built_in">Object</span>.keys(struct).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">routePart</span>) </span>{
                <span class="hljs-keyword">var</span> block = struct[routePart];
                <span class="hljs-keyword">if</span> (!block)
                    <span class="hljs-keyword">return</span>;
                <span class="hljs-keyword">var</span> messageType = baseType + <span class="hljs-string">"/"</span> + routePart;
                <span class="hljs-keyword">if</span> (block.url &amp;&amp; block.params) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>we ended up at an API definition part!</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    <span class="hljs-keyword">var</span> endPoint = messageType.replace(<span class="hljs-regexp">/^[\/]+/g</span>, <span class="hljs-string">""</span>);
                    <span class="hljs-keyword">var</span> parts = messageType.split(<span class="hljs-string">"/"</span>);
                    <span class="hljs-keyword">var</span> section = Util.toCamelCase(parts[<span class="hljs-number">1</span>].toLowerCase());
                    parts.splice(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>);
                    <span class="hljs-keyword">var</span> funcName = Util.toCamelCase(parts.join(<span class="hljs-string">"-"</span>));

                    <span class="hljs-keyword">if</span> (!api[section]) {
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Unsupported route section, not implemented in version "</span> +
                            self.version + <span class="hljs-string">" for route '"</span> + endPoint + <span class="hljs-string">"' and block: "</span> +
                            <span class="hljs-built_in">JSON</span>.stringify(block));
                    }

                    <span class="hljs-keyword">if</span> (!api[section][funcName]) {
                        <span class="hljs-keyword">if</span> (self.debug)
                            Util.log(<span class="hljs-string">"Tried to call "</span> + funcName);
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Unsupported route, not implemented in version "</span> +
                            self.version + <span class="hljs-string">" for route '"</span> + endPoint + <span class="hljs-string">"' and block: "</span> +
                            <span class="hljs-built_in">JSON</span>.stringify(block));
                    }

                    <span class="hljs-keyword">if</span> (!self[section]) {
                        self[section] = {};
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>add a utility function 'getFooApi()', which returns the
section to which functions are attached.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                        self[Util.toCamelCase(<span class="hljs-string">"get-"</span> + section + <span class="hljs-string">"-api"</span>)] = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                            <span class="hljs-keyword">return</span> self[section];
                        };
                    }

                    self[section][funcName] = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, callback</span>) </span>{
                        <span class="hljs-keyword">try</span> {
                            parseParams(msg, block.params);
                        }
                        <span class="hljs-keyword">catch</span> (ex) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>when the message was sent to the client, we can
reply with the error directly.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                            api.sendError(ex, block, msg, callback);
                            <span class="hljs-keyword">if</span> (self.debug)
                                Util.log(ex.message, <span class="hljs-string">"fatal"</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>on error, there's no need to continue.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                            <span class="hljs-keyword">return</span>;
                        }

                        api[section][funcName].call(api, msg, block, callback);
                    };
                }
                <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>recurse into this block next:</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    prepareApi(block, messageType);
                }
            });
        }

        prepareApi(routes);
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="dox">
<div class="summary">
<p>Client#authenticate(options) -&gt; null
- options (Object): Object containing the authentication type and credentials
- type (String): One of the following: <code>basic</code> or <code>oauth</code>
- username (String): Github username
- password (String): Password to your account
- token (String): OAuth2 token</p>
</div>
<div class="body">
<p>Set an authentication method to have access to protected resources.</p>
<div class="pilwrap" id="example-1">
  <h5>
    <a href="#example-1" name="example-1" class="pilcrow"></a>
Example
  </h5>
</div>
<pre><code> // basic
 github.authenticate({
     type: &quot;basic&quot;,
     username: &quot;mikedeboertest&quot;,
     password: &quot;test1324&quot;
 });
<p>// or oauth
github.authenticate({
type: &quot;oauth&quot;,
token: &quot;e5a4a27487c26e571892846366de023349321a73&quot;
});</p>
<p>// or oauth key/ secret
github.authenticate({
type: &quot;oauth&quot;,
key: &quot;clientID&quot;,
secret: &quot;clientSecret&quot;
});</p>
<p>// or token
github.authenticate({
type: &quot;token&quot;,
token: &quot;userToken&quot;,
});</code></pre></p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.authenticate = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
        <span class="hljs-keyword">if</span> (!options) {
            <span class="hljs-keyword">this</span>.auth = <span class="hljs-literal">false</span>;
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> (!options.type || <span class="hljs-string">"basic|oauth|client|token"</span>.indexOf(options.type) === <span class="hljs-number">-1</span>)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Invalid authentication type, must be 'basic', 'oauth' or 'client'"</span>);
        <span class="hljs-keyword">if</span> (options.type == <span class="hljs-string">"basic"</span> &amp;&amp; (!options.username || !options.password))
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Basic authentication requires both a username and password to be set"</span>);
        <span class="hljs-keyword">if</span> (options.type == <span class="hljs-string">"oauth"</span>) {
            <span class="hljs-keyword">if</span> (!options.token &amp;&amp; !(options.key &amp;&amp; options.secret))
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"OAuth2 authentication requires a token or key &amp; secret to be set"</span>);
        }
        <span class="hljs-keyword">if</span> (options.type == <span class="hljs-string">"token"</span> &amp;&amp; !options.token)
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Token authentication requires a token to be set"</span>);

        <span class="hljs-keyword">this</span>.auth = options;
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPageLinks</span>(<span class="hljs-params">link</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> link == <span class="hljs-string">"object"</span> &amp;&amp; (link.link || link.meta.link))
            link = link.link || link.meta.link;

        <span class="hljs-keyword">var</span> links = {};
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> link != <span class="hljs-string">"string"</span>)
            <span class="hljs-keyword">return</span> links;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>link format:
'<a href="https://api.github.com/users/aseemk/followers?page=2">https://api.github.com/users/aseemk/followers?page=2</a>; rel=&quot;next&quot;, <a href="https://api.github.com/users/aseemk/followers?page=2">https://api.github.com/users/aseemk/followers?page=2</a>; rel=&quot;last&quot;'</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        link.replace(<span class="hljs-regexp">/&lt;([^&gt;]*)&gt;;\s*rel="([\w]*)\"/g</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">m, uri, type</span>) </span>{
            links[type] = uri;
        });
        <span class="hljs-keyword">return</span> links;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<div class="dox">
<div class="summary">
<p>Client#hasNextPage(link) -&gt; null
- link (mixed): response of a request or the contents of the Link header</p>
</div>
<div class="body">
<p>Check if a request result contains a link to the next page</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.hasNextPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">link</span>) </span>{
        <span class="hljs-keyword">return</span> getPageLinks(link).next;
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<div class="dox">
<div class="summary">
<p>Client#hasPreviousPage(link) -&gt; null
- link (mixed): response of a request or the contents of the Link header</p>
</div>
<div class="body">
<p>Check if a request result contains a link to the previous page</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.hasPreviousPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">link</span>) </span>{
        <span class="hljs-keyword">return</span> getPageLinks(link).prev;
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<div class="dox">
<div class="summary">
<p>Client#hasLastPage(link) -&gt; null
- link (mixed): response of a request or the contents of the Link header</p>
</div>
<div class="body">
<p>Check if a request result contains a link to the last page</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.hasLastPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">link</span>) </span>{
        <span class="hljs-keyword">return</span> getPageLinks(link).last;
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<div class="dox">
<div class="summary">
<p>Client#hasFirstPage(link) -&gt; null
- link (mixed): response of a request or the contents of the Link header</p>
</div>
<div class="body">
<p>Check if a request result contains a link to the first page</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.hasFirstPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">link</span>) </span>{
        <span class="hljs-keyword">return</span> getPageLinks(link).first;
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPage</span>(<span class="hljs-params">link, which, callback</span>) </span>{
        <span class="hljs-keyword">var</span> url = getPageLinks(link)[which];
        <span class="hljs-keyword">if</span> (!url)
            <span class="hljs-keyword">return</span> callback(<span class="hljs-keyword">new</span> error.NotFound(<span class="hljs-string">"No "</span> + which + <span class="hljs-string">" page found"</span>));

        <span class="hljs-keyword">var</span> api = <span class="hljs-keyword">this</span>[<span class="hljs-keyword">this</span>.version];
        <span class="hljs-keyword">var</span> parsedUrl = Url.parse(url, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">var</span> block = {
            <span class="hljs-attr">url</span>: parsedUrl.pathname,
            <span class="hljs-attr">method</span>: <span class="hljs-string">"GET"</span>,
            <span class="hljs-attr">params</span>: parsedUrl.query
        };
        <span class="hljs-keyword">this</span>.httpSend(parsedUrl.query, block, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, res</span>) </span>{
            <span class="hljs-keyword">if</span> (err)
                <span class="hljs-keyword">return</span> api.sendError(err, <span class="hljs-literal">null</span>, parsedUrl.query, callback);

            <span class="hljs-keyword">var</span> ret;
            <span class="hljs-keyword">try</span> {
                ret = res.data;
                <span class="hljs-keyword">var</span> contentType = res.headers[<span class="hljs-string">"content-type"</span>];
                <span class="hljs-keyword">if</span> (contentType &amp;&amp; contentType.indexOf(<span class="hljs-string">"application/json"</span>) !== <span class="hljs-number">-1</span>)
                    ret = <span class="hljs-built_in">JSON</span>.parse(ret);
            }
            <span class="hljs-keyword">catch</span> (ex) {
                <span class="hljs-keyword">if</span> (callback)
                    callback(<span class="hljs-keyword">new</span> error.InternalServerError(ex.message), res);
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-keyword">if</span> (!ret)
                ret = {};
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> ret == <span class="hljs-string">"object"</span>) {
                <span class="hljs-keyword">if</span> (!ret.meta)
                    ret.meta = {};
                [<span class="hljs-string">"x-ratelimit-limit"</span>, <span class="hljs-string">"x-ratelimit-remaining"</span>, <span class="hljs-string">"link"</span>].forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">header</span>) </span>{
                    <span class="hljs-keyword">if</span> (res.headers[header])
                        ret.meta[header] = res.headers[header];
                });
            }

            <span class="hljs-keyword">if</span> (callback)
                callback(<span class="hljs-literal">null</span>, ret);
        });
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<div class="dox">
<div class="summary">
<p>Client#getNextPage(link, callback) -&gt; null
- link (mixed): response of a request or the contents of the Link header
- callback (Function): function to call when the request is finished with an error as first argument and result data as second argument.</p>
</div>
<div class="body">
<p>Get the next page, based on the contents of the <code>Link</code> header</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.getNextPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">link, callback</span>) </span>{
        getPage.call(<span class="hljs-keyword">this</span>, link, <span class="hljs-string">"next"</span>, callback);
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<div class="dox">
<div class="summary">
<p>Client#getPreviousPage(link, callback) -&gt; null
- link (mixed): response of a request or the contents of the Link header
- callback (Function): function to call when the request is finished with an error as first argument and result data as second argument.</p>
</div>
<div class="body">
<p>Get the previous page, based on the contents of the <code>Link</code> header</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.getPreviousPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">link, callback</span>) </span>{
        getPage.call(<span class="hljs-keyword">this</span>, link, <span class="hljs-string">"prev"</span>, callback);
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<div class="dox">
<div class="summary">
<p>Client#getLastPage(link, callback) -&gt; null
- link (mixed): response of a request or the contents of the Link header
- callback (Function): function to call when the request is finished with an error as first argument and result data as second argument.</p>
</div>
<div class="body">
<p>Get the last page, based on the contents of the <code>Link</code> header</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.getLastPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">link, callback</span>) </span>{
        getPage.call(<span class="hljs-keyword">this</span>, link, <span class="hljs-string">"last"</span>, callback);
    };

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<div class="dox">
<div class="summary">
<p>Client#getFirstPage(link, callback) -&gt; null
- link (mixed): response of a request or the contents of the Link header
- callback (Function): function to call when the request is finished with an error as first argument and result data as second argument.</p>
</div>
<div class="body">
<p>Get the first page, based on the contents of the <code>Link</code> header</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.getFirstPage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">link, callback</span>) </span>{
        getPage.call(<span class="hljs-keyword">this</span>, link, <span class="hljs-string">"first"</span>, callback);
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRequestFormat</span>(<span class="hljs-params">hasBody, block</span>) </span>{
        <span class="hljs-keyword">if</span> (hasBody)
            <span class="hljs-keyword">return</span> block.requestFormat || <span class="hljs-keyword">this</span>.constants.requestFormat;

        <span class="hljs-keyword">return</span> <span class="hljs-string">"query"</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getQueryAndUrl</span>(<span class="hljs-params">msg, def, format, config</span>) </span>{
        <span class="hljs-keyword">var</span> url = def.url;
        <span class="hljs-keyword">if</span> (config.pathPrefix &amp;&amp; url.indexOf(config.pathPrefix) !== <span class="hljs-number">0</span>) {
            url = config.pathPrefix + def.url;
        }
        <span class="hljs-keyword">var</span> ret = {
            <span class="hljs-attr">query</span>: format == <span class="hljs-string">"json"</span> ? {} : format == <span class="hljs-string">"raw"</span> ? msg.data : []
        };
        <span class="hljs-keyword">if</span> (!def || !def.params) {
            ret.url = url;
            <span class="hljs-keyword">return</span> ret;
        }

        <span class="hljs-built_in">Object</span>.keys(def.params).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">paramName</span>) </span>{
            paramName = paramName.replace(<span class="hljs-regexp">/^[$]+/</span>, <span class="hljs-string">""</span>);
            <span class="hljs-keyword">if</span> (!(paramName <span class="hljs-keyword">in</span> msg))
                <span class="hljs-keyword">return</span>;

            <span class="hljs-keyword">var</span> isUrlParam = url.indexOf(<span class="hljs-string">":"</span> + paramName) !== <span class="hljs-number">-1</span>;
            <span class="hljs-keyword">var</span> valFormat = isUrlParam || format != <span class="hljs-string">"json"</span> ? <span class="hljs-string">"query"</span> : format;
            <span class="hljs-keyword">var</span> val;
            <span class="hljs-keyword">if</span> (valFormat != <span class="hljs-string">"json"</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> msg[paramName] == <span class="hljs-string">"object"</span>) {
                    <span class="hljs-keyword">try</span> {
                        msg[paramName] = <span class="hljs-built_in">JSON</span>.stringify(msg[paramName]);
                        val = <span class="hljs-built_in">encodeURIComponent</span>(msg[paramName]);
                    }
                    <span class="hljs-keyword">catch</span> (ex) {
                        <span class="hljs-keyword">return</span> Util.log(<span class="hljs-string">"httpSend: Error while converting object to JSON: "</span>
                            + (ex.message || ex), <span class="hljs-string">"error"</span>);
                    }
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (def.params[paramName] &amp;&amp; def.params[paramName].combined) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Check if this is a combined (search) string.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    val = msg[paramName].split(<span class="hljs-regexp">/[\s\t\r\n]*\+[\s\t\r\n]*/</span>)
                                        .map(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">part</span>) </span>{
                                            <span class="hljs-keyword">return</span> <span class="hljs-built_in">encodeURIComponent</span>(part);
                                        })
                                        .join(<span class="hljs-string">"+"</span>);
                }
                <span class="hljs-keyword">else</span>
                    val = <span class="hljs-built_in">encodeURIComponent</span>(msg[paramName]);
            }
            <span class="hljs-keyword">else</span>
                val = msg[paramName];

            <span class="hljs-keyword">if</span> (isUrlParam) {
                url = url.replace(<span class="hljs-string">":"</span> + paramName, val);
            }
            <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">if</span> (format == <span class="hljs-string">"json"</span>)
                    ret.query[paramName] = val;
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (format != <span class="hljs-string">"raw"</span>)
                    ret.query.push(paramName + <span class="hljs-string">"="</span> + val);
            }
        });
        ret.url = url;
        <span class="hljs-keyword">return</span> ret;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<div class="dox">
<div class="summary">
<p>Client#httpSend(msg, block, callback) -&gt; null
- msg (Object): parameters to send as the request body
- block (Object): parameter definition from the <code>routes.json</code> file that
contains validation rules
- callback (Function): function to be called when the request returns.
If the the request returns with an error, the error is passed to
the callback as its first argument (NodeJS-style).</p>
</div>
<div class="body">
<p>Send an HTTP request to the server and pass the result to a callback.</p>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">this</span>.httpSend = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg, block, callback</span>) </span>{
        <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
        <span class="hljs-keyword">var</span> method = block.method.toLowerCase();
        <span class="hljs-keyword">var</span> hasFileBody = block.hasFileBody;
        <span class="hljs-keyword">var</span> hasBody = !hasFileBody &amp;&amp; (<span class="hljs-string">"head|get|delete"</span>.indexOf(method) === <span class="hljs-number">-1</span>);
        <span class="hljs-keyword">var</span> format = getRequestFormat.call(<span class="hljs-keyword">this</span>, hasBody, block);
        <span class="hljs-keyword">var</span> obj = getQueryAndUrl(msg, block, format, self.config);
        <span class="hljs-keyword">var</span> query = obj.query;
        <span class="hljs-keyword">var</span> url = <span class="hljs-keyword">this</span>.config.url ? <span class="hljs-keyword">this</span>.config.url + obj.url : obj.url;

        <span class="hljs-keyword">var</span> path = url;
        <span class="hljs-keyword">var</span> protocol = <span class="hljs-keyword">this</span>.config.protocol || <span class="hljs-keyword">this</span>.constants.protocol || <span class="hljs-string">"http"</span>;
        <span class="hljs-keyword">var</span> host = block.host || <span class="hljs-keyword">this</span>.config.host || <span class="hljs-keyword">this</span>.constants.host;
        <span class="hljs-keyword">var</span> port = <span class="hljs-keyword">this</span>.config.port || <span class="hljs-keyword">this</span>.constants.port || (protocol == <span class="hljs-string">"https"</span> ? <span class="hljs-number">443</span> : <span class="hljs-number">80</span>);
        <span class="hljs-keyword">var</span> proxyUrl;
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.config.proxy !== <span class="hljs-literal">undefined</span>) {
            proxyUrl = <span class="hljs-keyword">this</span>.config.proxy;
        } <span class="hljs-keyword">else</span> {
            proxyUrl = process.env.HTTPS_PROXY || process.env.HTTP_PROXY;
        }
        <span class="hljs-keyword">if</span> (proxyUrl) {
            path = Url.format({
                <span class="hljs-attr">protocol</span>: protocol,
                <span class="hljs-attr">hostname</span>: host,
                <span class="hljs-attr">port</span>: port,
                <span class="hljs-attr">pathname</span>: path
            });

            <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/^(http|https):\/\//</span>.test(proxyUrl))
                proxyUrl = <span class="hljs-string">"https://"</span> + proxyUrl;

            <span class="hljs-keyword">var</span> parsedUrl = Url.parse(proxyUrl);
            protocol = parsedUrl.protocol.replace(<span class="hljs-string">":"</span>, <span class="hljs-string">""</span>);
            host = parsedUrl.hostname;
            port = parsedUrl.port || (protocol == <span class="hljs-string">"https"</span> ? <span class="hljs-number">443</span> : <span class="hljs-number">80</span>);
        }
        <span class="hljs-keyword">if</span> (!hasBody &amp;&amp; query.length)
            path += <span class="hljs-string">"?"</span> + query.join(<span class="hljs-string">"&amp;"</span>);

        <span class="hljs-keyword">var</span> headers = {
            <span class="hljs-string">"host"</span>: host,
            <span class="hljs-string">"content-length"</span>: <span class="hljs-string">"0"</span>
        };
        <span class="hljs-keyword">if</span> (hasBody) {
            <span class="hljs-keyword">if</span> (format == <span class="hljs-string">"json"</span>)
                query = <span class="hljs-built_in">JSON</span>.stringify(query);
            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (format != <span class="hljs-string">"raw"</span>)
                query = query.join(<span class="hljs-string">"&amp;"</span>);
            headers[<span class="hljs-string">"content-length"</span>] = Buffer.byteLength(query, <span class="hljs-string">"utf8"</span>);
            headers[<span class="hljs-string">"content-type"</span>] = format == <span class="hljs-string">"json"</span>
                ? <span class="hljs-string">"application/json; charset=utf-8"</span>
                : format == <span class="hljs-string">"raw"</span>
                    ? <span class="hljs-string">"text/plain; charset=utf-8"</span>
                    : <span class="hljs-string">"application/x-www-form-urlencoded; charset=utf-8"</span>;
        }
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.auth) {
            <span class="hljs-keyword">var</span> basic;
            <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">this</span>.auth.type) {
                <span class="hljs-keyword">case</span> <span class="hljs-string">"oauth"</span>:
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.auth.token) {
                        path += (path.indexOf(<span class="hljs-string">"?"</span>) === <span class="hljs-number">-1</span> ? <span class="hljs-string">"?"</span> : <span class="hljs-string">"&amp;"</span>) +
                            <span class="hljs-string">"access_token="</span> + <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-keyword">this</span>.auth.token);
                    } <span class="hljs-keyword">else</span> {
                        path += (path.indexOf(<span class="hljs-string">"?"</span>) === <span class="hljs-number">-1</span> ? <span class="hljs-string">"?"</span> : <span class="hljs-string">"&amp;"</span>) +
                            <span class="hljs-string">"client_id="</span> + <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-keyword">this</span>.auth.key) +
                            <span class="hljs-string">"&amp;client_secret="</span> + <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-keyword">this</span>.auth.secret);
                    }
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"token"</span>:
                    headers.authorization = <span class="hljs-string">"token "</span> + <span class="hljs-keyword">this</span>.auth.token;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">case</span> <span class="hljs-string">"basic"</span>:
                    basic = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-keyword">this</span>.auth.username + <span class="hljs-string">":"</span> + <span class="hljs-keyword">this</span>.auth.password, <span class="hljs-string">"ascii"</span>).toString(<span class="hljs-string">"base64"</span>);
                    headers.authorization = <span class="hljs-string">"Basic "</span> + basic;
                    <span class="hljs-keyword">break</span>;
                <span class="hljs-keyword">default</span>:
                    <span class="hljs-keyword">break</span>;
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">callCallback</span>(<span class="hljs-params">err, result</span>) </span>{
            <span class="hljs-keyword">if</span> (callback) {
                <span class="hljs-keyword">var</span> cb = callback;
                callback = <span class="hljs-literal">undefined</span>;
                cb(err, result);
            }
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addCustomHeaders</span>(<span class="hljs-params">customHeaders</span>) </span>{
            <span class="hljs-built_in">Object</span>.keys(customHeaders).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">header</span>) </span>{
                <span class="hljs-keyword">var</span> headerLC = header.toLowerCase();
                <span class="hljs-keyword">if</span> (self.requestHeaders.indexOf(headerLC) == <span class="hljs-number">-1</span>)
                    <span class="hljs-keyword">return</span>;
                headers[headerLC] = customHeaders[header];
            });
        }
        addCustomHeaders(Util.extend(msg.headers || {}, <span class="hljs-keyword">this</span>.config.headers));

        <span class="hljs-keyword">if</span> (!headers[<span class="hljs-string">"user-agent"</span>])
            headers[<span class="hljs-string">"user-agent"</span>] = <span class="hljs-string">"NodeJS HTTP Client"</span>;

        <span class="hljs-keyword">if</span> (!(<span class="hljs-string">"accept"</span> <span class="hljs-keyword">in</span> headers))
            headers.accept = <span class="hljs-keyword">this</span>.config.requestMedia || <span class="hljs-keyword">this</span>.constants.requestMedia;

        <span class="hljs-keyword">var</span> options = {
            <span class="hljs-attr">host</span>: host,
            <span class="hljs-attr">port</span>: port,
            <span class="hljs-attr">path</span>: path,
            <span class="hljs-attr">method</span>: method,
            <span class="hljs-attr">headers</span>: headers
        };

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.config.rejectUnauthorized !== <span class="hljs-literal">undefined</span>)
            options.rejectUnauthorized = <span class="hljs-keyword">this</span>.config.rejectUnauthorized;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.debug)
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"REQUEST: "</span>, options);

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">httpSendRequest</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> req = <span class="hljs-built_in">require</span>(protocol).request(options, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
                <span class="hljs-keyword">if</span> (self.debug) {
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"STATUS: "</span> + res.statusCode);
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"HEADERS: "</span> + <span class="hljs-built_in">JSON</span>.stringify(res.headers));
                }
                res.setEncoding(<span class="hljs-string">"utf8"</span>);
                <span class="hljs-keyword">var</span> data = <span class="hljs-string">""</span>;
                res.on(<span class="hljs-string">"data"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">chunk</span>) </span>{
                    data += chunk;
                });
                res.on(<span class="hljs-string">"error"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
                    callCallback(err);
                });
                res.on(<span class="hljs-string">"end"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">if</span> (res.statusCode &gt;= <span class="hljs-number">400</span> &amp;&amp; res.statusCode &lt; <span class="hljs-number">600</span> || res.statusCode &lt; <span class="hljs-number">10</span>) {
                        callCallback(<span class="hljs-keyword">new</span> error.HttpError(data, res.statusCode));
                    } <span class="hljs-keyword">else</span> {
                        res.data = data;
                        callCallback(<span class="hljs-literal">null</span>, res);
                    }
                });
            });

            <span class="hljs-keyword">var</span> timeout = (block.timeout !== <span class="hljs-literal">undefined</span>) ? block.timeout : self.config.timeout;
            <span class="hljs-keyword">if</span> (timeout) {
                req.setTimeout(timeout);
            }

            req.on(<span class="hljs-string">"error"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                <span class="hljs-keyword">if</span> (self.debug)
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"problem with request: "</span> + e.message);
                callCallback(e.message);
            });

            req.on(<span class="hljs-string">"timeout"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (self.debug)
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"problem with request: timed out"</span>);
                callCallback(<span class="hljs-keyword">new</span> error.GatewayTimeout());
            });

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>write data to request body</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (hasBody &amp;&amp; query.length) {
                <span class="hljs-keyword">if</span> (self.debug)
                    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"REQUEST BODY: "</span> + query + <span class="hljs-string">"\n"</span>);
                req.write(query + <span class="hljs-string">"\n"</span>);
            }

            <span class="hljs-keyword">if</span> (block.hasFileBody) {
              <span class="hljs-keyword">var</span> stream = fs.createReadStream(msg.filePath);
              stream.pipe(req);
            } <span class="hljs-keyword">else</span> {
              req.end();
            }
        };

        <span class="hljs-keyword">if</span> (hasFileBody) {
            fs.stat(msg.filePath, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err, stat</span>) </span>{
                <span class="hljs-keyword">if</span> (err) {
                    callCallback(err);
                } <span class="hljs-keyword">else</span> {
                    headers[<span class="hljs-string">"content-length"</span>] = stat.size;
                    headers[<span class="hljs-string">"content-type"</span>] = mime.lookup(msg.name);
                    httpSendRequest();
                }
            });
        } <span class="hljs-keyword">else</span> {
            httpSendRequest();
        }
    };
}).call(Client.prototype);

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
