<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/iconv-lite/lib/index.js";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>index.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">"use strict"</span>

<span class="hljs-keyword">var</span> bomHandling = <span class="hljs-built_in">require</span>(<span class="hljs-string">'./bom-handling'</span>),
    iconv = <span class="hljs-built_in">module</span>.exports;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>All codecs and aliases are kept here, keyed by encoding name/alias.
They are lazy loaded in <code>iconv.getCodec</code> from <code>encodings/index.js</code>.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">iconv.encodings = <span class="hljs-literal">null</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>Characters emitted in case of error.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">iconv.defaultCharUnicode = <span class="hljs-string">'ï¿½'</span>;
iconv.defaultCharSingleByte = <span class="hljs-string">'?'</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>Public API.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">iconv.encode = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encode</span>(<span class="hljs-params">str, encoding, options</span>) </span>{
    str = <span class="hljs-string">""</span> + (str || <span class="hljs-string">""</span>); <span class="hljs-comment">// Ensure string.</span>

    <span class="hljs-keyword">var</span> encoder = iconv.getEncoder(encoding, options);

    <span class="hljs-keyword">var</span> res = encoder.write(str);
    <span class="hljs-keyword">var</span> trail = encoder.end();
    
    <span class="hljs-keyword">return</span> (trail &amp;&amp; trail.length &gt; <span class="hljs-number">0</span>) ? Buffer.concat([res, trail]) : res;
}

iconv.decode = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decode</span>(<span class="hljs-params">buf, encoding, options</span>) </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> buf === <span class="hljs-string">'string'</span>) {
        <span class="hljs-keyword">if</span> (!iconv.skipDecodeWarning) {
            <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Iconv-lite warning: decode()-ing strings is deprecated. Refer to https://github.com/ashtuchkin/iconv-lite/wiki/Use-Buffers-when-decoding'</span>);
            iconv.skipDecodeWarning = <span class="hljs-literal">true</span>;
        }

        buf = <span class="hljs-keyword">new</span> Buffer(<span class="hljs-string">""</span> + (buf || <span class="hljs-string">""</span>), <span class="hljs-string">"binary"</span>); <span class="hljs-comment">// Ensure buffer.</span>
    }

    <span class="hljs-keyword">var</span> decoder = iconv.getDecoder(encoding, options);

    <span class="hljs-keyword">var</span> res = decoder.write(buf);
    <span class="hljs-keyword">var</span> trail = decoder.end();

    <span class="hljs-keyword">return</span> trail ? (res + trail) : res;
}

iconv.encodingExists = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">encodingExists</span>(<span class="hljs-params">enc</span>) </span>{
    <span class="hljs-keyword">try</span> {
        iconv.getCodec(enc);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
}

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>Legacy aliases to convert functions</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">iconv.toEncoding = iconv.encode;
iconv.fromEncoding = iconv.decode;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>Search for a codec in iconv.encodings. Cache codec data in iconv._codecDataCache.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">iconv._codecDataCache = {};
iconv.getCodec = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCodec</span>(<span class="hljs-params">encoding</span>) </span>{
    <span class="hljs-keyword">if</span> (!iconv.encodings)
        iconv.encodings = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../encodings"</span>); <span class="hljs-comment">// Lazy load all encoding definitions.</span>
    
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Canonicalize encoding name: strip all non-alphanumeric chars and appended year.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> enc = (<span class="hljs-string">''</span>+encoding).toLowerCase().replace(<span class="hljs-regexp">/[^0-9a-z]|:\d{4}$/g</span>, <span class="hljs-string">""</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>Traverse iconv.encodings to find actual codec.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> codecOptions = {};
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {
        <span class="hljs-keyword">var</span> codec = iconv._codecDataCache[enc];
        <span class="hljs-keyword">if</span> (codec)
            <span class="hljs-keyword">return</span> codec;

        <span class="hljs-keyword">var</span> codecDef = iconv.encodings[enc];

        <span class="hljs-keyword">switch</span> (<span class="hljs-keyword">typeof</span> codecDef) {
            <span class="hljs-keyword">case</span> <span class="hljs-string">"string"</span>: <span class="hljs-comment">// Direct alias to other encoding.</span>
                enc = codecDef;
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> <span class="hljs-string">"object"</span>: <span class="hljs-comment">// Alias with options. Can be layered.</span>
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> codecDef)
                    codecOptions[key] = codecDef[key];

                <span class="hljs-keyword">if</span> (!codecOptions.encodingName)
                    codecOptions.encodingName = enc;
                
                enc = codecDef.type;
                <span class="hljs-keyword">break</span>;

            <span class="hljs-keyword">case</span> <span class="hljs-string">"function"</span>: <span class="hljs-comment">// Codec itself.</span>
                <span class="hljs-keyword">if</span> (!codecOptions.encodingName)
                    codecOptions.encodingName = enc;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>The codec function must load all tables and return object with .encoder and .decoder methods.
It'll be called only once (for each different options object).</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                codec = <span class="hljs-keyword">new</span> codecDef(codecOptions, iconv);

                iconv._codecDataCache[codecOptions.encodingName] = codec; <span class="hljs-comment">// Save it to be reused later.</span>
                <span class="hljs-keyword">return</span> codec;

            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Encoding not recognized: '"</span> + encoding + <span class="hljs-string">"' (searched as: '"</span>+enc+<span class="hljs-string">"')"</span>);
        }
    }
}

iconv.getEncoder = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getEncoder</span>(<span class="hljs-params">encoding, options</span>) </span>{
    <span class="hljs-keyword">var</span> codec = iconv.getCodec(encoding),
        encoder = <span class="hljs-keyword">new</span> codec.encoder(options, codec);

    <span class="hljs-keyword">if</span> (codec.bomAware &amp;&amp; options &amp;&amp; options.addBOM)
        encoder = <span class="hljs-keyword">new</span> bomHandling.PrependBOM(encoder, options);

    <span class="hljs-keyword">return</span> encoder;
}

iconv.getDecoder = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getDecoder</span>(<span class="hljs-params">encoding, options</span>) </span>{
    <span class="hljs-keyword">var</span> codec = iconv.getCodec(encoding),
        decoder = <span class="hljs-keyword">new</span> codec.decoder(options, codec);

    <span class="hljs-keyword">if</span> (codec.bomAware &amp;&amp; !(options &amp;&amp; options.stripBOM === <span class="hljs-literal">false</span>))
        decoder = <span class="hljs-keyword">new</span> bomHandling.StripBOM(decoder, options);

    <span class="hljs-keyword">return</span> decoder;
}


</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Load extensions in Node. All of them are omitted in Browserify build via 'browser' field in package.json.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> nodeVer = <span class="hljs-keyword">typeof</span> process !== <span class="hljs-string">'undefined'</span> &amp;&amp; process.versions &amp;&amp; process.versions.node;
<span class="hljs-keyword">if</span> (nodeVer) {

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Load streaming support in Node v0.10+</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">var</span> nodeVerArr = nodeVer.split(<span class="hljs-string">"."</span>).map(<span class="hljs-built_in">Number</span>);
    <span class="hljs-keyword">if</span> (nodeVerArr[<span class="hljs-number">0</span>] &gt; <span class="hljs-number">0</span> || nodeVerArr[<span class="hljs-number">1</span>] &gt;= <span class="hljs-number">10</span>) {
        <span class="hljs-built_in">require</span>(<span class="hljs-string">"./streams"</span>)(iconv);
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Load Node primitive extensions.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-built_in">require</span>(<span class="hljs-string">"./extend-node"</span>)(iconv);
}


</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
