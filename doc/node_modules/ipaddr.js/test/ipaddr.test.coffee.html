<!DOCTYPE html>
<html>
<head>
  <title>ipaddr.test.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/ipaddr.js/test/ipaddr.test.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>ipaddr.test.coffee</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr = <span class="hljs-built_in">require</span> <span class="hljs-string">'../lib/ipaddr'</span>

<span class="hljs-built_in">module</span>.exports =
  <span class="hljs-string">'should define main classes'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.ok(ipaddr.IPv4?, <span class="hljs-string">'defines IPv4 class'</span>)
    test.ok(ipaddr.IPv6?, <span class="hljs-string">'defines IPv6 class'</span>)
    test.done()

  <span class="hljs-string">'can construct IPv4 from octets'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.doesNotThrow -&gt;
      <span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">192</span>, <span class="hljs-number">168</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>])
    test.done()

  <span class="hljs-string">'refuses to construct invalid IPv4'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.throws -&gt;
      <span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">300</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])
    test.throws -&gt;
      <span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">8</span>, <span class="hljs-number">8</span>, <span class="hljs-number">8</span>])
    test.done()

  <span class="hljs-string">'converts IPv4 to string correctly'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    addr = <span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">192</span>, <span class="hljs-number">168</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>])
    test.equal(addr.toString(), <span class="hljs-string">'192.168.1.1'</span>)
    test.done()

  <span class="hljs-string">'returns correct kind for IPv4'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    addr = <span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>])
    test.equal(addr.kind(), <span class="hljs-string">'ipv4'</span>)
    test.done()

  <span class="hljs-string">'allows to access IPv4 octets'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    addr = <span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">42</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>])
    test.equal(addr.octets[<span class="hljs-number">0</span>], <span class="hljs-number">42</span>)
    test.done()

  <span class="hljs-string">'checks IPv4 address format'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.IPv4.isIPv4(<span class="hljs-string">'192.168.007.0xa'</span>), <span class="hljs-literal">true</span>)
    test.equal(ipaddr.IPv4.isIPv4(<span class="hljs-string">'1024.0.0.1'</span>),      <span class="hljs-literal">true</span>)
    test.equal(ipaddr.IPv4.isIPv4(<span class="hljs-string">'8.0xa.wtf.6'</span>),     <span class="hljs-literal">false</span>)
    test.done()

  <span class="hljs-string">'validates IPv4 addresses'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.IPv4.isValid(<span class="hljs-string">'192.168.007.0xa'</span>), <span class="hljs-literal">true</span>)
    test.equal(ipaddr.IPv4.isValid(<span class="hljs-string">'1024.0.0.1'</span>),      <span class="hljs-literal">false</span>)
    test.equal(ipaddr.IPv4.isValid(<span class="hljs-string">'8.0xa.wtf.6'</span>),     <span class="hljs-literal">false</span>)
    test.done()

  <span class="hljs-string">'parses IPv4 in several weird formats'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.deepEqual(ipaddr.IPv4.parse(<span class="hljs-string">'192.168.1.1'</span>).octets,  [<span class="hljs-number">192</span>, <span class="hljs-number">168</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>])
    test.deepEqual(ipaddr.IPv4.parse(<span class="hljs-string">'0xc0.168.1.1'</span>).octets, [<span class="hljs-number">192</span>, <span class="hljs-number">168</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>])
    test.deepEqual(ipaddr.IPv4.parse(<span class="hljs-string">'192.0250.1.1'</span>).octets, [<span class="hljs-number">192</span>, <span class="hljs-number">168</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>])
    test.deepEqual(ipaddr.IPv4.parse(<span class="hljs-string">'0xc0a80101'</span>).octets,   [<span class="hljs-number">192</span>, <span class="hljs-number">168</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>])
    test.deepEqual(ipaddr.IPv4.parse(<span class="hljs-string">'030052000401'</span>).octets, [<span class="hljs-number">192</span>, <span class="hljs-number">168</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>])
    test.deepEqual(ipaddr.IPv4.parse(<span class="hljs-string">'3232235777'</span>).octets,   [<span class="hljs-number">192</span>, <span class="hljs-number">168</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>])
    test.done()

  <span class="hljs-string">'barfs at invalid IPv4'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.throws -&gt;
      ipaddr.IPv4.parse(<span class="hljs-string">'10.0.0.wtf'</span>)
    test.done()

  <span class="hljs-string">'matches IPv4 CIDR correctly'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    addr = <span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.equal(addr.match(ipaddr.IPv4.parse(<span class="hljs-string">'0.0.0.0'</span>), <span class="hljs-number">0</span>),   <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parse(<span class="hljs-string">'11.0.0.0'</span>), <span class="hljs-number">8</span>),  <span class="hljs-literal">false</span>)
    test.equal(addr.match(ipaddr.IPv4.parse(<span class="hljs-string">'10.0.0.0'</span>), <span class="hljs-number">8</span>),  <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parse(<span class="hljs-string">'10.0.0.1'</span>), <span class="hljs-number">8</span>),  <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parse(<span class="hljs-string">'10.0.0.10'</span>), <span class="hljs-number">8</span>), <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parse(<span class="hljs-string">'10.5.5.0'</span>), <span class="hljs-number">16</span>), <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parse(<span class="hljs-string">'10.4.5.0'</span>), <span class="hljs-number">16</span>), <span class="hljs-literal">false</span>)
    test.equal(addr.match(ipaddr.IPv4.parse(<span class="hljs-string">'10.4.5.0'</span>), <span class="hljs-number">15</span>), <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parse(<span class="hljs-string">'10.5.0.2'</span>), <span class="hljs-number">32</span>), <span class="hljs-literal">false</span>)
    test.equal(addr.match(addr, <span class="hljs-number">32</span>), <span class="hljs-literal">true</span>)
    test.done()

  <span class="hljs-string">'parses IPv4 CIDR correctly'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    addr = <span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">10</span>, <span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.equal(addr.match(ipaddr.IPv4.parseCIDR(<span class="hljs-string">'0.0.0.0/0'</span>)),   <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parseCIDR(<span class="hljs-string">'11.0.0.0/8'</span>)),  <span class="hljs-literal">false</span>)
    test.equal(addr.match(ipaddr.IPv4.parseCIDR(<span class="hljs-string">'10.0.0.0/8'</span>)),  <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parseCIDR(<span class="hljs-string">'10.0.0.1/8'</span>)),  <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parseCIDR(<span class="hljs-string">'10.0.0.10/8'</span>)), <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parseCIDR(<span class="hljs-string">'10.5.5.0/16'</span>)), <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parseCIDR(<span class="hljs-string">'10.4.5.0/16'</span>)), <span class="hljs-literal">false</span>)
    test.equal(addr.match(ipaddr.IPv4.parseCIDR(<span class="hljs-string">'10.4.5.0/15'</span>)), <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv4.parseCIDR(<span class="hljs-string">'10.5.0.2/32'</span>)), <span class="hljs-literal">false</span>)
    test.equal(addr.match(ipaddr.IPv4.parseCIDR(<span class="hljs-string">'10.5.0.1/32'</span>)), <span class="hljs-literal">true</span>)
    test.throws -&gt;
      ipaddr.IPv4.parseCIDR(<span class="hljs-string">'10.5.0.1'</span>)
    test.throws -&gt;
      ipaddr.IPv4.parseCIDR(<span class="hljs-string">'0.0.0.0/-1'</span>)
    test.throws -&gt;
      ipaddr.IPv4.parseCIDR(<span class="hljs-string">'0.0.0.0/33'</span>)
    test.done()

  <span class="hljs-string">'detects reserved IPv4 networks'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'0.0.0.0'</span>).range(),         <span class="hljs-string">'unspecified'</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'0.1.0.0'</span>).range(),         <span class="hljs-string">'unspecified'</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'10.1.0.1'</span>).range(),        <span class="hljs-string">'private'</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'192.168.2.1'</span>).range(),     <span class="hljs-string">'private'</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'224.100.0.1'</span>).range(),     <span class="hljs-string">'multicast'</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'169.254.15.0'</span>).range(),    <span class="hljs-string">'linkLocal'</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'127.1.1.1'</span>).range(),       <span class="hljs-string">'loopback'</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.255.255'</span>).range(), <span class="hljs-string">'broadcast'</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'240.1.2.3'</span>).range(),       <span class="hljs-string">'reserved'</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'8.8.8.8'</span>).range(),         <span class="hljs-string">'unicast'</span>)
    test.done()

  <span class="hljs-string">'checks the conventional IPv4 address format'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
      test.equal(ipaddr.IPv4.isValidFourPartDecimal(<span class="hljs-string">'192.168.1.1'</span>),  <span class="hljs-literal">true</span>)
      test.equal(ipaddr.IPv4.isValidFourPartDecimal(<span class="hljs-string">'0xc0.168.1.1'</span>), <span class="hljs-literal">false</span>)
      test.done()

  <span class="hljs-string">'can construct IPv6 from 16bit parts'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.doesNotThrow -&gt;
      <span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0x2001</span>, <span class="hljs-number">0xdb8</span>, <span class="hljs-number">0xf53a</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.done()

  <span class="hljs-string">'can construct IPv6 from 8bit parts'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.doesNotThrow -&gt;
      <span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0x20</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xd</span>, <span class="hljs-number">0xb8</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0x3a</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.deepEqual(<span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0x20</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xd</span>, <span class="hljs-number">0xb8</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0x3a</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]),
      <span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0x2001</span>, <span class="hljs-number">0xdb8</span>, <span class="hljs-number">0xf53a</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]))
    test.done()

  <span class="hljs-string">'refuses to construct invalid IPv6'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.throws -&gt;
      <span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0xfffff</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.throws -&gt;
      <span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0xfffff</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.throws -&gt;
      <span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0xffff</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.done()

  <span class="hljs-string">'converts IPv6 to string correctly'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    addr = <span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0x2001</span>, <span class="hljs-number">0xdb8</span>, <span class="hljs-number">0xf53a</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.equal(addr.toNormalizedString(), <span class="hljs-string">'2001:db8:f53a:0:0:0:0:1'</span>)
    test.equal(addr.toString(), <span class="hljs-string">'2001:db8:f53a::1'</span>)
    test.equal(<span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]).toString(), <span class="hljs-string">'::1'</span>)
    test.equal(<span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0x2001</span>, <span class="hljs-number">0xdb8</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]).toString(), <span class="hljs-string">'2001:db8::'</span>)
    test.done()

  <span class="hljs-string">'returns correct kind for IPv6'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    addr = <span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0x2001</span>, <span class="hljs-number">0xdb8</span>, <span class="hljs-number">0xf53a</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.equal(addr.kind(), <span class="hljs-string">'ipv6'</span>)
    test.done()

  <span class="hljs-string">'allows to access IPv6 address parts'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    addr = <span class="hljs-keyword">new</span> ipaddr.IPv6([<span class="hljs-number">0x2001</span>, <span class="hljs-number">0xdb8</span>, <span class="hljs-number">0xf53a</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">42</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.equal(addr.parts[<span class="hljs-number">5</span>], <span class="hljs-number">42</span>)
    test.done()

  <span class="hljs-string">'checks IPv6 address format'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.IPv6.isIPv6(<span class="hljs-string">'2001:db8:F53A::1'</span>),     <span class="hljs-literal">true</span>)
    test.equal(ipaddr.IPv6.isIPv6(<span class="hljs-string">'200001::1'</span>),            <span class="hljs-literal">true</span>)
    test.equal(ipaddr.IPv6.isIPv6(<span class="hljs-string">'::ffff:192.168.1.1'</span>),   <span class="hljs-literal">true</span>)
    test.equal(ipaddr.IPv6.isIPv6(<span class="hljs-string">'::ffff:300.168.1.1'</span>),   <span class="hljs-literal">false</span>)
    test.equal(ipaddr.IPv6.isIPv6(<span class="hljs-string">'::ffff:300.168.1.1:0'</span>), <span class="hljs-literal">false</span>)
    test.equal(ipaddr.IPv6.isIPv6(<span class="hljs-string">'fe80::wtf'</span>),            <span class="hljs-literal">false</span>)
    test.done()

  <span class="hljs-string">'validates IPv6 addresses'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-string">'2001:db8:F53A::1'</span>),     <span class="hljs-literal">true</span>)
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-string">'200001::1'</span>),            <span class="hljs-literal">false</span>)
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-string">'::ffff:192.168.1.1'</span>),   <span class="hljs-literal">true</span>)
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-string">'::ffff:300.168.1.1'</span>),   <span class="hljs-literal">false</span>)
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-string">'::ffff:300.168.1.1:0'</span>), <span class="hljs-literal">false</span>)
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-string">'::ffff:222.1.41.9000'</span>), <span class="hljs-literal">false</span>)
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-string">'2001:db8::F53A::1'</span>),    <span class="hljs-literal">false</span>)
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-string">'fe80::wtf'</span>),            <span class="hljs-literal">false</span>)
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-string">'2002::2:'</span>),             <span class="hljs-literal">false</span>)
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-literal">undefined</span>),              <span class="hljs-literal">false</span>)
    test.done()

  <span class="hljs-string">'parses IPv6 in different formats'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.deepEqual(ipaddr.IPv6.parse(<span class="hljs-string">'2001:db8:F53A:0:0:0:0:1'</span>).parts, [<span class="hljs-number">0x2001</span>, <span class="hljs-number">0xdb8</span>, <span class="hljs-number">0xf53a</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.deepEqual(ipaddr.IPv6.parse(<span class="hljs-string">'fe80::10'</span>).parts, [<span class="hljs-number">0xfe80</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0x10</span>])
    test.deepEqual(ipaddr.IPv6.parse(<span class="hljs-string">'2001:db8:F53A::'</span>).parts, [<span class="hljs-number">0x2001</span>, <span class="hljs-number">0xdb8</span>, <span class="hljs-number">0xf53a</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>])
    test.deepEqual(ipaddr.IPv6.parse(<span class="hljs-string">'::1'</span>).parts, [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    test.deepEqual(ipaddr.IPv6.parse(<span class="hljs-string">'::'</span>).parts, [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>])
    test.done()

  <span class="hljs-string">'barfs at invalid IPv6'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.throws -&gt;
      ipaddr.IPv6.parse(<span class="hljs-string">'fe80::0::1'</span>)
    test.done()

  <span class="hljs-string">'matches IPv6 CIDR correctly'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    addr = ipaddr.IPv6.parse(<span class="hljs-string">'2001:db8:f53a::1'</span>)
    test.equal(addr.match(ipaddr.IPv6.parse(<span class="hljs-string">'::'</span>), <span class="hljs-number">0</span>),                  <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv6.parse(<span class="hljs-string">'2001:db8:f53a::1:1'</span>), <span class="hljs-number">64</span>), <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv6.parse(<span class="hljs-string">'2001:db8:f53b::1:1'</span>), <span class="hljs-number">48</span>), <span class="hljs-literal">false</span>)
    test.equal(addr.match(ipaddr.IPv6.parse(<span class="hljs-string">'2001:db8:f531::1:1'</span>), <span class="hljs-number">44</span>), <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv6.parse(<span class="hljs-string">'2001:db8:f500::1'</span>), <span class="hljs-number">40</span>),   <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv6.parse(<span class="hljs-string">'2001:db9:f500::1'</span>), <span class="hljs-number">40</span>),   <span class="hljs-literal">false</span>)
    test.equal(addr.match(addr, <span class="hljs-number">128</span>), <span class="hljs-literal">true</span>)
    test.done()

  <span class="hljs-string">'parses IPv6 CIDR correctly'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    addr = ipaddr.IPv6.parse(<span class="hljs-string">'2001:db8:f53a::1'</span>)
    test.equal(addr.match(ipaddr.IPv6.parseCIDR(<span class="hljs-string">'::/0'</span>)),                  <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv6.parseCIDR(<span class="hljs-string">'2001:db8:f53a::1:1/64'</span>)), <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv6.parseCIDR(<span class="hljs-string">'2001:db8:f53b::1:1/48'</span>)), <span class="hljs-literal">false</span>)
    test.equal(addr.match(ipaddr.IPv6.parseCIDR(<span class="hljs-string">'2001:db8:f531::1:1/44'</span>)), <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv6.parseCIDR(<span class="hljs-string">'2001:db8:f500::1/40'</span>)),   <span class="hljs-literal">true</span>)
    test.equal(addr.match(ipaddr.IPv6.parseCIDR(<span class="hljs-string">'2001:db9:f500::1/40'</span>)),   <span class="hljs-literal">false</span>)
    test.equal(addr.match(ipaddr.IPv6.parseCIDR(<span class="hljs-string">'2001:db8:f53a::1/128'</span>)),  <span class="hljs-literal">true</span>)
    test.throws -&gt;
      ipaddr.IPv6.parseCIDR(<span class="hljs-string">'2001:db8:f53a::1'</span>)
    test.throws -&gt;
      ipaddr.IPv6.parseCIDR(<span class="hljs-string">'2001:db8:f53a::1/-1'</span>)
    test.throws -&gt;
      ipaddr.IPv6.parseCIDR(<span class="hljs-string">'2001:db8:f53a::1/129'</span>)
    test.done()

  <span class="hljs-string">'converts between IPv4-mapped IPv6 addresses and IPv4 addresses'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    addr = ipaddr.IPv4.parse(<span class="hljs-string">'77.88.21.11'</span>)
    mapped = addr.toIPv4MappedAddress()
    test.deepEqual(mapped.parts, [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0xffff</span>, <span class="hljs-number">0x4d58</span>, <span class="hljs-number">0x150b</span>])
    test.deepEqual(mapped.toIPv4Address().octets, addr.octets)
    test.done()

  <span class="hljs-string">'refuses to convert non-IPv4-mapped IPv6 address to IPv4 address'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.throws -&gt;
      ipaddr.IPv6.parse(<span class="hljs-string">'2001:db8::1'</span>).toIPv4Address()
    test.done()

  <span class="hljs-string">'detects reserved IPv6 networks'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'::'</span>).range(),                        <span class="hljs-string">'unspecified'</span>)
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'fe80::1234:5678:abcd:0123'</span>).range(), <span class="hljs-string">'linkLocal'</span>)
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'ff00::1234'</span>).range(),                <span class="hljs-string">'multicast'</span>)
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'::1'</span>).range(),                       <span class="hljs-string">'loopback'</span>)
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'fc00::'</span>).range(),                    <span class="hljs-string">'uniqueLocal'</span>)
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'::ffff:192.168.1.10'</span>).range(),       <span class="hljs-string">'ipv4Mapped'</span>)
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'::ffff:0:192.168.1.10'</span>).range(),     <span class="hljs-string">'rfc6145'</span>)
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'64:ff9b::1234'</span>).range(),             <span class="hljs-string">'rfc6052'</span>)
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'2002:1f63:45e8::1'</span>).range(),         <span class="hljs-string">'6to4'</span>)
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'2001::4242'</span>).range(),                <span class="hljs-string">'teredo'</span>)
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'2001:db8::3210'</span>).range(),            <span class="hljs-string">'reserved'</span>)
    test.equal(ipaddr.IPv6.parse(<span class="hljs-string">'2001:470:8:66::1'</span>).range(),          <span class="hljs-string">'unicast'</span>)
    test.done()

  <span class="hljs-string">'is able to determine IP address type'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.parse(<span class="hljs-string">'8.8.8.8'</span>).kind(), <span class="hljs-string">'ipv4'</span>)
    test.equal(ipaddr.parse(<span class="hljs-string">'2001:db8:3312::1'</span>).kind(), <span class="hljs-string">'ipv6'</span>)
    test.done()

  <span class="hljs-string">'throws an error if tried to parse an invalid address'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.throws -&gt;
      ipaddr.parse(<span class="hljs-string">'::some.nonsense'</span>)
    test.done()

  <span class="hljs-string">'correctly processes IPv4-mapped addresses'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.process(<span class="hljs-string">'8.8.8.8'</span>).kind(), <span class="hljs-string">'ipv4'</span>)
    test.equal(ipaddr.process(<span class="hljs-string">'2001:db8:3312::1'</span>).kind(), <span class="hljs-string">'ipv6'</span>)
    test.equal(ipaddr.process(<span class="hljs-string">'::ffff:192.168.1.1'</span>).kind(), <span class="hljs-string">'ipv4'</span>)
    test.done()

  <span class="hljs-string">'correctly converts IPv6 and IPv4 addresses to byte arrays'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.deepEqual(ipaddr.parse(<span class="hljs-string">'1.2.3.4'</span>).toByteArray(),
          [<span class="hljs-number">0x1</span>, <span class="hljs-number">0x2</span>, <span class="hljs-number">0x3</span>, <span class="hljs-number">0x4</span>]);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Fuck yeah. The first byte of Google's IPv6 address is 42. 42!</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    test.deepEqual(ipaddr.parse(<span class="hljs-string">'2a00:1450:8007::68'</span>).toByteArray(),
          [<span class="hljs-number">42</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x68</span> ])
    test.done()

  <span class="hljs-string">'correctly parses 1 as an IPv4 address'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-string">'1'</span>), <span class="hljs-literal">false</span>)
    test.equal(ipaddr.IPv4.isValid(<span class="hljs-string">'1'</span>), <span class="hljs-literal">true</span>)
    test.deepEqual(<span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]), ipaddr.parse(<span class="hljs-string">'1'</span>))
    test.done()

  <span class="hljs-string">'correctly detects IPv4 and IPv6 CIDR addresses'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.deepEqual([ipaddr.IPv6.parse(<span class="hljs-string">'fc00::'</span>), <span class="hljs-number">64</span>],
                   ipaddr.parseCIDR(<span class="hljs-string">'fc00::/64'</span>))
    test.deepEqual([ipaddr.IPv4.parse(<span class="hljs-string">'1.2.3.4'</span>), <span class="hljs-number">5</span>],
                   ipaddr.parseCIDR(<span class="hljs-string">'1.2.3.4/5'</span>))
    test.done()

  <span class="hljs-string">'does not consider a very large or very small number a valid IP address'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.isValid(<span class="hljs-string">'4999999999'</span>), <span class="hljs-literal">false</span>)
    test.equal(ipaddr.isValid(<span class="hljs-string">'-1'</span>), <span class="hljs-literal">false</span>)
    test.done()

  <span class="hljs-string">'does not hang on ::8:8:8:8:8:8:8:8:8'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.IPv6.isValid(<span class="hljs-string">'::8:8:8:8:8:8:8:8:8'</span>), <span class="hljs-literal">false</span>)
    test.done()

  <span class="hljs-string">'subnetMatch does not fail on empty range'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    ipaddr.subnetMatch(<span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]), {}, <span class="hljs-literal">false</span>)
    ipaddr.subnetMatch(<span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]), {subnet: []}, <span class="hljs-literal">false</span>)
    test.done()

  <span class="hljs-string">'subnetMatch returns default subnet on empty range'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.subnetMatch(<span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]), {}, <span class="hljs-literal">false</span>), <span class="hljs-literal">false</span>)
    test.equal(ipaddr.subnetMatch(<span class="hljs-keyword">new</span> ipaddr.IPv4([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>]), {subnet: []}, <span class="hljs-literal">false</span>), <span class="hljs-literal">false</span>)
    test.done()

  <span class="hljs-string">'is able to determine IP address type from byte array input'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.fromByteArray([<span class="hljs-number">0x7f</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]).kind(), <span class="hljs-string">'ipv4'</span>)
    test.equal(ipaddr.fromByteArray([<span class="hljs-number">0x20</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xd</span>, <span class="hljs-number">0xb8</span>, <span class="hljs-number">0xf5</span>, <span class="hljs-number">0x3a</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]).kind(), <span class="hljs-string">'ipv6'</span>)
    test.throws -&gt;
      ipaddr.fromByteArray([<span class="hljs-number">1</span>])
    test.done()

  <span class="hljs-string">'prefixLengthFromSubnetMask returns proper CIDR notation for standard IPv4 masks'</span>: <span class="hljs-function"><span class="hljs-params">(test)</span> -&gt;</span>
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.255.255'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">32</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.255.254'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">31</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.255.252'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">30</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.255.248'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">29</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.255.240'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">28</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.255.224'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">27</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.255.192'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">26</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.255.128'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">25</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.255.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">24</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.254.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">23</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.252.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">22</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.248.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">21</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.240.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">20</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.224.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">19</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.192.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">18</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.128.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">17</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.255.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">16</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.254.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">15</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.252.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">14</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.248.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">13</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.240.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">12</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.224.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">11</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.192.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">10</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.128.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">9</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.0.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">8</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'254.0.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">7</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'252.0.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">6</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'248.0.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">5</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'240.0.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">4</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'224.0.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">3</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'192.0.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">2</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'128.0.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">1</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'0.0.0.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-number">0</span>)
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>negative cases</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'192.168.255.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-literal">null</span>)
    test.equal(ipaddr.IPv4.parse(<span class="hljs-string">'255.0.255.0'</span>).prefixLengthFromSubnetMask(), <span class="hljs-literal">null</span>)
    test.done()


</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
