<!DOCTYPE html>
<html>
<head>
  <title>ipaddr.coffee</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../";
    var thisFile = "node_modules/ipaddr.js/src/ipaddr.coffee";
    var defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>ipaddr.coffee</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>
<p>Define the main object</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr = {}

root = <span class="hljs-keyword">this</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>Export for both the CommonJS and browser-like environment</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-keyword">if</span> <span class="hljs-built_in">module</span>? &amp;&amp; <span class="hljs-built_in">module</span>.exports
  <span class="hljs-built_in">module</span>.exports = ipaddr
<span class="hljs-keyword">else</span>
  root[<span class="hljs-string">'ipaddr'</span>] = ipaddr

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>A generic CIDR (Classless Inter-Domain Routing) RFC1518 range matcher.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-function"><span class="hljs-title">matchCIDR</span> = <span class="hljs-params">(first, second, partSize, cidrBits)</span> -&gt;</span>
  <span class="hljs-keyword">if</span> first.length != second.length
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: cannot match CIDR for objects with different lengths"</span>

  part = <span class="hljs-number">0</span>
  <span class="hljs-keyword">while</span> cidrBits &gt; <span class="hljs-number">0</span>
    shift = partSize - cidrBits
    shift = <span class="hljs-number">0</span> <span class="hljs-keyword">if</span> shift &lt; <span class="hljs-number">0</span>

    <span class="hljs-keyword">if</span> first[part] &gt;&gt; shift != second[part] &gt;&gt; shift
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

    cidrBits -= partSize
    part     += <span class="hljs-number">1</span>

  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>An utility function to ease named range matching. See examples below.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr.subnetMatch = <span class="hljs-function"><span class="hljs-params">(address, rangeList, defaultName=<span class="hljs-string">'unicast'</span>)</span> -&gt;</span>
  <span class="hljs-keyword">for</span> rangeName, rangeSubnets <span class="hljs-keyword">of</span> rangeList
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>ECMA5 Array.isArray isn't available everywhere</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    <span class="hljs-keyword">if</span> rangeSubnets[<span class="hljs-number">0</span>] &amp;&amp; !(rangeSubnets[<span class="hljs-number">0</span>] <span class="hljs-keyword">instanceof</span> Array)
      rangeSubnets = [ rangeSubnets ]

    <span class="hljs-keyword">for</span> subnet <span class="hljs-keyword">in</span> rangeSubnets
      <span class="hljs-keyword">return</span> rangeName <span class="hljs-keyword">if</span> address.match.apply(address, subnet)

  <span class="hljs-keyword">return</span> defaultName

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>An IPv4 address (RFC791).</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ipaddr</span>.<span class="hljs-title">IPv4</span></span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>Constructs a new IPv4 address from an array of four octets
in network order (MSB first)
Verifies the input.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  constructor: <span class="hljs-function"><span class="hljs-params">(octets)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> octets.length != <span class="hljs-number">4</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: ipv4 octet count should be 4"</span>

    <span class="hljs-keyword">for</span> octet <span class="hljs-keyword">in</span> octets
      <span class="hljs-keyword">if</span> !(<span class="hljs-number">0</span> &lt;= octet &lt;= <span class="hljs-number">255</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: ipv4 octet should fit in 8 bits"</span>

    @octets = octets

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>The 'kind' method exists on both IPv4 and IPv6 classes.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  kind: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'ipv4'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>Returns the address in convenient, decimal-dotted format.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  toString: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> @octets.join <span class="hljs-string">"."</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>Returns an array of byte-sized values in network order (MSB first)</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  toByteArray: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> @octets.slice(<span class="hljs-number">0</span>) <span class="hljs-comment"># octets.clone</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>Checks if this address matches other one within given CIDR range.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  match: <span class="hljs-function"><span class="hljs-params">(other, cidrRange)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> cidrRange == <span class="hljs-literal">undefined</span>
      [other, cidrRange] = other

    <span class="hljs-keyword">if</span> other.kind() != <span class="hljs-string">'ipv4'</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: cannot match ipv4 address with non-ipv4 one"</span>

    <span class="hljs-keyword">return</span> matchCIDR(<span class="hljs-keyword">this</span>.octets, other.octets, <span class="hljs-number">8</span>, cidrRange)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>Special IPv4 address ranges.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  SpecialRanges:
    unspecified: [
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">0</span>,     <span class="hljs-number">0</span>,    <span class="hljs-number">0</span>,   <span class="hljs-number">0</span>]),  <span class="hljs-number">8</span> ]
    ]
    broadcast: [
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">255</span>, <span class="hljs-number">255</span>,  <span class="hljs-number">255</span>, <span class="hljs-number">255</span>]), <span class="hljs-number">32</span> ]
    ]
    multicast: [ <span class="hljs-comment"># RFC3171</span>
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">224</span>,   <span class="hljs-number">0</span>,    <span class="hljs-number">0</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">4</span>  ]
    ]
    linkLocal: [ <span class="hljs-comment"># RFC3927</span>
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">169</span>,   <span class="hljs-number">254</span>,  <span class="hljs-number">0</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">16</span> ]
    ]
    loopback: [ <span class="hljs-comment"># RFC5735</span>
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">127</span>,   <span class="hljs-number">0</span>,    <span class="hljs-number">0</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">8</span>  ]
    ]
    private: [ <span class="hljs-comment"># RFC1918</span>
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">10</span>,    <span class="hljs-number">0</span>,    <span class="hljs-number">0</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">8</span>  ]
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">172</span>,   <span class="hljs-number">16</span>,   <span class="hljs-number">0</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">12</span> ]
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">192</span>,   <span class="hljs-number">168</span>,  <span class="hljs-number">0</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">16</span> ]
    ]
    reserved: [ <span class="hljs-comment"># Reserved and testing-only ranges; RFCs 5735, 5737, 2544, 1700</span>
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">192</span>,   <span class="hljs-number">0</span>,    <span class="hljs-number">0</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">24</span> ]
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">192</span>,   <span class="hljs-number">0</span>,    <span class="hljs-number">2</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">24</span> ]
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">192</span>,  <span class="hljs-number">88</span>,   <span class="hljs-number">99</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">24</span> ]
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">198</span>,  <span class="hljs-number">51</span>,  <span class="hljs-number">100</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">24</span> ]
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">203</span>,   <span class="hljs-number">0</span>,  <span class="hljs-number">113</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">24</span> ]
      [ <span class="hljs-keyword">new</span> IPv4([<span class="hljs-number">240</span>,   <span class="hljs-number">0</span>,    <span class="hljs-number">0</span>,   <span class="hljs-number">0</span>]), <span class="hljs-number">4</span>  ]
    ]

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>Checks if the address corresponds to one of the special ranges.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  range: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> ipaddr.subnetMatch(<span class="hljs-keyword">this</span>, @SpecialRanges)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Convrets this IPv4 address to an IPv4-mapped IPv6 address.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  toIPv4MappedAddress: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> ipaddr.IPv6.parse <span class="hljs-string">"::ffff:<span class="hljs-subst">#{@toString()}</span>"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>returns a number of leading ones in IPv4 address, making sure that
the rest is a solid sequence of 0's (valid netmask)
returns either the CIDR length or null if mask is not valid</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  prefixLengthFromSubnetMask: <span class="hljs-function">-&gt;</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>number of zeroes in octet</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    zerotable =
      <span class="hljs-number">0</span>:   <span class="hljs-number">8</span>
      <span class="hljs-number">128</span>: <span class="hljs-number">7</span>
      <span class="hljs-number">192</span>: <span class="hljs-number">6</span>
      <span class="hljs-number">224</span>: <span class="hljs-number">5</span>
      <span class="hljs-number">240</span>: <span class="hljs-number">4</span>
      <span class="hljs-number">248</span>: <span class="hljs-number">3</span>
      <span class="hljs-number">252</span>: <span class="hljs-number">2</span>
      <span class="hljs-number">254</span>: <span class="hljs-number">1</span>
      <span class="hljs-number">255</span>: <span class="hljs-number">0</span>

    cidr = <span class="hljs-number">0</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>non-zero encountered stop scanning for zeroes</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">    stop = <span class="hljs-literal">false</span>
    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">3.</span><span class="hljs-number">.0</span>] <span class="hljs-keyword">by</span> <span class="hljs-number">-1</span>
      octet = @octets[i]
      <span class="hljs-keyword">if</span> octet <span class="hljs-keyword">of</span> zerotable
        zeros = zerotable[octet]
        <span class="hljs-keyword">if</span> stop <span class="hljs-keyword">and</span> zeros != <span class="hljs-number">0</span>
          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
        <span class="hljs-keyword">unless</span> zeros == <span class="hljs-number">8</span>
          stop = <span class="hljs-literal">true</span>
        cidr += zeros
      <span class="hljs-keyword">else</span>
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">32</span> - cidr

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>A list of regular expressions that match arbitrary IPv4 addresses,
for which a number of weird notations exist.
Note that an address like 0010.0xa5.1.1 is considered legal.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipv4Part = <span class="hljs-string">"(0?\\d+|0x[a-f0-9]+)"</span>
ipv4Regexes =
  fourOctet: <span class="hljs-keyword">new</span> RegExp <span class="hljs-string">"^<span class="hljs-subst">#{ipv4Part}</span>\\.<span class="hljs-subst">#{ipv4Part}</span>\\.<span class="hljs-subst">#{ipv4Part}</span>\\.<span class="hljs-subst">#{ipv4Part}</span>$"</span>, <span class="hljs-string">'i'</span>
  longValue: <span class="hljs-keyword">new</span> RegExp <span class="hljs-string">"^<span class="hljs-subst">#{ipv4Part}</span>$"</span>, <span class="hljs-string">'i'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>Classful variants (like a.b, where a is an octet, and b is a 24-bit
value representing last three octets; this corresponds to a class C
address) are omitted due to classless nature of modern Internet.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr.IPv4.parser = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
<span class="hljs-function">  <span class="hljs-title">parseIntAuto</span> = <span class="hljs-params">(string)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> string[<span class="hljs-number">0</span>] == <span class="hljs-string">"0"</span> &amp;&amp; string[<span class="hljs-number">1</span>] != <span class="hljs-string">"x"</span>
      parseInt(string, <span class="hljs-number">8</span>)
    <span class="hljs-keyword">else</span>
      parseInt(string)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>parseInt recognizes all that octal &amp; hexadecimal weirdness for us</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">if</span> match = string.match(ipv4Regexes.fourOctet)
    <span class="hljs-keyword">return</span> (parseIntAuto(part) <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> match[<span class="hljs-number">1.</span><span class="hljs-number">.5</span>])
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> match = string.match(ipv4Regexes.longValue)
    value = parseIntAuto(match[<span class="hljs-number">1</span>])
    <span class="hljs-keyword">if</span> value &gt; <span class="hljs-number">0xffffffff</span> || value &lt; <span class="hljs-number">0</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: address outside defined range"</span>
    <span class="hljs-keyword">return</span> ((value &gt;&gt; shift) &amp; <span class="hljs-number">0xff</span> <span class="hljs-keyword">for</span> shift <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.24</span>] <span class="hljs-keyword">by</span> <span class="hljs-number">8</span>).reverse()
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<p>An IPv6 address (RFC2460)</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ipaddr</span>.<span class="hljs-title">IPv6</span></span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<p>Constructs an IPv6 address from an array of eight 16-bit parts
or sixteen 8-bit parts in network order (MSB first).
Throws an error if the input is invalid.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  constructor: <span class="hljs-function"><span class="hljs-params">(parts)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> parts.length == <span class="hljs-number">16</span>
      @parts = []
      <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-number">0.</span><span class="hljs-number">.14</span>] <span class="hljs-keyword">by</span> <span class="hljs-number">2</span>
        @parts.push((parts[i] &lt;&lt; <span class="hljs-number">8</span>) | parts[i + <span class="hljs-number">1</span>])
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> parts.length == <span class="hljs-number">8</span>
      @parts = parts
    <span class="hljs-keyword">else</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: ipv6 part count should be 8 or 16"</span>

    <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> @parts
      <span class="hljs-keyword">if</span> !(<span class="hljs-number">0</span> &lt;= part &lt;= <span class="hljs-number">0xffff</span>)
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: ipv6 part should fit in 16 bits"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>The 'kind' method exists on both IPv4 and IPv6 classes.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  kind: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">'ipv6'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>Returns the address in compact, human-readable format like
2001:db8:8:66::1</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  toString: <span class="hljs-function">-&gt;</span>
    stringParts = (part.toString(<span class="hljs-number">16</span>) <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> @parts)

    compactStringParts = []
<span class="hljs-function">    <span class="hljs-title">pushPart</span> = <span class="hljs-params">(part)</span> -&gt;</span> compactStringParts.push part

    state = <span class="hljs-number">0</span>
    <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> stringParts
      <span class="hljs-keyword">switch</span> state
        <span class="hljs-keyword">when</span> <span class="hljs-number">0</span>
          <span class="hljs-keyword">if</span> part == <span class="hljs-string">'0'</span>
            pushPart(<span class="hljs-string">''</span>)
          <span class="hljs-keyword">else</span>
            pushPart(part)

          state = <span class="hljs-number">1</span>
        <span class="hljs-keyword">when</span> <span class="hljs-number">1</span>
          <span class="hljs-keyword">if</span> part == <span class="hljs-string">'0'</span>
            state = <span class="hljs-number">2</span>
          <span class="hljs-keyword">else</span>
            pushPart(part)
        <span class="hljs-keyword">when</span> <span class="hljs-number">2</span>
          <span class="hljs-keyword">unless</span> part == <span class="hljs-string">'0'</span>
            pushPart(<span class="hljs-string">''</span>)
            pushPart(part)
            state = <span class="hljs-number">3</span>
        <span class="hljs-keyword">when</span> <span class="hljs-number">3</span>
          pushPart(part)

    <span class="hljs-keyword">if</span> state == <span class="hljs-number">2</span>
      pushPart(<span class="hljs-string">''</span>)
      pushPart(<span class="hljs-string">''</span>)

    <span class="hljs-keyword">return</span> compactStringParts.join <span class="hljs-string">":"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>Returns an array of byte-sized values in network order (MSB first)</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  toByteArray: <span class="hljs-function">-&gt;</span>
    bytes = []
    <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> @parts
      bytes.push(part &gt;&gt; <span class="hljs-number">8</span>)
      bytes.push(part &amp; <span class="hljs-number">0xff</span>)

    <span class="hljs-keyword">return</span> bytes

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<p>Returns the address in expanded format with all zeroes included, like
2001:db8:8:66:0:0:0:1</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  toNormalizedString: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> (part.toString(<span class="hljs-number">16</span>) <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> @parts).join <span class="hljs-string">":"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>Checks if this address matches other one within given CIDR range.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  match: <span class="hljs-function"><span class="hljs-params">(other, cidrRange)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> cidrRange == <span class="hljs-literal">undefined</span>
      [other, cidrRange] = other

    <span class="hljs-keyword">if</span> other.kind() != <span class="hljs-string">'ipv6'</span>
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: cannot match ipv6 address with non-ipv6 one"</span>

    <span class="hljs-keyword">return</span> matchCIDR(<span class="hljs-keyword">this</span>.parts, other.parts, <span class="hljs-number">16</span>, cidrRange)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<p>Special IPv6 ranges</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  SpecialRanges:
    unspecified: [ <span class="hljs-keyword">new</span> IPv6([<span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]), <span class="hljs-number">128</span> ] <span class="hljs-comment"># RFC4291, here and after</span>
    linkLocal:   [ <span class="hljs-keyword">new</span> IPv6([<span class="hljs-number">0xfe80</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]), <span class="hljs-number">10</span>  ]
    multicast:   [ <span class="hljs-keyword">new</span> IPv6([<span class="hljs-number">0xff00</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]), <span class="hljs-number">8</span>   ]
    loopback:    [ <span class="hljs-keyword">new</span> IPv6([<span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">1</span>]), <span class="hljs-number">128</span> ]
    uniqueLocal: [ <span class="hljs-keyword">new</span> IPv6([<span class="hljs-number">0xfc00</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]), <span class="hljs-number">7</span>   ]
    ipv4Mapped:  [ <span class="hljs-keyword">new</span> IPv6([<span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0xffff</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]), <span class="hljs-number">96</span>  ]
    rfc6145:     [ <span class="hljs-keyword">new</span> IPv6([<span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0xffff</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]), <span class="hljs-number">96</span>  ] <span class="hljs-comment"># RFC6145</span>
    rfc6052:     [ <span class="hljs-keyword">new</span> IPv6([<span class="hljs-number">0x64</span>,   <span class="hljs-number">0xff9b</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]), <span class="hljs-number">96</span>  ] <span class="hljs-comment"># RFC6052</span>
    <span class="hljs-string">'6to4'</span>:      [ <span class="hljs-keyword">new</span> IPv6([<span class="hljs-number">0x2002</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]), <span class="hljs-number">16</span>  ] <span class="hljs-comment"># RFC3056</span>
    teredo:      [ <span class="hljs-keyword">new</span> IPv6([<span class="hljs-number">0x2001</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>,      <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]), <span class="hljs-number">32</span>  ] <span class="hljs-comment"># RFC6052, RFC6146</span>
    reserved: [
      [ <span class="hljs-keyword">new</span> IPv6([ <span class="hljs-number">0x2001</span>, <span class="hljs-number">0xdb8</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>]), <span class="hljs-number">32</span> ] <span class="hljs-comment"># RFC4291</span>
    ]

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>Checks if the address corresponds to one of the special ranges.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  range: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> ipaddr.subnetMatch(<span class="hljs-keyword">this</span>, @SpecialRanges)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<p>Checks if this address is an IPv4-mapped IPv6 address.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  isIPv4MappedAddress: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">return</span> @range() == <span class="hljs-string">'ipv4Mapped'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>Converts this address to IPv4 address if it is an IPv4-mapped IPv6 address.
Throws an error otherwise.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  toIPv4Address: <span class="hljs-function">-&gt;</span>
    <span class="hljs-keyword">unless</span> @isIPv4MappedAddress()
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: trying to convert a generic ipv6 address to ipv4"</span>

    [high, low] = @parts[<span class="hljs-number">-2.</span>.<span class="hljs-number">-1</span>]

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ipaddr.IPv4([high &gt;&gt; <span class="hljs-number">8</span>, high &amp; <span class="hljs-number">0xff</span>, low &gt;&gt; <span class="hljs-number">8</span>, low &amp; <span class="hljs-number">0xff</span>])

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<p>IPv6-matching regular expressions.
For IPv6, the task is simpler: it is enough to match the colon-delimited
hexadecimal IPv6 and a transitional variant with dotted-decimal IPv4 at
the end.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipv6Part = <span class="hljs-string">"(?:[0-9a-f]+::?)+"</span>
ipv6Regexes =
  native:       <span class="hljs-keyword">new</span> RegExp <span class="hljs-string">"^(::)?(<span class="hljs-subst">#{ipv6Part}</span>)?([0-9a-f]+)?(::)?$"</span>, <span class="hljs-string">'i'</span>
  transitional: <span class="hljs-keyword">new</span> RegExp <span class="hljs-string">"^((?:<span class="hljs-subst">#{ipv6Part}</span>)|(?:::)(?:<span class="hljs-subst">#{ipv6Part}</span>)?)"</span> +
                           <span class="hljs-string">"<span class="hljs-subst">#{ipv4Part}</span>\\.<span class="hljs-subst">#{ipv4Part}</span>\\.<span class="hljs-subst">#{ipv4Part}</span>\\.<span class="hljs-subst">#{ipv4Part}</span>$"</span>, <span class="hljs-string">'i'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<p>Expand :: in an IPv6 address or address part consisting of <code>parts</code> groups.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript"><span class="hljs-function"><span class="hljs-title">expandIPv6</span> = <span class="hljs-params">(string, parts)</span> -&gt;</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<p>More than one '::' means invalid adddress</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">if</span> string.indexOf(<span class="hljs-string">'::'</span>) != string.lastIndexOf(<span class="hljs-string">'::'</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<p>How many parts do we already have?</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  colonCount = <span class="hljs-number">0</span>
  lastColon = <span class="hljs-number">-1</span>
  <span class="hljs-keyword">while</span> (lastColon = string.indexOf(<span class="hljs-string">':'</span>, lastColon + <span class="hljs-number">1</span>)) &gt;= <span class="hljs-number">0</span>
    colonCount++

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<p>0::0 is two parts more than ::</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  colonCount-- <span class="hljs-keyword">if</span> string.substr(<span class="hljs-number">0</span>, <span class="hljs-number">2</span>) == <span class="hljs-string">'::'</span>
  colonCount-- <span class="hljs-keyword">if</span> string.substr(<span class="hljs-number">-2</span>, <span class="hljs-number">2</span>) == <span class="hljs-string">'::'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>The following loop would hang if colonCount &gt; parts</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">if</span> colonCount &gt; parts
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>replacement = ':' + '0:' * (parts - colonCount)</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  replacementCount = parts - colonCount
  replacement = <span class="hljs-string">':'</span>
  <span class="hljs-keyword">while</span> replacementCount--
    replacement += <span class="hljs-string">'0:'</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>Insert the missing zeroes</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  string = string.replace(<span class="hljs-string">'::'</span>, replacement)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>Trim any garbage which may be hanging around if :: was at the edge in
the source string</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  string = string[<span class="hljs-number">1.</span>.<span class="hljs-number">-1</span>] <span class="hljs-keyword">if</span> string[<span class="hljs-number">0</span>] == <span class="hljs-string">':'</span>
  string = string[<span class="hljs-number">0.</span>.<span class="hljs-number">-2</span>] <span class="hljs-keyword">if</span> string[string.length<span class="hljs-number">-1</span>] == <span class="hljs-string">':'</span>

  <span class="hljs-keyword">return</span> (parseInt(part, <span class="hljs-number">16</span>) <span class="hljs-keyword">for</span> part <span class="hljs-keyword">in</span> string.split(<span class="hljs-string">":"</span>))

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>Parse an IPv6 address.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr.IPv6.parser = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
  <span class="hljs-keyword">if</span> string.match(ipv6Regexes[<span class="hljs-string">'native'</span>])
    <span class="hljs-keyword">return</span> expandIPv6(string, <span class="hljs-number">8</span>)

  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> match = string.match(ipv6Regexes[<span class="hljs-string">'transitional'</span>])
    parts = expandIPv6(match[<span class="hljs-number">1</span>][<span class="hljs-number">0.</span>.<span class="hljs-number">-2</span>], <span class="hljs-number">6</span>)
    <span class="hljs-keyword">if</span> parts
      octets = [parseInt(match[<span class="hljs-number">2</span>]), parseInt(match[<span class="hljs-number">3</span>]),
                parseInt(match[<span class="hljs-number">4</span>]), parseInt(match[<span class="hljs-number">5</span>])]
      <span class="hljs-keyword">for</span> octet <span class="hljs-keyword">in</span> octets
        <span class="hljs-keyword">if</span> !(<span class="hljs-number">0</span> &lt;= octet &lt;= <span class="hljs-number">255</span>)
          <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

      parts.push(octets[<span class="hljs-number">0</span>] &lt;&lt; <span class="hljs-number">8</span> | octets[<span class="hljs-number">1</span>])
      parts.push(octets[<span class="hljs-number">2</span>] &lt;&lt; <span class="hljs-number">8</span> | octets[<span class="hljs-number">3</span>])
      <span class="hljs-keyword">return</span> parts

  <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>Checks if a given string is formatted like IPv4/IPv6 address.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr.IPv4.isIPv4 = ipaddr.IPv6.isIPv6 = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
  <span class="hljs-keyword">return</span> @parser(string) != <span class="hljs-literal">null</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>Checks if a given string is a valid IPv4/IPv6 address.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr.IPv4.isValid = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
  <span class="hljs-keyword">try</span>
    <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>(@parser(string))
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">catch</span> e
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

ipaddr.IPv4.isValidFourPartDecimal = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
  <span class="hljs-keyword">if</span> ipaddr.IPv4.isValid(string) <span class="hljs-keyword">and</span> string.match(<span class="hljs-regexp">/^\d+(\.\d+){3}$/</span>)
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

ipaddr.IPv6.isValid = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<p>Since IPv6.isValid is always called first, this shortcut
provides a substantial performance gain.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">  <span class="hljs-keyword">if</span> <span class="hljs-keyword">typeof</span> string == <span class="hljs-string">"string"</span> <span class="hljs-keyword">and</span> string.indexOf(<span class="hljs-string">":"</span>) == <span class="hljs-number">-1</span>
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

  <span class="hljs-keyword">try</span>
    <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>(@parser(string))
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>
  <span class="hljs-keyword">catch</span> e
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<p>Tries to parse and validate a string with IPv4/IPv6 address.
Throws an error if it fails.</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr.IPv4.parse = ipaddr.IPv6.parse = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
  parts = @parser(string)
  <span class="hljs-keyword">if</span> parts == <span class="hljs-literal">null</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: string is not formatted like ip address"</span>

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">this</span>(parts)

ipaddr.IPv4.parseCIDR = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
  <span class="hljs-keyword">if</span> match = string.match(<span class="hljs-regexp">/^(.+)\/(\d+)$/</span>)
    maskLength = parseInt(match[<span class="hljs-number">2</span>])
    <span class="hljs-keyword">if</span> maskLength &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> maskLength &lt;= <span class="hljs-number">32</span>
      <span class="hljs-keyword">return</span> [@parse(match[<span class="hljs-number">1</span>]), maskLength]

  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: string is not formatted like an IPv4 CIDR range"</span>

ipaddr.IPv6.parseCIDR = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
  <span class="hljs-keyword">if</span> match = string.match(<span class="hljs-regexp">/^(.+)\/(\d+)$/</span>)
    maskLength = parseInt(match[<span class="hljs-number">2</span>])
    <span class="hljs-keyword">if</span> maskLength &gt;= <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> maskLength &lt;= <span class="hljs-number">128</span>
      <span class="hljs-keyword">return</span> [@parse(match[<span class="hljs-number">1</span>]), maskLength]

  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: string is not formatted like an IPv6 CIDR range"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>Checks if the address is valid IP address</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr.isValid = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
  <span class="hljs-keyword">return</span> ipaddr.IPv6.isValid(string) || ipaddr.IPv4.isValid(string)

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>Try to parse an address and throw an error if it is impossible</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr.parse = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
  <span class="hljs-keyword">if</span> ipaddr.IPv6.isValid(string)
    <span class="hljs-keyword">return</span> ipaddr.IPv6.parse(string)
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ipaddr.IPv4.isValid(string)
    <span class="hljs-keyword">return</span> ipaddr.IPv4.parse(string)
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: the address has neither IPv6 nor IPv4 format"</span>

ipaddr.parseCIDR = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
  <span class="hljs-keyword">try</span>
    <span class="hljs-keyword">return</span> ipaddr.IPv6.parseCIDR(string)
  <span class="hljs-keyword">catch</span> e
    <span class="hljs-keyword">try</span>
      <span class="hljs-keyword">return</span> ipaddr.IPv4.parseCIDR(string)
    <span class="hljs-keyword">catch</span> e
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: the address has neither IPv6 nor IPv4 CIDR format"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<p>Try to parse an array in network order (MSB first) for IPv4 and IPv6</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr.fromByteArray = <span class="hljs-function"><span class="hljs-params">(bytes)</span> -&gt;</span>
  length = bytes.length
  <span class="hljs-keyword">if</span> length == <span class="hljs-number">4</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ipaddr.IPv4(bytes)
  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> length == <span class="hljs-number">16</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> ipaddr.IPv6(bytes)
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Error <span class="hljs-string">"ipaddr: the binary input is neither an IPv6 nor IPv4 address"</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<p>Parse an address and return plain IPv4 address if it is an IPv4-mapped address</p>

        </td>
        <td class="code highlight">
          <pre class="coffeescript">ipaddr.process = <span class="hljs-function"><span class="hljs-params">(string)</span> -&gt;</span>
  addr = @parse(string)
  <span class="hljs-keyword">if</span> addr.kind() == <span class="hljs-string">'ipv6'</span> &amp;&amp; addr.isIPv4MappedAddress()
    <span class="hljs-keyword">return</span> addr.toIPv4Address()
  <span class="hljs-keyword">else</span>
    <span class="hljs-keyword">return</span> addr

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
