<!DOCTYPE html>
<html>
<head>
  <title>sf.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/sf/sf.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>sf.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-meta">'use strict'</span>;

<span class="hljs-keyword">var</span> shortDays = [<span class="hljs-string">'Sun'</span>, <span class="hljs-string">'Mon'</span>, <span class="hljs-string">'Tue'</span>, <span class="hljs-string">'Wed'</span>, <span class="hljs-string">'Thu'</span>, <span class="hljs-string">'Fri'</span>, <span class="hljs-string">'Sat'</span>];
<span class="hljs-keyword">var</span> days = [<span class="hljs-string">'Sunday'</span>, <span class="hljs-string">'Monday'</span>, <span class="hljs-string">'Tuesday'</span>, <span class="hljs-string">'Wednesday'</span>, <span class="hljs-string">'Thursday'</span>, <span class="hljs-string">'Friday'</span>, <span class="hljs-string">'Saturday'</span>];
<span class="hljs-keyword">var</span> shortMonths = [<span class="hljs-string">'Jan'</span>, <span class="hljs-string">'Feb'</span>, <span class="hljs-string">'Mar'</span>, <span class="hljs-string">'Apr'</span>, <span class="hljs-string">'May'</span>, <span class="hljs-string">'Jun'</span>, <span class="hljs-string">'Jul'</span>, <span class="hljs-string">'Aug'</span>, <span class="hljs-string">'Sep'</span>, <span class="hljs-string">'Oct'</span>, <span class="hljs-string">'Nov'</span>, <span class="hljs-string">'Dec'</span>];
<span class="hljs-keyword">var</span> months = [<span class="hljs-string">'January'</span>, <span class="hljs-string">'February'</span>, <span class="hljs-string">'March'</span>, <span class="hljs-string">'April'</span>, <span class="hljs-string">'May'</span>, <span class="hljs-string">'June'</span>, <span class="hljs-string">'July'</span>, <span class="hljs-string">'August'</span>, <span class="hljs-string">'September'</span>, <span class="hljs-string">'October'</span>, <span class="hljs-string">'November'</span>, <span class="hljs-string">'December'</span>];

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">padLeft</span>(<span class="hljs-params">str, char, totalWidth</span>) </span>{
  <span class="hljs-keyword">while</span> (str.length &lt; totalWidth) {
    str = char + str;
  }
  <span class="hljs-keyword">return</span> str;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">padRight</span>(<span class="hljs-params">str, char, totalWidth</span>) </span>{
  <span class="hljs-keyword">while</span> (str.length &lt; totalWidth) {
    str = str + char;
  }
  <span class="hljs-keyword">return</span> str;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatNumber</span>(<span class="hljs-params">num, format</span>) </span>{
  format = format || <span class="hljs-string">"0"</span>;

  <span class="hljs-keyword">var</span> hex = format.match(<span class="hljs-regexp">/^([xX])([0-9]*)$/</span>);
  <span class="hljs-keyword">if</span> (hex) {
    <span class="hljs-keyword">var</span> str = num.toString(<span class="hljs-number">16</span>);
    <span class="hljs-keyword">if</span> (hex[<span class="hljs-number">1</span>] == <span class="hljs-string">'x'</span>) {
      str = str.toLowerCase();
    } <span class="hljs-keyword">else</span> {
      str = str.toUpperCase();
    }
    <span class="hljs-keyword">var</span> width = <span class="hljs-built_in">parseInt</span>(hex[<span class="hljs-number">2</span>]);
    str = padLeft(str, <span class="hljs-string">'0'</span>, width);
    <span class="hljs-keyword">return</span> str;
  }

  <span class="hljs-keyword">var</span> negative = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (num &lt; <span class="hljs-number">0</span>) {
    num = -num;
    negative = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">var</span> addPositiveSign = <span class="hljs-literal">false</span>;
  <span class="hljs-keyword">if</span> (format.match(<span class="hljs-regexp">/^\+/</span>)) {
    format = format.substr(<span class="hljs-number">1</span>);
    addPositiveSign = <span class="hljs-literal">true</span>;
  }

  <span class="hljs-keyword">var</span> formatParts = format.split(<span class="hljs-string">'.'</span>);
  <span class="hljs-keyword">var</span> formatBeforeDecimal = formatParts[<span class="hljs-number">0</span>];
  <span class="hljs-keyword">var</span> wholeNumber = <span class="hljs-built_in">Math</span>.floor(num);
  <span class="hljs-keyword">var</span> decimalVal = num - wholeNumber;
  <span class="hljs-keyword">var</span> result = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">var</span> wholeNumberStr = wholeNumber.toString();
  <span class="hljs-keyword">var</span> formatIdx, numberIdx;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>format whole number part</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">for</span> (formatIdx = formatBeforeDecimal.length - <span class="hljs-number">1</span>, numberIdx = wholeNumberStr.length - <span class="hljs-number">1</span>; numberIdx &gt;= <span class="hljs-number">0</span> || formatIdx &gt;= <span class="hljs-number">0</span>; formatIdx--) {
    <span class="hljs-keyword">if</span> (formatIdx &lt; <span class="hljs-number">0</span> &amp;&amp; numberIdx &gt;= <span class="hljs-number">0</span>) {
      result = wholeNumberStr[numberIdx--] + result;
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-keyword">if</span> (formatBeforeDecimal[formatIdx] == <span class="hljs-string">'0'</span> || formatBeforeDecimal[formatIdx] == <span class="hljs-string">'#'</span>) {
      <span class="hljs-keyword">if</span> (numberIdx &gt;= <span class="hljs-number">0</span>) {
        result = wholeNumberStr[numberIdx--] + result;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (formatBeforeDecimal[formatIdx] == <span class="hljs-string">'#'</span>) {
          <span class="hljs-keyword">break</span>;
        }
        result = <span class="hljs-string">'0'</span> + result;
      }
      <span class="hljs-keyword">continue</span>;
    }

    result = formatBeforeDecimal[formatIdx] + result;
  }
  result = result.replace(<span class="hljs-regexp">/^[^0-9]+/</span>, <span class="hljs-string">''</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>format decimal part</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">  <span class="hljs-keyword">if</span> (formatParts.length &gt; <span class="hljs-number">1</span>) {
    <span class="hljs-keyword">var</span> formatAfterDecimal = formatParts[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">var</span> decimalValStr = decimalVal.toString().substr(<span class="hljs-number">2</span>);

    result += <span class="hljs-string">'.'</span>;
    <span class="hljs-keyword">for</span> (formatIdx = <span class="hljs-number">0</span>, numberIdx = <span class="hljs-number">0</span>; formatIdx &lt; formatAfterDecimal.length; formatIdx++) {
      <span class="hljs-keyword">if</span> (formatAfterDecimal[formatIdx] == <span class="hljs-string">'0'</span> || formatAfterDecimal[formatIdx] == <span class="hljs-string">'#'</span>) {
        <span class="hljs-keyword">if</span> (numberIdx &lt; decimalValStr.length) {
          result += decimalValStr[numberIdx++];
        } <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (formatAfterDecimal[formatIdx] == <span class="hljs-string">'#'</span>) {
            <span class="hljs-keyword">break</span>;
          }
          result += <span class="hljs-string">'0'</span>;
        }
      } <span class="hljs-keyword">else</span> {
        result += formatAfterDecimal[formatIdx];
      }
    }
  }

  <span class="hljs-keyword">if</span> (result[result.length - <span class="hljs-number">1</span>] == <span class="hljs-string">'.'</span>) {
    result = result.substr(<span class="hljs-number">0</span>, result.length - <span class="hljs-number">1</span>);
  }

  <span class="hljs-keyword">if</span> (negative) {
    result = <span class="hljs-string">'-'</span> + result;
  }
  <span class="hljs-keyword">if</span> (!negative &amp;&amp; addPositiveSign) {
    result = <span class="hljs-string">'+'</span> + result;
  }

  <span class="hljs-keyword">return</span> result;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatTimeSpanPart</span>(<span class="hljs-params">timeSpan, format, width</span>) </span>{
  <span class="hljs-keyword">var</span> formatStr = <span class="hljs-string">"{0:"</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; width; i++) {
    formatStr += <span class="hljs-string">'0'</span>;
  }
  formatStr += <span class="hljs-string">"}"</span>;

  <span class="hljs-keyword">switch</span> (format) {
  <span class="hljs-keyword">case</span> <span class="hljs-string">'y'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.years);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'M'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.months);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'d'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.days);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'h'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.hours);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'m'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.minutes);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'s'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.seconds);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'f'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.milliseconds);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'^y'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.totalYears);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'^M'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.totalMonths);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'^d'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.totalDays);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'^h'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.totalHours);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'^m'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.totalMinutes);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'^s'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.totalSeconds);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'^f'</span>:
    <span class="hljs-keyword">return</span> sf(formatStr, timeSpan.totalMilliseconds);
  <span class="hljs-keyword">default</span>:
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"unhandled time span format '"</span> + format + <span class="hljs-string">"'"</span>);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatTimeSpan</span>(<span class="hljs-params">timespan, format</span>) </span>{
  <span class="hljs-keyword">if</span> (!format || format === <span class="hljs-string">''</span>) {
    <span class="hljs-keyword">return</span> timespan.toString();
  }

  <span class="hljs-keyword">var</span> formats = [
    <span class="hljs-string">'y'</span>,
    <span class="hljs-string">'M'</span>,
    <span class="hljs-string">'d'</span>,
    <span class="hljs-string">'h'</span>,
    <span class="hljs-string">'m'</span>,
    <span class="hljs-string">'s'</span>,
    <span class="hljs-string">'f'</span>
  ];
  <span class="hljs-keyword">var</span> result = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">var</span> totalCount;
  <span class="hljs-keyword">while</span> (format.length &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span> (format[<span class="hljs-number">0</span>] === <span class="hljs-string">"'"</span>) {
      <span class="hljs-keyword">var</span> nextTick = format.indexOf(<span class="hljs-string">"'"</span>, <span class="hljs-number">1</span>);
      result += format.substring(<span class="hljs-number">1</span>, nextTick);
      format = format.substring(nextTick + <span class="hljs-number">1</span>);
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-keyword">if</span> (format.length &gt; <span class="hljs-number">1</span> &amp;&amp; format[<span class="hljs-number">0</span>] === <span class="hljs-string">'^'</span>) {
      totalCount = <span class="hljs-literal">true</span>;
      format = format.substring(<span class="hljs-number">1</span>);
    } <span class="hljs-keyword">else</span> {
      totalCount = <span class="hljs-literal">false</span>;
    }

    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; formats.length; i++) {
      <span class="hljs-keyword">if</span> (format.indexOf(formats[i]) === <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">var</span> width = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (format.indexOf(formats[i]) === <span class="hljs-number">0</span>) {
          width++;
          format = format.substring(formats[i].length);
        }
        result += formatTimeSpanPart(timespan, (totalCount ? <span class="hljs-string">'^'</span> : <span class="hljs-string">''</span>) + formats[i], width);
        <span class="hljs-keyword">break</span>;
      }
    }
    <span class="hljs-keyword">if</span> (i &lt; formats.length) {
      <span class="hljs-keyword">continue</span>;
    }

    result += format[<span class="hljs-number">0</span>];
    format = format.substring(<span class="hljs-number">1</span>);
  }
  <span class="hljs-keyword">return</span> result;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatDatePart</span>(<span class="hljs-params">date, format</span>) </span>{
  <span class="hljs-keyword">switch</span> (format) {
  <span class="hljs-keyword">case</span> <span class="hljs-string">'sd'</span>: <span class="hljs-comment">// Short date - 10/12/2002</span>
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:M}/{0:d}/{0:yyyy}"</span>, date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'D'</span>: <span class="hljs-comment">// Long date - December 10, 2002</span>
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:MMMM} {0:dd}, {0:yyyy}"</span>, date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'t'</span>: <span class="hljs-comment">// Short time - 10:11 PM</span>
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:hh}:{0:mm} {0:tt}"</span>, date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'T'</span>: <span class="hljs-comment">// Long time - 10:11:29 PM</span>
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:hh}:{0:mm}:{0:ss} {0:tt}"</span>, date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'fdt'</span>: <span class="hljs-comment">// Full date &amp; time - December 10, 2002 10:11 PM</span>
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:D} {0:t}"</span>, date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'F'</span>: <span class="hljs-comment">// Full date &amp; time (long) - December 10, 2002 10:11:29 PM</span>
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:D} {0:T}"</span>, date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'g'</span>: <span class="hljs-comment">// Default date &amp; time - 10/12/2002 10:11 PM</span>
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:sd} {0:t}"</span>, date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'G'</span>: <span class="hljs-comment">// Default date &amp; time (long) - 10/12/2002 10:11:29 PM</span>
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:sd} {0:T}"</span>, date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'md'</span>: <span class="hljs-comment">// Month day pattern - December 10</span>
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:MMMM} {0:dd}"</span>, date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'r'</span>: <span class="hljs-comment">// RFC1123 date string - Tue, 10 Dec 2002 22:11:29 +0500</span>
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:ddd}, {0:dd} {0:MMM} {0:yyyy} {0:HH}:{0:mm}:{0:ss} {0:+zzzz}"</span>, date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'s'</span>: <span class="hljs-comment">// Sortable date string - 2002-12-10T22:11:29</span>
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:yyyy}-{0:MM}-{0:dd}:{0:HH}:{0:mm}:{0:ss}"</span>, date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'d'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:#0}"</span>, date.getDate());
  <span class="hljs-keyword">case</span> <span class="hljs-string">'dd'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:00}"</span>, date.getDate());
  <span class="hljs-keyword">case</span> <span class="hljs-string">'ddd'</span>:
    <span class="hljs-keyword">return</span> shortDays[date.getDay()];
  <span class="hljs-keyword">case</span> <span class="hljs-string">'dddd'</span>:
    <span class="hljs-keyword">return</span> days[date.getDay()];
  <span class="hljs-keyword">case</span> <span class="hljs-string">'f'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:0}"</span>, date.getMilliseconds() / <span class="hljs-number">100.0</span>);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'ff'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:00}"</span>, date.getMilliseconds() / <span class="hljs-number">10.0</span>);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'fff'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:000}"</span>, date.getMilliseconds() / <span class="hljs-number">1.0</span>);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'h'</span>:
    <span class="hljs-keyword">var</span> hours_h = date.getHours() % <span class="hljs-number">12</span>;
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:#0}"</span>, hours_h == <span class="hljs-number">0</span> ? <span class="hljs-number">12</span> : hours_h);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'hh'</span>:
    <span class="hljs-keyword">var</span> hours_hh = date.getHours() % <span class="hljs-number">12</span>;
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:00}"</span>, hours_hh == <span class="hljs-number">0</span> ? <span class="hljs-number">12</span> : hours_hh);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'H'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:#0}"</span>, date.getHours());
  <span class="hljs-keyword">case</span> <span class="hljs-string">'HH'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:00}"</span>, date.getHours());
  <span class="hljs-keyword">case</span> <span class="hljs-string">'mm'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:00}"</span>, date.getMinutes());
  <span class="hljs-keyword">case</span> <span class="hljs-string">'M'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:#0}"</span>, date.getMonth() + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'MM'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:00}"</span>, date.getMonth() + <span class="hljs-number">1</span>);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'MMM'</span>:
    <span class="hljs-keyword">return</span> shortMonths[date.getMonth()];
  <span class="hljs-keyword">case</span> <span class="hljs-string">'MMMM'</span>:
    <span class="hljs-keyword">return</span> months[date.getMonth()];
  <span class="hljs-keyword">case</span> <span class="hljs-string">'ss'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:00}"</span>, date.getSeconds());
  <span class="hljs-keyword">case</span> <span class="hljs-string">'tt'</span>:
    <span class="hljs-keyword">return</span> date.getHours() &gt;= <span class="hljs-number">12</span> ? <span class="hljs-string">'PM'</span> : <span class="hljs-string">'AM'</span>;
  <span class="hljs-keyword">case</span> <span class="hljs-string">'yy'</span>:
    <span class="hljs-keyword">return</span> getYear(date).toString().substr(<span class="hljs-number">2</span>);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'yyyy'</span>:
    <span class="hljs-keyword">return</span> getYear(date);
  <span class="hljs-keyword">case</span> <span class="hljs-string">'zz'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:00}"</span>, <span class="hljs-built_in">Math</span>.floor(date.getTimezoneOffset() / <span class="hljs-number">60</span>));
  <span class="hljs-keyword">case</span> <span class="hljs-string">'+zz'</span>:
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:+00}"</span>, <span class="hljs-built_in">Math</span>.floor(date.getTimezoneOffset() / <span class="hljs-number">60</span>));
  <span class="hljs-keyword">case</span> <span class="hljs-string">'zzz'</span>:
    <span class="hljs-keyword">var</span> wholeTimezoneOffset = <span class="hljs-built_in">Math</span>.floor(date.getTimezoneOffset() / <span class="hljs-number">60</span>);
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:00}:{1:00}"</span>, wholeTimezoneOffset, date.getTimezoneOffset() - (wholeTimezoneOffset * <span class="hljs-number">60</span>));
  <span class="hljs-keyword">case</span> <span class="hljs-string">'zzzz'</span>:
    <span class="hljs-keyword">var</span> wholeTimezoneOffset = <span class="hljs-built_in">Math</span>.floor(date.getTimezoneOffset() / <span class="hljs-number">60</span>);
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:00}{1:00}"</span>, wholeTimezoneOffset, date.getTimezoneOffset() - (wholeTimezoneOffset * <span class="hljs-number">60</span>));
  <span class="hljs-keyword">case</span> <span class="hljs-string">'+zzzz'</span>:
    <span class="hljs-keyword">var</span> wholeTimezoneOffset = <span class="hljs-built_in">Math</span>.floor(date.getTimezoneOffset() / <span class="hljs-number">60</span>);
    <span class="hljs-keyword">return</span> sf(<span class="hljs-string">"{0:+00}{1:00}"</span>, wholeTimezoneOffset, date.getTimezoneOffset() - (wholeTimezoneOffset * <span class="hljs-number">60</span>));
  <span class="hljs-keyword">default</span>:
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"unhandled date format '"</span> + format + <span class="hljs-string">"'"</span>);
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getYear</span>(<span class="hljs-params">date</span>) </span>{
  <span class="hljs-keyword">return</span> date.getYear() + <span class="hljs-number">1900</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatDate</span>(<span class="hljs-params">date, format</span>) </span>{
  <span class="hljs-keyword">if</span> (!format || format === <span class="hljs-string">''</span>) {
    <span class="hljs-keyword">return</span> date;
  }

  <span class="hljs-keyword">var</span> formats = [
    <span class="hljs-string">'sd'</span>,
    <span class="hljs-string">'fdt'</span>,
    <span class="hljs-string">'md'</span>,
    <span class="hljs-string">'dddd'</span>,
    <span class="hljs-string">'ddd'</span>,
    <span class="hljs-string">'dd'</span>,
    <span class="hljs-string">'d'</span>,
    <span class="hljs-string">'D'</span>,
    <span class="hljs-string">'fff'</span>,
    <span class="hljs-string">'ff'</span>,
    <span class="hljs-string">'f'</span>,
    <span class="hljs-string">'F'</span>,
    <span class="hljs-string">'g'</span>,
    <span class="hljs-string">'G'</span>,
    <span class="hljs-string">'hh'</span>,
    <span class="hljs-string">'h'</span>,
    <span class="hljs-string">'HH'</span>,
    <span class="hljs-string">'H'</span>,
    <span class="hljs-string">'mm'</span>,
    <span class="hljs-string">'MMMM'</span>,
    <span class="hljs-string">'MMM'</span>,
    <span class="hljs-string">'MM'</span>,
    <span class="hljs-string">'M'</span>,
    <span class="hljs-string">'r'</span>,
    <span class="hljs-string">'ss'</span>,
    <span class="hljs-string">'s'</span>,
    <span class="hljs-string">'tt'</span>,
    <span class="hljs-string">'t'</span>,
    <span class="hljs-string">'T'</span>,
    <span class="hljs-string">'yyyy'</span>,
    <span class="hljs-string">'yy'</span>,
    <span class="hljs-string">'+zzzz'</span>,
    <span class="hljs-string">'+zz'</span>,
    <span class="hljs-string">'zzzz'</span>,
    <span class="hljs-string">'zzz'</span>,
    <span class="hljs-string">'zz'</span>
  ];
  <span class="hljs-keyword">var</span> result = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">var</span> i;
  <span class="hljs-keyword">while</span> (format.length &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">if</span> (format[<span class="hljs-number">0</span>] === <span class="hljs-string">"'"</span>) {
      <span class="hljs-keyword">var</span> nextTick = format.indexOf(<span class="hljs-string">"'"</span>, <span class="hljs-number">1</span>);
      result += format.substring(<span class="hljs-number">1</span>, nextTick);
      format = format.substring(nextTick + <span class="hljs-number">1</span>);
      <span class="hljs-keyword">continue</span>;
    }
    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; formats.length; i++) {
      <span class="hljs-keyword">if</span> (format.indexOf(formats[i]) === <span class="hljs-number">0</span>) {
        result += formatDatePart(date, formats[i]);
        format = format.substring(formats[i].length);
        <span class="hljs-keyword">break</span>;
      }
    }
    <span class="hljs-keyword">if</span> (i &lt; formats.length) {
      <span class="hljs-keyword">continue</span>;
    }

    result += format[<span class="hljs-number">0</span>];
    format = format.substring(<span class="hljs-number">1</span>);
  }
  <span class="hljs-keyword">return</span> result;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatObjectIndent</span>(<span class="hljs-params">obj</span>) </span>{
  <span class="hljs-keyword">if</span> (!obj) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">'null'</span>;
  }
  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span>(obj) != <span class="hljs-string">'object'</span>) {
    <span class="hljs-keyword">return</span> obj.toString();
  }
  <span class="hljs-keyword">var</span> results = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">var</span> keys = <span class="hljs-built_in">Object</span>.keys(obj).sort();
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; keys.length; i++) {
    results += keys[i] + <span class="hljs-string">":"</span>;
    <span class="hljs-keyword">var</span> val = obj[keys[i]];
    <span class="hljs-keyword">if</span> (!val) {
      results += <span class="hljs-string">'\n'</span>;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> Buffer) {
      <span class="hljs-keyword">var</span> bufferContent = <span class="hljs-string">''</span>;
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> bufferIdx = <span class="hljs-number">0</span>; bufferIdx &lt; val.length; bufferIdx++) {
        <span class="hljs-keyword">if</span> (bufferIdx !== <span class="hljs-number">0</span>) {
          bufferContent += <span class="hljs-string">', '</span>;
        }
        <span class="hljs-keyword">if</span> (bufferIdx &gt;= <span class="hljs-number">10</span>) {
          bufferContent += <span class="hljs-string">'...'</span>;
          <span class="hljs-keyword">break</span>;
        }
        bufferContent += val[bufferIdx];
      }
      results += <span class="hljs-string">' Buffer['</span> + bufferContent + <span class="hljs-string">'] (length: '</span> + val.length + <span class="hljs-string">')\n'</span>;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Date</span> || isTimezoneJsDate(val)) {
      results += <span class="hljs-string">" "</span> + formatDate(val, <span class="hljs-string">'r'</span>) + <span class="hljs-string">"\n"</span>;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span>(val) === <span class="hljs-string">'string'</span> || <span class="hljs-keyword">typeof</span>(val) === <span class="hljs-string">'number'</span> || <span class="hljs-keyword">typeof</span>(val) === <span class="hljs-string">'boolean'</span>) {
      results += <span class="hljs-string">" "</span> + val + <span class="hljs-string">"\n"</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">var</span> str = formatObjectIndent(val);
      results += <span class="hljs-string">"\n"</span> + sf.indent(str, {}) + <span class="hljs-string">"\n"</span>;
    }
  }
  results = results.replace(<span class="hljs-regexp">/\s+$/</span>, <span class="hljs-string">''</span>);
  <span class="hljs-keyword">return</span> results;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatObject</span>(<span class="hljs-params">obj, format</span>) </span>{
  <span class="hljs-keyword">if</span> (!format || format === <span class="hljs-string">''</span>) {
    <span class="hljs-keyword">return</span> obj;
  }

  <span class="hljs-keyword">if</span> (format == <span class="hljs-string">'inspect'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">require</span>(<span class="hljs-string">'util'</span>).inspect(obj);
  }

  <span class="hljs-keyword">if</span> (format == <span class="hljs-string">'json'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(obj);
  }

  <span class="hljs-keyword">if</span> (format == <span class="hljs-string">'indent'</span>) {
    <span class="hljs-keyword">return</span> formatObjectIndent(obj);
  }

  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"unhandled format: "</span> + format);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formatError</span>(<span class="hljs-params">err, format</span>) </span>{
  <span class="hljs-keyword">if</span> (!format || format === <span class="hljs-string">''</span>) {
    <span class="hljs-keyword">return</span> err.stack;
  }

  <span class="hljs-keyword">if</span> (format == <span class="hljs-string">'message'</span>) {
    <span class="hljs-keyword">return</span> err.message;
  }

  <span class="hljs-keyword">return</span> formatObject(err, format);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">align</span>(<span class="hljs-params">str, val</span>) </span>{
  str = str || <span class="hljs-string">''</span>;
  <span class="hljs-keyword">if</span> (val &lt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> padRight(str, <span class="hljs-string">' '</span>, <span class="hljs-built_in">Math</span>.abs(val));
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val &gt; <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> padLeft(str, <span class="hljs-string">' '</span>, val);
  }
  <span class="hljs-keyword">return</span> str;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">splitFieldName</span>(<span class="hljs-params">fieldName</span>) </span>{
  <span class="hljs-keyword">var</span> results = [];
  <span class="hljs-keyword">var</span> part = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; fieldName.length;) {
    <span class="hljs-keyword">if</span> (fieldName[i] == <span class="hljs-string">'.'</span>) {
      results.push(part);
      part = <span class="hljs-string">''</span>;
      i++;
      <span class="hljs-keyword">continue</span>;
    }

    <span class="hljs-keyword">if</span> (fieldName[i] == <span class="hljs-string">'['</span>) {
      results.push(part);
      part = <span class="hljs-string">'['</span>;
      i++;
      <span class="hljs-keyword">continue</span>;
    }

    part += fieldName[i++];
  }
  results.push(part);
  <span class="hljs-keyword">return</span> results;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getValue</span>(<span class="hljs-params">args, fieldName</span>) </span>{
  <span class="hljs-keyword">var</span> fieldIndex = <span class="hljs-built_in">parseInt</span>(fieldName);
  <span class="hljs-keyword">if</span> (fieldIndex.toString() === fieldName) {
    <span class="hljs-keyword">return</span> args[fieldIndex + <span class="hljs-number">1</span>];
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">var</span> parts = splitFieldName(fieldName);
    <span class="hljs-keyword">var</span> root = args[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; parts.length; i++) {
      <span class="hljs-keyword">var</span> part = parts[i];

      <span class="hljs-keyword">if</span> (part.length &gt;= <span class="hljs-number">1</span> &amp;&amp; part[<span class="hljs-number">0</span>] == <span class="hljs-string">'?'</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span>(root) == <span class="hljs-string">'undefined'</span>) {
          <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;
        } <span class="hljs-keyword">else</span> {
          part = part.substr(<span class="hljs-number">1</span>);
        }
      }

      <span class="hljs-keyword">if</span> (part.length &gt;= <span class="hljs-number">1</span> &amp;&amp; part[<span class="hljs-number">0</span>] == <span class="hljs-string">'['</span>) {
        part = part.substr(<span class="hljs-number">1</span>, part.length - <span class="hljs-number">2</span>);
        <span class="hljs-keyword">var</span> strMatch = part.match(<span class="hljs-regexp">/^['"](.*)['"]$/</span>);
        <span class="hljs-keyword">if</span> (strMatch) {
          root = root[strMatch[<span class="hljs-number">1</span>]];
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (part &lt; <span class="hljs-number">0</span>) {
          part = -part;
          root = root[root.length - part];
        } <span class="hljs-keyword">else</span> {
          root = root[part];
        }
        <span class="hljs-keyword">continue</span>;
      }

      root = root[part];
    }
    <span class="hljs-keyword">return</span> root;
  }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sf</span>(<span class="hljs-params">formatString</span>) </span>{
  <span class="hljs-keyword">var</span> result = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; formatString.length;) {
    <span class="hljs-keyword">if</span> (formatString[i] == <span class="hljs-string">'}'</span>) {
      i++;
      <span class="hljs-keyword">if</span> (formatString[i] == <span class="hljs-string">'}'</span>) {
        result += <span class="hljs-string">'}'</span>;
        i++;
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Unescaped substitution"</span>);
    }
    <span class="hljs-keyword">if</span> (formatString[i] == <span class="hljs-string">'{'</span>) {
      <span class="hljs-keyword">var</span> spec = <span class="hljs-string">''</span>;
      i++;
      <span class="hljs-keyword">if</span> (formatString[i] == <span class="hljs-string">'{'</span>) {
        result += <span class="hljs-string">'{'</span>;
        i++;
        <span class="hljs-keyword">continue</span>;
      }
      <span class="hljs-keyword">for</span> (; i &lt; formatString.length;) {
        <span class="hljs-keyword">if</span> (formatString[i] == <span class="hljs-string">'}'</span>) {
          <span class="hljs-keyword">break</span>;
        }
        spec += formatString[i++];
      }
      <span class="hljs-keyword">if</span> (i == formatString.length) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"Unterminated substitution"</span>);
      }
      i++;
      <span class="hljs-keyword">var</span> alignTokenLoc = spec.indexOf(<span class="hljs-string">','</span>);
      <span class="hljs-keyword">var</span> specTokenLoc;
      <span class="hljs-keyword">var</span> alignVal = <span class="hljs-number">0</span>;
      <span class="hljs-keyword">if</span> (alignTokenLoc &gt; <span class="hljs-number">0</span>) {
        specTokenLoc = spec.indexOf(<span class="hljs-string">':'</span>);
        <span class="hljs-keyword">if</span> (specTokenLoc &gt; <span class="hljs-number">0</span>) {
          <span class="hljs-keyword">if</span> (alignTokenLoc &lt; specTokenLoc) {
            alignVal = spec.substr(alignTokenLoc + <span class="hljs-number">1</span>, specTokenLoc - alignTokenLoc - <span class="hljs-number">1</span>);
            spec = spec.substr(<span class="hljs-number">0</span>, alignTokenLoc) + spec.substr(specTokenLoc);
          }
        } <span class="hljs-keyword">else</span> {
          alignVal = spec.substr(alignTokenLoc + <span class="hljs-number">1</span>);
          spec = spec.substr(<span class="hljs-number">0</span>, alignTokenLoc);
        }
      }

      specTokenLoc = spec.indexOf(<span class="hljs-string">':'</span>);
      <span class="hljs-keyword">var</span> fieldName, formatSpec;
      <span class="hljs-keyword">if</span> (specTokenLoc &gt; <span class="hljs-number">0</span>) {
        fieldName = spec.substr(<span class="hljs-number">0</span>, specTokenLoc);
        formatSpec = spec.substr(specTokenLoc + <span class="hljs-number">1</span>);
      } <span class="hljs-keyword">else</span> {
        fieldName = spec;
        formatSpec = <span class="hljs-literal">null</span>;
      }
      <span class="hljs-keyword">var</span> val = getValue(<span class="hljs-built_in">arguments</span>, fieldName);

      <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> sf.TimeSpan) {
        result += align(formatTimeSpan(val, formatSpec), alignVal);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span>(val) === <span class="hljs-string">'number'</span>) {
        result += align(formatNumber(val, formatSpec), alignVal);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Date</span> || isTimezoneJsDate(val)) {
        result += align(formatDate(val, formatSpec), alignVal);
      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (val <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Error</span>) {
        result += align(formatError(val, formatSpec), alignVal);
      } <span class="hljs-keyword">else</span> {
        result += align(formatObject(val, formatSpec), alignVal);
      }
    } <span class="hljs-keyword">else</span> {
      result += formatString[i++];
    }
  }
  <span class="hljs-keyword">return</span> result;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isTimezoneJsDate</span>(<span class="hljs-params">date</span>) </span>{
  <span class="hljs-keyword">return</span> date &amp;&amp; date.hasOwnProperty(<span class="hljs-string">'timezone'</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getStringLength</span>(<span class="hljs-params">str, options</span>) </span>{
  options.tabWidth = options.tabWidth || <span class="hljs-number">4</span>;

  <span class="hljs-keyword">var</span> tabStr = padLeft(<span class="hljs-string">''</span>, <span class="hljs-string">' '</span>, options.tabWidth);
  str = str.replace(<span class="hljs-regexp">/\t/g</span>, tabStr);
  <span class="hljs-keyword">return</span> str.length;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isSpace</span>(<span class="hljs-params">char</span>) </span>{
  <span class="hljs-keyword">if</span> (char.match(<span class="hljs-regexp">/\s/</span>)) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isSplitable</span>(<span class="hljs-params">char</span>) </span>{
  <span class="hljs-keyword">if</span> (isSpace(char)) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  <span class="hljs-keyword">if</span> (char == <span class="hljs-string">'('</span> || char == <span class="hljs-string">')'</span> || char == <span class="hljs-string">'.'</span> || char == <span class="hljs-string">','</span> || char == <span class="hljs-string">'?'</span> || char == <span class="hljs-string">'!'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-keyword">if</span> (char &gt;= <span class="hljs-string">'a'</span> &amp;&amp; char &lt;= <span class="hljs-string">'z'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-keyword">if</span> (char &gt;= <span class="hljs-string">'A'</span> &amp;&amp; char &lt;= <span class="hljs-string">'Z'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }
  <span class="hljs-keyword">if</span> (char &gt;= <span class="hljs-string">'0'</span> &amp;&amp; char &lt;= <span class="hljs-string">'9'</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findLastSplit</span>(<span class="hljs-params">line, i</span>) </span>{
  <span class="hljs-keyword">if</span> (i &gt;= line.length) {
    i = line.length - <span class="hljs-number">1</span>;
  }
  <span class="hljs-keyword">while</span> (i &gt; <span class="hljs-number">0</span> &amp;&amp; !isSplitable(line[i])) {
    i--;
  }
  <span class="hljs-keyword">return</span> i;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">findNextSplit</span>(<span class="hljs-params">line, i</span>) </span>{
  <span class="hljs-keyword">while</span> (i &lt; line.length &amp;&amp; !isSplitable(line[i])) {
    i++;
  }
  <span class="hljs-keyword">return</span> i;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">wordWrapLine</span>(<span class="hljs-params">line, options</span>) </span>{
  <span class="hljs-keyword">if</span> (line.length === <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
  }

  options._prefixLength = options._prefixLength || getStringLength(options.prefix, options);

  <span class="hljs-keyword">if</span> (line.length + options._prefixLength &lt; options.wordwrap) {
    <span class="hljs-keyword">return</span> options.prefix + line;
  }

  <span class="hljs-keyword">var</span> i = options._prefixLength + options.wordwrap;
  <span class="hljs-keyword">var</span> lastSplit = findLastSplit(line, i);
  <span class="hljs-keyword">var</span> nextSplit = findNextSplit(line, i);
  <span class="hljs-keyword">var</span> rest;

  <span class="hljs-keyword">if</span> (lastSplit === <span class="hljs-number">0</span> &amp;&amp; (nextSplit + options._prefixLength &gt; options.wordwrap)) {
    rest = wordWrapLine(line.substr(options.wordwrap - options._prefixLength), options);
    <span class="hljs-keyword">if</span> (rest.length &gt; <span class="hljs-number">0</span>) {
      rest = <span class="hljs-string">'\n'</span> + rest;
    }
    <span class="hljs-keyword">return</span> options.prefix + line.substr(<span class="hljs-number">0</span>, options.wordwrap - options._prefixLength) + rest;
  }

  rest = wordWrapLine(line.substr(lastSplit + <span class="hljs-number">1</span>), options);
  <span class="hljs-keyword">if</span> (rest.length &gt; <span class="hljs-number">0</span>) {
    rest = <span class="hljs-string">'\n'</span> + rest;
  }
  <span class="hljs-keyword">if</span> (!isSpace(line[lastSplit])) {
    lastSplit++;
  }
  <span class="hljs-keyword">return</span> options.prefix + line.substr(<span class="hljs-number">0</span>, lastSplit) + rest;
}

sf.indent = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str, options</span>) </span>{
  options = options || {};
  options.prefix = <span class="hljs-string">'prefix'</span> <span class="hljs-keyword">in</span> options ? options.prefix : <span class="hljs-string">'  '</span>;
  options.tabWidth = options.tabWidth || <span class="hljs-number">4</span>;

  options._prefixLength = getStringLength(options.prefix, options);

  <span class="hljs-keyword">if</span> (options.wordwrap) {
    <span class="hljs-keyword">var</span> results = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">var</span> lines = str.split(<span class="hljs-string">'\n'</span>);

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; lines.length; i++) {
      <span class="hljs-keyword">var</span> line = lines[i];
      <span class="hljs-keyword">if</span> (line === <span class="hljs-string">''</span>) {
        results += options.prefix + line + <span class="hljs-string">'\n'</span>;
      } <span class="hljs-keyword">else</span> {
        line = wordWrapLine(line, options) + <span class="hljs-string">'\n'</span>;
      }
      results += line;
    }
    <span class="hljs-keyword">if</span> (results.length &gt; <span class="hljs-number">0</span>) {
      results = results.substr(<span class="hljs-number">0</span>, results.length - <span class="hljs-number">1</span>);
    }
    <span class="hljs-keyword">return</span> results;
  }

  str = str.replace(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">'\n'</span> + options.prefix);
  str = options.prefix + str;
  <span class="hljs-keyword">return</span> str;
};

sf.log = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(sf.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>));
};

sf.info = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.info(sf.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>));
};

sf.warn = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.warn(sf.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>));
};

sf.error = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.error(sf.apply(<span class="hljs-keyword">this</span>, <span class="hljs-built_in">arguments</span>));
};

sf.TimeSpan = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">milliseconds, seconds, minutes, hours, days</span>) </span>{
  <span class="hljs-keyword">var</span> MILLISECONDS = <span class="hljs-number">1</span>;
  <span class="hljs-keyword">var</span> SECOND = MILLISECONDS * <span class="hljs-number">1000</span>;
  <span class="hljs-keyword">var</span> MINUTE = SECOND * <span class="hljs-number">60</span>;
  <span class="hljs-keyword">var</span> HOUR = MINUTE * <span class="hljs-number">60</span>;
  <span class="hljs-keyword">var</span> DAY = HOUR * <span class="hljs-number">24</span>;
  <span class="hljs-keyword">var</span> MONTH = DAY * <span class="hljs-number">30</span>;
  <span class="hljs-keyword">var</span> YEAR = DAY * <span class="hljs-number">365.25</span>;

  seconds = seconds || <span class="hljs-number">0</span>;
  minutes = minutes || <span class="hljs-number">0</span>;
  hours = hours || <span class="hljs-number">0</span>;
  days = days || <span class="hljs-number">0</span>;
  <span class="hljs-keyword">var</span> _ms = milliseconds
              + (SECOND * seconds)
              + (MINUTE * minutes)
              + (HOUR * hours)
    + (DAY * days);

  <span class="hljs-keyword">var</span> remaining = _ms;

  <span class="hljs-keyword">var</span> _years = <span class="hljs-built_in">Math</span>.floor(remaining / YEAR);
  remaining %= YEAR;

  <span class="hljs-keyword">var</span> _months = <span class="hljs-built_in">Math</span>.floor(remaining / MONTH);
  remaining %= MONTH;

  <span class="hljs-keyword">var</span> _days = <span class="hljs-built_in">Math</span>.floor(remaining / DAY);
  remaining %= DAY;

  <span class="hljs-keyword">var</span> _hours = <span class="hljs-built_in">Math</span>.floor(remaining / HOUR);
  remaining %= HOUR;

  <span class="hljs-keyword">var</span> _minutes = <span class="hljs-built_in">Math</span>.floor(remaining / MINUTE);
  remaining %= MINUTE;

  <span class="hljs-keyword">var</span> _seconds = <span class="hljs-built_in">Math</span>.floor(remaining / SECOND);
  remaining %= SECOND;

  <span class="hljs-keyword">var</span> _milliseconds = <span class="hljs-built_in">Math</span>.floor(remaining / MILLISECONDS);
  remaining %= MILLISECONDS;

  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"years"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _years;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"months"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _months;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"days"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _days;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"hours"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _hours;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"minutes"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _minutes;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"seconds"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _seconds;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"milliseconds"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _milliseconds;
  });

  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"totalYears"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _ms / YEAR;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"totalMonths"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _ms / MONTH;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"totalDays"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _ms / DAY;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"totalHours"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _ms / HOUR;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"totalMinutes"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _ms / MINUTE;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"totalSeconds"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _ms / SECOND;
  });
  <span class="hljs-keyword">this</span>.__defineGetter__(<span class="hljs-string">"totalMilliseconds"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _ms;
  });

  <span class="hljs-keyword">this</span>.toString = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> _ms;
  };

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
};

<span class="hljs-keyword">var</span> <span class="hljs-built_in">module</span>;
<span class="hljs-keyword">if</span>(<span class="hljs-built_in">module</span>) {
  <span class="hljs-built_in">module</span>.exports = sf;
}

<span class="hljs-keyword">var</span> <span class="hljs-built_in">window</span>;
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>) {
  define([], <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> sf;
  });
}

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
